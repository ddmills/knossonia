{"version":3,"sources":["webpack://knossonia/./src/index.js","webpack://knossonia/./src/core/Game.js","webpack://knossonia/./src/core/rendering/RenderManager.js","webpack://knossonia/./src/core/Manager.js","webpack://knossonia/./src/core/rendering/Display.js","webpack://knossonia/./src/core/input/InputController.js","webpack://knossonia/./src/core/input/events/InputKeyboardEvent.js","webpack://knossonia/./src/core/input/events/InputEvent.js","webpack://knossonia/./src/core/input/events/InputMouseEvent.js","webpack://knossonia/./src/systems/HungerSystem.js","webpack://knossonia/./src/ecs/components/Actor.js","webpack://knossonia/../node_modules/camelcase/index.js","webpack://knossonia/../src/Properties/Property.js","webpack://knossonia/../src/Properties/SimpleProperty.js","webpack://knossonia/../src/Properties/EntityProperty.js","webpack://knossonia/../src/Properties/EntityArrayProperty.js","webpack://knossonia/../src/Properties/PropertyFactory.js","webpack://knossonia/../src/Component.js","webpack://knossonia/../src/registries/ComponentRegistry.js","webpack://knossonia/../node_modules/deepmerge/dist/cjs.js","webpack://knossonia/../src/PrefabComponent.js","webpack://knossonia/../src/Prefab.js","webpack://knossonia/../src/registries/PrefabRegistry.js","webpack://knossonia/../node_modules/nanoid/non-secure/index.js","webpack://knossonia/../src/EntityEvent.js","webpack://knossonia/../src/Entity.js","webpack://knossonia/../src/registries/EntityRegistry.js","webpack://knossonia/../src/Query.js","webpack://knossonia/../src/registries/QueryRegistry.js","webpack://knossonia/../src/Engine.js","webpack://knossonia/./src/ecs/components/Brain.js","webpack://knossonia/./src/ai/GoalActionResult.js","webpack://knossonia/./src/ecs/components/Goal.js","webpack://knossonia/./src/ai/GoalEvaluator.js","webpack://knossonia/./src/ai/GoalTypes/BoredGoalType.js","webpack://knossonia/./src/ai/GoalTypes/GoalType.js","webpack://knossonia/./src/ai/GoalTypes/EatFoodGoalType.js","webpack://knossonia/./src/ai/GoalTypes/SatisfyHungerGoalType.js","webpack://knossonia/./src/ai/GoalTypes/MoveGoalType.js","webpack://knossonia/./src/ecs/components/Eater.js","webpack://knossonia/./src/ecs/components/Moniker.js","webpack://knossonia/./src/ecs/components/Logger.js","webpack://knossonia/./src/ecs/components/Position.js","webpack://knossonia/./src/ecs/components/Map.js","webpack://knossonia/./src/ecs/components/MapLayer.js","webpack://knossonia/./src/ecs/components/Glyph.js","webpack://knossonia/./src/ecs/components/Legs.js","webpack://knossonia/./src/ecs/components/MoveCommand.js","webpack://knossonia/./src/enums/Directions.js","webpack://knossonia/./src/ecs/components/IsPlayer.js","webpack://knossonia/./src/ecs/components/Wandering.js","webpack://knossonia/./src/systems/System.js","webpack://knossonia/./src/systems/ActionSystem.js","webpack://knossonia/./src/ecs/index.js","webpack://knossonia/./src/systems/RenderSystem.js","webpack://knossonia/./src/systems/MovementSystem.js","webpack://knossonia/./src/systems/UISystem.js","webpack://knossonia/./src/core/input/MouseManager.js","webpack://knossonia/./src/core/input/CommandManager.js","webpack://knossonia/./src/core/input/InputDomainType.js","webpack://knossonia/./src/core/input/commands.js","webpack://knossonia/./src/core/input/InputCommand.js","webpack://knossonia/./src/core/input/InputCommandType.js","webpack://knossonia/./src/core/input/KeyCodes.js","webpack://knossonia/./src/core/screens/ScreenManager.js","webpack://knossonia/./src/core/screens/ScreenType.js","webpack://knossonia/./src/core/screens/screens/AdventureScreen.js","webpack://knossonia/./src/core/screens/screens/Screen.js","webpack://knossonia/./src/core/screens/screens/MainMenuScreen.js","webpack://knossonia/./src/core/PlayerManager.js","webpack://knossonia/./src/core/GameStateManager.js","webpack://knossonia/./src/core/ClockManager.js","webpack://knossonia/./src/systems/CursorSystem.js","webpack://knossonia/webpack/bootstrap","webpack://knossonia/webpack/runtime/create fake namespace object","webpack://knossonia/webpack/runtime/define property getters","webpack://knossonia/webpack/runtime/hasOwnProperty shorthand","webpack://knossonia/webpack/runtime/make namespace object","webpack://knossonia/webpack/startup"],"names":["game","Game","this","engine","ECS","clock","ClockManager","renderer","Renderer","state","GameStateManager","mouse","MouseManager","player","PlayerManager","screens","ScreenManager","commands","CommandManager","input","InputController","hungerSystem","HungerSystem","actionSystem","ActionSystem","movementSystem","MovementSystem","renderSystem","RenderSystem","UISystem","cursor","CursorSystem","newGame","requestAnimationFrame","loop","bind","t","update","document","getElementById","display","Display","width","height","tileWidth","tileHeight","body","appendChild","canvas","x","y","char","fg","bg","draw","text","drawText","clear","xPx","yPx","Math","trunc","Manager","data","createElement","getContext","widthPx","heightPx","style","cssText","ctx","font","textBaseline","fillStyle","fillText","i","length","charAt","clearRect","addEventListener","onKeydown","container","onMouseClick","onMouseMove","onMouseEnter","onMouseLeave","e","evt","InputKeyboardEvent","key","keyCode","shift","shiftKey","ctrl","ctrlKey","alt","altKey","meta","metaKey","preventDefault","onInputEvent","offsetX","offsetY","pxToTile","InputMouseEvent","button","updatePosition","updateMouseEnter","updateMouseLeave","InputEvent","tileX","tileY","ecs","createQuery","all","Eater","dt","tickDelta","get","forEach","entity","eater","hunger","System","Actor","reduceEnergy","addEnergy","value","energy","Component","camelCase","options","Array","TypeError","pascalCase","string","isLastCharLower","isLastCharUpper","isLastLastCharUpper","character","preserveCamelCase","p1","m","module","constructor","component","enumerable","set","v","id","getEntity","console","Proxy","Reflect","isNaN","old","deleteProperty","values","len","proxy","map","ref","filter","EntityProperty","EntityArrayProperty","SimpleProperty","properties","Boolean","ob","Object","prop","destroy","createComponent","handlerName","camelcase","initialValue","initialProperties","_defaultPropertyValue","property","PropertyFactory","Map","type","_getType","definition","typeOrClassOrComponent","isMergeableObject","isNonNullObject","stringValue","isReactElement","isSpecial","REACT_ELEMENT_TYPE","Symbol","cloneUnlessOtherwiseSpecified","deepmerge","val","defaultArrayMerge","target","source","element","getKeys","getEnumerableOwnPropertySymbols","propertyIsOnObject","object","mergeObject","destination","propertyIsUnsafe","customMerge","getMergeFunction","sourceIsArray","array","Error","prev","next","overwrite","componentDef","initialProps","props","merge","parent","arrComps","accessor","initialCompProps","registered","prefab","Prefab","inherit","name","componentData","def","PrefabComponent","PrefabRegistry","nameOrClassOrPrefab","urlAlphabet","writable","components","getAccessor","hasType","hasOwnProperty","nestedComponent","create","typeOrClass","attach","configurable","has","allowMultiple","isComponent","instance","index","v2","EntityEvent","Entity","refs","Set","json","entityData","createOrGetById","d","any","none","hasAny","c","hasAll","hasNone","isMatch","query","Query","nanoid","ComponentRegistry","EntityRegistry","QueryRegistry","entities","prefabs","nameOrClass","queries","serialize","deserializeEntity","deserialize","Brain","peekGoal","isFinished","popGoal","currentGoal","result","takeAction","FAILURE","removeGoal","INVALID","fireEvent","handle","goal","goalsToDestroy","goals","g","isSelf","isSiblingGoal","originalIntent","push","pop","SUCCESS","Goal","GoalEvaluator","complete","goalTypeMap","GoalTypes","goalType","getGoalType","warn","BoredGoalType","GoalType","brain","pushGoal","EatFoodGoalType","food","handled","SatisfyHungerGoalType","isHungry","MoveGoalType","random","Moniker","Logger","log","moniker","Position","idx","MapLayer","mapEntity","content","Glyph","Legs","actor","hasEnergy","position","MoveCommand","direction","DIR_Z","directions","shortName","fullName","delta","DIR_NW","DIR_N","DIR_NE","DIR_W","DIR_E","DIR_SW","DIR_S","DIR_SE","IsPlayer","Wandering","floor","Directions","sorted","from","sort","a","b","incrementTick","isPlayer","Engine","registerComponent","registerPrefab","renderable","glyph","render","moveCommand","turn","subTurn","padEnd","hasMouse","max","INPUT_DOMAIN_DEFAULT","cmd","registerCommand","getCommandForInputEvent","onInputCommand","domain","lastIndexOf","splice","getDomainCommands","find","matches","command","INPUT_DOMAIN_MAIN_MENU","INPUT_DOMAIN_ADVENTURE","INPUT_DOMAIN_LOOK","isKeyboard","InputCommand","INPUT_CMD_CONFIRM","KEY_ENTER","KEY_SPACE","INPUT_CMD_CANCEL","KEY_ESCAPE","INPUT_CMD_SAVE","KEY_S","INPUT_CMD_LOAD","KEY_L","INPUT_CMD_WAIT","INPUT_CMD_MOVE_NW","KEY_Q","INPUT_CMD_MOVE_N","KEY_W","KEY_UP","INPUT_CMD_MOVE_NE","KEY_E","INPUT_CMD_MOVE_W","KEY_A","KEY_LEFT","INPUT_CMD_MOVE_E","KEY_D","KEY_RIGHT","INPUT_CMD_MOVE_SW","KEY_Z","INPUT_CMD_MOVE_S","KEY_X","KEY_DOWN","INPUT_CMD_MOVE_SE","KEY_C","INPUT_CMD_LOOK","inputEvent","KEY_CANCEL","KEY_HELP","KEY_BACK_SPACE","KEY_TAB","KEY_CLEAR","KEY_ENTER_SPECIAL","KEY_SHIFT","KEY_CONTROL","KEY_ALT","KEY_PAUSE","KEY_CAPS_LOCK","KEY_KANA","KEY_EISU","KEY_JUNJA","KEY_FINAL","KEY_HANJA","KEY_CONVERT","KEY_NONCONVERT","KEY_ACCEPT","KEY_MODECHANGE","KEY_PAGE_UP","KEY_PAGE_DOWN","KEY_END","KEY_HOME","KEY_SELECT","KEY_PRINT","KEY_EXECUTE","KEY_PRINTSCREEN","KEY_INSERT","KEY_DELETE","KEY_NUM_0","KEY_NUM_1","KEY_NUM_2","KEY_NUM_3","KEY_NUM_4","KEY_NUM_5","KEY_NUM_6","KEY_NUM_7","KEY_NUM_8","KEY_NUM_9","KEY_COLON","KEY_SEMICOLON","KEY_LESS_THAN","KEY_EQUALS","KEY_GREATER_THAN","KEY_QUESTION_MARK","KEY_AT","KEY_B","KEY_F","KEY_G","KEY_H","KEY_I","KEY_J","KEY_K","KEY_M","KEY_N","KEY_O","KEY_P","KEY_R","KEY_T","KEY_U","KEY_V","KEY_Y","KEY_META","KEY_CONTEXT_MENU","KEY_SLEEP","KEY_NUMPAD_0","KEY_NUMPAD_1","KEY_NUMPAD_2","KEY_NUMPAD_3","KEY_NUMPAD_4","KEY_NUMPAD_5","KEY_NUMPAD_6","KEY_NUMPAD_7","KEY_NUMPAD_8","KEY_NUMPAD_9","KEY_MULTIPLY","KEY_ADD","KEY_SEPARATOR","KEY_SUBTRACT","KEY_DECIMAL","KEY_DIVIDE","KEY_F1","KEY_F2","KEY_F3","KEY_F4","KEY_F5","KEY_F6","KEY_F7","KEY_F8","KEY_F9","KEY_F10","KEY_F11","KEY_F12","KEY_F13","KEY_F14","KEY_F15","KEY_F16","KEY_F17","KEY_F18","KEY_F19","KEY_F20","KEY_F21","KEY_F22","KEY_F23","KEY_F24","KEY_NUM_LOCK","KEY_SCROLL_LOCK","KEY_WIN_OEM_FJ_JISHO","KEY_WIN_OEM_FJ_MASSHOU","KEY_WIN_OEM_FJ_TOUROKU","KEY_WIN_OEM_FJ_LOYA","KEY_WIN_OEM_FJ_ROYA","KEY_CIRCUMFLEX","KEY_EXCLAMATION","KEY_DOUBLE_QUOTE","KEY_HASH","KEY_DOLLAR","KEY_PERCENT","KEY_AMPERSAND","KEY_UNDERSCORE","KEY_OPEN_PAREN","KEY_CLOSE_PAREN","KEY_ASTERISK","KEY_PLUS","KEY_PIPE","KEY_HYPHEN_MINUS","KEY_OPEN_CURLY_BRACKET","KEY_CLOSE_CURLY_BRACKET","KEY_TILDE","KEY_VOLUME_MUTE","KEY_VOLUME_DOWN","KEY_VOLUME_UP","KEY_SEMICOLON_2","KEY_EQUALS_2","KEY_COMMA","KEY_MINUS","KEY_PERIOD","KEY_SLASH","KEY_BACK_QUOTE","KEY_OPEN_BRACKET","KEY_BACK_SLASH","KEY_CLOSE_BRACKET","KEY_QUOTE","KEY_META_2","KEY_ALTGR","KEY_WIN_ICO_HELP","KEY_WIN_ICO_00","KEY_WIN_ICO_CLEAR","KEY_WIN_OEM_RESET","KEY_WIN_OEM_JUMP","KEY_WIN_OEM_PA1","KEY_WIN_OEM_PA2","KEY_WIN_OEM_PA3","KEY_WIN_OEM_WSCTRL","KEY_WIN_OEM_CUSEL","KEY_WIN_OEM_ATTN","KEY_WIN_OEM_FINISH","KEY_WIN_OEM_COPY","KEY_WIN_OEM_AUTO","KEY_WIN_OEM_ENLW","KEY_WIN_OEM_BACKTAB","KEY_ATTN","KEY_CRSEL","KEY_EXSEL","KEY_EREOF","KEY_PLAY","KEY_ZOOM","KEY_PA1","KEY_WIN_OEM_CLEAR","SCREEN_MAIN_MENU","MainMenuScreen","SCREEN_ADVENTURE","AdventureScreen","screenType","screen","onLeave","onEnter","onUpdate","setScreen","pushDomain","popDomain","dir","isEnabled","move","saveGame","loadGame","toggle","disable","wait","onDirectionInput","Screen","createPrefab","isTurn","remove","add","turns","playerEntityId","onNewGame","onSaveGame","localStorage","setItem","JSON","stringify","parse","getItem","onLoadGame","enable","__webpack_module_cache__","__webpack_require__","moduleId","exports","__webpack_modules__","mode","__esModule","ns","r","o","defineProperty","obj","prototype","call","toStringTag"],"mappings":"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","file":"main.de021c7301483b93de4b.js","sourcesContent":["import { game } from './core/Game';\n\ngame.start();\n","import Renderer from './rendering/RenderManager';\nimport InputController from './input/InputController';\nimport HungerSystem from '../systems/HungerSystem';\nimport ActionSystem from '../systems/ActionSystem';\nimport RenderSystem from '../systems/RenderSystem';\nimport MovementSystem from '../systems/MovementSystem';\nimport UISystem from '../systems/UISystem';\nimport MouseManager from './input/MouseManager';\nimport CommandManager from './input/CommandManager';\nimport ScreenManager from './screens/ScreenManager';\nimport PlayerManager from './PlayerManager';\nimport ECS from '../ecs';\nimport GameStateManager from './GameStateManager';\nimport ClockManager from './ClockManager';\nimport CursorSystem from '../systems/CursorSystem';\n\nexport default class Game {\n    get ecs() {\n        return this.engine.engine;\n    }\n\n    constructor() {\n        this.engine = new ECS();\n        this.clock = new ClockManager(this);\n        this.renderer = new Renderer(this);\n        this.state = new GameStateManager(this);\n        this.mouse = new MouseManager(this);\n        this.player = new PlayerManager(this);\n        this.screens = new ScreenManager(this);\n        this.commands = new CommandManager(this);\n        this.input = new InputController(this);\n\n        this.hungerSystem = new HungerSystem(this);\n        this.actionSystem = new ActionSystem(this);\n        this.movementSystem = new MovementSystem(this);\n        this.renderSystem = new RenderSystem(this);\n        this.UISystem = new UISystem(this);\n        this.cursor = new CursorSystem(this);\n    }\n\n    start() {\n        this.state.newGame();\n        requestAnimationFrame(this.loop.bind(this));\n    }\n\n    loop(t) {\n        const dt = 0;\n\n        this.hungerSystem.update(dt);\n        this.actionSystem.update(dt);\n        this.movementSystem.update(dt);\n        this.renderSystem.update(dt);\n        this.UISystem.update(dt);\n        this.screens.update(dt);\n        this.cursor.update(dt);\n\n        requestAnimationFrame(this.loop.bind(this));\n    }\n}\n\nexport const game = new Game();\n","import Manager from '../Manager';\nimport Display from './Display';\n\nexport default class Renderer extends Manager {\n    #tileWidth = 16;\n    #tileHeight = 24;\n\n    width = 64;\n    height = 32;\n\n    get tileWidth() {\n        return this.#tileWidth;\n    }\n\n    get tileHeight() {\n        return this.#tileHeight;\n    }\n\n    get canvas() {\n        return this.display.canvas;\n    }\n\n    constructor(game) {\n        super(game);\n        const tileSet = document.getElementById('tileset');\n\n        this.display = new Display({\n            width: this.width,\n            height: this.height,\n            tileWidth: this.tileWidth,\n            tileHeight: this.tileHeight,\n        });\n\n        document.body.appendChild(this.display.canvas);\n    }\n\n    draw(x, y, char, fg, bg) {\n        this.display.draw(x, y, char, fg, bg);\n    }\n\n    drawText(x, y, text) {\n        this.display.drawText(x, y, text);\n    }\n\n    clear() {\n        this.display.clear();\n    }\n\n    pxToTile(xPx, yPx) {\n        const x = Math.trunc(xPx / this.tileWidth);\n        const y = Math.trunc(yPx / this.tileHeight);\n\n        return {x, y};\n    }\n}\n","export default class Manager {\n    #game;\n\n    get game() {\n        return this.#game;\n    }\n\n    constructor(game) {\n        this.#game = game;\n    }\n\n    onNewGame() {}\n    onSaveGame() {}\n    onLoadGame(data) {}\n}\n","export default class Display {\n    #ctx;\n    #canvas;\n    #width;\n    #height;\n    #tileWidth;\n    #tileHeight;\n\n    get tileWidth() {\n        return this.#tileWidth;\n    }\n\n    get tileHeight() {\n        return this.#tileHeight;\n    }\n\n    get width() {\n        return this.#width;\n    }\n\n    get height() {\n        return this.#height;\n    }\n\n    get canvas() {\n        return this.#canvas;\n    }\n\n    get ctx() {\n        return this.#ctx;\n    }\n\n    constructor({width, height, tileWidth, tileHeight}) {\n        this.#width = width;\n        this.#height = height;\n        this.#tileWidth = tileWidth;\n        this.#tileHeight = tileHeight;\n\n        this.#canvas = document.createElement('canvas');\n        this.#ctx = this.canvas.getContext('2d');\n\n        const widthPx = this.tileWidth * this.width;\n        const heightPx = this.tileHeight * this.height;\n\n        this.canvas.style.cssText = `width: ${widthPx}px; height: ${heightPx}px`;\n        this.canvas.width = widthPx;\n        this.canvas.height = heightPx;\n\n        this.ctx.font = `${this.#tileHeight}px monospace`;\n        this.ctx.textBaseline = 'top';\n    }\n\n    draw(x, y, char, fg = '#eee', bg) {\n        // this.clearTile(x, y);\n        // this.ctx.fillStyle = '#333';\n        // this.ctx.fillRect(\n        //     x * this.tileWidth,\n        //     y * this.tileHeight,\n        //     this.tileWidth,\n        //     this.tileHeight\n        // );\n\n        this.ctx.fillStyle = fg;\n        this.ctx.fillText(\n            char,\n            x * this.tileWidth,\n            y * this.tileHeight\n        );\n    }\n\n    drawText(x, y, text, fg = '#eee', bg) {\n        this.ctx.fillStyle = fg;\n        for (let i = 0; i < text.length; i++) {\n            this.draw(\n                x + i,\n                y,\n                text.charAt(i),\n                fg,\n                bg\n            );\n        }\n    }\n\n    clear() {\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n\n    clearTile(x, y) {\n        this.ctx.clearRect(\n            x * this.tileWidth,\n            y * this.tileHeight,\n            this.tileWidth,\n            this.tileHeight\n        );\n    }\n}\n","import InputKeyboardEvent from './events/InputKeyboardEvent';\nimport InputMouseEvent from './events/InputMouseEvent';\nimport Manager from '../Manager';\n\nexport default class InputController extends Manager {\n    constructor(game) {\n        super(game);\n        document.addEventListener('keydown', this.onKeydown.bind(this));\n\n        const container = this.game.renderer.canvas;\n\n        container.addEventListener('click', this.onMouseClick.bind(this));\n        container.addEventListener('mousemove', this.onMouseMove.bind(this));\n        container.addEventListener('mouseenter', this.onMouseEnter.bind(this));\n        container.addEventListener('mouseleave', this.onMouseLeave.bind(this));\n    }\n\n    onKeydown(e) {\n        const evt = new InputKeyboardEvent({\n            key: e.keyCode,\n            shift: e.shiftKey,\n            ctrl: e.ctrlKey,\n            alt: e.altKey,\n            meta: e.metaKey,\n        });\n\n        e.preventDefault();\n\n        this.game.commands.onInputEvent(evt);\n    }\n\n    onMouseClick(e) {\n        const xPx = e.offsetX;\n        const yPx = e.offsetY;\n        const {x, y} = this.game.renderer.pxToTile(xPx, yPx);\n\n        const evt = new InputMouseEvent({\n            key: e.button,\n            x,\n            y,\n            shift: e.shiftKey,\n            ctrl: e.ctrlKey,\n            alt: e.altKey,\n            meta: e.metaKey,\n            xPx,\n            yPx,\n        });\n\n        this.game.commands.onInputEvent(evt);\n    }\n\n    onMouseMove(e) {\n        const xPx = e.offsetX;\n        const yPx = e.offsetY;\n        const {x, y} = this.game.renderer.pxToTile(xPx, yPx);\n\n        this.game.mouse.updatePosition(x, y);\n    }\n\n    onMouseEnter(e) {\n        this.game.mouse.updateMouseEnter();\n    }\n\n    onMouseLeave(e) {\n        this.game.mouse.updateMouseLeave();\n    }\n}\n","import InputEvent from './InputEvent';\n\nexport default class InputKeyboardEvent extends InputEvent {}\n","export default class InputEvent {\n    key = false;\n    shift = false;\n    ctrl = false;\n    alt = false;\n    meta = false;\n\n    constructor(data) {\n        this.key = data.key;\n        this.shift = data.shift;\n        this.ctrl = data.ctrl;\n        this.alt = data.alt;\n        this.meta = data.meta;\n    }\n}\n","import InputEvent from './InputEvent';\n\nexport default class InputMouseEvent extends InputEvent {\n    x = false;\n    y = false;\n    tileX = false;\n    tileY = false;\n\n    constructor(data) {\n        super(data);\n        this.x = data.x;\n        this.y = data.y;\n        this.tileX = data.tileX;\n        this.tileY = data.tileY;\n    }\n}\n","import { Eater } from '../ecs/components';\nimport System from './System';\n\nexport default class HungerSystem extends System {\n    #query = null;\n\n    constructor(game) {\n        super(game);\n        this.#query = game.ecs.createQuery({\n            all: [Eater],\n        });\n    }\n\n    update(dt) {\n        if (this.game.actionSystem.tickDelta > 0) {\n            this.#query.get().forEach((entity) => {\n                entity.eater.hunger -= this.game.actionSystem.tickDelta;\n            });\n        }\n    }\n}\n","import { Component } from 'geotic';\n\nexport class Actor extends Component {\n    static properties = {\n        energy: 0,\n    };\n\n    get hasEnergy() {\n        return this.energy >= 0;\n    }\n\n    onEnergyConsumed(evt) {\n        this.reduceEnergy(evt.data);\n    }\n\n    onTick(evt) {\n        this.addEnergy(1);\n    }\n\n    addEnergy(value) {\n        this.energy += value;\n\n        if (this.energy >= 0) {\n            this.energy = 0;\n        }\n    }\n\n    reduceEnergy(value) {\n        this.addEnergy(value * -1);\n    }\n}\n","'use strict';\n\nconst preserveCamelCase = string => {\n\tlet isLastCharLower = false;\n\tlet isLastCharUpper = false;\n\tlet isLastLastCharUpper = false;\n\n\tfor (let i = 0; i < string.length; i++) {\n\t\tconst character = string[i];\n\n\t\tif (isLastCharLower && /[\\p{Lu}]/u.test(character)) {\n\t\t\tstring = string.slice(0, i) + '-' + string.slice(i);\n\t\t\tisLastCharLower = false;\n\t\t\tisLastLastCharUpper = isLastCharUpper;\n\t\t\tisLastCharUpper = true;\n\t\t\ti++;\n\t\t} else if (isLastCharUpper && isLastLastCharUpper && /[\\p{Ll}]/u.test(character)) {\n\t\t\tstring = string.slice(0, i - 1) + '-' + string.slice(i - 1);\n\t\t\tisLastLastCharUpper = isLastCharUpper;\n\t\t\tisLastCharUpper = false;\n\t\t\tisLastCharLower = true;\n\t\t} else {\n\t\t\tisLastCharLower = character.toLocaleLowerCase() === character && character.toLocaleUpperCase() !== character;\n\t\t\tisLastLastCharUpper = isLastCharUpper;\n\t\t\tisLastCharUpper = character.toLocaleUpperCase() === character && character.toLocaleLowerCase() !== character;\n\t\t}\n\t}\n\n\treturn string;\n};\n\nconst camelCase = (input, options) => {\n\tif (!(typeof input === 'string' || Array.isArray(input))) {\n\t\tthrow new TypeError('Expected the input to be `string | string[]`');\n\t}\n\n\toptions = {\n\t\t...{pascalCase: false},\n\t\t...options\n\t};\n\n\tconst postProcess = x => options.pascalCase ? x.charAt(0).toLocaleUpperCase() + x.slice(1) : x;\n\n\tif (Array.isArray(input)) {\n\t\tinput = input.map(x => x.trim())\n\t\t\t.filter(x => x.length)\n\t\t\t.join('-');\n\t} else {\n\t\tinput = input.trim();\n\t}\n\n\tif (input.length === 0) {\n\t\treturn '';\n\t}\n\n\tif (input.length === 1) {\n\t\treturn options.pascalCase ? input.toLocaleUpperCase() : input.toLocaleLowerCase();\n\t}\n\n\tconst hasUpperCase = input !== input.toLocaleLowerCase();\n\n\tif (hasUpperCase) {\n\t\tinput = preserveCamelCase(input);\n\t}\n\n\tinput = input\n\t\t.replace(/^[_.\\- ]+/, '')\n\t\t.toLocaleLowerCase()\n\t\t.replace(/[_.\\- ]+([\\p{Alpha}\\p{N}_]|$)/gu, (_, p1) => p1.toLocaleUpperCase())\n\t\t.replace(/\\d+([\\p{Alpha}\\p{N}_]|$)/gu, m => m.toLocaleUpperCase());\n\n\treturn postProcess(input);\n};\n\nmodule.exports = camelCase;\n// TODO: Remove this for the next major release\nmodule.exports.default = camelCase;\n","export default class Property {\n    component;\n\n    constructor(component) {\n        this.component = component;\n    }\n\n    get ecs() {\n        return this.component.ecs;\n    }\n\n    get descriptor() {\n        return {\n            enumerable: true,\n            get: () => this.get(),\n            set: (v) => this.set(v),\n        };\n    }\n\n    get() {\n        return undefined;\n    }\n\n    set(value) {}\n\n    serialize() {\n        return undefined;\n    }\n\n    onDestroyed() {}\n\n    cleanupReference(entity) {}\n}\n","import Property from './Property';\n\nexport default class SimpleProperty extends Property {\n    value = null;\n\n    set(value) {\n        this.value = value;\n    }\n\n    get() {\n        return this.value;\n    }\n\n    serialize() {\n        return this.value;\n    }\n}\n","import Property from './Property';\n\nexport default class EntityProperty extends Property {\n    id;\n\n    set(value) {\n        if (this.id && (!value || value.id !== this.id || value !== this.id)) {\n            this.ecs.entities.removeRef(this.id, this);\n        }\n\n        if (value && value.id) {\n            this.ecs.entities.addRef(value.id, this);\n            this.id = value.id;\n            return;\n        }\n\n        if (typeof value === 'string') {\n            this.ecs.entities.addRef(value, this);\n            this.id = value;\n            return;\n        }\n\n        this.id = undefined;\n    }\n\n    get() {\n        return this.id && this.component.ecs.getEntity(this.id);\n    }\n\n    serialize() {\n        return this.id;\n    }\n\n    onDestroyed() {\n        if (this.id) {\n            this.ecs.entities.removeRef(this.id, this);\n        }\n    }\n\n    cleanupReference(entity) {\n        if (this.id === entity.id) {\n            this.id = undefined;\n        } else {\n            console.warn(\n                `Property in unclean state. A reference to an entity \"${entity.id}\" was never cleaned up.`\n            );\n        }\n    }\n}\n","import Property from './Property';\n\nexport default class EntityArrayProperty extends Property {\n    proxy = [];\n\n    constructor(component) {\n        super(component);\n        this.proxy = new Proxy([], {\n            get: (target, prop, receiver) => {\n                return Reflect.get(target, prop, receiver);\n            },\n            set: (target, prop, value, receiver) => {\n                if (isNaN(prop)) {\n                    return Reflect.set(target, prop, value, receiver);\n                }\n\n                const old = Reflect.get(target, prop, receiver);\n\n                if (typeof value === 'string') {\n                    value = this.ecs.entities.get(value);\n                }\n\n                if (old && old != value) {\n                    this.ecs.entities.removeRef(value, this);\n                }\n\n                if (value && value.id) {\n                    this.ecs.entities.addRef(value.id, this);\n\n                    return Reflect.set(target, prop, value, receiver);\n                }\n\n                return Reflect.set(target, prop, value, receiver);\n            },\n            deleteProperty: (target, prop) => {\n                if (isNaN(prop)) {\n                    return Reflect.deleteProperty(target, prop);\n                }\n\n                const value = Reflect.get(target, prop);\n                this.ecs.entities.removeRef(value, this);\n\n                return Reflect.deleteProperty(target, prop);\n            },\n        });\n    }\n\n    set(values = []) {\n        const len = Math.max(values.length, this.proxy.length);\n\n        for (let i = 0; i < len; i++) {\n            if (i in values) {\n                this.proxy[i] = values[i];\n            } else {\n                delete this.proxy[i];\n            }\n        }\n\n        this.proxy.length = values.length;\n    }\n\n    get() {\n        return this.proxy;\n    }\n\n    serialize() {\n        return this.proxy.map((ref) => ref.id);\n    }\n\n    onDestroyed() {\n        this.set([]);\n    }\n\n    cleanupReference(entity) {\n        this.set(this.proxy.filter((ref) => ref.id !== entity.id));\n    }\n}\n","import Property from './Property';\nimport SimpleProperty from './SimpleProperty';\nimport EntityProperty from './EntityProperty';\nimport EntityArrayProperty from './EntityArrayProperty';\n\nexport default class PropertyStrategy {\n    static create(component, value) {\n        switch (value) {\n            case '<Entity>':\n                return new EntityProperty(component);\n            case '<EntityArray>':\n                return new EntityArrayProperty(component);\n            default:\n                return new SimpleProperty(component);\n        }\n    }\n}\n","import camelcase from 'camelcase';\r\nimport PropertyFactory from './Properties/PropertyFactory';\r\n\r\nexport default class Component {\r\n    #entity = null;\r\n    #ecs = null;\r\n    #props = {};\r\n    #isDestroyed = false;\r\n\r\n    static allowMultiple = false;\r\n    static keyProperty = null;\r\n    static properties = {};\r\n\r\n    static get type() {\r\n        return this.name;\r\n    }\r\n\r\n    get entity() {\r\n        return this.#entity;\r\n    }\r\n\r\n    get ecs() {\r\n        return this.#ecs;\r\n    }\r\n\r\n    get type() {\r\n        return this.constructor.name;\r\n    }\r\n\r\n    get isAttached() {\r\n        return Boolean(this.entity);\r\n    }\r\n\r\n    get isDestroyed() {\r\n        return this.#isDestroyed;\r\n    }\r\n\r\n    get allowMultiple() {\r\n        return this.constructor.allowMultiple;\r\n    }\r\n\r\n    get keyProperty() {\r\n        return this.constructor.keyProperty;\r\n    }\r\n\r\n    get properties() {\r\n        const ob = {};\r\n\r\n        for (const [key, value] of Object.entries(this.#props)) {\r\n            ob[key] = value.get();\r\n        }\r\n\r\n        return ob;\r\n    }\r\n\r\n    get key() {\r\n        return this[this.keyProperty];\r\n    }\r\n\r\n    constructor(ecs, properties = {}) {\r\n        this.#ecs = ecs;\r\n        this._defineProxies(properties);\r\n    }\r\n\r\n    serialize() {\r\n        return Object.entries(this.#props).reduce(\r\n            (o, [key, value]) => ({\r\n                ...o,\r\n                [key]: value.serialize(),\r\n            }),\r\n            {}\r\n        );\r\n    }\r\n\r\n    _onAttached(entity) {\r\n        this.#entity = entity;\r\n        this.ecs.queries.onComponentAdded(entity, this);\r\n        this.onAttached();\r\n    }\r\n\r\n    _onDetached() {\r\n        if (this.isAttached) {\r\n            this.onDetached();\r\n            const entity = this.#entity;\r\n\r\n            this.#entity = null;\r\n            this.ecs.queries.onComponentRemoved(entity, this);\r\n        }\r\n    }\r\n\r\n    _onDestroyed() {\r\n        this.#isDestroyed = true;\r\n        this.onDestroyed();\r\n\r\n        for (const prop of Object.values(this.#props)) {\r\n            prop.onDestroyed();\r\n        }\r\n    }\r\n\r\n    onAttached() {}\r\n\r\n    onDetached() {}\r\n\r\n    onDestroyed() {}\r\n\r\n    remove(destroy = true) {\r\n        if (this.isAttached) {\r\n            this.entity.remove(this);\r\n        }\r\n        if (destroy) {\r\n            this._onDestroyed();\r\n        }\r\n    }\r\n\r\n    destroy() {\r\n        this.remove(true);\r\n    }\r\n\r\n    clone() {\r\n        return this.ecs.createComponent(\r\n            this.type,\r\n            this.serialize()\r\n        );\r\n    }\r\n\r\n    _onEvent(evt) {\r\n        this.onEvent(evt);\r\n\r\n        const handlerName = camelcase(`on ${evt.name}`);\r\n\r\n        if (typeof this[handlerName] === 'function') {\r\n            this[handlerName](evt);\r\n        }\r\n    }\r\n\r\n    onEvent(evt) {}\r\n\r\n    _defaultPropertyValue(propertyName) {\r\n        const value = this.constructor.properties[propertyName];\r\n\r\n        if (value === '<EntityArray>') {\r\n            return [];\r\n        }\r\n\r\n        if (value === '<Entity>') {\r\n            return undefined;\r\n        }\r\n\r\n        return value;\r\n    }\r\n\r\n    _defineProxies(initialProperties) {\r\n        for (const key in this.constructor.properties) {\r\n            const initialValue = initialProperties.hasOwnProperty(key)\r\n                ? initialProperties[key]\r\n                : this._defaultPropertyValue(key);\r\n            const property = PropertyFactory.create(\r\n                this,\r\n                this.constructor.properties[key]\r\n            );\r\n\r\n            this.#props[key] = property;\r\n            Object.defineProperty(this, key, property.descriptor);\r\n            property.set(initialValue);\r\n        }\r\n    }\r\n}\r\n","import Component from '../Component';\nimport camelcase from 'camelcase';\n\nexport default class ComponentRegistry {\n    #nameCache = new Map();\n    #definitions = new Map();\n    #ecs = null;\n\n    constructor(ecs) {\n        this.#ecs = ecs;\n    }\n\n    register(component) {\n        this.#definitions.set(component.name, component);\n        this.#nameCache.set(component.name, camelcase(component.name));\n    }\n\n    getAccessor(type) {\n        if (this.#nameCache.has(type)) {\n            return this.#nameCache.get(type);\n        }\n\n        this.#nameCache.set(type, camelcase(type));\n    }\n\n    get(typeOrClassOrComponent) {\n        const type = this._getType(typeOrClassOrComponent);\n\n        if (!type) {\n            console.warn(\n                `Cannot get component definition for type or class ${typeOrClassOrComponent} since it is neither a Component class or type (string)`\n            );\n            return null;\n        }\n\n        return this.#definitions.get(type);\n    }\n\n    create(typeOrClass, properties = {}) {\n        const definition = this.get(typeOrClass);\n\n        if (definition) {\n            return new definition(this.#ecs, properties);\n        }\n\n        console.warn(\n            `Could not create component definition for ${typeOrClass} since it is not registered`\n        );\n    }\n\n    _getType(typeOrClassOrComponent) {\n        if (typeof typeOrClassOrComponent === 'string') {\n            return typeOrClassOrComponent;\n        }\n\n        if (typeOrClassOrComponent instanceof Component) {\n            return typeOrClassOrComponent.type;\n        }\n\n        if (typeOrClassOrComponent.prototype instanceof Component) {\n            return typeOrClassOrComponent.name;\n        }\n\n        return null;\n    }\n}\n","'use strict';\n\nvar isMergeableObject = function isMergeableObject(value) {\n\treturn isNonNullObject(value)\n\t\t&& !isSpecial(value)\n};\n\nfunction isNonNullObject(value) {\n\treturn !!value && typeof value === 'object'\n}\n\nfunction isSpecial(value) {\n\tvar stringValue = Object.prototype.toString.call(value);\n\n\treturn stringValue === '[object RegExp]'\n\t\t|| stringValue === '[object Date]'\n\t\t|| isReactElement(value)\n}\n\n// see https://github.com/facebook/react/blob/b5ac963fb791d1298e7f396236383bc955f916c1/src/isomorphic/classic/element/ReactElement.js#L21-L25\nvar canUseSymbol = typeof Symbol === 'function' && Symbol.for;\nvar REACT_ELEMENT_TYPE = canUseSymbol ? Symbol.for('react.element') : 0xeac7;\n\nfunction isReactElement(value) {\n\treturn value.$$typeof === REACT_ELEMENT_TYPE\n}\n\nfunction emptyTarget(val) {\n\treturn Array.isArray(val) ? [] : {}\n}\n\nfunction cloneUnlessOtherwiseSpecified(value, options) {\n\treturn (options.clone !== false && options.isMergeableObject(value))\n\t\t? deepmerge(emptyTarget(value), value, options)\n\t\t: value\n}\n\nfunction defaultArrayMerge(target, source, options) {\n\treturn target.concat(source).map(function(element) {\n\t\treturn cloneUnlessOtherwiseSpecified(element, options)\n\t})\n}\n\nfunction getMergeFunction(key, options) {\n\tif (!options.customMerge) {\n\t\treturn deepmerge\n\t}\n\tvar customMerge = options.customMerge(key);\n\treturn typeof customMerge === 'function' ? customMerge : deepmerge\n}\n\nfunction getEnumerableOwnPropertySymbols(target) {\n\treturn Object.getOwnPropertySymbols\n\t\t? Object.getOwnPropertySymbols(target).filter(function(symbol) {\n\t\t\treturn target.propertyIsEnumerable(symbol)\n\t\t})\n\t\t: []\n}\n\nfunction getKeys(target) {\n\treturn Object.keys(target).concat(getEnumerableOwnPropertySymbols(target))\n}\n\nfunction propertyIsOnObject(object, property) {\n\ttry {\n\t\treturn property in object\n\t} catch(_) {\n\t\treturn false\n\t}\n}\n\n// Protects from prototype poisoning and unexpected merging up the prototype chain.\nfunction propertyIsUnsafe(target, key) {\n\treturn propertyIsOnObject(target, key) // Properties are safe to merge if they don't exist in the target yet,\n\t\t&& !(Object.hasOwnProperty.call(target, key) // unsafe if they exist up the prototype chain,\n\t\t\t&& Object.propertyIsEnumerable.call(target, key)) // and also unsafe if they're nonenumerable.\n}\n\nfunction mergeObject(target, source, options) {\n\tvar destination = {};\n\tif (options.isMergeableObject(target)) {\n\t\tgetKeys(target).forEach(function(key) {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(target[key], options);\n\t\t});\n\t}\n\tgetKeys(source).forEach(function(key) {\n\t\tif (propertyIsUnsafe(target, key)) {\n\t\t\treturn\n\t\t}\n\n\t\tif (propertyIsOnObject(target, key) && options.isMergeableObject(source[key])) {\n\t\t\tdestination[key] = getMergeFunction(key, options)(target[key], source[key], options);\n\t\t} else {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(source[key], options);\n\t\t}\n\t});\n\treturn destination\n}\n\nfunction deepmerge(target, source, options) {\n\toptions = options || {};\n\toptions.arrayMerge = options.arrayMerge || defaultArrayMerge;\n\toptions.isMergeableObject = options.isMergeableObject || isMergeableObject;\n\t// cloneUnlessOtherwiseSpecified is added to `options` so that custom arrayMerge()\n\t// implementations can use it. The caller may not replace it.\n\toptions.cloneUnlessOtherwiseSpecified = cloneUnlessOtherwiseSpecified;\n\n\tvar sourceIsArray = Array.isArray(source);\n\tvar targetIsArray = Array.isArray(target);\n\tvar sourceAndTargetTypesMatch = sourceIsArray === targetIsArray;\n\n\tif (!sourceAndTargetTypesMatch) {\n\t\treturn cloneUnlessOtherwiseSpecified(source, options)\n\t} else if (sourceIsArray) {\n\t\treturn options.arrayMerge(target, source, options)\n\t} else {\n\t\treturn mergeObject(target, source, options)\n\t}\n}\n\ndeepmerge.all = function deepmergeAll(array, options) {\n\tif (!Array.isArray(array)) {\n\t\tthrow new Error('first argument should be an array')\n\t}\n\n\treturn array.reduce(function(prev, next) {\n\t\treturn deepmerge(prev, next, options)\n\t}, {})\n};\n\nvar deepmerge_1 = deepmerge;\n\nmodule.exports = deepmerge_1;\n","import merge from 'deepmerge';\n\nexport default class PrefabComponent {\n    get type() {\n        return this.componentDef.type;\n    }\n\n    constructor(componentDef, properties = {}, overwrite = true) {\n        this.componentDef = componentDef;\n        this.properties = properties;\n        this.overwrite = overwrite;\n    }\n\n    applyToEntity(entity, initialProps = {}) {\n        if (!this.componentDef.allowMultiple && entity.has(this.componentDef)) {\n            if (this.overwrite) {\n                entity.remove(this.componentDef);\n            } else {\n                console.log(\n                    `Ignoring prefab component \"${this.type}\" since the entity \"${entity.id}\" already has one.`\n                );\n                return;\n            }\n        }\n\n        const props = merge(this.properties, initialProps);\n\n        entity.add(this.componentDef, props);\n    }\n}\n","export default class Prefab {\r\n    name = '';\r\n    inherit = [];\r\n    components = [];\r\n\r\n    constructor(ecs, name) {\r\n        this.ecs = ecs;\r\n        this.name = name;\r\n    }\r\n\r\n    addComponent(prefabComponent) {\r\n        this.components.push(prefabComponent);\r\n    }\r\n\r\n    applyToEntity(entity, initialProps = {}) {\r\n        this.inherit.forEach((parent) => {\r\n            parent.applyToEntity(entity, initialProps);\r\n        });\r\n\r\n        const arrComps = {};\r\n\r\n        this.components.forEach((component, i) => {\r\n            const definition = component.componentDef;\r\n            const accessor = this.ecs.components.getAccessor(definition.type);\r\n\r\n            let initialCompProps = {};\r\n\r\n            if (definition.allowMultiple) {\r\n                if (definition.keyProperty) {\r\n                    const key = component.properties[definition.keyProperty];\r\n\r\n                    if (\r\n                        initialProps[accessor] &&\r\n                        initialProps[accessor][key]\r\n                    ) {\r\n                        initialCompProps =\r\n                            initialProps[accessor][key];\r\n                    }\r\n                } else {\r\n                    if (!arrComps[accessor]) {\r\n                        arrComps[accessor] = 0;\r\n                    }\r\n\r\n                    if (\r\n                        initialProps[accessor] &&\r\n                        initialProps[accessor][\r\n                            arrComps[accessor]\r\n                        ]\r\n                    ) {\r\n                        initialCompProps =\r\n                            initialProps[accessor][\r\n                                arrComps[accessor]\r\n                            ];\r\n                    }\r\n\r\n                    arrComps[accessor]++;\r\n                }\r\n            } else {\r\n                initialCompProps = initialProps[accessor];\r\n            }\r\n\r\n            component.applyToEntity(entity, initialCompProps);\r\n        });\r\n\r\n        return entity;\r\n    }\r\n}\r\n","import Component from '../Component';\nimport PrefabComponent from '../PrefabComponent';\nimport Prefab from '../Prefab';\n\nexport default class PrefabRegistry {\n    #prefabs = {};\n    #ecs = null;\n\n    constructor(ecs) {\n        this.#ecs = ecs;\n    }\n\n    deserialize(data) {\n        const registered = this.get(data.name);\n\n        if (registered) {\n            return registered;\n        }\n\n        const prefab = new Prefab(this.#ecs, data.name);\n\n        let inherit;\n\n        if (Array.isArray(data.inherit)) {\n            inherit = data.inherit;\n        } else if (typeof data.inherit === 'string') {\n            inherit = [data.inherit];\n        } else {\n            inherit = [];\n        }\n\n        prefab.inherit = inherit.map((parent) => {\n            const ref = this.get(parent);\n\n            if (!ref) {\n                console.warn(\n                    `Prefab \"${data.name}\" cannot inherit from Prefab \"${parent}\" because is not registered yet! Prefabs must be registered in the right order.`\n                );\n                return parent;\n            }\n\n            return ref;\n        });\n\n        const comps = data.components || [];\n\n        for (const componentData of comps) {\n            if (\n                typeof componentData === 'string' ||\n                componentData.prototype instanceof Component\n            ) {\n                const def = this.#ecs.components.get(componentData);\n                if (def) {\n                    prefab.addComponent(new PrefabComponent(def));\n                }\n            } else if (typeof componentData === 'object') {\n                const type = componentData.type;\n                const def = this.#ecs.components.get(type);\n                if (def) {\n                    prefab.addComponent(\n                        new PrefabComponent(\n                            def,\n                            componentData.properties,\n                            componentData.overwrite\n                        )\n                    );\n                }\n            } else {\n                console.warn(\n                    `Unrecognized component reference \"${componentData}\" in prefab \"${data.name}\". Ensure the component is registered before the prefab.`\n                );\n            }\n        }\n\n        this.register(prefab);\n\n        return prefab;\n    }\n\n    register(prefab) {\n        this.#prefabs[prefab.name] = prefab;\n    }\n\n    get(nameOrClassOrPrefab) {\n        const name = PrefabRegistry._getName(nameOrClassOrPrefab);\n\n        return this.#prefabs[name];\n    }\n\n    create(nameOrClass, initialProps = {}) {\n        const prefab = this.get(nameOrClass);\n\n        if (!prefab) {\n            console.warn(\n                `Could not instantiate prefab for ${nameOrClass} since it is not registered`\n            );\n\n            return;\n        }\n\n        const entity = this.#ecs.createEntity();\n        prefab.applyToEntity(entity, initialProps);\n\n        return entity;\n    }\n\n    static _getName(nameOrClassOrPrefab) {\n        if (typeof nameOrClassOrPrefab === 'string') {\n            return nameOrClassOrPrefab;\n        }\n\n        if (nameOrClassOrPrefab instanceof Prefab) {\n            return nameOrClassOrPrefab.name;\n        }\n\n        if (nameOrClassOrPrefab.prototype instanceof Prefab) {\n            return nameOrClassOrPrefab.name;\n        }\n\n        return null;\n    }\n}\n","// This alphabet uses `A-Za-z0-9_-` symbols. The genetic algorithm helped\n// optimize the gzip compression for this alphabet.\nlet urlAlphabet =\n  'ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW'\n\nlet customAlphabet = (alphabet, size) => {\n  return () => {\n    let id = ''\n    // A compact alternative for `for (var i = 0; i < step; i++)`.\n    let i = size\n    while (i--) {\n      // `| 0` is more compact and faster than `Math.floor()`.\n      id += alphabet[Math.random() * alphabet.length | 0]\n    }\n    return id\n  }\n}\n\nlet nanoid = (size = 21) => {\n  let id = ''\n  // A compact alternative for `for (var i = 0; i < step; i++)`.\n  let i = size\n  while (i--) {\n    // `| 0` is more compact and faster than `Math.floor()`.\n    id += urlAlphabet[Math.random() * 64 | 0]\n  }\n  return id\n}\n\nexport { nanoid, customAlphabet }\n","export default class EntityEvent {\n    data = {};\n    #prevented = false;\n    #handled = false;\n\n    get prevented() {\n        return this.#prevented;\n    }\n\n    get handled() {\n        return this.#handled;\n    }\n\n    constructor(name, data = {}) {\n        this.name = name;\n        this.data = data;\n    }\n\n    is(name) {\n        return this.name === name;\n    }\n\n    handle() {\n        this.#handled = true;\n        this.#prevented = true;\n    }\n\n    prevent() {\n        this.#prevented = true;\n    }\n}\n","import Component from './Component';\r\nimport EntityEvent from './EntityEvent';\r\n\r\nexport default class Entity {\r\n    #id = null;\r\n    #components = {};\r\n    #ecs = null;\r\n    #isDestroyed = false;\r\n\r\n    get ecs() {\r\n        return this.#ecs;\r\n    }\r\n\r\n    get components() {\r\n        return this.#components;\r\n    }\r\n\r\n    get isDestroyed() {\r\n        return this.#isDestroyed;\r\n    }\r\n\r\n    constructor(ecs, id = null) {\r\n        this.#ecs = ecs;\r\n        this.#id = id || ecs.generateId();\r\n        Object.defineProperty(this, 'id', {\r\n            value: this.#id,\r\n            enumerable: true,\r\n            writable: false,\r\n        });\r\n    }\r\n\r\n    has(typeOrClass, key = null) {\r\n        const type = this.ecs.components._getType(typeOrClass);\r\n        const accessor = this.ecs.components.getAccessor(type);\r\n        const hasType = this.hasOwnProperty(accessor);\r\n\r\n        if (hasType && key) {\r\n            return this[accessor].hasOwnProperty(key);\r\n        }\r\n\r\n        return hasType;\r\n    }\r\n\r\n    get(typeOrClass, key = null) {\r\n        const type = this.ecs.components._getType(typeOrClass);\r\n        const accessor = this.ecs.components.getAccessor(type);\r\n        const components = this[accessor];\r\n\r\n        if (components && key) {\r\n            return components[key];\r\n        }\r\n\r\n        return components;\r\n    }\r\n\r\n    destroy() {\r\n        this.#isDestroyed = true;\r\n\r\n        for (const component of Object.values(this.components)) {\r\n            if (component instanceof Component) {\r\n                component.destroy();\r\n            } else {\r\n                for (const nestedComponent of Object.values(component)) {\r\n                    nestedComponent.destroy();\r\n                }\r\n            }\r\n        }\r\n\r\n        this.ecs.entities.onEntityDestroyed(this);\r\n    }\r\n\r\n    add(typeOrClass, properties = {}) {\r\n        const component = this.ecs.components.create(typeOrClass, properties);\r\n\r\n        if (!component) {\r\n            console.warn(\r\n                `\"${typeOrClass}\" component cannot be added, since it is not registered.`\r\n            );\r\n            return false;\r\n        }\r\n\r\n        return this.attach(component);\r\n    }\r\n\r\n    attach(component) {\r\n        const accessor = this.ecs.components.getAccessor(component.type);\r\n\r\n        if (!component.allowMultiple) {\r\n            if (this.has(component.type)) {\r\n                console.warn(\r\n                    `\"${component.type}\" component has allowMultiple set to ${component.allowMultiple}. Trying to add a \"${component.type}\" component to an entity which already has one.`\r\n                );\r\n                return false;\r\n            }\r\n\r\n            this.components[accessor] = component;\r\n\r\n            Object.defineProperty(this, accessor, {\r\n                enumerable: true,\r\n                configurable: true,\r\n                get() {\r\n                    return this.components[accessor];\r\n                },\r\n            });\r\n\r\n            component._onAttached(this);\r\n            this.ecs.queries.onComponentAdded(this);\r\n\r\n            return true;\r\n        }\r\n\r\n        if (!component.keyProperty) {\r\n            if (!this.components[accessor]) {\r\n                this.components[accessor] = [];\r\n                Object.defineProperty(this, accessor, {\r\n                    configurable: true,\r\n                    enumerable: true,\r\n                    get() {\r\n                        return this.components[accessor];\r\n                    },\r\n                });\r\n            }\r\n\r\n            this.components[accessor].push(component);\r\n\r\n            component._onAttached(this);\r\n            this.ecs.queries.onComponentAdded(this);\r\n\r\n            return true;\r\n        }\r\n\r\n        if (!component.key) {\r\n            console.warn(\r\n                `\"${component.type}\" component has a falsy key of \"${component.key}\". The keyProperty is set to \"${component.keyProperty}\".`\r\n            );\r\n            return false;\r\n        }\r\n\r\n        if (!this.components[accessor]) {\r\n            this.components[accessor] = {};\r\n            Object.defineProperty(this, accessor, {\r\n                configurable: true,\r\n                enumerable: true,\r\n                get() {\r\n                    return this.components[accessor];\r\n                },\r\n            });\r\n        }\r\n\r\n        this.components[accessor][component.key] = component;\r\n\r\n        component._onAttached(this);\r\n        this.ecs.queries.onComponentAdded(this, component);\r\n\r\n        return true;\r\n    }\r\n\r\n    owns(component) {\r\n        return component.entity === this;\r\n    }\r\n\r\n    remove(typeOrClassOrComponent, key = null) {\r\n        const isComponent = typeOrClassOrComponent instanceof Component;\r\n        key = isComponent ? typeOrClassOrComponent.key : key;\r\n\r\n        const definition = this.ecs.components.get(typeOrClassOrComponent);\r\n\r\n        const accessor = this.ecs.components.getAccessor(definition.type);\r\n\r\n        if (definition.allowMultiple) {\r\n            if (!definition.keyProperty) {\r\n                if (isComponent) {\r\n                    const all = this.components[accessor];\r\n\r\n                    if (!all) {\r\n                        console.warn(\r\n                            `Trying to remove a \"${definition.type}\" component from an entity, but it wasn't found.`\r\n                        );\r\n                        return;\r\n                    }\r\n\r\n                    const index = all.indexOf(typeOrClassOrComponent);\r\n\r\n                    if (index > -1) {\r\n                        all.splice(index, 1);\r\n                        typeOrClassOrComponent._onDetached();\r\n\r\n                        if (all.length === 0) {\r\n                            delete this[accessor];\r\n                            delete this.components[accessor];\r\n                        }\r\n\r\n                        this.ecs.queries.onComponentRemoved(this);\r\n\r\n                        return true;\r\n                    }\r\n                } else {\r\n                    for (const instance of this.components[accessor]) {\r\n                        instance._onDetached();\r\n                    }\r\n\r\n                    delete this[accessor];\r\n                    delete this.components[accessor];\r\n                    this.ecs.queries.onComponentRemoved(this);\r\n\r\n                    return true;\r\n                }\r\n            }\r\n\r\n            if (!key) {\r\n                console.warn(\r\n                    `Trying to remove a \"${definition.type}\" component which allows multiple without specifying an key.`\r\n                );\r\n                return;\r\n            }\r\n\r\n            const all = this.components[accessor];\r\n            const component = all[key];\r\n\r\n            if (component) {\r\n                delete all[key];\r\n                component._onDetached();\r\n                if (Object.keys(all).length <= 0) {\r\n                    delete this[accessor];\r\n                    delete this.components[accessor];\r\n                }\r\n                this.ecs.queries.onComponentRemoved(this);\r\n\r\n                return component;\r\n            } else {\r\n                console.warn(\r\n                    `Trying to remove a \"${definition.type}\" component from an entity at \"${key}\", but it wasn't found.`\r\n                );\r\n                return;\r\n            }\r\n        }\r\n\r\n        if (accessor in this) {\r\n            const component = this.components[accessor];\r\n\r\n            delete this[accessor];\r\n            delete this.components[accessor];\r\n            component._onDetached();\r\n            this.ecs.queries.onComponentRemoved(this);\r\n\r\n            return component;\r\n        }\r\n\r\n        console.warn(\r\n            `Trying to remove a \"${definition.type}\" component from an entity, but it wasn't found.`\r\n        );\r\n    }\r\n\r\n    serialize() {\r\n        return Object.entries(this.components).reduce(\r\n            (o, [key, value]) => {\r\n                if (value instanceof Component) {\r\n                    return {\r\n                        ...o,\r\n                        [key]: value.serialize(),\r\n                    };\r\n                }\r\n\r\n                if (Array.isArray(value)) {\r\n                    return {\r\n                        ...o,\r\n                        [key]: value.map((v) => v.serialize()),\r\n                    };\r\n                }\r\n\r\n                return {\r\n                    ...o,\r\n                    [key]: Object.entries(value).reduce(\r\n                        (o2, [k2, v2]) => ({\r\n                            ...o2,\r\n                            [k2]: v2.serialize(),\r\n                        }),\r\n                        {}\r\n                    ),\r\n                };\r\n            },\r\n            {\r\n                id: this.id,\r\n            }\r\n        );\r\n    }\r\n\r\n    fireEvent(name, data) {\r\n        const evt = new EntityEvent(name, data);\r\n\r\n        for (const component of Object.values(this.components)) {\r\n            if (component instanceof Component) {\r\n                component._onEvent(evt);\r\n\r\n                if (evt.prevented) {\r\n                    return evt;\r\n                }\r\n            } else {\r\n                for (const nestedComponent of Object.values(component)) {\r\n                    nestedComponent._onEvent(evt);\r\n\r\n                    if (evt.prevented) {\r\n                        return evt;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return evt;\r\n    }\r\n}\r\n","import Entity from '../Entity';\nimport camelcase from 'camelcase';\n\nexport default class EntityRegistry {\n    #entities = new Map();\n    #ecs = null;\n    #refs = new Map();\n\n    constructor(ecs) {\n        this.#ecs = ecs;\n    }\n\n    get all() {\n        return this.#entities.values();\n    }\n\n    register(entity) {\n        this.#entities.set(entity.id, entity);\n\n        return entity;\n    }\n\n    get(id) {\n        return this.#entities.get(id);\n    }\n\n    createOrGetById(id) {\n        const entity = this.get(id);\n\n        if (entity) {\n            return entity;\n        }\n\n        return this.create(id);\n    }\n\n    create(id = undefined) {\n        const entity = new Entity(this.#ecs, id);\n\n        this.register(entity);\n\n        this.#ecs.queries.onEntityCreated(entity);\n\n        return entity;\n    }\n\n    destroy(entity) {\n        entity.destroy();\n    }\n\n    onEntityDestroyed(entity) {\n        this.cleanupRefs(entity);\n        this.#entities.delete(entity.id);\n        this.#ecs.queries.onEntityDestroyed(entity);\n    }\n\n    cleanupRefs(entity) {\n        const refs = this.#refs.get(entity.id);\n\n        if (!refs) {\n            return;\n        }\n\n        for (const ref of refs) {\n            ref.cleanupReference(entity);\n        }\n\n        delete this.#refs[entity.id];\n    }\n\n    addRef(entityId, property) {\n        if (!this.#refs.has(entityId)) {\n            this.#refs.set(entityId, new Set([property]));\n            return;\n        }\n\n        this.#refs.get(entityId).add(property);\n    }\n\n    removeRef(entityId, property) {\n        if (this.#refs.has(entityId)) {\n            this.#refs.get(entityId).delete(property);\n        }\n    }\n\n    serialize() {\n        const json = [];\n\n        this.#entities.forEach((entity) => {\n            json.push(entity.serialize());\n        });\n\n        return json;\n    }\n\n    deserialize(data) {\n        for (const entityData of data.entities) {\n            this.createOrGetById(entityData.id);\n        }\n\n        for (const entityData of data.entities) {\n            this.deserializeEntity(entityData);\n        }\n    }\n\n    deserializeEntity(data) {\n        const { id, ...componentData } = data;\n        const entity = this.createOrGetById(id);\n\n        Object.entries(componentData).forEach(([key, value]) => {\n            const type = camelcase(key, { pascalCase: true });\n            const definition = this.#ecs.components.get(type);\n\n            if (definition.allowMultiple) {\n                Object.values(value).forEach((d) => {\n                    entity.add(definition, d);\n                });\n            } else {\n                entity.add(definition, value);\n            }\n        });\n    }\n}\n","import merge from 'deepmerge';\n\nexport default class Query {\n    #ecs;\n    #filter;\n    #cache = new Set();\n\n    constructor(ecs, filter = {}) {\n        this.#ecs = ecs;\n        this.#filter = merge({ any: [], all: [], none: [] }, filter);\n        this.bustCache();\n    }\n\n    isMatch(entity) {\n        const hasAny = this.#filter.any.length\n            ? this.#filter.any.some((c) => entity.has(c))\n            : true;\n        const hasAll = this.#filter.all.every((c) => entity.has(c));\n        const hasNone = !this.#filter.none.some((c) => entity.has(c));\n\n        return hasAny && hasAll && hasNone;\n    }\n\n    candidate(entity) {\n        if (this.isMatch(entity)) {\n            this.#cache.add(entity);\n            return true;\n        }\n\n        this.#cache.delete(entity);\n        return false;\n    }\n\n    _onEntityCreated(entity) {\n        this.candidate(entity);\n    }\n\n    _onComponentAdded(entity) {\n        this.candidate(entity);\n    }\n\n    _onComponentRemoved(entity) {\n        this.candidate(entity);\n    }\n\n    _onEntityDestroyed(entity) {\n        this.#cache.delete(entity);\n    }\n\n    bustCache() {\n        this.#cache.clear();\n\n        for (const entity of this.#ecs.entities.all) {\n            this.candidate(entity);\n        }\n\n        return this.#cache;\n    }\n\n    get() {\n        return this.#cache;\n    }\n}\n","import Query from '../Query';\n\nexport default class QueryRegistry {\n    #ecs;\n    #queries = [];\n\n    constructor(ecs) {\n        this.#ecs = ecs;\n    }\n\n    create(filters) {\n        const query = new Query(this.#ecs, filters);\n\n        this.#queries.push(query);\n\n        return query;\n    }\n\n    onComponentAdded(entity) {\n        this.#queries.forEach((query) => query._onComponentAdded(entity));\n    }\n\n    onComponentRemoved(entity) {\n        this.#queries.forEach((query) => query._onComponentRemoved(entity));\n    }\n\n    onEntityCreated(entity) {\n        this.#queries.forEach((query) => query._onEntityCreated(entity));\n    }\n\n    onEntityDestroyed(entity) {\n        this.#queries.forEach((query) => query._onEntityDestroyed(entity));\n    }\n}\n","import ComponentRegistry from './registries/ComponentRegistry';\nimport PrefabRegistry from './registries/PrefabRegistry';\nimport { nanoid } from 'nanoid/non-secure';\nimport EntityRegistry from './registries/EntityRegistry';\nimport QueryRegistry from './registries/QueryRegistry';\n\nexport default class Engine {\n    constructor() {\n        this.idGenerator = () => nanoid();\n        this.components = new ComponentRegistry(this);\n        this.prefabs = new PrefabRegistry(this);\n        this.entities = new EntityRegistry(this);\n        this.queries = new QueryRegistry(this);\n    }\n\n    generateId() {\n        return this.idGenerator();\n    }\n\n    createEntity() {\n        return this.entities.create();\n    }\n\n    createPrefab(nameOrClass, initialProps = {}) {\n        return this.prefabs.create(nameOrClass, initialProps);\n    }\n\n    destroyEntity(entity) {\n        return this.entities.destroy(entity);\n    }\n\n    registerPrefab(data) {\n        this.prefabs.deserialize(data);\n    }\n\n    registerComponent(component) {\n        this.components.register(component);\n    }\n\n    getEntity(id) {\n        return this.entities.get(id);\n    }\n\n    createComponent(type, properties) {\n        return this.components.create(type, properties);\n    }\n\n    createQuery(filters) {\n        return this.queries.create(filters);\n    }\n\n    serialize() {\n        return {\n            entities: this.entities.serialize(),\n        };\n    }\n\n    deserialize(data) {\n        if (data.id) {\n            return this.entities.deserializeEntity(data);\n        }\n\n        return this.entities.deserialize(data);\n    }\n}\n","import { Component } from 'geotic';\nimport { SUCCESS, INVALID, FAILURE } from '../../ai/GoalActionResult';\n\nexport class Brain extends Component {\n    static properties = {\n        goals: '<EntityArray>',\n    };\n\n    onTakeAction(evt) {\n        while (this.peekGoal() && this.peekGoal().isFinished()) {\n            this.popGoal().entity.destroy();\n        }\n\n        const currentGoal = this.peekGoal();\n        const result = currentGoal.takeAction();\n\n        if (result === FAILURE) {\n            this.removeGoal(currentGoal);\n        } else if (result === INVALID) {\n            this.removeGoal(currentGoal);\n            this.entity.fireEvent('take-action');\n        }\n\n        evt.handle();\n    }\n\n    removeGoal(goal) {\n        const goalsToDestroy = [];\n\n        this.goals = this.goals.filter((g) => {\n            const isSelf = Boolean(g.id === goal.entity.id);\n            const isSiblingGoal = Boolean(\n                g.goal.originalIntent &&\n                    g.goal.originalIntent.id === goal.originalIntent.id\n            );\n\n            if (isSelf || isSiblingGoal) {\n                goalsToDestroy.push(g.goal);\n                return false;\n            }\n\n            return true;\n        });\n\n        goalsToDestroy.forEach((g) => g.entity.destroy());\n    }\n\n    pushGoal(goal) {\n        if (!(goal instanceof Component)) {\n            throw new Error('Pushing non-component goal!', goal);\n        }\n\n        goal.parent = this.entity;\n\n        return this.goals.push(goal.entity);\n    }\n\n    popGoal() {\n        return this.goals.pop().goal;\n    }\n\n    peekGoal() {\n        return this.goals[this.goals.length - 1].goal;\n    }\n}\n","export const SUCCESS = 'SUCCESS';\nexport const FAILURE = 'FAILURE';\nexport const INVALID = 'INVALID';\n","import { Component } from 'geotic';\nimport * as GoalEvaluator from '../../ai/GoalEvaluator';\n\nexport class Goal extends Component {\n    static properties = {\n        name: 'Bored',\n        originalIntent: '<Entity>',\n        parent: '<Entity>',\n        target: '<Entity>',\n        complete: false,\n        data: {},\n    };\n\n    isFinished() {\n        return GoalEvaluator.isFinished(this.parent, this);\n    }\n\n    takeAction() {\n        return GoalEvaluator.takeAction(this.parent, this);\n    }\n}\n","import * as GoalTypes from './GoalTypes';\n\nconst goalTypeMap = {};\n\nObject.values(GoalTypes).forEach((goalType) => {\n    goalTypeMap[goalType.name] = goalType;\n});\n\nconst getGoalType = (name) => {\n    const type = goalTypeMap[name];\n\n    if (!type) {\n        console.warn(`GoalType (${name}) not found!`);\n    }\n\n    return type;\n};\n\nexport const isFinished = (entity, goal) => {\n    const type = getGoalType(goal.name);\n\n    return type.isFinished(entity, goal);\n};\n\nexport const takeAction = (entity, goal) => {\n    const type = getGoalType(goal.name);\n\n    return type.takeAction(entity, goal);\n};\n","import { GoalType } from './GoalType';\nimport { SUCCESS } from '../GoalActionResult';\n\nexport class BoredGoalType extends GoalType {\n    static name = 'Bored';\n\n    static isFinished = (entity, goal) => {\n        return false;\n    };\n\n    static takeAction = (entity, goal) => {\n        const evt = entity.fireEvent('boredom');\n\n        if (evt.data.goal) {\n            entity.brain.pushGoal(evt.data.goal);\n            entity.fireEvent('take-action');\n\n            return SUCCESS;\n        }\n\n        entity.fireEvent('consume-energy', 1000);\n\n        return SUCCESS;\n    };\n}\n","import { FAILURE } from '../GoalActionResult';\nimport { game } from '../../core/Game';\n\nexport class GoalType {\n    static name = 'Unknown';\n\n    static isFinished(entity, goal) {\n        return false;\n    }\n\n    static takeAction(entity, goal) {\n        return FAILURE;\n    }\n\n    static createAsSubGoal(originalIntent, properties = {}) {\n        return this.create({\n            ...properties,\n            originalIntent: originalIntent.entity.id,\n        });\n    }\n\n    static create(properties = {}) {\n        return game.ecs.createPrefab('Goal', {\n            goal: {\n                name: this.name,\n                ...properties,\n            },\n        }).goal;\n    }\n}\n","import { GoalType } from './GoalType';\nimport { SUCCESS, FAILURE } from '../GoalActionResult';\n\nexport class EatFoodGoalType extends GoalType {\n    static name = 'EatFood';\n\n    static isFinished = (entity, goal) => {\n        return goal.complete;\n    };\n\n    static takeAction = (entity, goal) => {\n        const evt = entity.fireEvent('try-eat-food', {\n            food: 10000,\n        });\n\n        if (evt.handled) {\n            goal.complete = true;\n\n            return SUCCESS;\n        }\n\n        return FAILURE;\n    };\n}\n","import { GoalType } from './GoalType';\nimport { EatFoodGoalType } from './EatFoodGoalType';\nimport { SUCCESS } from '../GoalActionResult';\n\nexport class SatisfyHungerGoalType extends GoalType {\n    static name = 'SatisfyHunger';\n\n    static isFinished = (entity, goal) => {\n        return !entity.eater.isHungry;\n    };\n\n    static takeAction = (entity, goal) => {\n        entity.brain.pushGoal(EatFoodGoalType.createAsSubGoal(goal));\n        entity.brain.pushGoal(EatFoodGoalType.createAsSubGoal(goal));\n\n        entity.fireEvent('take-action');\n\n        return SUCCESS;\n    };\n}\n","import { GoalType } from './GoalType';\nimport { SUCCESS, FAILURE } from '../GoalActionResult';\n\nexport class MoveGoalType extends GoalType {\n    static name = 'Move';\n\n    static isFinished = (entity, goal) => {\n        return goal.complete;\n    };\n\n    static takeAction = (entity, goal) => {\n        const evt = entity.fireEvent('try-move', {\n            x: goal.data.x,\n            y: goal.data.y,\n        });\n\n        if (evt.handled) {\n            goal.complete = true;\n\n            return SUCCESS;\n        }\n\n        return FAILURE;\n    };\n}\n","import { Component } from 'geotic';\nimport { SatisfyHungerGoalType } from '../../ai/GoalTypes';\n\nexport class Eater extends Component {\n    static properties = {\n        hunger: 6000,\n    };\n\n    get isHungry() {\n        return this.hunger <= 3000;\n    }\n\n    onBoredom(evt) {\n        if (this.isHungry) {\n            evt.data.goal = SatisfyHungerGoalType.create();\n            evt.handle();\n        }\n    }\n\n    onTryEatFood(evt) {\n        if (Math.random() < 0.75) {\n            this.entity.fireEvent('log', 'eats some food');\n            this.hunger += evt.data.food;\n            this.entity.fireEvent('energy-consumed', 150);\n\n            evt.handle();\n        } else {\n            this.entity.fireEvent('log', 'fails to eat the food');\n        }\n    }\n}\n","import { Component } from 'geotic';\n\nexport class Moniker extends Component {\n    static properties = {\n        name: 'Unknown',\n    };\n}\n","import { Component } from 'geotic';\nimport { Moniker } from './Moniker';\n\nexport class Logger extends Component {\n    get moniker() {\n        return this.entity.has(Moniker) ? this.entity.moniker.name : 'Unknown';\n    }\n\n    onLog(evt) {\n        console.log(`[${this.moniker}]`, evt.data);\n        evt.handle();\n    }\n}\n","import { Component } from 'geotic';\n\nexport class Position extends Component {\n    static properties = {\n        x: 0,\n        y: 0,\n    };\n}\n","import { Component } from 'geotic';\nimport { MapLayer } from './MapLayer';\n\nexport class Map extends Component {\n    static properties = {\n        name: '',\n        width: 32,\n        height: 32,\n    };\n\n    get map() {\n        return this.mapEntity.map;\n    }\n\n    idx(x, y) {\n        return y * this.width + x;\n    }\n\n    coord(idx) {\n        return idx % this.width, idx / this.width;\n    }\n\n    getLayer(name) {\n        return this.entity.get(MapLayer, name);\n    }\n}\n","import { Component } from 'geotic';\n\nexport class MapLayer extends Component {\n    static properties = {\n        mapEntity: '<Entity>',\n        name: '',\n        content: '<EntityArray>',\n    };\n\n    get map() {\n        return this.mapEntity.map;\n    }\n\n    getByIndex(idx) {\n        return content[idx];\n    }\n\n    get(x, y) {}\n}\n","import { Component } from 'geotic';\n\nexport class Glyph extends Component {\n    static properties = {\n        fg: '#fff',\n        bg: '',\n        char: '',\n    };\n}\n","import { Component } from 'geotic';\nimport { Position } from './Position';\nimport { Actor } from './Actor';\n\nexport class Legs extends Component {\n    onTryMove(evt) {\n        if (!this.entity.has(Position)) {\n            return;\n        }\n\n        if (this.entity.has(Actor) && !this.entity.actor.hasEnergy) {\n            console.log('NO ENERGY');\n            return;\n        }\n\n        this.entity.position.x += evt.data.x;\n        this.entity.position.y += evt.data.y;\n        this.entity.fireEvent('energy-consumed', 750);\n\n        evt.handle();\n    }\n}\n","import { Component } from 'geotic';\nimport { DIR_Z } from '../../enums/Directions';\n\nexport class MoveCommand extends Component {\n    static properties = {\n        direction: DIR_Z,\n    };\n}\n","const directions = [\n    {\n        key: 0,\n        shortName: 'NW',\n        fullName: 'Northwest',\n        delta: {\n            x: -1,\n            y: -1,\n        },\n    },\n    {\n        key: 1,\n        shortName: 'N',\n        fullName: 'North',\n        delta: {\n            x: 0,\n            y: -1,\n        },\n    },\n    {\n        key: 2,\n        shortName: 'NE',\n        fullName: 'Northeast',\n        delta: {\n            x: 1,\n            y: -1,\n        },\n    },\n    {\n        key: 3,\n        shortName: 'W',\n        fullName: 'West',\n        delta: {\n            x: -1,\n            y: 0,\n        },\n    },\n    {\n        key: 4,\n        shortName: 'Z',\n        fullName: 'Here',\n        delta: {\n            x: 0,\n            y: 0,\n        },\n    },\n    {\n        key: 5,\n        shortName: 'E',\n        fullName: 'East',\n        delta: {\n            x: 1,\n            y: 0,\n        },\n    },\n    {\n        key: 6,\n        shortName: 'SW',\n        fullName: 'Southwest',\n        delta: {\n            x: -1,\n            y: 1,\n        },\n    },\n    {\n        key: 7,\n        shortName: 'S',\n        fullName: 'South',\n        delta: {\n            x: 0,\n            y: 1,\n        },\n    },\n    {\n        key: 8,\n        shortName: 'SE',\n        fullName: 'Southeast',\n        delta: {\n            x: 1,\n            y: 1,\n        },\n    },\n];\n\nexport const DIR_NW = 0;\nexport const DIR_N = 1;\nexport const DIR_NE = 2;\nexport const DIR_W = 3;\nexport const DIR_Z = 4;\nexport const DIR_E = 5;\nexport const DIR_SW = 6;\nexport const DIR_S = 7;\nexport const DIR_SE = 8;\n\nexport const shortName = (direction) => directions[direction].shortName;\n\nexport const fullName = (direction) => directions[direction].fullName;\n\nexport const delta = (direction) => directions[direction].delta;\n","import { Component } from 'geotic';\n\nexport class IsPlayer extends Component {}\n","import { Component } from 'geotic';\nimport { MoveGoalType } from '../../ai/GoalTypes';\nimport * as Directions from '../../enums/Directions';\n\nexport class Wandering extends Component {\n    onBoredom(evt) {\n        if (Math.random() < 0.25) {\n            const direction = Math.floor(Math.random() * 9);\n            const delta = Directions.delta(direction);\n\n            evt.data.goal = MoveGoalType.create({\n                data: delta,\n            });\n            evt.handle();\n        }\n    }\n}\n","export default class System {\n    #game = null;\n\n    get game() {\n        return this.#game;\n    }\n\n    constructor(game) {\n        this.#game = game;\n    }\n\n    update(dt) {}\n}\n","import ecs from '../ecs';\nimport { Actor } from '../ecs/components';\nimport System from './System';\n\nexport default class ActionSystem extends System {\n    #query = null;\n\n    constructor(game) {\n        super(game);\n\n        this.#query = game.ecs.createQuery({\n            all: [Actor],\n        });\n    }\n\n    update(dt) {\n        const entities = this.#query.get();\n        const sorted = Array.from(entities);\n        sorted.sort((a, b) => (a.actor.energy < b.actor.energy ? 1 : -1));\n\n        let entity = sorted[0];\n\n        if (!entity.actor.hasEnergy) {\n            this.game.clock.incrementTick(-1 * entity.actor.energy);\n\n            entities.forEach((entity) => {\n                entity.actor.addEnergy(this.game.clock.tickDelta);\n            });\n        }\n\n        while (entity.actor.hasEnergy && !entity.isPlayer) {\n            entity.fireEvent('take-action');\n            entity = sorted.shift();\n        }\n    }\n}\n","import { Engine } from 'geotic';\n\nimport * as components from './components';\nimport * as prefabs from './prefabs';\nimport Manager from '../core/Manager';\n\nexport default class ECS extends Manager {\n    #engine;\n\n    get engine() {\n        return this.#engine;\n    }\n\n    constructor(game) {\n        super(game);\n        this.#engine = new Engine();\n\n        Object.values(components).forEach((component) => {\n            this.#engine.registerComponent(component);\n        });\n\n        Object.values(prefabs).forEach((prefab) => {\n            this.#engine.registerPrefab(prefab);\n        });\n    }\n\n    onNewGame() {\n        for (let entity of this.#engine.entities.all) {\n            entity.destroy();\n        }\n    }\n\n    onSaveGame() {\n        return {\n            engine: this.#engine.serialize(),\n        };\n    }\n\n    onLoadGame(data) {\n        for (let entity of this.#engine.entities.all) {\n            entity.destroy();\n        }\n\n        this.#engine.deserialize(data.engine);\n    }\n}\n","import { Glyph, Position } from '../ecs/components';\nimport System from './System';\n\nexport default class RenderSystem extends System {\n    #query = null;\n\n    constructor(game) {\n        super(game);\n        this.#query = game.ecs.createQuery({\n            all: [Glyph, Position],\n        });\n    }\n\n    render() {\n        this.game.renderer.clear();\n\n        this.#query.get().forEach((renderable) => {\n            this.game.renderer.draw(\n                renderable.position.x,\n                renderable.position.y,\n                renderable.glyph.char,\n                renderable.glyph.fg,\n                renderable.glyph.bg\n            );\n        });\n    }\n\n    update(dt) {\n        if (!this.game.clock.tickDelta) {\n            return;\n        }\n\n        this.render();\n    }\n}\n","import { MoveCommand, Position } from '../ecs/components';\nimport * as Directions from '../enums/Directions';\nimport System from './System';\n\nexport default class MovementSystem extends System {\n    #query = null;\n\n    constructor(game) {\n        super(game);\n        this.#query = game.ecs.createQuery({\n            all: [MoveCommand, Position],\n        });\n    }\n\n    update(dt) {\n        this.#query.get().forEach((entity) => {\n            const delta = Directions.delta(entity.moveCommand.direction);\n\n            entity.fireEvent('TryMove', delta);\n\n            entity.moveCommand.destroy();\n        });\n    }\n}\n","import { Moniker, Actor } from '../ecs/components';\nimport System from './System';\n\nexport default class UISystem extends System {\n    #query = null;\n\n    constructor(game) {\n        super(game);\n        this.#query = this.game.ecs.createQuery({\n            all: [Moniker, Actor],\n        });\n    }\n\n    update(dt) {\n        const turn = this.game.clock.turn;\n        const subTurn = `${this.game.clock.subTurn}`.padEnd(3, '0');\n\n        const x = this.game.mouse.x;\n        const y = this.game.mouse.y;\n        const hasMouse = this.game.mouse.hasMouse;\n\n        this.game.renderer.drawText(\n            1,\n            1,\n            `Knossonia (${x}, ${y}) ${hasMouse}`\n        );\n\n        this.game.renderer.drawText(\n            this.game.renderer.width - 5 - `${turn}`.length,\n            1,\n            `${turn}.${subTurn}`\n        );\n    }\n}\n","import Manager from '../Manager';\n\nexport default class MouseManager extends Manager {\n    #x = 0;\n    #y = 0;\n    #hasMouse = false;\n\n    get x() {\n        return this.#x;\n    }\n\n    get y() {\n        return this.#y;\n    }\n\n    get hasMouse() {\n        return this.#hasMouse;\n    }\n\n    updatePosition(x, y) {\n        this.#x = Math.max(0, x);\n        this.#y = Math.max(0, y);\n    }\n\n    updateMouseEnter() {\n        this.#hasMouse = true;\n    }\n\n    updateMouseLeave() {\n        this.#hasMouse = false;\n    }\n}\n","import { INPUT_DOMAIN_DEFAULT } from './InputDomainType';\nimport commands from './commands';\nimport Manager from '../Manager';\n\nexport default class CommandManager extends Manager {\n    #commands = {};\n    #domainStack = [INPUT_DOMAIN_DEFAULT];\n\n    constructor(game) {\n        super(game);\n        commands.forEach((cmd) => this.registerCommand(cmd));\n    }\n\n    onInputEvent(evt) {\n        const cmd = this.getCommandForInputEvent(evt);\n\n        if (cmd) {\n            this.game.screens.onInputCommand(cmd);\n        }\n    }\n\n    pushDomain(domain) {\n        this.#domainStack.push(domain);\n    }\n\n    popDomain(domain) {\n        const index = this.#domainStack.lastIndexOf(domain);\n\n        if (index > -1) {\n            this.#domainStack.splice(index, 1);\n        }\n    }\n\n    getDomainCommands(domain) {\n        return this.#commands[domain] || [];\n    }\n\n    getCommandForInputEvent(evt) {\n        for (let i = this.#domainStack.length - 1; i >= 0; i--) {\n            const domain = this.#domainStack[i];\n            const cmds = this.getDomainCommands(domain);\n            const cmd = cmds.find((cmd) => cmd.matches(evt));\n\n            if (cmd) {\n                return cmd;\n            }\n        }\n    }\n\n    registerCommand(command) {\n        if (!this.#commands[command.domain]) {\n            this.#commands[command.domain] = [];\n        }\n\n        this.#commands[command.domain].push(command);\n    }\n}\n","export const INPUT_DOMAIN_DEFAULT = 0;\nexport const INPUT_DOMAIN_MAIN_MENU = 1;\nexport const INPUT_DOMAIN_ADVENTURE = 2;\nexport const INPUT_DOMAIN_LOOK = 3;\n","import {\n    INPUT_DOMAIN_MAIN_MENU,\n    INPUT_DOMAIN_DEFAULT,\n    INPUT_DOMAIN_ADVENTURE,\n} from './InputDomainType';\nimport InputCommand from './InputCommand';\nimport {\n    INPUT_CMD_WAIT,\n    INPUT_CMD_MOVE_NW,\n    INPUT_CMD_MOVE_N,\n    INPUT_CMD_MOVE_NE,\n    INPUT_CMD_MOVE_W,\n    INPUT_CMD_MOVE_E,\n    INPUT_CMD_MOVE_SW,\n    INPUT_CMD_MOVE_S,\n    INPUT_CMD_MOVE_SE,\n    INPUT_CMD_CONFIRM,\n    INPUT_CMD_CANCEL,\n    INPUT_CMD_SAVE,\n    INPUT_CMD_LOAD,\n    INPUT_CMD_LOOK,\n} from './InputCommandType';\nimport {\n    KEY_S,\n    KEY_Q,\n    KEY_W,\n    KEY_E,\n    KEY_A,\n    KEY_D,\n    KEY_Z,\n    KEY_X,\n    KEY_C,\n    KEY_ENTER,\n    KEY_ESCAPE,\n    KEY_UP,\n    KEY_LEFT,\n    KEY_RIGHT,\n    KEY_DOWN,\n    KEY_SPACE,\n    KEY_L,\n} from './KeyCodes';\n\nconst cmd = (domain, type, name, isKeyboard, key, shift, ctrl, alt, meta) =>\n    new InputCommand({\n        domain,\n        type,\n        name,\n        isKeyboard,\n        key,\n        shift,\n        ctrl,\n        alt,\n        meta,\n    });\n\n// prettier-ignore\nexport default [\n    // DOMAIN                   CMD                 NAME        KB    KEY           SHIFT  CTRL   ALT    META\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_CONFIRM,  'confirm',  true, KEY_ENTER,    false, false, false, false),\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_CONFIRM,  'confirm2', true, KEY_SPACE,    false, true,  false, false),\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_CANCEL,   'cancel',   true, KEY_ESCAPE,   false, false, false, false),\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_SAVE,     'save',     true, KEY_S,        false, true,  false, false),\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_LOAD,     'load',     true, KEY_L,        false, true,  false, false),\n    cmd(INPUT_DOMAIN_ADVENTURE, INPUT_CMD_WAIT,     'wait',     true, KEY_S,        false, false, false, false),\n    cmd(INPUT_DOMAIN_ADVENTURE, INPUT_CMD_MOVE_NW,  'move_nw',  true, KEY_Q,        false, false, false, false),\n    cmd(INPUT_DOMAIN_ADVENTURE, INPUT_CMD_MOVE_N,   'move_n',   true, KEY_W,        false, false, false, false),\n    cmd(INPUT_DOMAIN_ADVENTURE, INPUT_CMD_MOVE_N,   'move_n2',  true, KEY_UP,       false, false, false, false),\n    cmd(INPUT_DOMAIN_ADVENTURE, INPUT_CMD_MOVE_NE,  'move_ne',  true, KEY_E,        false, false, false, false),\n    cmd(INPUT_DOMAIN_ADVENTURE, INPUT_CMD_MOVE_W,   'move_w',   true, KEY_A,        false, false, false, false),\n    cmd(INPUT_DOMAIN_ADVENTURE, INPUT_CMD_MOVE_W,   'move_w2',  true, KEY_LEFT,     false, false, false, false),\n    cmd(INPUT_DOMAIN_ADVENTURE, INPUT_CMD_MOVE_E,   'move_e',   true, KEY_D,        false, false, false, false),\n    cmd(INPUT_DOMAIN_ADVENTURE, INPUT_CMD_MOVE_E,   'move_e2',  true, KEY_RIGHT,    false, false, false, false),\n    cmd(INPUT_DOMAIN_ADVENTURE, INPUT_CMD_MOVE_SW,  'move_sw',  true, KEY_Z,        false, false, false, false),\n    cmd(INPUT_DOMAIN_ADVENTURE, INPUT_CMD_MOVE_S,   'move_s',   true, KEY_X,        false, false, false, false),\n    cmd(INPUT_DOMAIN_ADVENTURE, INPUT_CMD_MOVE_S,   'move_s2',  true, KEY_DOWN,     false, false, false, false),\n    cmd(INPUT_DOMAIN_ADVENTURE, INPUT_CMD_MOVE_SE,  'move_se',  true, KEY_C,        false, false, false, false),\n    cmd(INPUT_DOMAIN_ADVENTURE, INPUT_CMD_LOOK,     'look',     true, KEY_L,        false, false, false, false),\n];\n","import InputKeyboardEvent from './events/InputEvent';\n\nexport default class InputCommand {\n    constructor(data) {\n        this.domain = data.domain;\n        this.type = data.type;\n        this.name = data.name;\n        this.isKeyboard = data.isKeyboard;\n        this.key = data.key;\n        this.shift = data.shift;\n        this.ctrl = data.ctrl;\n        this.alt = data.alt;\n        this.meta = data.meta;\n    }\n\n    matches(inputEvent) {\n        const isKeyboard = inputEvent instanceof InputKeyboardEvent;\n\n        return (\n            this.isKeyboard == isKeyboard &&\n            this.key == inputEvent.key &&\n            this.shift == inputEvent.shift &&\n            this.ctrl == inputEvent.ctrl &&\n            this.alt == inputEvent.alt &&\n            this.meta == inputEvent.meta\n        );\n    }\n}\n","export const INPUT_CMD_MOVE_NW = 0;\nexport const INPUT_CMD_MOVE_N = 1;\nexport const INPUT_CMD_MOVE_NE = 2;\nexport const INPUT_CMD_MOVE_W = 3;\nexport const INPUT_CMD_MOVE_E = 4;\nexport const INPUT_CMD_MOVE_SW = 5;\nexport const INPUT_CMD_MOVE_S = 6;\nexport const INPUT_CMD_MOVE_SE = 7;\nexport const INPUT_CMD_WAIT = 8;\nexport const INPUT_CMD_CONFIRM = 9;\nexport const INPUT_CMD_CANCEL = 10;\nexport const INPUT_CMD_SAVE = 11;\nexport const INPUT_CMD_LOAD = 12;\nexport const INPUT_CMD_LOOK = 13;\n","export const KEY_CANCEL = 3;\nexport const KEY_HELP = 6;\nexport const KEY_BACK_SPACE = 8;\nexport const KEY_TAB = 9;\nexport const KEY_CLEAR = 12;\nexport const KEY_ENTER = 13;\nexport const KEY_ENTER_SPECIAL = 14;\nexport const KEY_SHIFT = 16;\nexport const KEY_CONTROL = 17;\nexport const KEY_ALT = 18;\nexport const KEY_PAUSE = 19;\nexport const KEY_CAPS_LOCK = 20;\nexport const KEY_KANA = 21;\nexport const KEY_EISU = 22;\nexport const KEY_JUNJA = 23;\nexport const KEY_FINAL = 24;\nexport const KEY_HANJA = 25;\nexport const KEY_ESCAPE = 27;\nexport const KEY_CONVERT = 28;\nexport const KEY_NONCONVERT = 29;\nexport const KEY_ACCEPT = 30;\nexport const KEY_MODECHANGE = 31;\nexport const KEY_SPACE = 32;\nexport const KEY_PAGE_UP = 33;\nexport const KEY_PAGE_DOWN = 34;\nexport const KEY_END = 35;\nexport const KEY_HOME = 36;\nexport const KEY_LEFT = 37;\nexport const KEY_UP = 38;\nexport const KEY_RIGHT = 39;\nexport const KEY_DOWN = 40;\nexport const KEY_SELECT = 41;\nexport const KEY_PRINT = 42;\nexport const KEY_EXECUTE = 43;\nexport const KEY_PRINTSCREEN = 44;\nexport const KEY_INSERT = 45;\nexport const KEY_DELETE = 46;\nexport const KEY_NUM_0 = 48;\nexport const KEY_NUM_1 = 49;\nexport const KEY_NUM_2 = 50;\nexport const KEY_NUM_3 = 51;\nexport const KEY_NUM_4 = 52;\nexport const KEY_NUM_5 = 53;\nexport const KEY_NUM_6 = 54;\nexport const KEY_NUM_7 = 55;\nexport const KEY_NUM_8 = 56;\nexport const KEY_NUM_9 = 57;\nexport const KEY_COLON = 58;\nexport const KEY_SEMICOLON = 59;\nexport const KEY_LESS_THAN = 60;\nexport const KEY_EQUALS = 61;\nexport const KEY_GREATER_THAN = 62;\nexport const KEY_QUESTION_MARK = 63;\nexport const KEY_AT = 64;\nexport const KEY_A = 65;\nexport const KEY_B = 66;\nexport const KEY_C = 67;\nexport const KEY_D = 68;\nexport const KEY_E = 69;\nexport const KEY_F = 70;\nexport const KEY_G = 71;\nexport const KEY_H = 72;\nexport const KEY_I = 73;\nexport const KEY_J = 74;\nexport const KEY_K = 75;\nexport const KEY_L = 76;\nexport const KEY_M = 77;\nexport const KEY_N = 78;\nexport const KEY_O = 79;\nexport const KEY_P = 80;\nexport const KEY_Q = 81;\nexport const KEY_R = 82;\nexport const KEY_S = 83;\nexport const KEY_T = 84;\nexport const KEY_U = 85;\nexport const KEY_V = 86;\nexport const KEY_W = 87;\nexport const KEY_X = 88;\nexport const KEY_Y = 89;\nexport const KEY_Z = 90;\nexport const KEY_META = 91; // windows key (windows) or command key (mac)\nexport const KEY_CONTEXT_MENU = 93;\nexport const KEY_SLEEP = 95;\nexport const KEY_NUMPAD_0 = 96;\nexport const KEY_NUMPAD_1 = 97;\nexport const KEY_NUMPAD_2 = 98;\nexport const KEY_NUMPAD_3 = 99;\nexport const KEY_NUMPAD_4 = 100;\nexport const KEY_NUMPAD_5 = 101;\nexport const KEY_NUMPAD_6 = 102;\nexport const KEY_NUMPAD_7 = 103;\nexport const KEY_NUMPAD_8 = 104;\nexport const KEY_NUMPAD_9 = 105;\nexport const KEY_MULTIPLY = 106;\nexport const KEY_ADD = 107;\nexport const KEY_SEPARATOR = 108;\nexport const KEY_SUBTRACT = 109;\nexport const KEY_DECIMAL = 110;\nexport const KEY_DIVIDE = 111;\nexport const KEY_F1 = 112;\nexport const KEY_F2 = 113;\nexport const KEY_F3 = 114;\nexport const KEY_F4 = 115;\nexport const KEY_F5 = 116;\nexport const KEY_F6 = 117;\nexport const KEY_F7 = 118;\nexport const KEY_F8 = 119;\nexport const KEY_F9 = 120;\nexport const KEY_F10 = 121;\nexport const KEY_F11 = 122;\nexport const KEY_F12 = 123;\nexport const KEY_F13 = 124;\nexport const KEY_F14 = 125;\nexport const KEY_F15 = 126;\nexport const KEY_F16 = 127;\nexport const KEY_F17 = 128;\nexport const KEY_F18 = 129;\nexport const KEY_F19 = 130;\nexport const KEY_F20 = 131;\nexport const KEY_F21 = 132;\nexport const KEY_F22 = 133;\nexport const KEY_F23 = 134;\nexport const KEY_F24 = 135;\nexport const KEY_NUM_LOCK = 144;\nexport const KEY_SCROLL_LOCK = 145;\nexport const KEY_WIN_OEM_FJ_JISHO = 146;\nexport const KEY_WIN_OEM_FJ_MASSHOU = 147;\nexport const KEY_WIN_OEM_FJ_TOUROKU = 148;\nexport const KEY_WIN_OEM_FJ_LOYA = 149;\nexport const KEY_WIN_OEM_FJ_ROYA = 150;\nexport const KEY_CIRCUMFLEX = 160;\nexport const KEY_EXCLAMATION = 161;\nexport const KEY_DOUBLE_QUOTE = 162;\nexport const KEY_HASH = 163;\nexport const KEY_DOLLAR = 164;\nexport const KEY_PERCENT = 165;\nexport const KEY_AMPERSAND = 166;\nexport const KEY_UNDERSCORE = 167;\nexport const KEY_OPEN_PAREN = 168;\nexport const KEY_CLOSE_PAREN = 169;\nexport const KEY_ASTERISK = 170;\nexport const KEY_PLUS = 171;\nexport const KEY_PIPE = 172;\nexport const KEY_HYPHEN_MINUS = 173;\nexport const KEY_OPEN_CURLY_BRACKET = 174;\nexport const KEY_CLOSE_CURLY_BRACKET = 175;\nexport const KEY_TILDE = 176;\nexport const KEY_VOLUME_MUTE = 181;\nexport const KEY_VOLUME_DOWN = 182;\nexport const KEY_VOLUME_UP = 183;\nexport const KEY_SEMICOLON_2 = 186;\nexport const KEY_EQUALS_2 = 187;\nexport const KEY_COMMA = 188;\nexport const KEY_MINUS = 189;\nexport const KEY_PERIOD = 190;\nexport const KEY_SLASH = 191;\nexport const KEY_BACK_QUOTE = 192;\nexport const KEY_OPEN_BRACKET = 219;\nexport const KEY_BACK_SLASH = 220;\nexport const KEY_CLOSE_BRACKET = 221;\nexport const KEY_QUOTE = 222;\nexport const KEY_META_2 = 224;\nexport const KEY_ALTGR = 225;\nexport const KEY_WIN_ICO_HELP = 227;\nexport const KEY_WIN_ICO_00 = 228;\nexport const KEY_WIN_ICO_CLEAR = 230;\nexport const KEY_WIN_OEM_RESET = 233;\nexport const KEY_WIN_OEM_JUMP = 234;\nexport const KEY_WIN_OEM_PA1 = 235;\nexport const KEY_WIN_OEM_PA2 = 236;\nexport const KEY_WIN_OEM_PA3 = 237;\nexport const KEY_WIN_OEM_WSCTRL = 238;\nexport const KEY_WIN_OEM_CUSEL = 239;\nexport const KEY_WIN_OEM_ATTN = 240;\nexport const KEY_WIN_OEM_FINISH = 241;\nexport const KEY_WIN_OEM_COPY = 242;\nexport const KEY_WIN_OEM_AUTO = 243;\nexport const KEY_WIN_OEM_ENLW = 244;\nexport const KEY_WIN_OEM_BACKTAB = 245;\nexport const KEY_ATTN = 246;\nexport const KEY_CRSEL = 247;\nexport const KEY_EXSEL = 248;\nexport const KEY_EREOF = 249;\nexport const KEY_PLAY = 250;\nexport const KEY_ZOOM = 251;\nexport const KEY_PA1 = 253;\nexport const KEY_WIN_OEM_CLEAR = 254;\n","import { SCREEN_MAIN_MENU, SCREEN_ADVENTURE } from './ScreenType';\nimport AdventureScreen from './screens/AdventureScreen';\nimport MainMenuScreen from './screens/MainMenuScreen';\nimport Manager from '../Manager';\n\nexport default class ScreenManager extends Manager {\n    #screenType = SCREEN_MAIN_MENU;\n    #screens = {};\n\n    constructor(game) {\n        super(game);\n        this.#screens = {\n            [SCREEN_MAIN_MENU]: new MainMenuScreen(game),\n            [SCREEN_ADVENTURE]: new AdventureScreen(game),\n        };\n    }\n\n    get screen() {\n        return this.#screens[this.#screenType];\n    }\n\n    setScreen(screenType) {\n        this.screen.onLeave();\n        this.#screenType = screenType;\n        this.screen.onEnter();\n        this.game.renderSystem.render();\n    }\n\n    onInputCommand(cmd) {\n        this.screen.onInputCommand(cmd);\n    }\n\n    update(dt) {\n        this.screen.onUpdate(dt);\n    }\n\n    onLoadGame(data) {\n        this.setScreen(SCREEN_ADVENTURE);\n    }\n}\n","export const SCREEN_MAIN_MENU = 0;\nexport const SCREEN_ADVENTURE = 1;\n","import Screen from './Screen';\nimport {\n    INPUT_CMD_MOVE_N,\n    INPUT_CMD_MOVE_NE,\n    INPUT_CMD_MOVE_W,\n    INPUT_CMD_WAIT,\n    INPUT_CMD_MOVE_E,\n    INPUT_CMD_MOVE_SW,\n    INPUT_CMD_MOVE_S,\n    INPUT_CMD_MOVE_SE,\n    INPUT_CMD_MOVE_NW,\n    INPUT_CMD_CANCEL,\n    INPUT_CMD_SAVE,\n    INPUT_CMD_LOAD,\n    INPUT_CMD_LOOK,\n} from '../../input/InputCommandType';\nimport { INPUT_DOMAIN_ADVENTURE } from '../../input/InputDomainType';\nimport {\n    DIR_N,\n    DIR_W,\n    DIR_Z,\n    DIR_E,\n    DIR_S,\n    DIR_NW,\n    DIR_SW,\n    DIR_SE,\n    DIR_NE,\n} from '../../../enums/Directions';\nimport { SCREEN_MAIN_MENU } from '../ScreenType';\n\nexport default class AdventureScreen extends Screen {\n    onEnter() {\n        this.game.commands.pushDomain(INPUT_DOMAIN_ADVENTURE);\n    }\n\n    onLeave() {\n        this.game.commands.popDomain(INPUT_DOMAIN_ADVENTURE);\n    }\n\n    onDirectionInput(dir) {\n        if (this.game.cursor.isEnabled) {\n            this.game.cursor.move(dir);\n        } else {\n            this.game.player.move(dir);\n        }\n    }\n\n    onInputCommand(cmd) {\n        if (cmd.type === INPUT_CMD_SAVE) {\n            this.game.state.saveGame();\n        }\n        if (cmd.type === INPUT_CMD_LOAD) {\n            this.game.state.loadGame();\n        }\n        if (cmd.type === INPUT_CMD_LOOK) {\n            this.game.cursor.toggle();\n        }\n        if (cmd.type === INPUT_CMD_CANCEL) {\n            if (this.game.cursor.isEnabled) {\n                this.game.cursor.disable();\n            } else {\n                this.game.screens.setScreen(SCREEN_MAIN_MENU);\n            }\n        }\n        if (cmd.type === INPUT_CMD_WAIT) {\n            this.game.player.wait();\n        }\n        if (cmd.type === INPUT_CMD_MOVE_NW) {\n            this.onDirectionInput(DIR_NW);\n        }\n        if (cmd.type === INPUT_CMD_MOVE_N) {\n            this.onDirectionInput(DIR_N);\n        }\n        if (cmd.type === INPUT_CMD_MOVE_NE) {\n            this.onDirectionInput(DIR_NE);\n        }\n        if (cmd.type === INPUT_CMD_MOVE_W) {\n            this.onDirectionInput(DIR_W);\n        }\n        if (cmd.type === INPUT_CMD_MOVE_E) {\n            this.onDirectionInput(DIR_E);\n        }\n        if (cmd.type === INPUT_CMD_MOVE_SW) {\n            this.onDirectionInput(DIR_SW);\n        }\n        if (cmd.type === INPUT_CMD_MOVE_S) {\n            this.onDirectionInput(DIR_S);\n        }\n        if (cmd.type === INPUT_CMD_MOVE_SE) {\n            this.onDirectionInput(DIR_SE);\n        }\n    }\n}\n","export default class Screen {\n    #game;\n\n    get game() {\n        return this.#game;\n    }\n\n    constructor(game) {\n        this.#game = game;\n    }\n\n    onEnter() {}\n\n    onLeave() {}\n\n    onInputCommand(cmd) {}\n\n    onUpdate(dt) {}\n}\n","import Screen from './Screen';\nimport {\n    INPUT_CMD_CONFIRM,\n    INPUT_CMD_SAVE,\n    INPUT_CMD_LOAD,\n} from '../../input/InputCommandType';\nimport { INPUT_DOMAIN_MAIN_MENU } from '../../input/InputDomainType';\nimport { SCREEN_ADVENTURE } from '../ScreenType';\n\nexport default class MainMenuScreen extends Screen {\n    onEnter() {\n        this.game.commands.pushDomain(INPUT_DOMAIN_MAIN_MENU);\n    }\n\n    onLeave() {\n        this.game.commands.popDomain(INPUT_DOMAIN_MAIN_MENU);\n    }\n\n    onInputCommand(cmd) {\n        if (cmd.type === INPUT_CMD_CONFIRM) {\n            this.game.state.newGame();\n            this.game.screens.setScreen(SCREEN_ADVENTURE);\n        }\n\n        if (cmd.type === INPUT_CMD_SAVE) {\n            this.game.state.saveGame();\n        }\n\n        if (cmd.type === INPUT_CMD_LOAD) {\n            this.game.state.loadGame();\n        }\n    }\n\n    onUpdate(dt) {\n        this.game.renderer.clear();\n        this.game.renderer.drawText(1, 1, `Knossonia`);\n        this.game.renderer.drawText(1, 3, `press enter to embark`);\n        this.game.renderer.drawText(\n            1,\n            7,\n            `move [w, a, d, x]`\n        );\n        this.game.renderer.drawText(\n            1,\n            8,\n            `save [ctrl+s]`\n        );\n        this.game.renderer.drawText(\n            1,\n            9,\n            `load [ctrl+l]`\n        );\n    }\n}\n","import Manager from './Manager';\nimport { BoredGoalType } from '../ai/GoalTypes';\nimport { MoveCommand } from '../ecs/components';\n\nexport default class PlayerManager extends Manager {\n    #entityId = null;\n\n    get entity() {\n        return this.game.ecs.getEntity(this.#entityId);\n    }\n\n    get isTurn() {\n        return this.entity.actor.hasEnergy;\n    }\n\n    get x() {\n        return this.entity.position.x;\n    }\n\n    get y() {\n        return this.entity.position.y;\n    }\n\n    onNewGame() {\n        const player = this.game.ecs.createPrefab('Player', {\n            position: {\n                x: 16,\n                y: 16,\n            },\n        });\n\n        this.#entityId = player.id;\n\n        for (let i = 0; i < 3; i++) {\n            const wanderer = this.game.ecs.createPrefab('HumanWanderer', {\n                moniker: {\n                    name: `Wanderer ${i}`,\n                },\n                position: {\n                    x: 21 + i,\n                    y: 8,\n                },\n            });\n\n            wanderer.brain.pushGoal(BoredGoalType.create());\n        }\n    }\n\n    move(direction) {\n        if (!this.isTurn) {\n            return;\n        }\n\n        if (this.entity.has(MoveCommand)) {\n            this.entity.remove(MoveCommand);\n        }\n\n        this.entity.add(MoveCommand, {\n            direction,\n        });\n    }\n\n    wait(turns = 1) {\n        if (!this.isTurn) {\n            return;\n        }\n\n        this.entity.fireEvent('energy-consumed', turns * 1000);\n    }\n\n    onSaveGame() {\n        return {\n            playerEntityId: this.#entityId,\n        };\n    }\n\n    onLoadGame(data) {\n        this.#entityId = data.playerEntityId;\n    }\n}\n","import Manager from './Manager';\n\nexport default class GameStateManager extends Manager {\n    newGame() {\n        console.log('NEW GAME');\n        this.game.clock.onNewGame();\n        this.game.engine.onNewGame();\n        this.game.player.onNewGame();\n    }\n\n    saveGame() {\n        const data = {\n            ...this.game.clock.onSaveGame(),\n            ...this.game.player.onSaveGame(),\n            ...this.game.engine.onSaveGame(),\n        };\n\n        console.log('SAVE GAME', data);\n        localStorage.setItem('save', JSON.stringify(data));\n    }\n\n    loadGame() {\n        const data = JSON.parse(localStorage.getItem('save'));\n\n        console.log('LOAD GAME', data);\n\n        this.game.clock.onLoadGame(data);\n        this.game.engine.onLoadGame(data);\n        this.game.player.onLoadGame(data);\n        this.game.screens.onLoadGame(data);\n    }\n}\n","import Manager from './Manager';\n\nexport default class ClockManager extends Manager {\n    #tick = 0;\n    #tickDelta = 0;\n\n    get tick() {\n        return this.#tick;\n    }\n\n    get tickDelta() {\n        return this.#tickDelta;\n    }\n\n    get turn() {\n        return Math.floor(this.#tick / 1000);\n    }\n\n    get subTurn() {\n        return this.#tick - this.turn * 1000;\n    }\n\n    incrementTick(delta) {\n        this.#tickDelta = delta;\n        this.#tick += delta;\n    }\n\n    onNewGame() {}\n\n    onLoadGame(data) {}\n\n    onSaveGame() {\n        return {};\n    }\n}\n","import * as Directions from '../enums/Directions';\nimport System from './System';\n\nexport default class CursorSystem extends System {\n    #isEnabled = false;\n    #x = 1;\n    #y = 1;\n\n    get x() {\n        return this.#x;\n    }\n\n    get y() {\n        return this.#y;\n    }\n\n    get isEnabled() {\n        return this.#isEnabled;\n    }\n\n    enable() {\n        this.#x = this.game.player.x;\n        this.#y = this.game.player.y;\n        this.#isEnabled = true;\n    }\n\n    disable() {\n        this.#isEnabled = false;\n    }\n\n    toggle() {\n        if (this.isEnabled) {\n            this.disable();\n        } else {\n            this.enable();\n        }\n    }\n\n    move(direction) {\n        const delta = Directions.delta(direction);\n        this.#x += delta.x;\n        this.#y += delta.y;\n    }\n\n    update(dt) {\n        if (!this.#isEnabled) {\n            return;\n        }\n\n        console.log('draw!');\n        this.game.renderer.draw(this.#x, this.#y, 'X', 'yellow');\n        // if (this.game.actionSystem.tickDelta > 0) {\n        //     this.#query.get().forEach((entity) => {\n        //         entity.eater.hunger -= this.game.actionSystem.tickDelta;\n        //     });\n        // }\n    }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// create a fake namespace object\n// mode & 1: value is a module id, require it\n// mode & 2: merge all properties of value into the ns\n// mode & 4: return value when already ns object\n// mode & 8|1: behave like require\n__webpack_require__.t = function(value, mode) {\n\tif(mode & 1) value = this(value);\n\tif(mode & 8) return value;\n\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n\tvar ns = Object.create(null);\n\t__webpack_require__.r(ns);\n\tvar def = {};\n\tif(mode & 2 && typeof value == 'object' && value) {\n\t\tfor(const key in value) def[key] = () => value[key];\n\t}\n\tdef['default'] = () => value;\n\t__webpack_require__.d(ns, def);\n\treturn ns;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop)","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// startup\n// Load entry module\n__webpack_require__(0);\n// This entry module used 'exports' so it can't be inlined\n"],"sourceRoot":""}