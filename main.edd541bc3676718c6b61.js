/*! For license information please see main.edd541bc3676718c6b61.js.LICENSE.txt */
(()=>{var leafPrototypes,getProto,__webpack_modules__=[(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__);var _utils_ImageLoader__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),howler__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2);(0,_utils_ImageLoader__WEBPACK_IMPORTED_MODULE_0__.loadImages)().then((()=>{const{game}=__webpack_require__(3);window.game=game,window.ecs=game.ecs,game.start()})),howler__WEBPACK_IMPORTED_MODULE_1__.Howler.volume(0)},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{loadImages:()=>loadImages});const loadImage=img=>new Promise(((resolve,reject)=>{img.complete&&resolve(),img.addEventListener("load",(()=>{resolve()})),img.addEventListener("error",(error=>{reject(error)}))})),loadImages=()=>{const imgs=Array.from(document.querySelectorAll("img"));return Promise.all(imgs.map(loadImage))}},(module,exports,__webpack_require__)=>{var __WEBPACK_AMD_DEFINE_RESULT__;!function(){"use strict";var HowlerGlobal=function(){this.init()};HowlerGlobal.prototype={init:function(){var self=this||Howler;return self._counter=1e3,self._html5AudioPool=[],self.html5PoolSize=10,self._codecs={},self._howls=[],self._muted=!1,self._volume=1,self._canPlayEvent="canplaythrough",self._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,self.masterGain=null,self.noAudio=!1,self.usingWebAudio=!0,self.autoSuspend=!0,self.ctx=null,self.autoUnlock=!0,self._setup(),self},volume:function(vol){var self=this||Howler;if(vol=parseFloat(vol),self.ctx||setupAudioContext(),void 0!==vol&&vol>=0&&vol<=1){if(self._volume=vol,self._muted)return self;self.usingWebAudio&&self.masterGain.gain.setValueAtTime(vol,Howler.ctx.currentTime);for(var i=0;i<self._howls.length;i++)if(!self._howls[i]._webAudio)for(var ids=self._howls[i]._getSoundIds(),j=0;j<ids.length;j++){var sound=self._howls[i]._soundById(ids[j]);sound&&sound._node&&(sound._node.volume=sound._volume*vol)}return self}return self._volume},mute:function(muted){var self=this||Howler;self.ctx||setupAudioContext(),self._muted=muted,self.usingWebAudio&&self.masterGain.gain.setValueAtTime(muted?0:self._volume,Howler.ctx.currentTime);for(var i=0;i<self._howls.length;i++)if(!self._howls[i]._webAudio)for(var ids=self._howls[i]._getSoundIds(),j=0;j<ids.length;j++){var sound=self._howls[i]._soundById(ids[j]);sound&&sound._node&&(sound._node.muted=!!muted||sound._muted)}return self},stop:function(){for(var self=this||Howler,i=0;i<self._howls.length;i++)self._howls[i].stop();return self},unload:function(){for(var self=this||Howler,i=self._howls.length-1;i>=0;i--)self._howls[i].unload();return self.usingWebAudio&&self.ctx&&void 0!==self.ctx.close&&(self.ctx.close(),self.ctx=null,setupAudioContext()),self},codecs:function(ext){return(this||Howler)._codecs[ext.replace(/^x-/,"")]},_setup:function(){var self=this||Howler;if(self.state=self.ctx&&self.ctx.state||"suspended",self._autoSuspend(),!self.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(self._canPlayEvent="canplay")}catch(e){self.noAudio=!0}else self.noAudio=!0;try{(new Audio).muted&&(self.noAudio=!0)}catch(e){}return self.noAudio||self._setupCodecs(),self},_setupCodecs:function(){var self=this||Howler,audioTest=null;try{audioTest="undefined"!=typeof Audio?new Audio:null}catch(err){return self}if(!audioTest||"function"!=typeof audioTest.canPlayType)return self;var mpegTest=audioTest.canPlayType("audio/mpeg;").replace(/^no$/,""),checkOpera=self._navigator&&self._navigator.userAgent.match(/OPR\/([0-6].)/g),isOldOpera=checkOpera&&parseInt(checkOpera[0].split("/")[1],10)<33;return self._codecs={mp3:!(isOldOpera||!mpegTest&&!audioTest.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!mpegTest,opus:!!audioTest.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!audioTest.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!audioTest.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(audioTest.canPlayType('audio/wav; codecs="1"')||audioTest.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!audioTest.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!audioTest.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(audioTest.canPlayType("audio/x-m4a;")||audioTest.canPlayType("audio/m4a;")||audioTest.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(audioTest.canPlayType("audio/x-m4b;")||audioTest.canPlayType("audio/m4b;")||audioTest.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(audioTest.canPlayType("audio/x-mp4;")||audioTest.canPlayType("audio/mp4;")||audioTest.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!audioTest.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!audioTest.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!audioTest.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(audioTest.canPlayType("audio/x-flac;")||audioTest.canPlayType("audio/flac;")).replace(/^no$/,"")},self},_unlockAudio:function(){var self=this||Howler;if(!self._audioUnlocked&&self.ctx){self._audioUnlocked=!1,self.autoUnlock=!1,self._mobileUnloaded||44100===self.ctx.sampleRate||(self._mobileUnloaded=!0,self.unload()),self._scratchBuffer=self.ctx.createBuffer(1,1,22050);var unlock=function(e){for(;self._html5AudioPool.length<self.html5PoolSize;)try{var audioNode=new Audio;audioNode._unlocked=!0,self._releaseHtml5Audio(audioNode)}catch(e){self.noAudio=!0;break}for(var i=0;i<self._howls.length;i++)if(!self._howls[i]._webAudio)for(var ids=self._howls[i]._getSoundIds(),j=0;j<ids.length;j++){var sound=self._howls[i]._soundById(ids[j]);sound&&sound._node&&!sound._node._unlocked&&(sound._node._unlocked=!0,sound._node.load())}self._autoResume();var source=self.ctx.createBufferSource();source.buffer=self._scratchBuffer,source.connect(self.ctx.destination),void 0===source.start?source.noteOn(0):source.start(0),"function"==typeof self.ctx.resume&&self.ctx.resume(),source.onended=function(){source.disconnect(0),self._audioUnlocked=!0,document.removeEventListener("touchstart",unlock,!0),document.removeEventListener("touchend",unlock,!0),document.removeEventListener("click",unlock,!0);for(var i=0;i<self._howls.length;i++)self._howls[i]._emit("unlock")}};return document.addEventListener("touchstart",unlock,!0),document.addEventListener("touchend",unlock,!0),document.addEventListener("click",unlock,!0),self}},_obtainHtml5Audio:function(){var self=this||Howler;if(self._html5AudioPool.length)return self._html5AudioPool.pop();var testPlay=(new Audio).play();return testPlay&&"undefined"!=typeof Promise&&(testPlay instanceof Promise||"function"==typeof testPlay.then)&&testPlay.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(audio){var self=this||Howler;return audio._unlocked&&self._html5AudioPool.push(audio),self},_autoSuspend:function(){var self=this;if(self.autoSuspend&&self.ctx&&void 0!==self.ctx.suspend&&Howler.usingWebAudio){for(var i=0;i<self._howls.length;i++)if(self._howls[i]._webAudio)for(var j=0;j<self._howls[i]._sounds.length;j++)if(!self._howls[i]._sounds[j]._paused)return self;return self._suspendTimer&&clearTimeout(self._suspendTimer),self._suspendTimer=setTimeout((function(){if(self.autoSuspend){self._suspendTimer=null,self.state="suspending";var handleSuspension=function(){self.state="suspended",self._resumeAfterSuspend&&(delete self._resumeAfterSuspend,self._autoResume())};self.ctx.suspend().then(handleSuspension,handleSuspension)}}),3e4),self}},_autoResume:function(){var self=this;if(self.ctx&&void 0!==self.ctx.resume&&Howler.usingWebAudio)return"running"===self.state&&"interrupted"!==self.ctx.state&&self._suspendTimer?(clearTimeout(self._suspendTimer),self._suspendTimer=null):"suspended"===self.state||"running"===self.state&&"interrupted"===self.ctx.state?(self.ctx.resume().then((function(){self.state="running";for(var i=0;i<self._howls.length;i++)self._howls[i]._emit("resume")})),self._suspendTimer&&(clearTimeout(self._suspendTimer),self._suspendTimer=null)):"suspending"===self.state&&(self._resumeAfterSuspend=!0),self}};var Howler=new HowlerGlobal,Howl=function(o){o.src&&0!==o.src.length?this.init(o):console.error("An array of source files must be passed with any new Howl.")};Howl.prototype={init:function(o){var self=this;return Howler.ctx||setupAudioContext(),self._autoplay=o.autoplay||!1,self._format="string"!=typeof o.format?o.format:[o.format],self._html5=o.html5||!1,self._muted=o.mute||!1,self._loop=o.loop||!1,self._pool=o.pool||5,self._preload="boolean"!=typeof o.preload&&"metadata"!==o.preload||o.preload,self._rate=o.rate||1,self._sprite=o.sprite||{},self._src="string"!=typeof o.src?o.src:[o.src],self._volume=void 0!==o.volume?o.volume:1,self._xhr={method:o.xhr&&o.xhr.method?o.xhr.method:"GET",headers:o.xhr&&o.xhr.headers?o.xhr.headers:null,withCredentials:!(!o.xhr||!o.xhr.withCredentials)&&o.xhr.withCredentials},self._duration=0,self._state="unloaded",self._sounds=[],self._endTimers={},self._queue=[],self._playLock=!1,self._onend=o.onend?[{fn:o.onend}]:[],self._onfade=o.onfade?[{fn:o.onfade}]:[],self._onload=o.onload?[{fn:o.onload}]:[],self._onloaderror=o.onloaderror?[{fn:o.onloaderror}]:[],self._onplayerror=o.onplayerror?[{fn:o.onplayerror}]:[],self._onpause=o.onpause?[{fn:o.onpause}]:[],self._onplay=o.onplay?[{fn:o.onplay}]:[],self._onstop=o.onstop?[{fn:o.onstop}]:[],self._onmute=o.onmute?[{fn:o.onmute}]:[],self._onvolume=o.onvolume?[{fn:o.onvolume}]:[],self._onrate=o.onrate?[{fn:o.onrate}]:[],self._onseek=o.onseek?[{fn:o.onseek}]:[],self._onunlock=o.onunlock?[{fn:o.onunlock}]:[],self._onresume=[],self._webAudio=Howler.usingWebAudio&&!self._html5,void 0!==Howler.ctx&&Howler.ctx&&Howler.autoUnlock&&Howler._unlockAudio(),Howler._howls.push(self),self._autoplay&&self._queue.push({event:"play",action:function(){self.play()}}),self._preload&&"none"!==self._preload&&self.load(),self},load:function(){var url=null;if(Howler.noAudio)this._emit("loaderror",null,"No audio support.");else{"string"==typeof this._src&&(this._src=[this._src]);for(var i=0;i<this._src.length;i++){var ext,str;if(this._format&&this._format[i])ext=this._format[i];else{if("string"!=typeof(str=this._src[i])){this._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(ext=/^data:audio\/([^;,]+);/i.exec(str))||(ext=/\.([^.]+)$/.exec(str.split("?",1)[0])),ext&&(ext=ext[1].toLowerCase())}if(ext||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),ext&&Howler.codecs(ext)){url=this._src[i];break}}if(url)return this._src=url,this._state="loading","https:"===window.location.protocol&&"http:"===url.slice(0,5)&&(this._html5=!0,this._webAudio=!1),new Sound(this),this._webAudio&&loadBuffer(this),this;this._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(sprite,internal){var self=this,id=null;if("number"==typeof sprite)id=sprite,sprite=null;else{if("string"==typeof sprite&&"loaded"===self._state&&!self._sprite[sprite])return null;if(void 0===sprite&&(sprite="__default",!self._playLock)){for(var num=0,i=0;i<self._sounds.length;i++)self._sounds[i]._paused&&!self._sounds[i]._ended&&(num++,id=self._sounds[i]._id);1===num?sprite=null:id=null}}var sound=id?self._soundById(id):self._inactiveSound();if(!sound)return null;if(id&&!sprite&&(sprite=sound._sprite||"__default"),"loaded"!==self._state){sound._sprite=sprite,sound._ended=!1;var soundId=sound._id;return self._queue.push({event:"play",action:function(){self.play(soundId)}}),soundId}if(id&&!sound._paused)return internal||self._loadQueue("play"),sound._id;self._webAudio&&Howler._autoResume();var seek=Math.max(0,sound._seek>0?sound._seek:self._sprite[sprite][0]/1e3),duration=Math.max(0,(self._sprite[sprite][0]+self._sprite[sprite][1])/1e3-seek),timeout=1e3*duration/Math.abs(sound._rate),start=self._sprite[sprite][0]/1e3,stop=(self._sprite[sprite][0]+self._sprite[sprite][1])/1e3;sound._sprite=sprite,sound._ended=!1;var setParams=function(){sound._paused=!1,sound._seek=seek,sound._start=start,sound._stop=stop,sound._loop=!(!sound._loop&&!self._sprite[sprite][2])};if(!(seek>=stop)){var node=sound._node;if(self._webAudio){var playWebAudio=function(){self._playLock=!1,setParams(),self._refreshBuffer(sound);var vol=sound._muted||self._muted?0:sound._volume;node.gain.setValueAtTime(vol,Howler.ctx.currentTime),sound._playStart=Howler.ctx.currentTime,void 0===node.bufferSource.start?sound._loop?node.bufferSource.noteGrainOn(0,seek,86400):node.bufferSource.noteGrainOn(0,seek,duration):sound._loop?node.bufferSource.start(0,seek,86400):node.bufferSource.start(0,seek,duration),timeout!==1/0&&(self._endTimers[sound._id]=setTimeout(self._ended.bind(self,sound),timeout)),internal||setTimeout((function(){self._emit("play",sound._id),self._loadQueue()}),0)};"running"===Howler.state&&"interrupted"!==Howler.ctx.state?playWebAudio():(self._playLock=!0,self.once("resume",playWebAudio),self._clearTimer(sound._id))}else{var playHtml5=function(){node.currentTime=seek,node.muted=sound._muted||self._muted||Howler._muted||node.muted,node.volume=sound._volume*Howler.volume(),node.playbackRate=sound._rate;try{var play=node.play();if(play&&"undefined"!=typeof Promise&&(play instanceof Promise||"function"==typeof play.then)?(self._playLock=!0,setParams(),play.then((function(){self._playLock=!1,node._unlocked=!0,internal||(self._emit("play",sound._id),self._loadQueue())})).catch((function(){self._playLock=!1,self._emit("playerror",sound._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),sound._ended=!0,sound._paused=!0}))):internal||(self._playLock=!1,setParams(),self._emit("play",sound._id),self._loadQueue()),node.playbackRate=sound._rate,node.paused)return void self._emit("playerror",sound._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==sprite||sound._loop?self._endTimers[sound._id]=setTimeout(self._ended.bind(self,sound),timeout):(self._endTimers[sound._id]=function(){self._ended(sound),node.removeEventListener("ended",self._endTimers[sound._id],!1)},node.addEventListener("ended",self._endTimers[sound._id],!1))}catch(err){self._emit("playerror",sound._id,err)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===node.src&&(node.src=self._src,node.load());var loadedNoReadyState=window&&window.ejecta||!node.readyState&&Howler._navigator.isCocoonJS;if(node.readyState>=3||loadedNoReadyState)playHtml5();else{self._playLock=!0;var listener=function(){playHtml5(),node.removeEventListener(Howler._canPlayEvent,listener,!1)};node.addEventListener(Howler._canPlayEvent,listener,!1),self._clearTimer(sound._id)}}return sound._id}self._ended(sound)},pause:function(id){var self=this;if("loaded"!==self._state||self._playLock)return self._queue.push({event:"pause",action:function(){self.pause(id)}}),self;for(var ids=self._getSoundIds(id),i=0;i<ids.length;i++){self._clearTimer(ids[i]);var sound=self._soundById(ids[i]);if(sound&&!sound._paused&&(sound._seek=self.seek(ids[i]),sound._rateSeek=0,sound._paused=!0,self._stopFade(ids[i]),sound._node))if(self._webAudio){if(!sound._node.bufferSource)continue;void 0===sound._node.bufferSource.stop?sound._node.bufferSource.noteOff(0):sound._node.bufferSource.stop(0),self._cleanBuffer(sound._node)}else isNaN(sound._node.duration)&&sound._node.duration!==1/0||sound._node.pause();arguments[1]||self._emit("pause",sound?sound._id:null)}return self},stop:function(id,internal){var self=this;if("loaded"!==self._state||self._playLock)return self._queue.push({event:"stop",action:function(){self.stop(id)}}),self;for(var ids=self._getSoundIds(id),i=0;i<ids.length;i++){self._clearTimer(ids[i]);var sound=self._soundById(ids[i]);sound&&(sound._seek=sound._start||0,sound._rateSeek=0,sound._paused=!0,sound._ended=!0,self._stopFade(ids[i]),sound._node&&(self._webAudio?sound._node.bufferSource&&(void 0===sound._node.bufferSource.stop?sound._node.bufferSource.noteOff(0):sound._node.bufferSource.stop(0),self._cleanBuffer(sound._node)):isNaN(sound._node.duration)&&sound._node.duration!==1/0||(sound._node.currentTime=sound._start||0,sound._node.pause(),sound._node.duration===1/0&&self._clearSound(sound._node))),internal||self._emit("stop",sound._id))}return self},mute:function(muted,id){var self=this;if("loaded"!==self._state||self._playLock)return self._queue.push({event:"mute",action:function(){self.mute(muted,id)}}),self;if(void 0===id){if("boolean"!=typeof muted)return self._muted;self._muted=muted}for(var ids=self._getSoundIds(id),i=0;i<ids.length;i++){var sound=self._soundById(ids[i]);sound&&(sound._muted=muted,sound._interval&&self._stopFade(sound._id),self._webAudio&&sound._node?sound._node.gain.setValueAtTime(muted?0:sound._volume,Howler.ctx.currentTime):sound._node&&(sound._node.muted=!!Howler._muted||muted),self._emit("mute",sound._id))}return self},volume:function(){var vol,id,sound,self=this,args=arguments;if(0===args.length)return self._volume;if(1===args.length||2===args.length&&void 0===args[1]){var ids=self._getSoundIds(),index=ids.indexOf(args[0]);index>=0?id=parseInt(args[0],10):vol=parseFloat(args[0])}else args.length>=2&&(vol=parseFloat(args[0]),id=parseInt(args[1],10));if(!(void 0!==vol&&vol>=0&&vol<=1))return(sound=id?self._soundById(id):self._sounds[0])?sound._volume:0;if("loaded"!==self._state||self._playLock)return self._queue.push({event:"volume",action:function(){self.volume.apply(self,args)}}),self;void 0===id&&(self._volume=vol),id=self._getSoundIds(id);for(var i=0;i<id.length;i++)(sound=self._soundById(id[i]))&&(sound._volume=vol,args[2]||self._stopFade(id[i]),self._webAudio&&sound._node&&!sound._muted?sound._node.gain.setValueAtTime(vol,Howler.ctx.currentTime):sound._node&&!sound._muted&&(sound._node.volume=vol*Howler.volume()),self._emit("volume",sound._id));return self},fade:function(from,to,len,id){var self=this;if("loaded"!==self._state||self._playLock)return self._queue.push({event:"fade",action:function(){self.fade(from,to,len,id)}}),self;from=Math.min(Math.max(0,parseFloat(from)),1),to=Math.min(Math.max(0,parseFloat(to)),1),len=parseFloat(len),self.volume(from,id);for(var ids=self._getSoundIds(id),i=0;i<ids.length;i++){var sound=self._soundById(ids[i]);if(sound){if(id||self._stopFade(ids[i]),self._webAudio&&!sound._muted){var currentTime=Howler.ctx.currentTime,end=currentTime+len/1e3;sound._volume=from,sound._node.gain.setValueAtTime(from,currentTime),sound._node.gain.linearRampToValueAtTime(to,end)}self._startFadeInterval(sound,from,to,len,ids[i],void 0===id)}}return self},_startFadeInterval:function(sound,from,to,len,id,isGroup){var self=this,vol=from,diff=to-from,steps=Math.abs(diff/.01),stepLen=Math.max(4,steps>0?len/steps:len),lastTick=Date.now();sound._fadeTo=to,sound._interval=setInterval((function(){var tick=(Date.now()-lastTick)/len;lastTick=Date.now(),vol+=diff*tick,vol=Math.round(100*vol)/100,vol=diff<0?Math.max(to,vol):Math.min(to,vol),self._webAudio?sound._volume=vol:self.volume(vol,sound._id,!0),isGroup&&(self._volume=vol),(to<from&&vol<=to||to>from&&vol>=to)&&(clearInterval(sound._interval),sound._interval=null,sound._fadeTo=null,self.volume(to,sound._id),self._emit("fade",sound._id))}),stepLen)},_stopFade:function(id){var sound=this._soundById(id);return sound&&sound._interval&&(this._webAudio&&sound._node.gain.cancelScheduledValues(Howler.ctx.currentTime),clearInterval(sound._interval),sound._interval=null,this.volume(sound._fadeTo,id),sound._fadeTo=null,this._emit("fade",id)),this},loop:function(){var loop,id,sound,self=this,args=arguments;if(0===args.length)return self._loop;if(1===args.length){if("boolean"!=typeof args[0])return!!(sound=self._soundById(parseInt(args[0],10)))&&sound._loop;loop=args[0],self._loop=loop}else 2===args.length&&(loop=args[0],id=parseInt(args[1],10));for(var ids=self._getSoundIds(id),i=0;i<ids.length;i++)(sound=self._soundById(ids[i]))&&(sound._loop=loop,self._webAudio&&sound._node&&sound._node.bufferSource&&(sound._node.bufferSource.loop=loop,loop&&(sound._node.bufferSource.loopStart=sound._start||0,sound._node.bufferSource.loopEnd=sound._stop)));return self},rate:function(){var rate,id,sound,self=this,args=arguments;if(0===args.length)id=self._sounds[0]._id;else if(1===args.length){var ids=self._getSoundIds(),index=ids.indexOf(args[0]);index>=0?id=parseInt(args[0],10):rate=parseFloat(args[0])}else 2===args.length&&(rate=parseFloat(args[0]),id=parseInt(args[1],10));if("number"!=typeof rate)return(sound=self._soundById(id))?sound._rate:self._rate;if("loaded"!==self._state||self._playLock)return self._queue.push({event:"rate",action:function(){self.rate.apply(self,args)}}),self;void 0===id&&(self._rate=rate),id=self._getSoundIds(id);for(var i=0;i<id.length;i++)if(sound=self._soundById(id[i])){self.playing(id[i])&&(sound._rateSeek=self.seek(id[i]),sound._playStart=self._webAudio?Howler.ctx.currentTime:sound._playStart),sound._rate=rate,self._webAudio&&sound._node&&sound._node.bufferSource?sound._node.bufferSource.playbackRate.setValueAtTime(rate,Howler.ctx.currentTime):sound._node&&(sound._node.playbackRate=rate);var seek=self.seek(id[i]),duration=(self._sprite[sound._sprite][0]+self._sprite[sound._sprite][1])/1e3-seek,timeout=1e3*duration/Math.abs(sound._rate);!self._endTimers[id[i]]&&sound._paused||(self._clearTimer(id[i]),self._endTimers[id[i]]=setTimeout(self._ended.bind(self,sound),timeout)),self._emit("rate",sound._id)}return self},seek:function(){var seek,id,self=this,args=arguments;if(0===args.length)id=self._sounds[0]._id;else if(1===args.length){var ids=self._getSoundIds(),index=ids.indexOf(args[0]);index>=0?id=parseInt(args[0],10):self._sounds.length&&(id=self._sounds[0]._id,seek=parseFloat(args[0]))}else 2===args.length&&(seek=parseFloat(args[0]),id=parseInt(args[1],10));if(void 0===id)return self;if("number"==typeof seek&&("loaded"!==self._state||self._playLock))return self._queue.push({event:"seek",action:function(){self.seek.apply(self,args)}}),self;var sound=self._soundById(id);if(sound){if(!("number"==typeof seek&&seek>=0)){if(self._webAudio){var realTime=self.playing(id)?Howler.ctx.currentTime-sound._playStart:0,rateSeek=sound._rateSeek?sound._rateSeek-sound._seek:0;return sound._seek+(rateSeek+realTime*Math.abs(sound._rate))}return sound._node.currentTime}var playing=self.playing(id);playing&&self.pause(id,!0),sound._seek=seek,sound._ended=!1,self._clearTimer(id),self._webAudio||!sound._node||isNaN(sound._node.duration)||(sound._node.currentTime=seek);var seekAndEmit=function(){self._emit("seek",id),playing&&self.play(id,!0)};if(playing&&!self._webAudio){var emitSeek=function(){self._playLock?setTimeout(emitSeek,0):seekAndEmit()};setTimeout(emitSeek,0)}else seekAndEmit()}return self},playing:function(id){if("number"==typeof id){var sound=this._soundById(id);return!!sound&&!sound._paused}for(var i=0;i<this._sounds.length;i++)if(!this._sounds[i]._paused)return!0;return!1},duration:function(id){var duration=this._duration,sound=this._soundById(id);return sound&&(duration=this._sprite[sound._sprite][1]/1e3),duration},state:function(){return this._state},unload:function(){for(var self=this,sounds=self._sounds,i=0;i<sounds.length;i++)sounds[i]._paused||self.stop(sounds[i]._id),self._webAudio||(self._clearSound(sounds[i]._node),sounds[i]._node.removeEventListener("error",sounds[i]._errorFn,!1),sounds[i]._node.removeEventListener(Howler._canPlayEvent,sounds[i]._loadFn,!1),sounds[i]._node.removeEventListener("ended",sounds[i]._endFn,!1),Howler._releaseHtml5Audio(sounds[i]._node)),delete sounds[i]._node,self._clearTimer(sounds[i]._id);var index=Howler._howls.indexOf(self);index>=0&&Howler._howls.splice(index,1);var remCache=!0;for(i=0;i<Howler._howls.length;i++)if(Howler._howls[i]._src===self._src||self._src.indexOf(Howler._howls[i]._src)>=0){remCache=!1;break}return cache&&remCache&&delete cache[self._src],Howler.noAudio=!1,self._state="unloaded",self._sounds=[],self=null,null},on:function(event,fn,id,once){var events=this["_on"+event];return"function"==typeof fn&&events.push(once?{id,fn,once}:{id,fn}),this},off:function(event,fn,id){var events=this["_on"+event],i=0;if("number"==typeof fn&&(id=fn,fn=null),fn||id)for(i=0;i<events.length;i++){var isId=id===events[i].id;if(fn===events[i].fn&&isId||!fn&&isId){events.splice(i,1);break}}else if(event)this["_on"+event]=[];else{var keys=Object.keys(this);for(i=0;i<keys.length;i++)0===keys[i].indexOf("_on")&&Array.isArray(this[keys[i]])&&(this[keys[i]]=[])}return this},once:function(event,fn,id){return this.on(event,fn,id,1),this},_emit:function(event,id,msg){for(var events=this["_on"+event],i=events.length-1;i>=0;i--)events[i].id&&events[i].id!==id&&"load"!==event||(setTimeout(function(fn){fn.call(this,id,msg)}.bind(this,events[i].fn),0),events[i].once&&this.off(event,events[i].fn,events[i].id));return this._loadQueue(event),this},_loadQueue:function(event){if(this._queue.length>0){var task=this._queue[0];task.event===event&&(this._queue.shift(),this._loadQueue()),event||task.action()}return this},_ended:function(sound){var sprite=sound._sprite;if(!this._webAudio&&sound._node&&!sound._node.paused&&!sound._node.ended&&sound._node.currentTime<sound._stop)return setTimeout(this._ended.bind(this,sound),100),this;var loop=!(!sound._loop&&!this._sprite[sprite][2]);if(this._emit("end",sound._id),!this._webAudio&&loop&&this.stop(sound._id,!0).play(sound._id),this._webAudio&&loop){this._emit("play",sound._id),sound._seek=sound._start||0,sound._rateSeek=0,sound._playStart=Howler.ctx.currentTime;var timeout=1e3*(sound._stop-sound._start)/Math.abs(sound._rate);this._endTimers[sound._id]=setTimeout(this._ended.bind(this,sound),timeout)}return this._webAudio&&!loop&&(sound._paused=!0,sound._ended=!0,sound._seek=sound._start||0,sound._rateSeek=0,this._clearTimer(sound._id),this._cleanBuffer(sound._node),Howler._autoSuspend()),this._webAudio||loop||this.stop(sound._id,!0),this},_clearTimer:function(id){if(this._endTimers[id]){if("function"!=typeof this._endTimers[id])clearTimeout(this._endTimers[id]);else{var sound=this._soundById(id);sound&&sound._node&&sound._node.removeEventListener("ended",this._endTimers[id],!1)}delete this._endTimers[id]}return this},_soundById:function(id){for(var i=0;i<this._sounds.length;i++)if(id===this._sounds[i]._id)return this._sounds[i];return null},_inactiveSound:function(){this._drain();for(var i=0;i<this._sounds.length;i++)if(this._sounds[i]._ended)return this._sounds[i].reset();return new Sound(this)},_drain:function(){var limit=this._pool,cnt=0,i=0;if(!(this._sounds.length<limit)){for(i=0;i<this._sounds.length;i++)this._sounds[i]._ended&&cnt++;for(i=this._sounds.length-1;i>=0;i--){if(cnt<=limit)return;this._sounds[i]._ended&&(this._webAudio&&this._sounds[i]._node&&this._sounds[i]._node.disconnect(0),this._sounds.splice(i,1),cnt--)}}},_getSoundIds:function(id){if(void 0===id){for(var ids=[],i=0;i<this._sounds.length;i++)ids.push(this._sounds[i]._id);return ids}return[id]},_refreshBuffer:function(sound){return sound._node.bufferSource=Howler.ctx.createBufferSource(),sound._node.bufferSource.buffer=cache[this._src],sound._panner?sound._node.bufferSource.connect(sound._panner):sound._node.bufferSource.connect(sound._node),sound._node.bufferSource.loop=sound._loop,sound._loop&&(sound._node.bufferSource.loopStart=sound._start||0,sound._node.bufferSource.loopEnd=sound._stop||0),sound._node.bufferSource.playbackRate.setValueAtTime(sound._rate,Howler.ctx.currentTime),this},_cleanBuffer:function(node){var isIOS=Howler._navigator&&Howler._navigator.vendor.indexOf("Apple")>=0;if(Howler._scratchBuffer&&node.bufferSource&&(node.bufferSource.onended=null,node.bufferSource.disconnect(0),isIOS))try{node.bufferSource.buffer=Howler._scratchBuffer}catch(e){}return node.bufferSource=null,this},_clearSound:function(node){/MSIE |Trident\//.test(Howler._navigator&&Howler._navigator.userAgent)||(node.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var Sound=function(howl){this._parent=howl,this.init()};Sound.prototype={init:function(){var parent=this._parent;return this._muted=parent._muted,this._loop=parent._loop,this._volume=parent._volume,this._rate=parent._rate,this._seek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++Howler._counter,parent._sounds.push(this),this.create(),this},create:function(){var parent=this._parent,volume=Howler._muted||this._muted||this._parent._muted?0:this._volume;return parent._webAudio?(this._node=void 0===Howler.ctx.createGain?Howler.ctx.createGainNode():Howler.ctx.createGain(),this._node.gain.setValueAtTime(volume,Howler.ctx.currentTime),this._node.paused=!0,this._node.connect(Howler.masterGain)):Howler.noAudio||(this._node=Howler._obtainHtml5Audio(),this._errorFn=this._errorListener.bind(this),this._node.addEventListener("error",this._errorFn,!1),this._loadFn=this._loadListener.bind(this),this._node.addEventListener(Howler._canPlayEvent,this._loadFn,!1),this._endFn=this._endListener.bind(this),this._node.addEventListener("ended",this._endFn,!1),this._node.src=parent._src,this._node.preload=!0===parent._preload?"auto":parent._preload,this._node.volume=volume*Howler.volume(),this._node.load()),this},reset:function(){var parent=this._parent;return this._muted=parent._muted,this._loop=parent._loop,this._volume=parent._volume,this._rate=parent._rate,this._seek=0,this._rateSeek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++Howler._counter,this},_errorListener:function(){this._parent._emit("loaderror",this._id,this._node.error?this._node.error.code:0),this._node.removeEventListener("error",this._errorFn,!1)},_loadListener:function(){var parent=this._parent;parent._duration=Math.ceil(10*this._node.duration)/10,0===Object.keys(parent._sprite).length&&(parent._sprite={__default:[0,1e3*parent._duration]}),"loaded"!==parent._state&&(parent._state="loaded",parent._emit("load"),parent._loadQueue()),this._node.removeEventListener(Howler._canPlayEvent,this._loadFn,!1)},_endListener:function(){var parent=this._parent;parent._duration===1/0&&(parent._duration=Math.ceil(10*this._node.duration)/10,parent._sprite.__default[1]===1/0&&(parent._sprite.__default[1]=1e3*parent._duration),parent._ended(this)),this._node.removeEventListener("ended",this._endFn,!1)}};var cache={},loadBuffer=function(self){var url=self._src;if(cache[url])return self._duration=cache[url].duration,void loadSound(self);if(/^data:[^;]+;base64,/.test(url)){for(var data=atob(url.split(",")[1]),dataView=new Uint8Array(data.length),i=0;i<data.length;++i)dataView[i]=data.charCodeAt(i);decodeAudioData(dataView.buffer,self)}else{var xhr=new XMLHttpRequest;xhr.open(self._xhr.method,url,!0),xhr.withCredentials=self._xhr.withCredentials,xhr.responseType="arraybuffer",self._xhr.headers&&Object.keys(self._xhr.headers).forEach((function(key){xhr.setRequestHeader(key,self._xhr.headers[key])})),xhr.onload=function(){var code=(xhr.status+"")[0];"0"===code||"2"===code||"3"===code?decodeAudioData(xhr.response,self):self._emit("loaderror",null,"Failed loading audio file with status: "+xhr.status+".")},xhr.onerror=function(){self._webAudio&&(self._html5=!0,self._webAudio=!1,self._sounds=[],delete cache[url],self.load())},safeXhrSend(xhr)}},safeXhrSend=function(xhr){try{xhr.send()}catch(e){xhr.onerror()}},decodeAudioData=function(arraybuffer,self){var error=function(){self._emit("loaderror",null,"Decoding audio data failed.")},success=function(buffer){buffer&&self._sounds.length>0?(cache[self._src]=buffer,loadSound(self,buffer)):error()};"undefined"!=typeof Promise&&1===Howler.ctx.decodeAudioData.length?Howler.ctx.decodeAudioData(arraybuffer).then(success).catch(error):Howler.ctx.decodeAudioData(arraybuffer,success,error)},loadSound=function(self,buffer){buffer&&!self._duration&&(self._duration=buffer.duration),0===Object.keys(self._sprite).length&&(self._sprite={__default:[0,1e3*self._duration]}),"loaded"!==self._state&&(self._state="loaded",self._emit("load"),self._loadQueue())},setupAudioContext=function(){if(Howler.usingWebAudio){try{"undefined"!=typeof AudioContext?Howler.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?Howler.ctx=new webkitAudioContext:Howler.usingWebAudio=!1}catch(e){Howler.usingWebAudio=!1}Howler.ctx||(Howler.usingWebAudio=!1);var iOS=/iP(hone|od|ad)/.test(Howler._navigator&&Howler._navigator.platform),appVersion=Howler._navigator&&Howler._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),version=appVersion?parseInt(appVersion[1],10):null;if(iOS&&version&&version<9){var safari=/safari/.test(Howler._navigator&&Howler._navigator.userAgent.toLowerCase());Howler._navigator&&!safari&&(Howler.usingWebAudio=!1)}Howler.usingWebAudio&&(Howler.masterGain=void 0===Howler.ctx.createGain?Howler.ctx.createGainNode():Howler.ctx.createGain(),Howler.masterGain.gain.setValueAtTime(Howler._muted?0:Howler._volume,Howler.ctx.currentTime),Howler.masterGain.connect(Howler.ctx.destination)),Howler._setup()}};void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function(){return{Howler,Howl}}.apply(exports,[]))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__),exports.Howler=Howler,exports.Howl=Howl,void 0!==__webpack_require__.g?(__webpack_require__.g.HowlerGlobal=HowlerGlobal,__webpack_require__.g.Howler=Howler,__webpack_require__.g.Howl=Howl,__webpack_require__.g.Sound=Sound):"undefined"!=typeof window&&(window.HowlerGlobal=HowlerGlobal,window.Howler=Howler,window.Howl=Howl,window.Sound=Sound)}(),function(){"use strict";var _super;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(pan){if(!this.ctx||!this.ctx.listener)return this;for(var i=this._howls.length-1;i>=0;i--)this._howls[i].stereo(pan);return this},HowlerGlobal.prototype.pos=function(x,y,z){return this.ctx&&this.ctx.listener?(y="number"!=typeof y?this._pos[1]:y,z="number"!=typeof z?this._pos[2]:z,"number"!=typeof x?this._pos:(this._pos=[x,y,z],void 0!==this.ctx.listener.positionX?(this.ctx.listener.positionX.setTargetAtTime(this._pos[0],Howler.ctx.currentTime,.1),this.ctx.listener.positionY.setTargetAtTime(this._pos[1],Howler.ctx.currentTime,.1),this.ctx.listener.positionZ.setTargetAtTime(this._pos[2],Howler.ctx.currentTime,.1)):this.ctx.listener.setPosition(this._pos[0],this._pos[1],this._pos[2]),this)):this},HowlerGlobal.prototype.orientation=function(x,y,z,xUp,yUp,zUp){if(!this.ctx||!this.ctx.listener)return this;var or=this._orientation;return y="number"!=typeof y?or[1]:y,z="number"!=typeof z?or[2]:z,xUp="number"!=typeof xUp?or[3]:xUp,yUp="number"!=typeof yUp?or[4]:yUp,zUp="number"!=typeof zUp?or[5]:zUp,"number"!=typeof x?or:(this._orientation=[x,y,z,xUp,yUp,zUp],void 0!==this.ctx.listener.forwardX?(this.ctx.listener.forwardX.setTargetAtTime(x,Howler.ctx.currentTime,.1),this.ctx.listener.forwardY.setTargetAtTime(y,Howler.ctx.currentTime,.1),this.ctx.listener.forwardZ.setTargetAtTime(z,Howler.ctx.currentTime,.1),this.ctx.listener.upX.setTargetAtTime(xUp,Howler.ctx.currentTime,.1),this.ctx.listener.upY.setTargetAtTime(yUp,Howler.ctx.currentTime,.1),this.ctx.listener.upZ.setTargetAtTime(zUp,Howler.ctx.currentTime,.1)):this.ctx.listener.setOrientation(x,y,z,xUp,yUp,zUp),this)},Howl.prototype.init=(_super=Howl.prototype.init,function(o){return this._orientation=o.orientation||[1,0,0],this._stereo=o.stereo||null,this._pos=o.pos||null,this._pannerAttr={coneInnerAngle:void 0!==o.coneInnerAngle?o.coneInnerAngle:360,coneOuterAngle:void 0!==o.coneOuterAngle?o.coneOuterAngle:360,coneOuterGain:void 0!==o.coneOuterGain?o.coneOuterGain:0,distanceModel:void 0!==o.distanceModel?o.distanceModel:"inverse",maxDistance:void 0!==o.maxDistance?o.maxDistance:1e4,panningModel:void 0!==o.panningModel?o.panningModel:"HRTF",refDistance:void 0!==o.refDistance?o.refDistance:1,rolloffFactor:void 0!==o.rolloffFactor?o.rolloffFactor:1},this._onstereo=o.onstereo?[{fn:o.onstereo}]:[],this._onpos=o.onpos?[{fn:o.onpos}]:[],this._onorientation=o.onorientation?[{fn:o.onorientation}]:[],_super.call(this,o)}),Howl.prototype.stereo=function(pan,id){var self=this;if(!self._webAudio)return self;if("loaded"!==self._state)return self._queue.push({event:"stereo",action:function(){self.stereo(pan,id)}}),self;var pannerType=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===id){if("number"!=typeof pan)return self._stereo;self._stereo=pan,self._pos=[pan,0,0]}for(var ids=self._getSoundIds(id),i=0;i<ids.length;i++){var sound=self._soundById(ids[i]);if(sound){if("number"!=typeof pan)return sound._stereo;sound._stereo=pan,sound._pos=[pan,0,0],sound._node&&(sound._pannerAttr.panningModel="equalpower",sound._panner&&sound._panner.pan||setupPanner(sound,pannerType),"spatial"===pannerType?void 0!==sound._panner.positionX?(sound._panner.positionX.setValueAtTime(pan,Howler.ctx.currentTime),sound._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),sound._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):sound._panner.setPosition(pan,0,0):sound._panner.pan.setValueAtTime(pan,Howler.ctx.currentTime)),self._emit("stereo",sound._id)}}return self},Howl.prototype.pos=function(x,y,z,id){var self=this;if(!self._webAudio)return self;if("loaded"!==self._state)return self._queue.push({event:"pos",action:function(){self.pos(x,y,z,id)}}),self;if(y="number"!=typeof y?0:y,z="number"!=typeof z?-.5:z,void 0===id){if("number"!=typeof x)return self._pos;self._pos=[x,y,z]}for(var ids=self._getSoundIds(id),i=0;i<ids.length;i++){var sound=self._soundById(ids[i]);if(sound){if("number"!=typeof x)return sound._pos;sound._pos=[x,y,z],sound._node&&(sound._panner&&!sound._panner.pan||setupPanner(sound,"spatial"),void 0!==sound._panner.positionX?(sound._panner.positionX.setValueAtTime(x,Howler.ctx.currentTime),sound._panner.positionY.setValueAtTime(y,Howler.ctx.currentTime),sound._panner.positionZ.setValueAtTime(z,Howler.ctx.currentTime)):sound._panner.setPosition(x,y,z)),self._emit("pos",sound._id)}}return self},Howl.prototype.orientation=function(x,y,z,id){var self=this;if(!self._webAudio)return self;if("loaded"!==self._state)return self._queue.push({event:"orientation",action:function(){self.orientation(x,y,z,id)}}),self;if(y="number"!=typeof y?self._orientation[1]:y,z="number"!=typeof z?self._orientation[2]:z,void 0===id){if("number"!=typeof x)return self._orientation;self._orientation=[x,y,z]}for(var ids=self._getSoundIds(id),i=0;i<ids.length;i++){var sound=self._soundById(ids[i]);if(sound){if("number"!=typeof x)return sound._orientation;sound._orientation=[x,y,z],sound._node&&(sound._panner||(sound._pos||(sound._pos=self._pos||[0,0,-.5]),setupPanner(sound,"spatial")),void 0!==sound._panner.orientationX?(sound._panner.orientationX.setValueAtTime(x,Howler.ctx.currentTime),sound._panner.orientationY.setValueAtTime(y,Howler.ctx.currentTime),sound._panner.orientationZ.setValueAtTime(z,Howler.ctx.currentTime)):sound._panner.setOrientation(x,y,z)),self._emit("orientation",sound._id)}}return self},Howl.prototype.pannerAttr=function(){var o,id,sound,self=this,args=arguments;if(!self._webAudio)return self;if(0===args.length)return self._pannerAttr;if(1===args.length){if("object"!=typeof args[0])return(sound=self._soundById(parseInt(args[0],10)))?sound._pannerAttr:self._pannerAttr;o=args[0],void 0===id&&(o.pannerAttr||(o.pannerAttr={coneInnerAngle:o.coneInnerAngle,coneOuterAngle:o.coneOuterAngle,coneOuterGain:o.coneOuterGain,distanceModel:o.distanceModel,maxDistance:o.maxDistance,refDistance:o.refDistance,rolloffFactor:o.rolloffFactor,panningModel:o.panningModel}),self._pannerAttr={coneInnerAngle:void 0!==o.pannerAttr.coneInnerAngle?o.pannerAttr.coneInnerAngle:self._coneInnerAngle,coneOuterAngle:void 0!==o.pannerAttr.coneOuterAngle?o.pannerAttr.coneOuterAngle:self._coneOuterAngle,coneOuterGain:void 0!==o.pannerAttr.coneOuterGain?o.pannerAttr.coneOuterGain:self._coneOuterGain,distanceModel:void 0!==o.pannerAttr.distanceModel?o.pannerAttr.distanceModel:self._distanceModel,maxDistance:void 0!==o.pannerAttr.maxDistance?o.pannerAttr.maxDistance:self._maxDistance,refDistance:void 0!==o.pannerAttr.refDistance?o.pannerAttr.refDistance:self._refDistance,rolloffFactor:void 0!==o.pannerAttr.rolloffFactor?o.pannerAttr.rolloffFactor:self._rolloffFactor,panningModel:void 0!==o.pannerAttr.panningModel?o.pannerAttr.panningModel:self._panningModel})}else 2===args.length&&(o=args[0],id=parseInt(args[1],10));for(var ids=self._getSoundIds(id),i=0;i<ids.length;i++)if(sound=self._soundById(ids[i])){var pa=sound._pannerAttr;pa={coneInnerAngle:void 0!==o.coneInnerAngle?o.coneInnerAngle:pa.coneInnerAngle,coneOuterAngle:void 0!==o.coneOuterAngle?o.coneOuterAngle:pa.coneOuterAngle,coneOuterGain:void 0!==o.coneOuterGain?o.coneOuterGain:pa.coneOuterGain,distanceModel:void 0!==o.distanceModel?o.distanceModel:pa.distanceModel,maxDistance:void 0!==o.maxDistance?o.maxDistance:pa.maxDistance,refDistance:void 0!==o.refDistance?o.refDistance:pa.refDistance,rolloffFactor:void 0!==o.rolloffFactor?o.rolloffFactor:pa.rolloffFactor,panningModel:void 0!==o.panningModel?o.panningModel:pa.panningModel};var panner=sound._panner;panner?(panner.coneInnerAngle=pa.coneInnerAngle,panner.coneOuterAngle=pa.coneOuterAngle,panner.coneOuterGain=pa.coneOuterGain,panner.distanceModel=pa.distanceModel,panner.maxDistance=pa.maxDistance,panner.refDistance=pa.refDistance,panner.rolloffFactor=pa.rolloffFactor,panner.panningModel=pa.panningModel):(sound._pos||(sound._pos=self._pos||[0,0,-.5]),setupPanner(sound,"spatial"))}return self},Sound.prototype.init=function(_super){return function(){var parent=this._parent;this._orientation=parent._orientation,this._stereo=parent._stereo,this._pos=parent._pos,this._pannerAttr=parent._pannerAttr,_super.call(this),this._stereo?parent.stereo(this._stereo):this._pos&&parent.pos(this._pos[0],this._pos[1],this._pos[2],this._id)}}(Sound.prototype.init),Sound.prototype.reset=function(_super){return function(){var parent=this._parent;return this._orientation=parent._orientation,this._stereo=parent._stereo,this._pos=parent._pos,this._pannerAttr=parent._pannerAttr,this._stereo?parent.stereo(this._stereo):this._pos?parent.pos(this._pos[0],this._pos[1],this._pos[2],this._id):this._panner&&(this._panner.disconnect(0),this._panner=void 0,parent._refreshBuffer(this)),_super.call(this)}}(Sound.prototype.reset);var setupPanner=function(sound,type){"spatial"===(type=type||"spatial")?(sound._panner=Howler.ctx.createPanner(),sound._panner.coneInnerAngle=sound._pannerAttr.coneInnerAngle,sound._panner.coneOuterAngle=sound._pannerAttr.coneOuterAngle,sound._panner.coneOuterGain=sound._pannerAttr.coneOuterGain,sound._panner.distanceModel=sound._pannerAttr.distanceModel,sound._panner.maxDistance=sound._pannerAttr.maxDistance,sound._panner.refDistance=sound._pannerAttr.refDistance,sound._panner.rolloffFactor=sound._pannerAttr.rolloffFactor,sound._panner.panningModel=sound._pannerAttr.panningModel,void 0!==sound._panner.positionX?(sound._panner.positionX.setValueAtTime(sound._pos[0],Howler.ctx.currentTime),sound._panner.positionY.setValueAtTime(sound._pos[1],Howler.ctx.currentTime),sound._panner.positionZ.setValueAtTime(sound._pos[2],Howler.ctx.currentTime)):sound._panner.setPosition(sound._pos[0],sound._pos[1],sound._pos[2]),void 0!==sound._panner.orientationX?(sound._panner.orientationX.setValueAtTime(sound._orientation[0],Howler.ctx.currentTime),sound._panner.orientationY.setValueAtTime(sound._orientation[1],Howler.ctx.currentTime),sound._panner.orientationZ.setValueAtTime(sound._orientation[2],Howler.ctx.currentTime)):sound._panner.setOrientation(sound._orientation[0],sound._orientation[1],sound._orientation[2])):(sound._panner=Howler.ctx.createStereoPanner(),sound._panner.pan.setValueAtTime(sound._stereo,Howler.ctx.currentTime)),sound._panner.connect(sound._node),sound._paused||sound._parent.pause(sound._id,!0).play(sound._id,!0)}}()},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Game,game:()=>game});var _rendering_RenderManager__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(4),_input_InputController__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(16),_systems_ActionSystem__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(20),_systems_RenderSystem__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(139),_systems_UISystem__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(140),_input_MouseManager__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(141),_input_CommandManager__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(142),_screens_ScreenManager__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(148),_PlayerManager__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(164),_ecs__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(165),_GameStateManager__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(207),_ClockManager__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(208),_systems_CursorSystem__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(209),_MapManager__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(210),_systems_FOVSystem__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(212),_systems_DeathSystem__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(260),_systems_ParticleSystem__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(261),_FactionManager__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(262),_CameraManager__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(263),_systems_FPSMonitoringSystem__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(264),_WorldManager__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(265),_ConsoleManager__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(291),_systems_DestroySystem__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(292),_MusicManager__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(293),_systems_StatusSystem__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(295),_systems_LiquidSystem__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(296),_systems_TrapSystem__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(297),_systems_FireSystem__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__(298),_systems_TemperatureSystem__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__(299),_systems_AbilitySystem__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__(303);function _classPrivateFieldSet(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}return value}var _lastUpdate=new WeakMap;class Game{get ecs(){return this.engine.engine}constructor(){_lastUpdate.set(this,{writable:!0,value:void 0}),this.engine=new _ecs__WEBPACK_IMPORTED_MODULE_9__.default(this),this.music=new _MusicManager__WEBPACK_IMPORTED_MODULE_23__.default(this),this.mouse=new _input_MouseManager__WEBPACK_IMPORTED_MODULE_5__.default(this),this.clock=new _ClockManager__WEBPACK_IMPORTED_MODULE_11__.default(this),this.renderer=new _rendering_RenderManager__WEBPACK_IMPORTED_MODULE_0__.default(this),this.state=new _GameStateManager__WEBPACK_IMPORTED_MODULE_10__.default(this),this.world=new _WorldManager__WEBPACK_IMPORTED_MODULE_20__.WorldManager(this),this.map=new _MapManager__WEBPACK_IMPORTED_MODULE_13__.default(this),this.camera=new _CameraManager__WEBPACK_IMPORTED_MODULE_18__.default(this),this.factions=new _FactionManager__WEBPACK_IMPORTED_MODULE_17__.default(this),this.player=new _PlayerManager__WEBPACK_IMPORTED_MODULE_8__.default(this),this.commands=new _input_CommandManager__WEBPACK_IMPORTED_MODULE_6__.default(this),this.screens=new _screens_ScreenManager__WEBPACK_IMPORTED_MODULE_7__.default(this),this.input=new _input_InputController__WEBPACK_IMPORTED_MODULE_1__.default(this),this.console=new _ConsoleManager__WEBPACK_IMPORTED_MODULE_21__.default(this),this.actionSystem=new _systems_ActionSystem__WEBPACK_IMPORTED_MODULE_2__.default(this),this.deathSystem=new _systems_DeathSystem__WEBPACK_IMPORTED_MODULE_15__.default(this),this.statusSystem=new _systems_StatusSystem__WEBPACK_IMPORTED_MODULE_24__.default(this),this.FOVSystem=new _systems_FOVSystem__WEBPACK_IMPORTED_MODULE_14__.default(this),this.renderSystem=new _systems_RenderSystem__WEBPACK_IMPORTED_MODULE_3__.default(this),this.UISystem=new _systems_UISystem__WEBPACK_IMPORTED_MODULE_4__.default(this),this.cursor=new _systems_CursorSystem__WEBPACK_IMPORTED_MODULE_12__.default(this),this.particles=new _systems_ParticleSystem__WEBPACK_IMPORTED_MODULE_16__.default(this),this.fps=new _systems_FPSMonitoringSystem__WEBPACK_IMPORTED_MODULE_19__.default(this),this.destroySystem=new _systems_DestroySystem__WEBPACK_IMPORTED_MODULE_22__.default(this),this.liquidSystem=new _systems_LiquidSystem__WEBPACK_IMPORTED_MODULE_25__.default(this),this.trapSystem=new _systems_TrapSystem__WEBPACK_IMPORTED_MODULE_26__.default(this),this.fireSystem=new _systems_FireSystem__WEBPACK_IMPORTED_MODULE_27__.default(this),this.temperature=new _systems_TemperatureSystem__WEBPACK_IMPORTED_MODULE_28__.default(this),this.abilities=new _systems_AbilitySystem__WEBPACK_IMPORTED_MODULE_29__.default(this)}start(){_classPrivateFieldSet(this,_lastUpdate,Date.now()),this.boundLoop=this.loop.bind(this),requestAnimationFrame(this.loop.bind(this))}updateAdventureSystems(dt){for(let i=0;i<20;i++){this.clock.update(dt);const playerTurn=this.actionSystem.update(dt);if(playerTurn&&this.updatePlayerSystems(dt),this.liquidSystem.update(dt),this.trapSystem.update(dt),this.fireSystem.update(dt),this.temperature.update(dt),this.statusSystem.update(dt),this.abilities.update(dt),this.deathSystem.update(dt),this.destroySystem.update(dt),playerTurn)return}}updatePlayerSystems(dt){this.FOVSystem.update(dt),this.renderSystem.update(dt),this.particles.update(dt),this.UISystem.update(dt),this.map.update(dt),this.console.render(dt)}loop(t){const now=Date.now(),dt=now-function(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}(this,_lastUpdate);this.screens.update(dt),this.fps.update(dt),this.renderer.render(),_classPrivateFieldSet(this,_lastUpdate,now),requestAnimationFrame(this.boundLoop)}}const game=new Game},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Renderer});var _Manager__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5),_Display__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6),_spritesheets__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(8);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}var _spritesheets=new WeakMap,_display=new WeakMap;class Renderer extends _Manager__WEBPACK_IMPORTED_MODULE_0__.default{get display(){return _classPrivateFieldGet(this,_display)}get canvas(){return this.display.canvas}constructor(game){super(game),_defineProperty(this,"tileWidth",16),_defineProperty(this,"tileHeight",16),_spritesheets.set(this,{writable:!0,value:{}}),_display.set(this,{writable:!0,value:null}),(0,_spritesheets__WEBPACK_IMPORTED_MODULE_2__.default)().forEach((spritesheet=>{_classPrivateFieldGet(this,_spritesheets)[spritesheet.name]=spritesheet})),function(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}}(this,_display,new _Display__WEBPACK_IMPORTED_MODULE_1__.default({width:20,height:20,tileWidth:this.tileWidth,tileHeight:this.tileHeight})),document.body.appendChild(this.display.canvas)}resizeDisplay(width,height,zoom){this.display.setSize(width,height,zoom)}draw(x,y,char,fg1="#adb8bc",fg2="#333",bg){const sprite=_classPrivateFieldGet(this,_spritesheets).tiles.getSprite(char);this.display.draw(x,y,sprite,fg1,fg2,bg)}drawUI(x,y,char,fg1="#adb8bc",fg2="#333",bg){const sprite=_classPrivateFieldGet(this,_spritesheets).ui.getSprite(char);this.display.draw(x,y,sprite,fg1,fg2,bg)}computeTextWidth(text){return.5*text.length}computeTextWidthTile(text){return Math.ceil(this.computeTextWidth(text))}drawTextWrapping(x,y,width,text,fg1,fg2,bg){if(this.computeTextWidthTile(text)<width)return this.drawText(x,y,text,fg1,fg2,bg);let left,right,lastSpace=-1;for(let i=0;i<text.length;i++){const nextLeft=text.substr(0,i);if(this.computeTextWidthTile(nextLeft)>=width)break;" "===text.charAt(i)&&(left=nextLeft,right=text.substr(i,text.length-left.length).trimLeft(),lastSpace=i)}lastSpace>=0&&(this.drawText(x,y,left,fg1,fg2,bg),this.drawTextWrapping(x,y+1,width,right,fg1,fg2,bg))}drawText(x,y,text,fg1="#adb8bc",fg2="#333",bg){for(let i=0;i<text.length;i++){const sprite=_classPrivateFieldGet(this,_spritesheets).font.getSprite(text.charAt(i));this.display.draw(x+.5*i,y,sprite,fg1,fg2,bg)}}drawTextCenter(y,text,fg1="#adb8bc",fg2="#333",bg){const len=this.computeTextWidth(text);this.drawText(Math.ceil((this.game.camera.width-len)/2),y,text,fg1,fg2,bg)}clear(){this.display.clear()}clearArea(x,y,width,height){this.display.clearArea(x,y,width,height)}pxToTile(xPx,yPx){return{x:Math.trunc(xPx/this.tileWidth),y:Math.trunc(yPx/this.tileHeight)}}render(){this.display.render()}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Manager});var _game=new WeakMap;class Manager{get game(){return function(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}(this,_game)}constructor(game){_game.set(this,{writable:!0,value:void 0}),function(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}}(this,_game,game)}onNewGame(){}getSaveGameData(){}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Display});var _utils_Grid__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class Display{constructor({width,height,tileWidth,tileHeight}){_defineProperty(this,"ctx",void 0),_defineProperty(this,"canvas",void 0),_defineProperty(this,"width",void 0),_defineProperty(this,"height",void 0),_defineProperty(this,"zoom",1),_defineProperty(this,"tileWidth",void 0),_defineProperty(this,"tileHeight",void 0),_defineProperty(this,"cells",void 0),_defineProperty(this,"clearColor","#141a23"),this.tileWidth=tileWidth,this.tileHeight=tileHeight,this.cells=new _utils_Grid__WEBPACK_IMPORTED_MODULE_0__.default(2*width,height,(()=>null)),this.cells.suppressOOBWarn=!0,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d",{alpha:!1}),this.ctx.globalCompositeOperation="destination-over",this.ctx.font="".concat(this.tileHeight,"px monospace"),this.ctx.textBaseline="top",this.setSize(width,height)}setSize(width,height,zoom){this.width=width,this.height=height,this.zoom=zoom;const widthPx=this.tileWidth*this.width,heightPx=this.tileHeight*this.height;this.canvas.style.cssText="width: ".concat(widthPx,"px; height: ").concat(heightPx,"px; transform: scale(").concat(this.zoom,")"),this.canvas.width=widthPx,this.canvas.height=heightPx,this.cells.clearAndResize(2*width,height)}draw(x,y,sprite,fg1,fg2,bg){this.cells.set(2*x,y,{img:sprite.colorize(fg1,fg2),width:sprite.width,height:sprite.height,bg,x,y})}clear(){this.ctx.fillStyle=this.clearColor,this.ctx.fillRect(0,0,this.tileWidth*this.width,this.tileHeight*this.height),this.cells.clear()}clearArea(x,y,width,height){this.ctx.fillStyle=this.clearColor,this.ctx.fillRect(x*this.tileWidth,y*this.tileHeight,this.tileWidth*width,this.tileHeight*height);const offsetX=2*x;for(let i=0;i<width;i++)for(let j=0;j<height;j++){const cellX=offsetX+2*i,cellY=y+j;this.cells.set(cellX,cellY,void 0),this.cells.set(cellX+1,cellY,void 0)}}render(){this.cells.data.filter((c=>c)).forEach((cell=>{const pixelX=cell.x*this.tileWidth,pixelY=cell.y*this.tileHeight;cell.bg&&(this.ctx.fillStyle=cell.bg,this.ctx.fillRect(pixelX,pixelY,cell.width,cell.height)),cell.img&&this.ctx.drawImage(cell.img,pixelX,pixelY)}))}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Grid});class Grid{get width(){return this._width}get height(){return this._height}get size(){return this._width*this._height}constructor(width,height,defaultValueGenerator=(()=>null)){_defineProperty(this,"_width",0),_defineProperty(this,"_height",0),_defineProperty(this,"data",[]),_defineProperty(this,"suppressOOBWarn",!1),_defineProperty(this,"defaultValueGenerator",(()=>null)),this._width=width,this._height=height,this.defaultValueGenerator=defaultValueGenerator,this.clear()}idx(x,y){return y*this._width+x}coord(idx){return{x:Math.trunc(idx%this._width),y:Math.trunc(idx/this._width)}}clear(){this.data=[];for(let i=0;i<this.size;i++){const{x,y}=this.coord(i);this.data[i]=this.defaultValueGenerator(x,y)}}setAll(value){this.data=[];for(let i=0;i<this.size;i++)this.data[i]=value}set(x,y,value){if(this.isOutOfBounds(x,y))return void(this.suppressOOBWarn||console.warn("Trying to set out-of-bounds coordinates (".concat(x,", ").concat(y,") to value ").concat(value)));const idx=this.idx(x,y);this.data[idx]=value}serialize(){const entries=[...this.data];return{width:this.width,height:this.height,entries}}deserialize(data){this._width=data.width,this._height=data.height,this.data=data.entries}get(x,y){return this.isOutOfBounds(x,y)?this.defaultValueGenerator():this.data[this.idx(x,y)]}isOutOfBounds(x,y){return x<0||y<0||x>=this._width||y>=this.height}getNeighbors(x,y){return[this.get(x-1,y-1),this.get(x,y-1),this.get(x+1,y-1),this.get(x-1,y),this.get(x+1,y),this.get(x-1,y+1),this.get(x,y+1),this.get(x+1,y+1)]}clearAndResize(width,height){this._width=width,this._height=height,this.clear()}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _SpriteSheet__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(9);const __WEBPACK_DEFAULT_EXPORT__=()=>{const tileImage=document.getElementById("spritesheet-tiles"),fontImage=document.getElementById("spritesheet-font"),uiImage=document.getElementById("spritesheet-ui");return[new _SpriteSheet__WEBPACK_IMPORTED_MODULE_0__.default("tiles",tileImage),new _SpriteSheet__WEBPACK_IMPORTED_MODULE_0__.default("font",fontImage),new _SpriteSheet__WEBPACK_IMPORTED_MODULE_0__.default("ui",uiImage)]}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>SpriteSheet});var _cp437__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(10),_Sprite__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(11);function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}var _name=new WeakMap,_defaultGlyph=new WeakMap,_sprites=new WeakMap;class SpriteSheet{get name(){return _classPrivateFieldGet(this,_name)}get width(){return this.image.width}get height(){return this.image.height}get spriteCountX(){return 16}get spriteCountY(){return 16}constructor(name,image){_name.set(this,{writable:!0,value:null}),_defaultGlyph.set(this,{writable:!0,value:"?"}),_sprites.set(this,{writable:!0,value:{}}),function(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}}(this,_name,name),this.image=image,this.spriteWidth=this.image.width/this.spriteCountX,this.spriteHeight=this.image.height/this.spriteCountY,_cp437__WEBPACK_IMPORTED_MODULE_0__.default.forEach(((row,i)=>{row.forEach(((glyph,j)=>{_classPrivateFieldGet(this,_sprites)[glyph]=new _Sprite__WEBPACK_IMPORTED_MODULE_1__.default(glyph,this,j,i)}))}))}getSprite(glyph){return _classPrivateFieldGet(this,_sprites)[glyph]?_classPrivateFieldGet(this,_sprites)[glyph]:_classPrivateFieldGet(this,_sprites)[_classPrivateFieldGet(this,_defaultGlyph)]}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});const __WEBPACK_DEFAULT_EXPORT__=[["NUL","☺","☻","♥","♦","♣","♠","•","◘","○","◙","♂","♀","♪","♫","☼"],["►","◄","↕","‼","¶","§","▬","↨","↑","↓","→","←","∟","↔","▲","▼"],[" ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/"],["0","1","2","3","4","5","6","7","8","9",":",";","<","=",">","?"],["@","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O"],["P","Q","R","S","T","U","V","W","X","Y","Z","[","\\","]","^","_"],["`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o"],["p","q","r","s","t","u","v","w","x","y","z","{","|","}","~","⌂"],["Ç","ü","é","â","ä","à","å","ç","ê","ë","è","ï","î","ì","Ä","Å"],["É","æ","Æ","ô","ö","ò","û","ù","ÿ","Ö","Ü","¢","£","¥","₧","ƒ"],["á","í","ó","ú","ñ","Ñ","ª","º","¿","⌐","¬","½","¼","¡","«","»"],["░","▒","▓","│","┤","╡","╢","╖","╕","╣","║","╗","╝","╜","╛","┐"],["└","┴","┬","├","─","┼","╞","╟","╚","╔","╩","╦","╠","═","╬","╧"],["╨","╤","╥","╙","╘","╒","╓","╫","╪","┘","┌","█","▄","▌","▐","▀"],["α","ß","Γ","π","Σ","σ","µ","τ","Φ","Θ","Ω","δ","∞","φ","ε","∩"],["≡","±","≥","≤","⌠","⌡","÷","≈","°","∙","·","√","ⁿ","²","■","NBSP"]]},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Sprite});var _utils_ColorParser__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(12),_utils_ColorUtil__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(15);function _classPrivateFieldSet(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}return value}function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}var _ctx=new WeakMap,_glyph=new WeakMap,_sheet=new WeakMap,_x=new WeakMap,_y=new WeakMap;class Sprite{get glyph(){return _classPrivateFieldGet(this,_glyph)}get x(){return _classPrivateFieldGet(this,_x)}get y(){return _classPrivateFieldGet(this,_y)}get sheet(){return _classPrivateFieldGet(this,_sheet)}get image(){return this.sheet.image}get sourceX(){return this.sheet.spriteWidth*this.x}get sourceY(){return this.sheet.spriteHeight*this.y}get width(){return this.sheet.spriteWidth}get height(){return this.sheet.spriteHeight}constructor(glyph,sheet,x,y){var obj,key,value;_ctx.set(this,{writable:!0,value:null}),_glyph.set(this,{writable:!0,value:null}),_sheet.set(this,{writable:!0,value:null}),_x.set(this,{writable:!0,value:null}),_y.set(this,{writable:!0,value:null}),value={},(key="_cache")in(obj=this)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,_classPrivateFieldSet(this,_glyph,glyph),_classPrivateFieldSet(this,_sheet,sheet),_classPrivateFieldSet(this,_x,x),_classPrivateFieldSet(this,_y,y);const canvas=document.createElement("canvas");canvas.width=this.width,canvas.height=this.height,_classPrivateFieldSet(this,_ctx,canvas.getContext("2d")),_classPrivateFieldGet(this,_ctx).drawImage(this.sheet.image,this.sourceX,this.sourceY,this.width,this.height,0,0,this.width,this.height)}colorize(primaryCss,secondaryCss){const primary=(0,_utils_ColorParser__WEBPACK_IMPORTED_MODULE_0__.parseColor)(primaryCss),secondary=(0,_utils_ColorParser__WEBPACK_IMPORTED_MODULE_0__.parseColor)(secondaryCss),key="".concat(primary.key,"-").concat(secondary.key);if(this._cache.hasOwnProperty(key))return this._cache[key];const pixels=_classPrivateFieldGet(this,_ctx).getImageData(0,0,this.width,this.height);for(let i=0;i<pixels.data.length;i+=4){const r=pixels.data[i+0],g=pixels.data[i+1],b=pixels.data[i+2],a=pixels.data[i+3];(0,_utils_ColorUtil__WEBPACK_IMPORTED_MODULE_1__.isBlack)(r,g,b)?(pixels.data[i]=primary[0],pixels.data[i+1]=primary[1],pixels.data[i+2]=primary[2],pixels.data[i+3]=a):(0,_utils_ColorUtil__WEBPACK_IMPORTED_MODULE_1__.isWhite)(r,g,b)&&(pixels.data[i]=secondary[0],pixels.data[i+1]=secondary[1],pixels.data[i+2]=secondary[2],pixels.data[i+3]=a)}const cvs=document.createElement("canvas");return cvs.width=this.width,cvs.height=this.height,cvs.getContext("2d").putImageData(pixels,0,0),this._cache[key]=cvs,cvs}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{parseColor:()=>parseColor});var color_parse__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(13);const cache={},parseColor=colorStr=>{if(!cache.hasOwnProperty(colorStr)){const parsed=(0,color_parse__WEBPACK_IMPORTED_MODULE_0__.default)(colorStr).values,data=[parsed[0],parsed[1],parsed[2],parsed.alpha];data.key="".concat(data[0],",").concat(data[1],",").concat(data[2],",").concat(data[3]),cache[colorStr]=data}return cache[colorStr]}},(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var color_name__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(14);const __WEBPACK_DEFAULT_EXPORT__=function(cstr){var m,space,parts=[],alpha=1;if("string"==typeof cstr)if(color_name__WEBPACK_IMPORTED_MODULE_0__[cstr])parts=color_name__WEBPACK_IMPORTED_MODULE_0__[cstr].slice(),space="rgb";else if("transparent"===cstr)alpha=0,space="rgb",parts=[0,0,0];else if(/^#[A-Fa-f0-9]+$/.test(cstr)){var size=(base=cstr.slice(1)).length;alpha=1,size<=4?(parts=[parseInt(base[0]+base[0],16),parseInt(base[1]+base[1],16),parseInt(base[2]+base[2],16)],4===size&&(alpha=parseInt(base[3]+base[3],16)/255)):(parts=[parseInt(base[0]+base[1],16),parseInt(base[2]+base[3],16),parseInt(base[4]+base[5],16)],8===size&&(alpha=parseInt(base[6]+base[7],16)/255)),parts[0]||(parts[0]=0),parts[1]||(parts[1]=0),parts[2]||(parts[2]=0),space="rgb"}else if(m=/^((?:rgb|hs[lvb]|hwb|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms)a?)\s*\(([^\)]*)\)/.exec(cstr)){var name=m[1],isRGB="rgb"===name,base=name.replace(/a$/,"");space=base;size="cmyk"===base?4:"gray"===base?1:3;parts=m[2].trim().split(/\s*[,\/]\s*|\s+/).map((function(x,i){if(/%$/.test(x))return i===size?parseFloat(x)/100:"rgb"===base?255*parseFloat(x)/100:parseFloat(x);if("h"===base[i]){if(/deg$/.test(x))return parseFloat(x);if(void 0!==baseHues[x])return baseHues[x]}return parseFloat(x)})),name===base&&parts.push(1),alpha=isRGB||void 0===parts[size]?1:parts[size],parts=parts.slice(0,size)}else cstr.length>10&&/[0-9](?:\s|\/)/.test(cstr)&&(parts=cstr.match(/([0-9]+)/g).map((function(value){return parseFloat(value)})),space=cstr.match(/([a-z])/gi).join("").toLowerCase());else isNaN(cstr)?Array.isArray(cstr)||cstr.length?(parts=[cstr[0],cstr[1],cstr[2]],space="rgb",alpha=4===cstr.length?cstr[3]:1):cstr instanceof Object&&(null!=cstr.r||null!=cstr.red||null!=cstr.R?(space="rgb",parts=[cstr.r||cstr.red||cstr.R||0,cstr.g||cstr.green||cstr.G||0,cstr.b||cstr.blue||cstr.B||0]):(space="hsl",parts=[cstr.h||cstr.hue||cstr.H||0,cstr.s||cstr.saturation||cstr.S||0,cstr.l||cstr.lightness||cstr.L||cstr.b||cstr.brightness]),alpha=cstr.a||cstr.alpha||cstr.opacity||1,null!=cstr.opacity&&(alpha/=100)):(space="rgb",parts=[cstr>>>16,(65280&cstr)>>>8,255&cstr]);return{space,values:parts,alpha}};var baseHues={red:0,orange:60,yellow:120,green:180,blue:240,purple:300}},module=>{"use strict";module.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{HSLToRGB:()=>HSLToRGB,lerpHSL:()=>lerpHSL,isWhite:()=>isWhite,isBlack:()=>isBlack});const HSLToRGB=(h,s,l)=>{s/=100,l/=100;let c=(1-Math.abs(2*l-1))*s,x=c*(1-Math.abs(h/60%2-1)),m=l-c/2,r=0,g=0,b=0;return 0<=h&&h<60?(r=c,g=x,b=0):60<=h&&h<120?(r=x,g=c,b=0):120<=h&&h<180?(r=0,g=c,b=x):180<=h&&h<240?(r=0,g=x,b=c):240<=h&&h<300?(r=x,g=0,b=c):300<=h&&h<360&&(r=c,g=0,b=x),[Math.round(255*(r+m)),Math.round(255*(g+m)),Math.round(255*(b+m))]},lerpHSL=(a,b,t)=>{const deg=Math.trunc(lerp(a[0],b[0],t)),sat=Math.trunc(lerp(a[1],b[1],t)),light=Math.trunc(lerp(a[2],b[2],t));return HSLToRGB(deg,sat,light)},isWhite=(r,g,b)=>255===r&&255===g&&255===b,isBlack=(r,g,b)=>0===r&&0===g&&0===b},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>InputController});var _events_InputKeyboardEvent__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(17),_events_InputMouseEvent__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(19),_Manager__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(5);class InputController extends _Manager__WEBPACK_IMPORTED_MODULE_2__.default{constructor(game){super(game),document.addEventListener("keydown",this.onKeydown.bind(this));const container=this.game.renderer.canvas;container.addEventListener("click",this.onMouseClick.bind(this)),container.addEventListener("mousemove",this.onMouseMove.bind(this)),container.addEventListener("mouseenter",this.onMouseEnter.bind(this)),container.addEventListener("mouseleave",this.onMouseLeave.bind(this))}onKeydown(e){const evt=new _events_InputKeyboardEvent__WEBPACK_IMPORTED_MODULE_0__.default({key:e.keyCode,shift:e.shiftKey,ctrl:e.ctrlKey,alt:e.altKey,meta:e.metaKey});e.preventDefault(),this.game.commands.onInputEvent(evt)}onMouseClick(e){const xPx=e.offsetX,yPx=e.offsetY,{x,y}=this.game.renderer.pxToTile(xPx,yPx),evt=new _events_InputMouseEvent__WEBPACK_IMPORTED_MODULE_1__.default({key:e.button,x,y,shift:e.shiftKey,ctrl:e.ctrlKey,alt:e.altKey,meta:e.metaKey,xPx,yPx});this.game.commands.onInputEvent(evt)}onMouseMove(e){const xPx=e.offsetX,yPx=e.offsetY,{x,y}=this.game.renderer.pxToTile(xPx,yPx);this.game.mouse.updatePosition(x,y)}onMouseEnter(e){this.game.mouse.updateMouseEnter()}onMouseLeave(e){this.game.mouse.updateMouseLeave()}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>InputKeyboardEvent});var _InputEvent__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(18);class InputKeyboardEvent extends _InputEvent__WEBPACK_IMPORTED_MODULE_0__.default{}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>InputEvent});class InputEvent{constructor(data){_defineProperty(this,"key",!1),_defineProperty(this,"shift",!1),_defineProperty(this,"ctrl",!1),_defineProperty(this,"alt",!1),_defineProperty(this,"meta",!1),this.key=data.key,this.shift=data.shift,this.ctrl=data.ctrl,this.alt=data.alt,this.meta=data.meta}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>InputMouseEvent});var _InputEvent__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(18);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class InputMouseEvent extends _InputEvent__WEBPACK_IMPORTED_MODULE_0__.default{constructor(data){super(data),_defineProperty(this,"x",!1),_defineProperty(this,"y",!1),_defineProperty(this,"tileX",!1),_defineProperty(this,"tileY",!1),this.x=data.x,this.y=data.y,this.tileX=data.tileX,this.tileY=data.tileY}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>ActionSystem});var _ecs_components__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(21),_System__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(138);var _query=new WeakMap;class ActionSystem extends _System__WEBPACK_IMPORTED_MODULE_1__.default{constructor(game){super(game),_query.set(this,{writable:!0,value:null}),function(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}}(this,_query,game.ecs.createQuery({all:[_ecs_components__WEBPACK_IMPORTED_MODULE_0__.Actor],none:[_ecs_components__WEBPACK_IMPORTED_MODULE_0__.IsDestroying,_ecs_components__WEBPACK_IMPORTED_MODULE_0__.IsDead,_ecs_components__WEBPACK_IMPORTED_MODULE_0__.IsIncapacitated]}))}update(dt){const entities=function(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}(this,_query).get(),sorted=Array.from(entities);sorted.sort(((a,b)=>a.actor.energy<b.actor.energy?1:-1));let entity=sorted[0];for(entity&&!entity.actor.hasEnergy&&(this.game.clock.incrementTick(-1*entity.actor.energy),entities.forEach((entity=>{entity.actor.addEnergy(this.game.clock.tickDelta)})));entity&&entity.actor.hasEnergy;){if(entity.isPlayer){const action=this.game.player.getNextAction();return action&&action(),!0}entity.fireEvent("take-action"),entity=sorted.shift()}return!1}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Actor:()=>_Actor__WEBPACK_IMPORTED_MODULE_0__.Actor,IsDestroying:()=>_IsDestroying__WEBPACK_IMPORTED_MODULE_1__.IsDestroying,LiquidContainer:()=>_LiquidContainer__WEBPACK_IMPORTED_MODULE_2__.LiquidContainer,Door:()=>_Door__WEBPACK_IMPORTED_MODULE_3__.Door,Loot:()=>_Loot__WEBPACK_IMPORTED_MODULE_4__.Loot,Throwable:()=>_Throwable__WEBPACK_IMPORTED_MODULE_5__.Throwable,FragileGlass:()=>_FragileGlass__WEBPACK_IMPORTED_MODULE_6__.FragileGlass,Stackable:()=>_Stackable__WEBPACK_IMPORTED_MODULE_7__.Stackable,Inventory:()=>_Inventory__WEBPACK_IMPORTED_MODULE_8__.Inventory,IsInventoried:()=>_IsInventoried__WEBPACK_IMPORTED_MODULE_9__.IsInventoried,Brain:()=>_Brain__WEBPACK_IMPORTED_MODULE_10__.Brain,Body:()=>_Body__WEBPACK_IMPORTED_MODULE_11__.Body,Goal:()=>_Goal__WEBPACK_IMPORTED_MODULE_12__.Goal,Moniker:()=>_Moniker__WEBPACK_IMPORTED_MODULE_13__.Moniker,Logger:()=>_Logger__WEBPACK_IMPORTED_MODULE_14__.Logger,Position:()=>_Position__WEBPACK_IMPORTED_MODULE_15__.Position,Glyph:()=>_Glyph__WEBPACK_IMPORTED_MODULE_16__.Glyph,Legs:()=>_Legs__WEBPACK_IMPORTED_MODULE_17__.Legs,IsPlayer:()=>_IsPlayer__WEBPACK_IMPORTED_MODULE_18__.IsPlayer,Wandering:()=>_Wandering__WEBPACK_IMPORTED_MODULE_19__.Wandering,Blocker:()=>_Blocker__WEBPACK_IMPORTED_MODULE_20__.Blocker,Shadowcaster:()=>_Shadowcaster__WEBPACK_IMPORTED_MODULE_21__.Shadowcaster,IsVisible:()=>_IsVisible__WEBPACK_IMPORTED_MODULE_22__.IsVisible,Explorable:()=>_Explorable__WEBPACK_IMPORTED_MODULE_23__.Explorable,Explored:()=>_Explored__WEBPACK_IMPORTED_MODULE_24__.Explored,Health:()=>_Health__WEBPACK_IMPORTED_MODULE_25__.Health,IsDead:()=>_IsDead__WEBPACK_IMPORTED_MODULE_26__.IsDead,FactionMember:()=>_FactionMember__WEBPACK_IMPORTED_MODULE_27__.FactionMember,Eyes:()=>_Eyes__WEBPACK_IMPORTED_MODULE_28__.Eyes,Particle:()=>_Particle__WEBPACK_IMPORTED_MODULE_29__.Particle,ParticleEmitter:()=>_ParticleEmitter__WEBPACK_IMPORTED_MODULE_30__.ParticleEmitter,LootDropper:()=>_LootDropper__WEBPACK_IMPORTED_MODULE_31__.LootDropper,IsEquipped:()=>_IsEquipped__WEBPACK_IMPORTED_MODULE_32__.IsEquipped,Equipment:()=>_Equipment__WEBPACK_IMPORTED_MODULE_33__.Equipment,EquipmentSlot:()=>_EquipmentSlot__WEBPACK_IMPORTED_MODULE_34__.EquipmentSlot,Stats:()=>_Stats__WEBPACK_IMPORTED_MODULE_35__.Stats,Race:()=>_Race__WEBPACK_IMPORTED_MODULE_36__.Race,Weapon:()=>_Weapon__WEBPACK_IMPORTED_MODULE_37__.Weapon,Status:()=>_Status__WEBPACK_IMPORTED_MODULE_38__.Status,Ground:()=>_Ground__WEBPACK_IMPORTED_MODULE_39__.Ground,IsIncapacitated:()=>_IsIncapacitated__WEBPACK_IMPORTED_MODULE_40__.IsIncapacitated,SharpTrap:()=>_SharpTrap__WEBPACK_IMPORTED_MODULE_41__.SharpTrap,EquippedSkillMod:()=>_EquippedSkillMod__WEBPACK_IMPORTED_MODULE_42__.EquippedSkillMod,Combustible:()=>_Combustible__WEBPACK_IMPORTED_MODULE_43__.Combustible,Fire:()=>_Fire__WEBPACK_IMPORTED_MODULE_44__.Fire,ThermalCapacity:()=>_ThermalCapacity__WEBPACK_IMPORTED_MODULE_45__.ThermalCapacity,Abilities:()=>_Abilities__WEBPACK_IMPORTED_MODULE_46__.Abilities,AbilityStatus:()=>_AbilityStatus__WEBPACK_IMPORTED_MODULE_47__.AbilityStatus});var _Actor__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(22),_IsDestroying__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(24),_LiquidContainer__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(25),_Door__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(48),_Loot__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(51),_Throwable__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(57),_FragileGlass__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(71),_Stackable__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(55),_Inventory__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(52),_IsInventoried__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(54),_Brain__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(73),_Body__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(69),_Goal__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(74),_Moniker__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(76),_Logger__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(77),_Position__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(78),_Glyph__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(79),_Legs__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(80),_IsPlayer__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(81),_Wandering__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(82),_Blocker__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(49),_Shadowcaster__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(50),_IsVisible__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(70),_Explorable__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(84),_Explored__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(85),_Health__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(86),_IsDead__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(87),_FactionMember__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__(88),_Eyes__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__(91),_Particle__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__(92),_ParticleEmitter__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__(93),_LootDropper__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__(94),_IsEquipped__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__(99),_Equipment__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__(100),_EquipmentSlot__WEBPACK_IMPORTED_MODULE_34__=__webpack_require__(102),_Stats__WEBPACK_IMPORTED_MODULE_35__=__webpack_require__(116),_Race__WEBPACK_IMPORTED_MODULE_36__=__webpack_require__(118),_Weapon__WEBPACK_IMPORTED_MODULE_37__=__webpack_require__(121),_Status__WEBPACK_IMPORTED_MODULE_38__=__webpack_require__(122),_Ground__WEBPACK_IMPORTED_MODULE_39__=__webpack_require__(123),_IsIncapacitated__WEBPACK_IMPORTED_MODULE_40__=__webpack_require__(124),_SharpTrap__WEBPACK_IMPORTED_MODULE_41__=__webpack_require__(125),_EquippedSkillMod__WEBPACK_IMPORTED_MODULE_42__=__webpack_require__(126),_Combustible__WEBPACK_IMPORTED_MODULE_43__=__webpack_require__(127),_Fire__WEBPACK_IMPORTED_MODULE_44__=__webpack_require__(128),_ThermalCapacity__WEBPACK_IMPORTED_MODULE_45__=__webpack_require__(129),_Abilities__WEBPACK_IMPORTED_MODULE_46__=__webpack_require__(130),_AbilityStatus__WEBPACK_IMPORTED_MODULE_47__=__webpack_require__(131)},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Actor:()=>Actor});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23);class Actor extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{get hasEnergy(){return this.energy>=0}onEnergyConsumed(evt){this.reduceEnergy(evt.data)}onTick(evt){this.addEnergy(1)}addEnergy(value){this.energy+=value,this.energy>=0&&(this.energy=0)}reduceEnergy(value){this.addEnergy(-1*value)}}value={energy:0},(key="properties")in(obj=Actor)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Component:()=>Component,Engine:()=>Engine,Prefab:()=>Prefab});const camelCase=(input,options)=>{if("string"!=typeof input&&!Array.isArray(input))throw new TypeError("Expected the input to be `string | string[]`");options={pascalCase:!1,...options};if(0===(input=Array.isArray(input)?input.map((x=>x.trim())).filter((x=>x.length)).join("-"):input.trim()).length)return"";if(1===input.length)return options.pascalCase?input.toLocaleUpperCase():input.toLocaleLowerCase();return input!==input.toLocaleLowerCase()&&(input=(string=>{let isLastCharLower=!1,isLastCharUpper=!1,isLastLastCharUpper=!1;for(let i=0;i<string.length;i++){const character=string[i];isLastCharLower&&/[\p{Lu}]/u.test(character)?(string=string.slice(0,i)+"-"+string.slice(i),isLastCharLower=!1,isLastLastCharUpper=isLastCharUpper,isLastCharUpper=!0,i++):isLastCharUpper&&isLastLastCharUpper&&/[\p{Ll}]/u.test(character)?(string=string.slice(0,i-1)+"-"+string.slice(i-1),isLastLastCharUpper=isLastCharUpper,isLastCharUpper=!1,isLastCharLower=!0):(isLastCharLower=character.toLocaleLowerCase()===character&&character.toLocaleUpperCase()!==character,isLastLastCharUpper=isLastCharUpper,isLastCharUpper=character.toLocaleUpperCase()===character&&character.toLocaleLowerCase()!==character)}return string})(input)),input=input.replace(/^[_.\- ]+/,"").toLocaleLowerCase().replace(/[_.\- ]+([\p{Alpha}\p{N}_]|$)/gu,((_,p1)=>p1.toLocaleUpperCase())).replace(/\d+([\p{Alpha}\p{N}_]|$)/gu,(m=>m.toLocaleUpperCase())),x=input,options.pascalCase?x.charAt(0).toLocaleUpperCase()+x.slice(1):x;var x};var camelcase=camelCase,_default=camelCase;camelcase.default=_default;const camelCache={},camelString=value=>(camelCache.hasOwnProperty(value)||(camelCache[value]=camelcase(value)),camelCache[value]),pascalCache=new Map;class Property{constructor(component){_defineProperty(this,"component",void 0),this.component=component}get ecs(){return this.component.ecs}get descriptor(){return{enumerable:!0,get:()=>this.get(),set:v=>this.set(v)}}get(){}set(value){}serialize(){}onDestroyed(){}cleanupReference(entity){}}class SimpleProperty extends Property{constructor(...args){super(...args),_defineProperty(this,"value",null)}set(value){this.value=value}get(){return this.value}serialize(){return this.value}}class EntityProperty extends Property{constructor(...args){super(...args),_defineProperty(this,"id",void 0)}set(value){return!this.id||value&&value.id===this.id&&value===this.id||this.ecs.entities.removeRef(this.id,this),value&&value.id?(this.ecs.entities.addRef(value.id,this),void(this.id=value.id)):"string"==typeof value?(this.ecs.entities.addRef(value,this),void(this.id=value)):void(this.id=void 0)}get(){return this.id&&this.component.ecs.getEntity(this.id)}serialize(){return this.id}onDestroyed(){this.id&&this.ecs.entities.removeRef(this.id,this)}cleanupReference(entity){this.id===entity.id?this.id=void 0:console.warn('Property in unclean state. A reference to an entity "'.concat(entity.id,'" was never cleaned up.'),entity)}}class EntityArrayProperty extends Property{constructor(component){super(component),_defineProperty(this,"proxy",[]),this.proxy=new Proxy([],{get:(target,prop,receiver)=>Reflect.get(target,prop,receiver),set:(target,prop,value,receiver)=>{if(isNaN(prop))return Reflect.set(target,prop,value,receiver);const old=Reflect.get(target,prop,receiver);return"string"==typeof value&&(value=this.ecs.entities.get(value)),old&&old!=value&&this.ecs.entities.removeRef(value,this),value&&value.id?(this.ecs.entities.addRef(value.id,this),Reflect.set(target,prop,value,receiver)):Reflect.set(target,prop,value,receiver)},deleteProperty:(target,prop)=>{if(isNaN(prop))return Reflect.deleteProperty(target,prop);const value=Reflect.get(target,prop);return this.ecs.entities.removeRef(value,this),Reflect.deleteProperty(target,prop)}})}set(values=[]){const len=Math.max(values.length,this.proxy.length);for(let i=0;i<len;i++)i in values?this.proxy[i]=values[i]:delete this.proxy[i];this.proxy.length=values.length}get(){return this.proxy}serialize(){return this.proxy.map((ref=>ref.id))}onDestroyed(){this.set([])}cleanupReference(entity){this.set(this.proxy.filter((ref=>ref.id!==entity.id)))}}class PropertyStrategy{static create(component,value){switch(value){case"<Entity>":return new EntityProperty(component);case"<EntityArray>":return new EntityArrayProperty(component);default:return new SimpleProperty(component)}}}class Component{static get type(){return this.name}get type(){return this.constructor.name}get isAttached(){return Boolean(this.entity)}get isDestroyed(){return this._isDestroyed}get allowMultiple(){return this.constructor.allowMultiple}get keyProperty(){return this.constructor.keyProperty}get properties(){const ob={};for(const[key,value]of Object.entries(this._props))ob[key]=value.get();return ob}get key(){return this[this.keyProperty]}constructor(ecs,properties={}){_defineProperty(this,"entity",null),_defineProperty(this,"ecs",null),_defineProperty(this,"_props",{}),_defineProperty(this,"_isDestroyed",!1),this.ecs=ecs,this._defineProxies(properties)}serialize(){return Object.entries(this._props).reduce(((o,[key,value])=>({...o,[key]:value.serialize()})),{})}_onAttached(entity){this.entity=entity,this.ecs.queries.onComponentAdded(entity,this),this.onAttached()}_onDetached(){this.isAttached&&(this.onDetached(),this.entity=null)}_onDestroyed(){this._isDestroyed=!0,this.onDestroyed();for(const prop of Object.values(this._props))prop.onDestroyed()}onAttached(){}onDetached(){}onDestroyed(){}remove(destroy=!0){this.isAttached&&this.entity.remove(this),destroy&&this._onDestroyed()}destroy(){this.remove(!0)}clone(){return this.ecs.createComponent(this.type,this.serialize())}_onEvent(evt){this.onEvent(evt);const handlerName=camelString("on ".concat(evt.name));"function"==typeof this[handlerName]&&this[handlerName](evt)}onEvent(evt){}_defaultPropertyValue(propertyName){const value=this.constructor.properties[propertyName];return"<EntityArray>"===value?[]:"<Entity>"!==value?value:void 0}_defineProxies(initialProperties){for(const key in this.constructor.properties){const initialValue=initialProperties.hasOwnProperty(key)?initialProperties[key]:this._defaultPropertyValue(key),property=PropertyStrategy.create(this,this.constructor.properties[key]);this._props[key]=property,Object.defineProperty(this,key,property.descriptor),property.set(initialValue)}}}_defineProperty(Component,"allowMultiple",!1),_defineProperty(Component,"keyProperty",null),_defineProperty(Component,"properties",{});class ComponentRegistry{constructor(ecs){_defineProperty(this,"_definitions",new Map),_defineProperty(this,"_ecs",null),this._ecs=ecs}register(component){this._definitions.set(component.name,component),camelString(component.name)}getAccessor(type){return camelString(type)}get(typeOrClassOrComponent){const type=this._getType(typeOrClassOrComponent);return type?this._definitions.get(type):(console.warn("Cannot get component definition for type or class ".concat(typeOrClassOrComponent," since it is neither a Component class or type (string)")),null)}create(typeOrClass,properties={}){const definition=this.get(typeOrClass);if(definition)return new definition(this._ecs,properties);console.warn("Could not create component definition for ".concat(typeOrClass," since it is not registered"))}_getType(typeOrClassOrComponent){return"string"==typeof typeOrClassOrComponent?typeOrClassOrComponent:typeOrClassOrComponent instanceof Component?typeOrClassOrComponent.type:typeOrClassOrComponent.prototype instanceof Component?typeOrClassOrComponent.name:null}}var isMergeableObject=function(value){return function(value){return!!value&&"object"==typeof value}(value)&&!function(value){var stringValue=Object.prototype.toString.call(value);return"[object RegExp]"===stringValue||"[object Date]"===stringValue||function(value){return value.$$typeof===REACT_ELEMENT_TYPE}(value)}(value)};var REACT_ELEMENT_TYPE="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function cloneUnlessOtherwiseSpecified(value,options){return!1!==options.clone&&options.isMergeableObject(value)?deepmerge((val=value,Array.isArray(val)?[]:{}),value,options):value;var val}function defaultArrayMerge(target,source,options){return target.concat(source).map((function(element){return cloneUnlessOtherwiseSpecified(element,options)}))}function getKeys(target){return Object.keys(target).concat(function(target){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(target).filter((function(symbol){return target.propertyIsEnumerable(symbol)})):[]}(target))}function propertyIsOnObject(object,property){try{return property in object}catch(_){return!1}}function mergeObject(target,source,options){var destination={};return options.isMergeableObject(target)&&getKeys(target).forEach((function(key){destination[key]=cloneUnlessOtherwiseSpecified(target[key],options)})),getKeys(source).forEach((function(key){(function(target,key){return propertyIsOnObject(target,key)&&!(Object.hasOwnProperty.call(target,key)&&Object.propertyIsEnumerable.call(target,key))})(target,key)||(propertyIsOnObject(target,key)&&options.isMergeableObject(source[key])?destination[key]=function(key,options){if(!options.customMerge)return deepmerge;var customMerge=options.customMerge(key);return"function"==typeof customMerge?customMerge:deepmerge}(key,options)(target[key],source[key],options):destination[key]=cloneUnlessOtherwiseSpecified(source[key],options))})),destination}function deepmerge(target,source,options){(options=options||{}).arrayMerge=options.arrayMerge||defaultArrayMerge,options.isMergeableObject=options.isMergeableObject||isMergeableObject,options.cloneUnlessOtherwiseSpecified=cloneUnlessOtherwiseSpecified;var sourceIsArray=Array.isArray(source);return sourceIsArray===Array.isArray(target)?sourceIsArray?options.arrayMerge(target,source,options):mergeObject(target,source,options):cloneUnlessOtherwiseSpecified(source,options)}deepmerge.all=function(array,options){if(!Array.isArray(array))throw new Error("first argument should be an array");return array.reduce((function(prev,next){return deepmerge(prev,next,options)}),{})};var cjs=deepmerge;class PrefabComponent{get type(){return this.componentDef.type}constructor(componentDef,properties={},overwrite=!0){this.componentDef=componentDef,this.properties=properties,this.overwrite=overwrite}applyToEntity(entity,initialProps={}){if(!this.componentDef.allowMultiple&&entity.has(this.componentDef)){if(!this.overwrite)return void console.log('Ignoring prefab component "'.concat(this.type,'" since the entity "').concat(entity.id,'" already has one.'));entity.remove(this.componentDef)}const props=cjs(this.properties,initialProps);entity.add(this.componentDef,props)}}class Prefab{constructor(ecs,name){_defineProperty(this,"name",""),_defineProperty(this,"inherit",[]),_defineProperty(this,"components",[]),this.ecs=ecs,this.name=name}addComponent(prefabComponent){this.components.push(prefabComponent)}applyToEntity(entity,initialProps={}){this.inherit.forEach((parent=>{parent.applyToEntity(entity,initialProps)}));const arrComps={};return this.components.forEach(((component,i)=>{const definition=component.componentDef,accessor=this.ecs.components.getAccessor(definition.type);let initialCompProps={};if(definition.allowMultiple)if(definition.keyProperty){const key=component.properties[definition.keyProperty];initialProps[accessor]&&initialProps[accessor][key]&&(initialCompProps=initialProps[accessor][key])}else arrComps[accessor]||(arrComps[accessor]=0),initialProps[accessor]&&initialProps[accessor][arrComps[accessor]]&&(initialCompProps=initialProps[accessor][arrComps[accessor]]),arrComps[accessor]++;else initialCompProps=initialProps[accessor];component.applyToEntity(entity,initialCompProps)})),entity}}class PrefabRegistry{constructor(ecs){_defineProperty(this,"_prefabs",{}),_defineProperty(this,"_ecs",null),this._ecs=ecs}deserialize(data){const registered=this.get(data.name);if(registered)return registered;const prefab=new Prefab(this._ecs,data.name);let inherit;inherit=Array.isArray(data.inherit)?data.inherit:"string"==typeof data.inherit?[data.inherit]:[],prefab.inherit=inherit.map((parent=>{const ref=this.get(parent);return ref||(console.warn('Prefab "'.concat(data.name,'" cannot inherit from Prefab "').concat(parent,'" because is not registered yet! Prefabs must be registered in the right order.')),parent)}));const comps=data.components||[];for(const componentData of comps)if("string"==typeof componentData||componentData.prototype instanceof Component){const def=this._ecs.components.get(componentData);def&&prefab.addComponent(new PrefabComponent(def))}else if("object"==typeof componentData){const type=componentData.type,def=this._ecs.components.get(type);def&&prefab.addComponent(new PrefabComponent(def,componentData.properties,componentData.overwrite))}else console.warn('Unrecognized component reference "'.concat(componentData,'" in prefab "').concat(data.name,'". Ensure the component is registered before the prefab.'));return this.register(prefab),prefab}register(prefab){this._prefabs[prefab.name]=prefab}get(nameOrClassOrPrefab){const name=PrefabRegistry._getName(nameOrClassOrPrefab);return this._prefabs[name]}create(nameOrClass,initialProps={}){const prefab=this.get(nameOrClass);if(!prefab)return void console.warn("Could not instantiate prefab for ".concat(nameOrClass," since it is not registered"));const entity=this._ecs.createEntity();return prefab.applyToEntity(entity,initialProps),entity}static _getName(nameOrClassOrPrefab){return"string"==typeof nameOrClassOrPrefab?nameOrClassOrPrefab:nameOrClassOrPrefab instanceof Prefab||nameOrClassOrPrefab.prototype instanceof Prefab?nameOrClassOrPrefab.name:null}}class EntityEvent{get prevented(){return this._prevented}get handled(){return this._handled}constructor(name,data={}){_defineProperty(this,"data",{}),_defineProperty(this,"_prevented",!1),_defineProperty(this,"_handled",!1),this.name=name,this.data=data}is(name){return this.name===name}handle(){this._handled=!0,this._prevented=!0}prevent(){this._prevented=!0}}class Entity{get isDestroyed(){return this._isDestroyed}constructor(ecs,id=null){_defineProperty(this,"id",null),_defineProperty(this,"components",{}),_defineProperty(this,"ecs",null),_defineProperty(this,"_isDestroyed",!1),this.ecs=ecs,this.id=id||ecs.generateId()}has(typeOrClass,key=null){const type=this.ecs.components._getType(typeOrClass),accessor=this.ecs.components.getAccessor(type),hasType=this.hasOwnProperty(accessor);return hasType&&key?this[accessor].hasOwnProperty(key):hasType}get(typeOrClass,key=null){const type=this.ecs.components._getType(typeOrClass),components=this[this.ecs.components.getAccessor(type)];return components&&key?components[key]:components}destroy(){this._isDestroyed=!0;for(const component of Object.values(this.components))if(component instanceof Component)component.destroy();else for(const nestedComponent of Object.values(component))nestedComponent.destroy();this.ecs.entities.onEntityDestroyed(this)}add(typeOrClass,properties={}){if(typeOrClass instanceof Component)return typeOrClass.isAttached?(console.warn('"'.concat(typeOrClass.type,'" component cannot be added, since it is already attached to an entity.')),!1):this.attach(typeOrClass);const component=this.ecs.components.create(typeOrClass,properties);return component?this.attach(component):(console.warn('"'.concat(typeOrClass,'" component cannot be added, since it is not registered.')),!1)}attach(component){const accessor=this.ecs.components.getAccessor(component.type);return component.allowMultiple?component.keyProperty?component.key?(this.components[accessor]||(this.components[accessor]={},Object.defineProperty(this,accessor,{configurable:!0,enumerable:!0,writable:!1,value:this.components[accessor]})),this.components[accessor][component.key]=component,component._onAttached(this),!0):(console.warn('"'.concat(component.type,'" component has a falsy key of "').concat(component.key,'". The keyProperty is set to "').concat(component.keyProperty,'".')),!1):(this.components[accessor]||(this.components[accessor]=[],Object.defineProperty(this,accessor,{configurable:!0,enumerable:!0,writable:!1,value:this.components[accessor]})),this.components[accessor].push(component),component._onAttached(this),!0):this.has(component.type)?(console.warn('"'.concat(component.type,'" component has allowMultiple set to ').concat(component.allowMultiple,'. Trying to add a "').concat(component.type,'" component to an entity which already has one.')),!1):(this.components[accessor]=component,Object.defineProperty(this,accessor,{enumerable:!0,configurable:!0,writable:!1,value:this.components[accessor]}),component._onAttached(this),!0)}owns(component){return component.entity===this}remove(typeOrClassOrComponent,key=null){const isComponent=typeOrClassOrComponent instanceof Component;key=isComponent?typeOrClassOrComponent.key:key;const definition=this.ecs.components.get(typeOrClassOrComponent),accessor=this.ecs.components.getAccessor(definition.type);if(definition.allowMultiple){if(!definition.keyProperty){if(!isComponent){for(const instance of this.components[accessor])instance._onDetached();return delete this[accessor],delete this.components[accessor],this.ecs.queries.onComponentRemoved(this),!0}{const all=this.components[accessor];if(!all)return void console.warn('Trying to remove a "'.concat(definition.type,"\" component from an entity, but it wasn't found."));const index=all.indexOf(typeOrClassOrComponent);if(index>-1)return all.splice(index,1),typeOrClassOrComponent._onDetached(),0===all.length&&(delete this[accessor],delete this.components[accessor]),this.ecs.queries.onComponentRemoved(this),!0}}if(!key)return void console.warn('Trying to remove a "'.concat(definition.type,'" component which allows multiple without specifying an key.'));const all=this.components[accessor],component=all[key];return component?(delete all[key],component._onDetached(),Object.keys(all).length<=0&&(delete this[accessor],delete this.components[accessor]),this.ecs.queries.onComponentRemoved(this),component):void console.warn('Trying to remove a "'.concat(definition.type,'" component from an entity at "').concat(key,"\", but it wasn't found."))}if(accessor in this){const component=this.components[accessor];return delete this[accessor],delete this.components[accessor],component._onDetached(),this.ecs.queries.onComponentRemoved(this),component}console.warn('Trying to remove a "'.concat(definition.type,"\" component from an entity, but it wasn't found."))}serialize(){return Object.entries(this.components).reduce(((o,[key,value])=>value instanceof Component?{...o,[key]:value.serialize()}:Array.isArray(value)?{...o,[key]:value.map((v=>v.serialize()))}:{...o,[key]:Object.entries(value).reduce(((o2,[k2,v2])=>({...o2,[k2]:v2.serialize()})),{})}),{id:this.id})}fireEvent(name,data){const evt=new EntityEvent(name,data);for(const component of Object.values(this.components))if(component instanceof Component){if(component._onEvent(evt),evt.prevented)return evt}else for(const nestedComponent of Object.values(component))if(nestedComponent._onEvent(evt),evt.prevented)return evt;return evt}}class EntityRegistry{constructor(ecs){_defineProperty(this,"_entities",new Map),_defineProperty(this,"_ecs",null),_defineProperty(this,"_refs",new Map),this._ecs=ecs}get all(){return this._entities.values()}register(entity){return this._entities.set(entity.id,entity),entity}get(id){return this._entities.get(id)}createOrGetById(id){const entity=this.get(id);return entity||this.create(id)}create(id){const entity=new Entity(this._ecs,id);return this.register(entity),this._ecs.queries.onEntityCreated(entity),entity}destroy(entity){entity.destroy()}onEntityDestroyed(entity){this.cleanupRefs(entity),this._entities.delete(entity.id),this._ecs.queries.onEntityDestroyed(entity)}cleanupRefs(entity){const refs=this._refs.get(entity.id);if(refs){for(const ref of refs)ref.cleanupReference(entity);delete this._refs[entity.id]}}addRef(entityId,property){this._refs.has(entityId)?this._refs.get(entityId).add(property):this._refs.set(entityId,new Set([property]))}removeRef(entityId,property){this._refs.has(entityId)&&this._refs.get(entityId).delete(property)}serialize(entities){const json=[];return(entities||this._entities).forEach((entity=>{json.push(entity.serialize())})),json}deserialize(data){for(const entityData of data.entities)this.createOrGetById(entityData.id);for(const entityData of data.entities)this.deserializeEntity(entityData)}deserializeEntity(data){const{id,...componentData}=data,entity=this.createOrGetById(id);Object.entries(componentData).forEach((([key,value])=>{const type=(value=>(pascalCache.has(value)||pascalCache.set(value,camelcase(value,{pascalCase:!0})),pascalCache.get(value)))(key),definition=this._ecs.components.get(type);definition.allowMultiple?Object.values(value).forEach((d=>{entity.add(definition,d)})):entity.add(definition,value)}))}}class Query{constructor(ecs,filter={}){_defineProperty(this,"_ecs",void 0),_defineProperty(this,"_filter",void 0),_defineProperty(this,"_onEntityAddedCallbacks",[]),_defineProperty(this,"_onEntityRemovedCallbacks",[]),_defineProperty(this,"_cache",new Set),this._ecs=ecs,this._filter=cjs({any:[],all:[],none:[]},filter),this.bustCache()}isMatch(entity){const hasAny=!this._filter.any.length||this._filter.any.some((c=>entity.has(c))),hasAll=this._filter.all.every((c=>entity.has(c))),hasNone=!this._filter.none.some((c=>entity.has(c)));return hasAny&&hasAll&&hasNone}onEntityAdded(fn){this._onEntityAddedCallbacks.push(fn)}onEntityRemoved(fn){this._onEntityRemovedCallbacks.push(fn)}has(entity){return this._cache.has(entity)}candidate(entity){const isTracking=this.has(entity);return this.isMatch(entity)?(isTracking||(this._cache.add(entity),this._onEntityAddedCallbacks.forEach((cb=>cb(entity)))),!0):(isTracking&&(this._cache.delete(entity),this._onEntityRemovedCallbacks.forEach((cb=>cb(entity)))),!1)}_onEntityCreated(entity){this.candidate(entity)}_onComponentAdded(entity){this.candidate(entity)}_onComponentRemoved(entity){this.candidate(entity)}_onEntityDestroyed(entity){this.has(entity)&&(this._cache.delete(entity),this._onEntityRemovedCallbacks.forEach((cb=>cb(entity))))}bustCache(){this._cache.clear();for(const entity of this._ecs.entities.all)this.candidate(entity);return this._cache}get(){return this._cache}}class QueryRegistry{constructor(ecs){_defineProperty(this,"_ecs",void 0),_defineProperty(this,"_queries",[]),this._ecs=ecs}create(filters){const query=new Query(this._ecs,filters);return this._queries.push(query),query}onComponentAdded(entity){this._queries.forEach((query=>query._onComponentAdded(entity)))}onComponentRemoved(entity){this._queries.forEach((query=>query._onComponentRemoved(entity)))}onEntityCreated(entity){this._queries.forEach((query=>query._onEntityCreated(entity)))}onEntityDestroyed(entity){this._queries.forEach((query=>query._onEntityDestroyed(entity)))}}class Engine{constructor(){this.idGenerator=()=>((size=21)=>{let id="",i=size;for(;i--;)id+="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW"[64*Math.random()|0];return id})(),this.components=new ComponentRegistry(this),this.prefabs=new PrefabRegistry(this),this.entities=new EntityRegistry(this),this.queries=new QueryRegistry(this)}generateId(){return this.idGenerator()}createEntity(id){return this.entities.create(id)}createPrefab(nameOrClass,initialProps={}){return this.prefabs.create(nameOrClass,initialProps)}destroyEntity(entity){return this.entities.destroy(entity)}registerPrefab(data){this.prefabs.deserialize(data)}registerComponent(component){this.components.register(component)}getEntity(id){return this.entities.get(id)}createComponent(type,properties){return this.components.create(type,properties)}createQuery(filters){return this.queries.create(filters)}serialize(entities){return{entities:this.entities.serialize(entities)}}deserialize(data){return data.id?this.entities.deserializeEntity(data):this.entities.deserialize(data)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{IsDestroying:()=>IsDestroying});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23);class IsDestroying extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{}value={pass:0},(key="properties")in(obj=IsDestroying)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{LiquidContainer:()=>LiquidContainer});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_data_Spawnables__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(26),_data_Spawner__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(27),_enums_LiquidTypes__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(29),_IsDestroying__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(24);class LiquidContainer extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{get liquid(){return!this.isEmpty&&_enums_LiquidTypes__WEBPACK_IMPORTED_MODULE_3__.liquids[this.content]}get isEmpty(){return isNaN(this.content)||this.volume<=0}get display(){return this.isEmpty?"[empty] ".concat(this.volume,"/").concat(this.maxVolume):"[".concat(_enums_LiquidTypes__WEBPACK_IMPORTED_MODULE_3__.liquids[this.content].name,"] ").concat(this.volume,"/").concat(this.maxVolume)}get primaryColorOverride(){return this.overridePrimary&&this.liquid?this.liquid.primary:null}get secondaryColorOverride(){return this.overrideSecondary&&this.liquid?this.liquid.secondary:null}_checkDestroyOnEmpty(){this.destroyOnEmpty&&this.isEmpty&&!this.entity.isDestroying&&this.entity.add(_IsDestroying__WEBPACK_IMPORTED_MODULE_4__.IsDestroying)}pour(x,y,quantity){return this.isPourable?this.volume<=0?(console.warn("The contianer is empty and cannot be poured."),!1):((isNaN(quantity)||quantity>=this.volume)&&(quantity=this.volume),this.volume-=quantity,(0,_data_Spawner__WEBPACK_IMPORTED_MODULE_2__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_1__.SPWN_POOL_LIQUID,x,y,{content:this.content,volume:quantity}),this._checkDestroyOnEmpty(),!0):(console.warn("The container connot be poured."),!1)}combineFrom(other){if(this.content!==other.content)return console.warn("Cannot combine different liquid types"),!1;const sum=this.volume+other.volume;return sum>this.maxVolume?(console.warn("Container is not large enought to combine both liquids"),this.volume=this.maxVolume,other.volume-=sum-this.maxVolume):(this.volume+=other.volume,other.volume-=other.volume),other._checkDestroyOnEmpty(),!0}onTryPour(evt){if(this.isEmpty)return void console.warn("The container is empty.");const pos=evt.data.interactor.position.getPos();this.pour(pos.x,pos.y,evt.data.volume),evt.data.interactor.fireEvent("energy-consumed",400),evt.handle()}onTryDrink(evt){this.isEmpty?console.warn("The container is empty."):((0,_enums_LiquidTypes__WEBPACK_IMPORTED_MODULE_3__.drinkLiquid)(evt.data.interactor,this.content,this.volume),this.volume=0,this._checkDestroyOnEmpty(),evt.data.interactor.fireEvent("energy-consumed",700),evt.handle())}onGetInteractions(evt){this.isEmpty||(evt.data.interactions.push({name:"Drink",evt:"try-drink"}),this.isPourable&&evt.data.interactions.push({name:"Pour",evt:"try-pour"}))}}obj=LiquidContainer,key="properties",value={content:_enums_LiquidTypes__WEBPACK_IMPORTED_MODULE_3__.LIQUID_BLOOD,volume:10,maxVolume:10,overridePrimary:!1,overrideSecondary:!1,isPourable:!1,destroyOnEmpty:!1,isFreeFlowing:!1},key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{SPWN_VIAL_HONEY:()=>SPWN_VIAL_HONEY,SPWN_VIAL_BLOOD:()=>SPWN_VIAL_BLOOD,SPWN_VIAL_WATER:()=>SPWN_VIAL_WATER,SPWN_STONE:()=>SPWN_STONE,SPWN_TWIG:()=>SPWN_TWIG,SPWN_ASH:()=>SPWN_ASH,SPWN_GOBLIN_GRUNT:()=>SPWN_GOBLIN_GRUNT,SPWN_HUMAN_WANDERER:()=>SPWN_HUMAN_WANDERER,SPWN_PINE_TREE:()=>SPWN_PINE_TREE,SPWN_WOOD_WALL:()=>SPWN_WOOD_WALL,SPWN_WOOD_DOOR:()=>SPWN_WOOD_DOOR,SPWN_WOOD_CHEST:()=>SPWN_WOOD_CHEST,SPWN_STONE_WALL:()=>SPWN_STONE_WALL,SPWN_DIRT_PATH:()=>SPWN_DIRT_PATH,SPWN_CORPSE:()=>SPWN_CORPSE,SPWN_POOL_LIQUID:()=>SPWN_POOL_LIQUID,SPWN_GLASS_SHARD:()=>SPWN_GLASS_SHARD,SPWN_AMULET:()=>SPWN_AMULET,SPWN_CLOTH_ARMOR:()=>SPWN_CLOTH_ARMOR,SPWN_LEATHER_BOOTS:()=>SPWN_LEATHER_BOOTS,SPWN_SHORTSWORD:()=>SPWN_SHORTSWORD,SPWN_GREATSWORD:()=>SPWN_GREATSWORD,SPWN_BATTLE_AXE:()=>SPWN_BATTLE_AXE,SPWN_HATCHET:()=>SPWN_HATCHET,SPWN_MACE:()=>SPWN_MACE,SPWN_GROUND_GRASS:()=>SPWN_GROUND_GRASS,SPWN_GROUND_STONE:()=>SPWN_GROUND_STONE,SPWN_HEAVY_PLATE_ARMOR:()=>SPWN_HEAVY_PLATE_ARMOR,SPWN_LEATHER_ARMOR:()=>SPWN_LEATHER_ARMOR,SPWN_CLOTH_HOOD:()=>SPWN_CLOTH_HOOD,SPWN_WIZARD_CAP:()=>SPWN_WIZARD_CAP,SPWN_HELM:()=>SPWN_HELM});const SPWN_VIAL_HONEY="SPWN_VIAL_HONEY",SPWN_VIAL_BLOOD="SPWN_VIAL_BLOOD",SPWN_VIAL_WATER="SPWN_VIAL_WATER",SPWN_STONE="SPWN_STONE",SPWN_TWIG="SPWN_TWIG",SPWN_ASH="SPWN_ASH",SPWN_GOBLIN_GRUNT="SPWN_GOBLIN_GRUNT",SPWN_HUMAN_WANDERER="SPWN_HUMAN_WANDERER",SPWN_PINE_TREE="SPWN_PINE_TREE",SPWN_WOOD_WALL="SPWN_WOOD_WALL",SPWN_WOOD_DOOR="SPWN_WOOD_DOOR",SPWN_WOOD_CHEST="SPWN_WOOD_CHEST",SPWN_STONE_WALL="SPWN_STONE_WALL",SPWN_DIRT_PATH="SPWN_DIRT_PATH",SPWN_CORPSE="SPWN_CORPSE",SPWN_POOL_LIQUID="SPWN_POOL_LIQUID",SPWN_GLASS_SHARD="SPWN_GLASS_SHARD",SPWN_AMULET="SPWN_AMULET",SPWN_CLOTH_ARMOR="SPWN_CLOTH_ARMOR",SPWN_LEATHER_BOOTS="SPWN_LEATHER_BOOTS",SPWN_SHORTSWORD="SPWN_SHORTSWORD",SPWN_GREATSWORD="SPWN_GREATSWORD",SPWN_BATTLE_AXE="SPWN_BATTLE_AXE",SPWN_HATCHET="SPWN_HATCHET",SPWN_MACE="SPWN_MACE",SPWN_GROUND_GRASS="SPWN_GROUND_GRASS",SPWN_GROUND_STONE="SPWN_GROUND_STONE",SPWN_HEAVY_PLATE_ARMOR="SPWN_HEAVY_PLATE_ARMOR",SPWN_LEATHER_ARMOR="SPWN_LEATHER_ARMOR",SPWN_CLOTH_HOOD="SPWN_CLOTH_HOOD",SPWN_WIZARD_CAP="SPWN_WIZARD_CAP",SPWN_HELM="SPWN_HELM"},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{spawn:()=>spawn});var _core_Game__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_spawnables_SpawnableVialHoney__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(28),_spawnables_SpawnableVialBlood__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(30),_spawnables_SpawnableVialWater__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(31),_spawnables_SpawnableGoblinGrunt__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(32),_spawnables_SpawnablePineTree__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(44),_spawnables_SpawnableHumanWanderer__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(46),_spawnables_SpawnablePoolLiquid__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(47);const simplePrefab=prefabName=>data=>_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.ecs.createPrefab(prefabName,data),spawnables={SPWN_VIAL_HONEY:_spawnables_SpawnableVialHoney__WEBPACK_IMPORTED_MODULE_1__.createSpawnable,SPWN_VIAL_BLOOD:_spawnables_SpawnableVialBlood__WEBPACK_IMPORTED_MODULE_2__.createSpawnable,SPWN_VIAL_WATER:_spawnables_SpawnableVialWater__WEBPACK_IMPORTED_MODULE_3__.createSpawnable,SPWN_STONE:simplePrefab("Stone"),SPWN_WOOD_WALL:simplePrefab("WoodWall"),SPWN_WOOD_DOOR:simplePrefab("Door"),SPWN_WOOD_CHEST:simplePrefab("Chest"),SPWN_STONE_WALL:simplePrefab("Wall"),SPWN_DIRT_PATH:simplePrefab("DirtPathway"),SPWN_CORPSE:simplePrefab("Corpse"),SPWN_GLASS_SHARD:simplePrefab("GlassShard"),SPWN_AMULET:simplePrefab("Amulet"),SPWN_CLOTH_ARMOR:simplePrefab("ClothArmor"),SPWN_HEAVY_PLATE_ARMOR:simplePrefab("PlateArmor"),SPWN_LEATHER_ARMOR:simplePrefab("LeatherArmor"),SPWN_LEATHER_BOOTS:simplePrefab("Boots"),SPWN_SHORTSWORD:simplePrefab("Shortsword"),SPWN_GREATSWORD:simplePrefab("Greatsword"),SPWN_BATTLE_AXE:simplePrefab("BattleAxe"),SPWN_HATCHET:simplePrefab("Hatchet"),SPWN_MACE:simplePrefab("Mace"),SPWN_GROUND_GRASS:simplePrefab("Grass"),SPWN_GROUND_STONE:simplePrefab("StoneGround"),SPWN_CLOTH_HOOD:simplePrefab("ClothHood"),SPWN_WIZARD_CAP:simplePrefab("WizardCap"),SPWN_HELM:simplePrefab("Helm"),SPWN_TWIG:simplePrefab("Twig"),SPWN_ASH:simplePrefab("Ash"),SPWN_GOBLIN_GRUNT:_spawnables_SpawnableGoblinGrunt__WEBPACK_IMPORTED_MODULE_4__.createSpawnable,SPWN_HUMAN_WANDERER:_spawnables_SpawnableHumanWanderer__WEBPACK_IMPORTED_MODULE_6__.createSpawnable,SPWN_PINE_TREE:_spawnables_SpawnablePineTree__WEBPACK_IMPORTED_MODULE_5__.createSpawnable,SPWN_POOL_LIQUID:_spawnables_SpawnablePoolLiquid__WEBPACK_IMPORTED_MODULE_7__.createSpawnable},spawn=(key,x,y,data={})=>{const entity=spawnables[key](data,x,y);return isNaN(x)||isNaN(y)||!entity.position||entity.position.setPos(x,y),entity}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{createSpawnable:()=>createSpawnable});var _core_Game__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_enums_LiquidTypes__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(29);const createSpawnable=()=>{const vial=_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.ecs.createPrefab("Vial");return vial.liquidContainer.content=_enums_LiquidTypes__WEBPACK_IMPORTED_MODULE_1__.LIQUID_HONEY,vial}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{LIQUID_WATER:()=>LIQUID_WATER,LIQUID_BLOOD:()=>LIQUID_BLOOD,LIQUID_HONEY:()=>LIQUID_HONEY,LIQUID_OIL:()=>LIQUID_OIL,liquids:()=>liquids,drinkLiquid:()=>drinkLiquid});var _core_Game__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3);const LIQUID_WATER=0,LIQUID_BLOOD=1,LIQUID_HONEY=3,LIQUID_OIL=4,liquids={[LIQUID_WATER]:{name:"water",colorDesc:"watery",primary:"#66a3dc",secondary:"#8bb9d5",onDrink:entity=>{console.log("Mmm. earth juice. yummy")}},[LIQUID_BLOOD]:{name:"blood",colorDesc:"bloody",primary:"#ce2a36",secondary:"#e0c1c2",onDrink:(entity,volume)=>{console.log("blood. this would make a good syrup"),entity.fireEvent("heal",{value:1*volume})}},[LIQUID_HONEY]:{name:"honey",colorDesc:"gooey golden",primary:"#d6aa3a",secondary:"#f4d260",onDrink:(entity,volume)=>{const pos=entity.position.getPos();_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.particles.createEmitter(pos.x,pos.y-1,{direction:{x:0,y:-1},glyphs:[".","○"],fg1s:["#d6aa3a"],speed:.02,lifetime:500}),entity.fireEvent("heal",{value:2*volume})}}},drinkLiquid=(entity,type,volume)=>{liquids[type].onDrink(entity,volume)}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{createSpawnable:()=>createSpawnable});var _core_Game__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_enums_LiquidTypes__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(29);const createSpawnable=()=>{const vial=_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.ecs.createPrefab("Vial");return vial.liquidContainer.content=_enums_LiquidTypes__WEBPACK_IMPORTED_MODULE_1__.LIQUID_BLOOD,vial}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{createSpawnable:()=>createSpawnable});var _core_Game__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_enums_LiquidTypes__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(29);const createSpawnable=()=>{const vial=_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.ecs.createPrefab("Vial");return vial.liquidContainer.content=_enums_LiquidTypes__WEBPACK_IMPORTED_MODULE_1__.LIQUID_WATER,vial}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{createSpawnable:()=>createSpawnable});var _ai_GoalTypes__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(33),_core_Game__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),_Spawnables__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(26),_Spawner__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(27);const createSpawnable=()=>{const goblin=_core_Game__WEBPACK_IMPORTED_MODULE_1__.game.ecs.createPrefab("Goblin");goblin.brain.pushGoal(_ai_GoalTypes__WEBPACK_IMPORTED_MODULE_0__.BoredGoalType.create());const sword=(0,_Spawner__WEBPACK_IMPORTED_MODULE_3__.spawn)(_Spawnables__WEBPACK_IMPORTED_MODULE_2__.SPWN_SHORTSWORD);return goblin.equipmentSlot.handRight.equip(sword),goblin}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{BoredGoalType:()=>_BoredGoalType__WEBPACK_IMPORTED_MODULE_0__.BoredGoalType,EatFoodGoalType:()=>_EatFoodGoalType__WEBPACK_IMPORTED_MODULE_1__.EatFoodGoalType,MoveGoalType:()=>_MoveGoalType__WEBPACK_IMPORTED_MODULE_2__.MoveGoalType,KillSomethingGoalType:()=>_KillSomethingGoalType__WEBPACK_IMPORTED_MODULE_3__.KillSomethingGoalType});var _BoredGoalType__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(34),_EatFoodGoalType__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(43),_MoveGoalType__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(42),_KillSomethingGoalType__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(37)},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{BoredGoalType:()=>BoredGoalType});var _GoalType__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(35),_GoalActionResult__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(36),_KillSomethingGoalType__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(37);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class BoredGoalType extends _GoalType__WEBPACK_IMPORTED_MODULE_0__.GoalType{}_defineProperty(BoredGoalType,"name","Bored"),_defineProperty(BoredGoalType,"isFinished",((entity,goal)=>!1)),_defineProperty(BoredGoalType,"takeAction",((entity,goal)=>{const targets=new Set;if(entity.fireEvent("try-detect-hostiles",{targets}),targets.size>0){const target=[...targets][0],killGoal=_KillSomethingGoalType__WEBPACK_IMPORTED_MODULE_2__.KillSomethingGoalType.createAsSubGoal(goal,{target:target.id});return entity.brain.pushGoal(killGoal),entity.fireEvent("take-action"),_GoalActionResult__WEBPACK_IMPORTED_MODULE_1__.SUCCESS}const boredomGoal=entity.fireEvent("boredom");return boredomGoal.data.goal?(entity.brain.pushGoal(boredomGoal.data.goal),entity.fireEvent("take-action"),_GoalActionResult__WEBPACK_IMPORTED_MODULE_1__.SUCCESS):(entity.fireEvent("energy-consumed",1e3),_GoalActionResult__WEBPACK_IMPORTED_MODULE_1__.SUCCESS)}))},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{GoalType:()=>GoalType});var obj,key,value,_GoalActionResult__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(36),_core_Game__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3);class GoalType{static isFinished(entity,goal){return!1}static takeAction(entity,goal){return _GoalActionResult__WEBPACK_IMPORTED_MODULE_0__.FAILURE}static createAsSubGoal(originalIntent,properties={}){return this.create({...properties,originalIntent:originalIntent.entity.id})}static create(properties={}){return _core_Game__WEBPACK_IMPORTED_MODULE_1__.game.ecs.createPrefab("Goal",{goal:{name:this.name,...properties}}).goal}}value="Unknown",(key="name")in(obj=GoalType)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{SUCCESS:()=>SUCCESS,FAILURE:()=>FAILURE,INVALID:()=>INVALID});const SUCCESS="SUCCESS",FAILURE="FAILURE",INVALID="INVALID"},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{KillSomethingGoalType:()=>KillSomethingGoalType});var _GoalType__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(35),_GoalActionResult__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(36),_utils_AStar__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(38),_core_Game__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(3),_utils_diagonalDistance__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(39),_MoveGoalType__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(42);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class KillSomethingGoalType extends _GoalType__WEBPACK_IMPORTED_MODULE_0__.GoalType{}_defineProperty(KillSomethingGoalType,"name","KillSomething"),_defineProperty(KillSomethingGoalType,"isFinished",((entity,goal)=>!goal.target||goal.target.isDead||goal.target.isDestroyed)),_defineProperty(KillSomethingGoalType,"takeAction",((entity,goal)=>{if(entity.fireEvent("try-melee",{target:goal.target}).handled)return _GoalActionResult__WEBPACK_IMPORTED_MODULE_1__.SUCCESS;const start=entity.position.getPos(),targetPos=goal.target.position.getPos(),result=(0,_utils_AStar__WEBPACK_IMPORTED_MODULE_2__.computeAStar)({start,goal:targetPos,cost:(a,b)=>{if(_core_Game__WEBPACK_IMPORTED_MODULE_3__.game.map.isOutOfbounds(b.x,b.y))return 1/0;if(b.x===targetPos.x&&b.y===targetPos.y)return(0,_utils_diagonalDistance__WEBPACK_IMPORTED_MODULE_4__.diagonalDistance)(a,b);const entities=_core_Game__WEBPACK_IMPORTED_MODULE_3__.game.map.getEntitiesAt(b.x,b.y);return entities.some((e=>e.blocker))||entities.some((e=>e.id!==entity.id&&e.body&&!e.isIncapacitated))?1/0:entities.some((e=>e.sharpTrap))?8:(0,_utils_diagonalDistance__WEBPACK_IMPORTED_MODULE_4__.diagonalDistance)(a,b)}});if(result.success&&result.cost<55){const segment=result.path[1],delta={x:segment.x-start.x,y:segment.y-start.y},moveGoal=_MoveGoalType__WEBPACK_IMPORTED_MODULE_5__.MoveGoalType.createAsSubGoal(goal,{data:delta});return entity.brain.pushGoal(moveGoal),entity.fireEvent("take-action"),_GoalActionResult__WEBPACK_IMPORTED_MODULE_1__.SUCCESS}return entity.fireEvent("energy-consumed",1e3),_GoalActionResult__WEBPACK_IMPORTED_MODULE_1__.FAILURE}))},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{computeAStar:()=>computeAStar});var _diagonalDistance__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(39),_ManhattanDistance__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(40),_PriorityQueue__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(41);const getNeighbors=(x,y,allowDiagonals=!0)=>{const neighbors=[{x,y:y-1},{x:x-1,y},{x:x+1,y},{x,y:y+1}];return allowDiagonals&&neighbors.push({x:x-1,y:y-1},{x:x+1,y:y-1},{x:x-1,y:y+1},{x:x+1,y:y+1}),neighbors},key=pos=>"".concat(pos.x,",").concat(pos.y),defaultSettings={start:{},goal:{},cost:()=>{},allowDiagonals:!0},computeAStar=(settings=defaultSettings)=>{const heuristic=settings.allowDiagonals?_diagonalDistance__WEBPACK_IMPORTED_MODULE_0__.diagonalDistance:_ManhattanDistance__WEBPACK_IMPORTED_MODULE_1__.manhattanDistance,start=settings.start,goal=settings.goal,cost=settings.cost,open=new _PriorityQueue__WEBPACK_IMPORTED_MODULE_2__.default,cameFrom={},costSoFar={},startKey=key(start),goalKey=key(goal),result={success:!1,path:[],costs:[],cost:1/0,start,goal};if(cost(start,goal)===1/0)return result;for(open.put({key:startKey,pos:start},0),costSoFar[startKey]=0;!open.isEmpty();){const{key:currentKey,pos:current}=open.pop();if(currentKey===goalKey){result.success=!0;break}const neighbors=getNeighbors(current.x,current.y,settings.allowDiagonals);for(let next of neighbors){const nextKey=key(next),graphCost=nextKey===goalKey?0:cost(current,next);if(graphCost===1/0)continue;const newCost=costSoFar[currentKey]+graphCost;if(!(nextKey in costSoFar)||newCost<costSoFar[nextKey]){costSoFar[nextKey]=newCost;const priority=newCost+heuristic(next,goal);open.put({key:nextKey,pos:next},priority),cameFrom[nextKey]=current}}}if(!result.success)return result;result.path=[goal],result.cost=costSoFar[goalKey],result.costs=[costSoFar[goalKey]];let previous=cameFrom[key(goal)];for(;previous;){const previousKey=key(previous);result.path.unshift(previous),result.costs.unshift(costSoFar[previousKey]),previous=cameFrom[previousKey]}return result}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{diagonalDistance:()=>diagonalDistance});const diagonalDistance=(a,b)=>{const dx=Math.abs(a.x-b.x),dy=Math.abs(a.y-b.y);return 1*(dx+dy)+(1.41-2)*Math.min(dx,dy)}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{manhattanDistance:()=>manhattanDistance});const manhattanDistance=(a,b)=>Math.abs(a.x-b.x)+Math.abs(a.y-b.y)},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>PriorityQueue});var _items=new WeakMap;class PriorityQueue{constructor(){_items.set(this,{writable:!0,value:[]})}isEmpty(){return _classPrivateFieldGet(this,_items).length<=0}pop(){if(!this.isEmpty())return _classPrivateFieldGet(this,_items).shift().value}peek(){if(!this.isEmpty())return _classPrivateFieldGet(this,_items)[0].value}put(value,priority){const item=((value,priority)=>({value,priority}))(value,priority);for(let i=0;i<_classPrivateFieldGet(this,_items).length;i++)if(_classPrivateFieldGet(this,_items)[i].priority>item.priority)return void _classPrivateFieldGet(this,_items).splice(i,0,item);_classPrivateFieldGet(this,_items).push(item)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{MoveGoalType:()=>MoveGoalType});var _GoalType__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(35),_GoalActionResult__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(36);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class MoveGoalType extends _GoalType__WEBPACK_IMPORTED_MODULE_0__.GoalType{}_defineProperty(MoveGoalType,"name","Move"),_defineProperty(MoveGoalType,"isFinished",((entity,goal)=>goal.complete)),_defineProperty(MoveGoalType,"takeAction",((entity,goal)=>entity.fireEvent("try-move",{x:goal.data.x,y:goal.data.y}).handled?(goal.complete=!0,_GoalActionResult__WEBPACK_IMPORTED_MODULE_1__.SUCCESS):_GoalActionResult__WEBPACK_IMPORTED_MODULE_1__.FAILURE))},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{EatFoodGoalType:()=>EatFoodGoalType});var _GoalType__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(35),_GoalActionResult__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(36);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class EatFoodGoalType extends _GoalType__WEBPACK_IMPORTED_MODULE_0__.GoalType{}_defineProperty(EatFoodGoalType,"name","EatFood"),_defineProperty(EatFoodGoalType,"isFinished",((entity,goal)=>goal.complete)),_defineProperty(EatFoodGoalType,"takeAction",((entity,goal)=>entity.fireEvent("try-eat-food",{food:1e4}).handled?(goal.complete=!0,_GoalActionResult__WEBPACK_IMPORTED_MODULE_1__.SUCCESS):_GoalActionResult__WEBPACK_IMPORTED_MODULE_1__.FAILURE))},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{createSpawnable:()=>createSpawnable});var _core_Game__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_utils_rand__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(45);const createSpawnable=()=>{const type=(0,_utils_rand__WEBPACK_IMPORTED_MODULE_1__.pickRandom)(["PineTree","SmallPineTree"]);return _core_Game__WEBPACK_IMPORTED_MODULE_0__.game.ecs.createPrefab(type)}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{pickRandom:()=>pickRandom,randomInt:()=>randomInt,randomBool:()=>randomBool,randomWeightedBool:()=>randomWeightedBool});const pickRandom=arr=>arr[Math.floor(Math.random()*arr.length)],randomInt=(min,max)=>Math.floor(Math.random()*(max-min+1)+min),randomBool=()=>pickRandom([!0,!1]),randomWeightedBool=(weight=.5)=>Math.random()<=weight},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{createSpawnable:()=>createSpawnable});var _ai_GoalTypes__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(33),_core_Game__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3);const createSpawnable=()=>{const wanderer=_core_Game__WEBPACK_IMPORTED_MODULE_1__.game.ecs.createPrefab("HumanWanderer");return wanderer.brain.pushGoal(_ai_GoalTypes__WEBPACK_IMPORTED_MODULE_0__.BoredGoalType.create()),wanderer}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{createSpawnable:()=>createSpawnable});var _core_Game__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3);const createSpawnable=data=>_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.ecs.createPrefab("Pool",{liquidContainer:{content:data.content,volume:data.volume}})},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Door:()=>Door});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_Blocker__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(49),_Shadowcaster__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(50);class Door extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{get ch(){return this.isOpen?this.chOpen:this.chClosed}get display(){return this.isOpen?"[open]":"[closed]"}openDoor(){if(this.isOpen)return!1;this.isOpen=!0;const glyph=this.entity.glyph;return glyph&&(glyph.ch=this.ch),this.entity.blocker.destroy(),this.entity.shadowcaster.destroy(),!0}closeDoor(){if(!this.isOpen)return!1;this.isOpen=!1;const glyph=this.entity.glyph;return glyph&&(glyph.ch=this.ch),this.entity.add(_Blocker__WEBPACK_IMPORTED_MODULE_1__.Blocker),this.entity.add(_Shadowcaster__WEBPACK_IMPORTED_MODULE_2__.Shadowcaster),!0}onGetInteractions(evt){this.isOpen?evt.data.interactions.push({name:"Close door",evt:"try-close-door"}):evt.data.interactions.push({name:"Open door",evt:"try-open-door"})}onTryCloseDoor(evt){this.closeDoor()&&evt.data.interactor.fireEvent("energy-consumed",800),evt.handle()}onTryOpenDoor(evt){this.openDoor()&&evt.data.interactor.fireEvent("energy-consumed",800),evt.handle()}onProjectileHit(evt){this.isOpen||(evt.data.stopProjectile=!0,evt.data.deflectProjectile=!1),this.openDoor()}}value={isOpen:!1,chOpen:"'",chClosed:"+"},(key="properties")in(obj=Door)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Blocker:()=>Blocker});var geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23);class Blocker extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{onProjectileHit(evt){this.isAttached&&(evt.data.stopProjectile=!0,evt.data.deflectProjectile=!0)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Shadowcaster:()=>Shadowcaster});var geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23);class Shadowcaster extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Loot:()=>Loot});var geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_Inventory__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(52),_IsInventoried__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(54);class Loot extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{take(newOwner){if(this.entity.isInventoried){if(this.entity.isInventoried.isOwnedBy(newOwner))return!0;this.entity.isInventoried.owner.inventory.removeLoot(this.entity)}return newOwner.inventory.addLoot(this.entity),!0}onGetInteractions(evt){const interactor=evt.data.interactor,isInventoried=this.entity.has(_IsInventoried__WEBPACK_IMPORTED_MODULE_2__.IsInventoried);interactor.has(_Inventory__WEBPACK_IMPORTED_MODULE_1__.Inventory)&&(isInventoried?interactor.inventory.hasLoot(this.entity)?evt.data.interactions.push({name:"Drop",evt:"try-drop"}):evt.data.interactions.push({name:"Take",evt:"try-take"}):evt.data.interactions.push({name:"Pickup",evt:"try-pick-up"}))}onEquipped(evt){evt.data.interactor.has(_Inventory__WEBPACK_IMPORTED_MODULE_1__.Inventory)&&(evt.data.interactor.inventory.hasLoot(this.entity)||evt.data.interactor.inventory.addLoot(this.entity))}onTryPickUp(evt){this.take(evt.data.interactor),evt.data.interactor.fireEvent("energy-consumed",100),evt.handle()}onTryTake(evt){this.take(evt.data.interactor),evt.data.interactor.fireEvent("energy-consumed",100),evt.handle()}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Inventory:()=>Inventory});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_core_Game__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),_core_screens_ScreenType__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(53),_IsInventoried__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(54),_Stackable__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(55);class Inventory extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{onDestroyed(){this.content.forEach((entity=>entity.destroy()))}onQueryOwnership(evt){this.content.forEach((entity=>{evt.data.result.add(entity),entity.fireEvent("query-ownership",{result:evt.data.result})}))}getStackable(stackableIdentifier){return this.content.find((entity=>entity.has(_Stackable__WEBPACK_IMPORTED_MODULE_4__.Stackable)&&entity.stackable.identifier===stackableIdentifier))}addLoot(loot){if(loot.has(_Stackable__WEBPACK_IMPORTED_MODULE_4__.Stackable)){const existing=this.getStackable(loot.stackable.identifier);if(existing)return void existing.stackable.addOther(loot)}loot.add(_IsInventoried__WEBPACK_IMPORTED_MODULE_3__.IsInventoried,{owner:this.entity}),this.content.push(loot)}hasLoot(loot){return this.content.indexOf(loot)>=0}removeLoot(loot,quantity){if(loot.has(_Stackable__WEBPACK_IMPORTED_MODULE_4__.Stackable)&&!isNaN(quantity))return loot.stackable.split(quantity),this.removeLoot(loot);const idx=this.content.indexOf(loot);return idx>=0&&(this.content.splice(idx,1),loot.isInventoried.destroy()),loot}dropLoot(loot,quantity){const ob=this.removeLoot(loot,quantity),pos=this.entity.position.getPos();return ob.position.setPos(pos.x,pos.y),ob.fireEvent("dropped",{dropper:this.entity}),ob}onTryOpen(evt){_core_Game__WEBPACK_IMPORTED_MODULE_1__.game.screens.replaceScreen(_core_screens_ScreenType__WEBPACK_IMPORTED_MODULE_2__.SCREEN_INVENTORY,{accessible:this.entity,accessor:evt.data.interactor}),evt.handle()}onGetInteractions(evt){this.isOpenable&&evt.data.interactions.push({name:"Open",evt:"try-open"})}}value={content:"<EntityArray>",isOpenable:!0},(key="properties")in(obj=Inventory)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{SCREEN_MAIN_MENU:()=>SCREEN_MAIN_MENU,SCREEN_ADVENTURE:()=>SCREEN_ADVENTURE,SCREEN_DEATH:()=>SCREEN_DEATH,SCREEN_INVENTORY:()=>SCREEN_INVENTORY,SCREEN_INTERACT_MODAL:()=>SCREEN_INTERACT_MODAL,SCREEN_CURSOR:()=>SCREEN_CURSOR,SCREEN_LOAD_SECTOR:()=>SCREEN_LOAD_SECTOR,SCREEN_EQUIPMENT:()=>SCREEN_EQUIPMENT,SCREEN_LIST_SELECT:()=>SCREEN_LIST_SELECT,SCREEN_CHARACTER:()=>SCREEN_CHARACTER,SCREEN_ABILITIES:()=>SCREEN_ABILITIES});const SCREEN_MAIN_MENU=0,SCREEN_ADVENTURE=1,SCREEN_DEATH=2,SCREEN_INVENTORY=3,SCREEN_INTERACT_MODAL=4,SCREEN_CURSOR=5,SCREEN_LOAD_SECTOR=6,SCREEN_EQUIPMENT=7,SCREEN_LIST_SELECT=8,SCREEN_CHARACTER=9,SCREEN_ABILITIES=10},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{IsInventoried:()=>IsInventoried});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_Stackable__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(55);class IsInventoried extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{isOwnedBy(entity){return this.owner&&this.owner.id===entity.id}onQueryOwnership(evt){evt.data.result.add(this.entity)}onTryDrop(evt){this.owner.inventory.dropLoot(this.entity),evt.data.interactor.fireEvent("energy-consumed",200),evt.handle()}onThrown(evt){const quantity=this.entity.has(_Stackable__WEBPACK_IMPORTED_MODULE_1__.Stackable)?1:null;this.owner.inventory.removeLoot(this.entity,quantity)}}value={owner:"<Entity>"},(key="properties")in(obj=IsInventoried)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Stackable:()=>Stackable});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_core_Game__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),_enums_Stackables__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(56),_IsDestroying__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(24),_IsInventoried__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(54);class Stackable extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{get display(){return"x ".concat(this.quantity)}increment(amount){this.quantity+=amount}addOther(other){this.increment(other.stackable.quantity),other.stackable.quantity=0,other.add(_IsDestroying__WEBPACK_IMPORTED_MODULE_3__.IsDestroying)}split(quantity){if(quantity>=this.quantity)return quantity=this.quantity,this.entity;const clone=_core_Game__WEBPACK_IMPORTED_MODULE_1__.game.engine.cloneEntity(this.entity);return clone.stackable.quantity-=quantity,this.quantity=quantity,clone.has(_IsInventoried__WEBPACK_IMPORTED_MODULE_4__.IsInventoried)&&clone.isInventoried.owner.inventory.content.push(clone),clone}}obj=Stackable,key="properties",value={identifier:_enums_Stackables__WEBPACK_IMPORTED_MODULE_2__.STACKABLE_DEFAULT,quantity:1},key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{STACKABLE_DEFAULT:()=>STACKABLE_DEFAULT,STACKABLE_STONE:()=>STACKABLE_STONE,STACKABLE_ASH:()=>STACKABLE_ASH,STACKABLE_GLASS_SHARD:()=>STACKABLE_GLASS_SHARD});const STACKABLE_DEFAULT="STACKABLE_DEFAULT",STACKABLE_STONE="STACKABLE_STONE",STACKABLE_ASH="STACKABLE_ASH",STACKABLE_GLASS_SHARD="STACKABLE_GLASS_SHARD"},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Throwable:()=>Throwable});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_core_Game__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),_core_screens_ScreenType__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(53),_data_Skills__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(58),_data_Attack__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(65),_data_DamageTypes__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(66),_data_Stats__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(61),_enums_CursorSegments__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(67),_utils_BresenhamLine__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(68),_utils_rand__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(45),_Blocker__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(49),_Body__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(69),_Inventory__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(52),_IsVisible__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(70);class Throwable extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{onGetInteractions(evt){evt.data.interactor.has(_Inventory__WEBPACK_IMPORTED_MODULE_12__.Inventory)&&evt.data.interactor.inventory.hasLoot(this.entity)&&evt.data.interactions.push({name:"Throw",evt:"try-throw"})}throw(trajectory,initiator){this.entity.fireEvent("thrown",{initiator,trajectory});for(let i=0;i<trajectory.length;i++){if(0==i)continue;const position=trajectory[i],entities=position.entities;let stopped=!1,deflected=!1;const hit=entities.find((entity=>{const evt=entity.fireEvent("projectile-hit",{initiator,trajectory,projectile:this.entity});return stopped=evt.data.stopProjectile,deflected=evt.data.deflectProjectile,stopped||deflected}));if(hit){if(deflected){const prev=trajectory[i-1];this.entity.position.setPos(prev.x,prev.y),this.entity.fireEvent("collide-ground",{initiator,x:prev.x,y:prev.y})}else{this.entity.position.setPos(position.x,position.y),this.entity.fireEvent("collide",{initiator,hit,x:position.x,y:position.y});const str=(0,_data_Stats__WEBPACK_IMPORTED_MODULE_6__.getStat)(_data_Stats__WEBPACK_IMPORTED_MODULE_6__.STAT_STRENGTH,initiator),damage=(0,_utils_rand__WEBPACK_IMPORTED_MODULE_9__.randomInt)(1,this.die)+str+this.modifier,attack=new _data_Attack__WEBPACK_IMPORTED_MODULE_4__.default({attacker:initiator,defender:hit,weaponName:this.entity.moniker.display,damage,damageType:this.damageType,ignoreDodge:!0});hit.fireEvent("attacked",{attack})}break}i===trajectory.length-1&&(this.entity.position.setPos(position.x,position.y),this.entity.fireEvent("collide-ground",{initiator,x:position.x,y:position.y}))}}onTryThrow(evt){const range=(0,_data_Skills__WEBPACK_IMPORTED_MODULE_3__.getSkillValue)(_data_Skills__WEBPACK_IMPORTED_MODULE_3__.SKILL_THROWING,evt.data.interactor);_core_Game__WEBPACK_IMPORTED_MODULE_1__.game.screens.pushScreen(_core_screens_ScreenType__WEBPACK_IMPORTED_MODULE_2__.SCREEN_CURSOR,{start:evt.data.interactor.position.getPos(),drawLine:!0,drawTags:!1,onResult:cursor=>{_core_Game__WEBPACK_IMPORTED_MODULE_1__.game.screens.setScreen(_core_screens_ScreenType__WEBPACK_IMPORTED_MODULE_2__.SCREEN_ADVENTURE),this.entity.position.setPos(cursor.start.x,cursor.start.y);const trajectory=(0,_utils_BresenhamLine__WEBPACK_IMPORTED_MODULE_8__.bresenhamLine)(cursor.start.x,cursor.start.y,cursor.position.x,cursor.position.y).slice(0,range+1).map((pos=>({x:pos.x,y:pos.y,entities:_core_Game__WEBPACK_IMPORTED_MODULE_1__.game.map.getEntitiesAt(pos.x,pos.y)})));evt.data.interactor.fireEvent("energy-consumed",this.cost),this.throw(trajectory,evt.data.interactor)},onCancel:()=>{_core_Game__WEBPACK_IMPORTED_MODULE_1__.game.screens.popScreen()},getSegmentTypes:line=>{let lineValid=!0;const result=line.map((({x,y},idx)=>{if(0===idx)return _enums_CursorSegments__WEBPACK_IMPORTED_MODULE_7__.CURSOR_SEGMENT_NONE;const entities=_core_Game__WEBPACK_IMPORTED_MODULE_1__.game.map.getEntitiesAt(x,y),blocker=entities.find((entity=>entity.has(_IsVisible__WEBPACK_IMPORTED_MODULE_13__.IsVisible)&&entity.has(_Blocker__WEBPACK_IMPORTED_MODULE_10__.Blocker))),body=entities.find((entity=>entity.has(_IsVisible__WEBPACK_IMPORTED_MODULE_13__.IsVisible)&&entity.has(_Body__WEBPACK_IMPORTED_MODULE_11__.Body)));blocker&&(lineValid=!1);return lineValid&&(body||idx===range)?(lineValid=!1,_enums_CursorSegments__WEBPACK_IMPORTED_MODULE_7__.CURSOR_SEGMENT_INTEREST):lineValid?_enums_CursorSegments__WEBPACK_IMPORTED_MODULE_7__.CURSOR_SEGMENT_UNKNOWN:_enums_CursorSegments__WEBPACK_IMPORTED_MODULE_7__.CURSOR_SEGMENT_INVALID})),interestIdx=result.indexOf(_enums_CursorSegments__WEBPACK_IMPORTED_MODULE_7__.CURSOR_SEGMENT_INTEREST),blockerIdx=result.indexOf(_enums_CursorSegments__WEBPACK_IMPORTED_MODULE_7__.CURSOR_SEGMENT_INVALID);return interestIdx<blockerIdx&&blockerIdx>=1&&(result[blockerIdx-1]=_enums_CursorSegments__WEBPACK_IMPORTED_MODULE_7__.CURSOR_SEGMENT_INTEREST),result}})}}obj=Throwable,key="properties",value={die:4,modifier:0,cost:500,damageType:_data_DamageTypes__WEBPACK_IMPORTED_MODULE_5__.DMG_TYPE_BLUDGEONING},key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{SKILL_SPEED:()=>SKILL_SPEED,SKILL_THROWING:()=>SKILL_THROWING,SKILL_ARMOR:()=>SKILL_ARMOR,SKILL_DODGE:()=>SKILL_DODGE,getSkill:()=>getSkill,getSkillName:()=>getSkillName,getSkillValue:()=>getSkillValue,getSkillEquippedMod:()=>getSkillEquippedMod,getAllSkillEquippedMods:()=>getAllSkillEquippedMods,getAllSkillEquippedModSums:()=>getAllSkillEquippedModSums});var _skills_ArmorSkill__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(59),_skills_SpeedSkill__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(62),_skills_ThrowingSkill__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(63),_skills_DodgeSkill__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(64);const SKILL_SPEED="SKILL_SPEED",SKILL_THROWING="SKILL_THROWING",SKILL_ARMOR="SKILL_ARMOR",SKILL_DODGE="SKILL_DODGE",lookup={[SKILL_ARMOR]:new _skills_ArmorSkill__WEBPACK_IMPORTED_MODULE_0__.default,[SKILL_SPEED]:new _skills_SpeedSkill__WEBPACK_IMPORTED_MODULE_1__.default,[SKILL_THROWING]:new _skills_ThrowingSkill__WEBPACK_IMPORTED_MODULE_2__.default,[SKILL_DODGE]:new _skills_DodgeSkill__WEBPACK_IMPORTED_MODULE_3__.default},getSkill=key=>lookup[key],getSkillName=key=>lookup[key].name,getSkillValue=(key,entity)=>lookup[key].compute(entity),getSkillEquippedMod=(key,entity)=>{const modifiers=[];return entity.fireEvent("query-skill-mod-equipped",{skill:key,modifiers}),modifiers},getAllSkillEquippedMods=entity=>Object.keys(lookup).reduce(((mods,skill)=>({...mods,[skill]:getSkillEquippedMod(skill,entity)})),{}),getAllSkillEquippedModSums=entity=>{const mods=getAllSkillEquippedMods(entity);return Object.keys(mods).reduce(((all,skill)=>({...all,[skill]:mods[skill].reduce(((sum,mod)=>sum+mod.mod),0)})),{})}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{getArmorBlockPercent:()=>getArmorBlockPercent,getArmorBlockPercentDisplay:()=>getArmorBlockPercentDisplay,default:()=>ArmorSkill});var _Skills__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(58),_Skill__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(60);const getArmorBlockPercent=(skill=0)=>1-10/(skill+10),getArmorBlockPercentDisplay=(skill=0)=>{const prcnt=getArmorBlockPercent(skill);return Math.floor(100*prcnt)};class ArmorSkill extends _Skill__WEBPACK_IMPORTED_MODULE_1__.default{constructor(){super(_Skills__WEBPACK_IMPORTED_MODULE_0__.SKILL_ARMOR,"armor")}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Skill});var _Stats__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(61);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class Skill{constructor(key,name,baseStat){_defineProperty(this,"key",-1),_defineProperty(this,"name","skill"),_defineProperty(this,"baseStat",null),this.key=key,this.name=name,this.baseStat=baseStat}getModifiers(entity){const modifiers=[];return entity.fireEvent("query-skill-mod",{name:this.name,skill:this.key,modifiers}),modifiers}getModifierSum(entity){return this.getModifiers(entity).reduce(((sum,cur)=>sum+cur.mod),0)}compute(entity){return(this.baseStat?(0,_Stats__WEBPACK_IMPORTED_MODULE_0__.getStat)(this.baseStat,entity):0)+this.getModifierSum(entity)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{STAT_STRENGTH:()=>STAT_STRENGTH,STAT_FINESSE:()=>STAT_FINESSE,STAT_ATHLETICISM:()=>STAT_ATHLETICISM,STAT_TRICKERY:()=>STAT_TRICKERY,getStatName:()=>getStatName,getStat:()=>getStat,rollStat:()=>rollStat,statCheck:()=>statCheck});var _utils_rand__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(45);const STAT_STRENGTH=0,STAT_FINESSE=1,STAT_ATHLETICISM=2,STAT_TRICKERY=3,lookup={[STAT_STRENGTH]:{name:"strength"},[STAT_FINESSE]:{name:"finesse"},[STAT_ATHLETICISM]:{name:"athleticism"},[STAT_TRICKERY]:{name:"trickery"}},getStatName=stat=>lookup[stat].name,getStat=(stat,entity)=>{const name=lookup[stat].name;return entity.stats[name]()},rollStat=(stat,entity)=>(0,_utils_rand__WEBPACK_IMPORTED_MODULE_0__.randomInt)(1,20)+getStat(stat,entity),statCheck=(stat,entity,target)=>rollStat(stat,entity)>=target},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{getSpeedPercent:()=>getSpeedPercent,getSpeedPercentDisplay:()=>getSpeedPercentDisplay,default:()=>SpeedSkill});var _Skills__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(58),_Stats__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(61),_Skill__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(60);const getSpeedPercent=(skill=0)=>5/(5+skill),getSpeedPercentDisplay=(skill=0)=>{const prcnt=getSpeedPercent(skill);return Math.floor(100*prcnt)};class SpeedSkill extends _Skill__WEBPACK_IMPORTED_MODULE_2__.default{constructor(){super(_Skills__WEBPACK_IMPORTED_MODULE_0__.SKILL_SPEED,"speed",_Stats__WEBPACK_IMPORTED_MODULE_1__.STAT_ATHLETICISM)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>ThrowingSkill});var _Skills__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(58),_Stats__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(61),_Skill__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(60);class ThrowingSkill extends _Skill__WEBPACK_IMPORTED_MODULE_2__.default{constructor(){super(_Skills__WEBPACK_IMPORTED_MODULE_0__.SKILL_THROWING,"throwing",_Stats__WEBPACK_IMPORTED_MODULE_1__.STAT_ATHLETICISM)}compute(entity){const base=(0,_Stats__WEBPACK_IMPORTED_MODULE_1__.getStat)(_Stats__WEBPACK_IMPORTED_MODULE_1__.STAT_ATHLETICISM,entity),modifier=this.getModifierSum(entity);return Math.max(0,base+modifier)+6}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{getDodgePercent:()=>getDodgePercent,default:()=>DodgeSkill});var _Skills__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(58),_Stats__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(61),_Skill__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(60);const getDodgePercent=(skill=0)=>{const unscaled=1-5/(skill+5);return Math.floor(100*unscaled)};class DodgeSkill extends _Skill__WEBPACK_IMPORTED_MODULE_2__.default{constructor(){super(_Skills__WEBPACK_IMPORTED_MODULE_0__.SKILL_DODGE,"dodge",_Stats__WEBPACK_IMPORTED_MODULE_1__.STAT_FINESSE)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Attack});class Attack{constructor(data){this.attacker=data.attacker,this.defender=data.defender,this.weaponName=data.weaponName,this.damage=data.damage,this.damageType=data.damageType,this.ignoreDodge=data.ignoreDodge}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DMG_TYPE_BLUDGEONING:()=>DMG_TYPE_BLUDGEONING,DMG_TYPE_PIERCING:()=>DMG_TYPE_PIERCING,DMG_TYPE_SLASHING:()=>DMG_TYPE_SLASHING,getDmgTypeName:()=>getDmgTypeName,getDmgTypeVerb:()=>getDmgTypeVerb});const DMG_TYPE_BLUDGEONING="DMG_TYPE_BLUDGEONING",DMG_TYPE_PIERCING="DMG_TYPE_PIERCING",DMG_TYPE_SLASHING="DMG_TYPE_SLASHING",lookup={[DMG_TYPE_BLUDGEONING]:{name:"Bludgeoning",verb:"bludgeons"},[DMG_TYPE_PIERCING]:{name:"Piercing",verb:"pierces"},[DMG_TYPE_SLASHING]:{name:"Slashing",verb:"slashes"}},getDmgTypeName=type=>lookup[type].name,getDmgTypeVerb=type=>lookup[type].verb},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{CURSOR_SEGMENT_UNKNOWN:()=>CURSOR_SEGMENT_UNKNOWN,CURSOR_SEGMENT_INVALID:()=>CURSOR_SEGMENT_INVALID,CURSOR_SEGMENT_NONE:()=>CURSOR_SEGMENT_NONE,CURSOR_SEGMENT_INTEREST:()=>CURSOR_SEGMENT_INTEREST,getCursorSegmentTypeColor:()=>getCursorSegmentTypeColor,getCursorSegmentTypeGlyph:()=>getCursorSegmentTypeGlyph});const CURSOR_SEGMENT_UNKNOWN=0,CURSOR_SEGMENT_INVALID=1,CURSOR_SEGMENT_NONE=2,CURSOR_SEGMENT_INTEREST=3,colorMap={[CURSOR_SEGMENT_UNKNOWN]:"#57a5ef",[CURSOR_SEGMENT_INVALID]:"#ce5454",[CURSOR_SEGMENT_INTEREST]:"#57a5ef"},glyphMap={[CURSOR_SEGMENT_UNKNOWN]:"·",[CURSOR_SEGMENT_INVALID]:"·",[CURSOR_SEGMENT_INTEREST]:"•"},getCursorSegmentTypeColor=type=>colorMap[type],getCursorSegmentTypeGlyph=type=>glyphMap[type]},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{bresenhamLine:()=>bresenhamLine,bresenhamLineExclusive:()=>bresenhamLineExclusive});const bresenhamLine=(x0,y0,x1,y1)=>{const dx=Math.abs(x1-x0),dy=Math.abs(y1-y0),sx=x0<x1?1:-1,sy=y0<y1?1:-1,result=[];let err=dx-dy;for(;result.push({x:x0,y:y0}),x0!==x1||y0!==y1;){const e2=2*err;e2>-dy&&(err-=dy,x0+=sx),e2<dx&&(err+=dx,y0+=sy)}return result},bresenhamLineExclusive=(x0,y0,x1,y1)=>{const line=bresenhamLine(x0,y0,x1,y1);return line.shift(),line.pop(),line}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Body:()=>Body});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_data_Spawnables__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(26),_data_Spawner__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(27);class Body extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{onDeath(evt){if(!this.entity.has("Position"))return;const pos=this.entity.position.getPos(),corpse=(0,_data_Spawner__WEBPACK_IMPORTED_MODULE_2__.spawn)(this.corpseSpawnable,pos.x,pos.y);this.entity.has("Moniker")&&(corpse.moniker.name="".concat(this.entity.moniker.name," corpse"))}onProjectileHit(evt){evt.data.stopProjectile=!0}}obj=Body,key="properties",value={corpseSpawnable:_data_Spawnables__WEBPACK_IMPORTED_MODULE_1__.SPWN_CORPSE},key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{IsVisible:()=>IsVisible});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23);class IsVisible extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{}value={amount:0,range:0},(key="properties")in(obj=IsVisible)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{FragileGlass:()=>FragileGlass});var geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_core_Game__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),_data_Spawnables__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(26),_data_Spawner__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(27),_enums_ConsoleEvents__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(72),_IsDestroying__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(24),_LiquidContainer__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(25);class FragileGlass extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{shatter(x,y){(0,_data_Spawner__WEBPACK_IMPORTED_MODULE_3__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_2__.SPWN_GLASS_SHARD,x,y,{stackable:{quantity:3}}),this.entity.has(_LiquidContainer__WEBPACK_IMPORTED_MODULE_6__.LiquidContainer)?this.entity.liquidContainer.pour(x,y)&&_core_Game__WEBPACK_IMPORTED_MODULE_1__.game.console.event(_enums_ConsoleEvents__WEBPACK_IMPORTED_MODULE_4__.CONSOLE_EVENT_SHATTER,{target:this.entity,liquid:this.entity.liquidContainer.content}):_core_Game__WEBPACK_IMPORTED_MODULE_1__.game.console.event(_enums_ConsoleEvents__WEBPACK_IMPORTED_MODULE_4__.CONSOLE_EVENT_SHATTER,{target:this.entity}),this.entity.add(_IsDestroying__WEBPACK_IMPORTED_MODULE_5__.IsDestroying)}onCollideGround(evt){this.shatter(evt.data.x,evt.data.y)}onCollide(evt){this.shatter(evt.data.x,evt.data.y)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{CONSOLE_EVENT_DAMAGE:()=>CONSOLE_EVENT_DAMAGE,CONSOLE_EVENT_DEAD:()=>CONSOLE_EVENT_DEAD,CONSOLE_EVENT_SHATTER:()=>CONSOLE_EVENT_SHATTER,CONSOLE_EVENT_MISS:()=>CONSOLE_EVENT_MISS,CONSOLE_EVENT_BLOCK:()=>CONSOLE_EVENT_BLOCK,CONSOLE_EVENT_TRAP_SHARP:()=>CONSOLE_EVENT_TRAP_SHARP,getMessage:()=>getMessage,shouldAppear:()=>shouldAppear});var _data_DamageTypes__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(66),_ecs_components__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(21),_LiquidTypes__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(29);const CONSOLE_EVENT_DAMAGE=0,CONSOLE_EVENT_DEAD=1,CONSOLE_EVENT_SHATTER=2,CONSOLE_EVENT_MISS=3,CONSOLE_EVENT_BLOCK=4,CONSOLE_EVENT_TRAP_SHARP=5,getMonikerSubject=entity=>entity.has(_ecs_components__WEBPACK_IMPORTED_MODULE_1__.Moniker)?"The ".concat(entity.moniker.simpleDisplay.toLowerCase()):"The thing",getMonikerIndirectObject=entity=>entity.has(_ecs_components__WEBPACK_IMPORTED_MODULE_1__.IsPlayer)?"you":entity.has(_ecs_components__WEBPACK_IMPORTED_MODULE_1__.Moniker)?"the ".concat(entity.moniker.simpleDisplay.toLowerCase()):void 0,mapping={[CONSOLE_EVENT_MISS]:{message(data){const attacker=getMonikerIndirectObject(data.attacker),defender=getMonikerSubject(data.defender);return"".concat(defender," dodged an attack from ").concat(attacker," (").concat(data.dodgePrcnt,"%)")},shouldAppear:data=>data.defender.has(_ecs_components__WEBPACK_IMPORTED_MODULE_1__.IsPlayer)||data.attacker.has(_ecs_components__WEBPACK_IMPORTED_MODULE_1__.IsVisible)},[CONSOLE_EVENT_DAMAGE]:{message(data){const source=getMonikerSubject(data.source),target=getMonikerIndirectObject(data.target),dmgVerb=(0,_data_DamageTypes__WEBPACK_IMPORTED_MODULE_0__.getDmgTypeVerb)(data.damageType),dmg=data.damage,blocked=data.blocked,blockText=blocked>0?". (".concat(blocked," damage was blocked)"):"";return"".concat(source," ").concat(dmgVerb," ").concat(target," for ").concat(dmg," hp").concat(blockText)},shouldAppear:data=>data.target.has(_ecs_components__WEBPACK_IMPORTED_MODULE_1__.IsPlayer)||data.target.has(_ecs_components__WEBPACK_IMPORTED_MODULE_1__.IsVisible)},[CONSOLE_EVENT_DEAD]:{message(data){const source=getMonikerSubject(data.source),target=getMonikerIndirectObject(data.target),dmgVerb=(0,_data_DamageTypes__WEBPACK_IMPORTED_MODULE_0__.getDmgTypeVerb)(data.damageType);return"".concat(source," ").concat(dmgVerb," ").concat(target," to death")},shouldAppear:data=>data.target.has(_ecs_components__WEBPACK_IMPORTED_MODULE_1__.IsPlayer)||data.target.has(_ecs_components__WEBPACK_IMPORTED_MODULE_1__.IsVisible)},[CONSOLE_EVENT_SHATTER]:{message:data=>isNaN(data.liquid)?"".concat(getMonikerSubject(data.target)," shatters!"):"".concat(getMonikerSubject(data.target)," shatters and spills its ").concat(_LiquidTypes__WEBPACK_IMPORTED_MODULE_2__.liquids[data.liquid].colorDesc," content!"),shouldAppear:data=>data.target.has(_ecs_components__WEBPACK_IMPORTED_MODULE_1__.IsVisible)},[CONSOLE_EVENT_TRAP_SHARP]:{message:data=>"".concat(getMonikerSubject(data.entity)," cuts themselves on ").concat(getMonikerIndirectObject(data.trap)," and begins bleeding"),shouldAppear:data=>data.trap.has(_ecs_components__WEBPACK_IMPORTED_MODULE_1__.IsVisible)}},getMessage=(evt,data)=>mapping[evt].message(data),shouldAppear=(evt,data)=>mapping[evt].shouldAppear(data)},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Brain:()=>Brain});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_ai_GoalActionResult__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(36);class Brain extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{onDestroyed(){this.goals.forEach((entity=>{entity.destroy()}))}onTakeAction(evt){for(;this.peekGoal()&&this.peekGoal().isFinished();)this.popGoal().entity.destroy();const currentGoal=this.peekGoal(),result=currentGoal.takeAction();result===_ai_GoalActionResult__WEBPACK_IMPORTED_MODULE_1__.FAILURE?this.removeGoal(currentGoal):result===_ai_GoalActionResult__WEBPACK_IMPORTED_MODULE_1__.INVALID&&(this.removeGoal(currentGoal),this.entity.fireEvent("take-action")),evt.handle()}removeGoal(goal){const goalsToDestroy=[];this.goals=this.goals.filter((g=>{const isSelf=Boolean(g.id===goal.entity.id),isSiblingGoal=Boolean(g.goal.originalIntent&&g.goal.originalIntent.id===goal.originalIntent.id);return!isSelf&&!isSiblingGoal||(goalsToDestroy.push(g.goal),!1)})),goalsToDestroy.forEach((g=>g.entity.destroy()))}pushGoal(goal){if(!(goal instanceof geotic__WEBPACK_IMPORTED_MODULE_0__.Component))throw new Error("Pushing non-component goal!",goal);return goal.parent=this.entity,this.goals.push(goal.entity)}popGoal(){return this.goals.pop().goal}peekGoal(){return this.goals[this.goals.length-1].goal}}value={goals:"<EntityArray>"},(key="properties")in(obj=Brain)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Goal:()=>Goal});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_ai_GoalEvaluator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(75);class Goal extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{isFinished(){return _ai_GoalEvaluator__WEBPACK_IMPORTED_MODULE_1__.isFinished(this.parent,this)}takeAction(){return _ai_GoalEvaluator__WEBPACK_IMPORTED_MODULE_1__.takeAction(this.parent,this)}}value={name:"Bored",originalIntent:"<Entity>",parent:"<Entity>",target:"<Entity>",complete:!1,data:{}},(key="properties")in(obj=Goal)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{isFinished:()=>isFinished,takeAction:()=>takeAction});var _GoalTypes__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(33);const goalTypeMap={};Object.values(_GoalTypes__WEBPACK_IMPORTED_MODULE_0__).forEach((goalType=>{goalTypeMap[goalType.name]=goalType}));const getGoalType=name=>{const type=goalTypeMap[name];return type||console.warn("GoalType (".concat(name,") not found!")),type},isFinished=(entity,goal)=>getGoalType(goal.name).isFinished(entity,goal),takeAction=(entity,goal)=>getGoalType(goal.name).takeAction(entity,goal)},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Moniker:()=>Moniker});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_Door__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(48),_LiquidContainer__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(25),_Stackable__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(55);class Moniker extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{get simpleDisplay(){return this.name}get display(){if(this.entity.has(_LiquidContainer__WEBPACK_IMPORTED_MODULE_2__.LiquidContainer)){const disp=this.entity.liquidContainer.display;return"".concat(this.name," ").concat(disp)}if(this.entity.has(_Stackable__WEBPACK_IMPORTED_MODULE_3__.Stackable)){const disp=this.entity.stackable.display;return"".concat(this.name," ").concat(disp)}if(this.entity.has(_Door__WEBPACK_IMPORTED_MODULE_1__.Door)){const disp=this.entity.door.display;return"".concat(this.name," ").concat(disp)}return this.name}}value={name:"Unknown"},(key="properties")in(obj=Moniker)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Logger:()=>Logger});var geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_Moniker__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(76);class Logger extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{get moniker(){return this.entity.has(_Moniker__WEBPACK_IMPORTED_MODULE_1__.Moniker)?this.entity.moniker.display:"Unknown"}onLog(evt){console.log("[".concat(this.moniker,"]"),evt.data),evt.handle()}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Position:()=>Position});var geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23);class Position extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{getPos(){return window.game.map.getPosition(this.entity.id)}setPos(x,y){return window.game.map.setPosition(x,y,this.entity.id)}equals(x,y){const pos=this.getPos();return pos.x===x&&pos.y===y}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Glyph:()=>Glyph});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_LiquidContainer__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(25);class Glyph extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{get primary(){if(this.entity.has(_LiquidContainer__WEBPACK_IMPORTED_MODULE_1__.LiquidContainer)){const col=this.entity.liquidContainer.primaryColorOverride;if(col)return col}return this.fg1}get secondary(){if(this.entity.has(_LiquidContainer__WEBPACK_IMPORTED_MODULE_1__.LiquidContainer)){const col=this.entity.liquidContainer.secondaryColorOverride;if(col)return col}return this.fg2}get background(){return this.bg}get char(){return this.ch}}value={fg1:"#ddd",fg2:"#666",bg:null,ch:"?",z:1e3},(key="properties")in(obj=Glyph)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Legs:()=>Legs});var geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_core_Game__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),_data_Skills__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(58),_Blocker__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(49);class Legs extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{onTryMove(evt){const position=this.entity.position.getPos(),targetX=position.x+evt.data.x,targetY=position.y+evt.data.y,targetTileEntities=_core_Game__WEBPACK_IMPORTED_MODULE_1__.game.map.getEntitiesAt(targetX,targetY);if(targetTileEntities.some((entity=>entity.has(_Blocker__WEBPACK_IMPORTED_MODULE_3__.Blocker))))return;const nonHostile=targetTileEntities.find((entity=>entity.factionMember&&!_core_Game__WEBPACK_IMPORTED_MODULE_1__.game.factions.areEntitiesHostile(entity,this.entity)));nonHostile&&nonHostile.position.setPos(position.x,position.y);const cost=20/(20+(0,_data_Skills__WEBPACK_IMPORTED_MODULE_2__.getSkillValue)(_data_Skills__WEBPACK_IMPORTED_MODULE_2__.SKILL_SPEED,this.entity))*1e3;this.entity.fireEvent("energy-consumed",cost),this.entity.position.setPos(targetX,targetY),evt.handle()}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{IsPlayer:()=>IsPlayer});var geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23);class IsPlayer extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Wandering:()=>Wandering});var geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_ai_GoalTypes__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(33),_enums_Directions__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(83);class Wandering extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{onBoredom(evt){if(Math.random()>.5)return;const direction=Math.floor(9*Math.random()),delta=_enums_Directions__WEBPACK_IMPORTED_MODULE_2__.delta(direction);evt.data.goal=_ai_GoalTypes__WEBPACK_IMPORTED_MODULE_1__.MoveGoalType.create({data:delta}),evt.handle()}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DIR_NW:()=>DIR_NW,DIR_N:()=>DIR_N,DIR_NE:()=>DIR_NE,DIR_W:()=>DIR_W,DIR_Z:()=>DIR_Z,DIR_E:()=>DIR_E,DIR_SW:()=>DIR_SW,DIR_S:()=>DIR_S,DIR_SE:()=>DIR_SE,shortName:()=>shortName,fullName:()=>fullName,delta:()=>delta,adjacent:()=>adjacent,getAdjacentDeltas:()=>getAdjacentDeltas,directionFromDelta:()=>directionFromDelta});const directions=[{key:0,shortName:"NW",fullName:"Northwest",delta:{x:-1,y:-1}},{key:1,shortName:"N",fullName:"North",delta:{x:0,y:-1}},{key:2,shortName:"NE",fullName:"Northeast",delta:{x:1,y:-1}},{key:3,shortName:"W",fullName:"West",delta:{x:-1,y:0}},{key:4,shortName:"Z",fullName:"Here",delta:{x:0,y:0},adjacent:[]},{key:5,shortName:"E",fullName:"East",delta:{x:1,y:0}},{key:6,shortName:"SW",fullName:"Southwest",delta:{x:-1,y:1}},{key:7,shortName:"S",fullName:"South",delta:{x:0,y:1}},{key:8,shortName:"SE",fullName:"Southeast",delta:{x:1,y:1}}],DIR_NW=0,DIR_N=1,DIR_NE=2,DIR_W=3,DIR_Z=4,DIR_E=5,DIR_SW=6,DIR_S=7,DIR_SE=8;directions[DIR_NW].adjacent=[DIR_N,DIR_W],directions[DIR_N].adjacent=[DIR_NW,DIR_NE],directions[DIR_NE].adjacent=[DIR_N,DIR_E],directions[DIR_W].adjacent=[DIR_NW,DIR_SW],directions[DIR_E].adjacent=[DIR_NE,DIR_SE],directions[DIR_SW].adjacent=[DIR_W,DIR_S],directions[DIR_S].adjacent=[DIR_SW,DIR_SE],directions[DIR_SE].adjacent=[DIR_S,DIR_E];const shortName=direction=>directions[direction].shortName,fullName=direction=>directions[direction].fullName,delta=direction=>directions[direction].delta,adjacent=direction=>directions[direction].adjacent,getAdjacentDeltas=direction=>adjacent(direction).map(delta),directionFromDelta=(x,y)=>Object.values(directions).find((dir=>dir.delta.x===x&&dir.delta.y===y))},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Explorable:()=>Explorable});var geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23);class Explorable extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Explored:()=>Explored});var geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23);class Explored extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Health:()=>Health});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_core_Game__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),_data_Skills__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(58),_data_skills_ArmorSkill__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(59),_data_skills_DodgeSkill__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(64),_enums_ConsoleEvents__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(72),_utils_rand__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(45),_IsDead__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(87);class Health extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{applyDamage(damage){return this.value-=damage,this.value<=0&&(this.value=0,this.entity.add(_IsDead__WEBPACK_IMPORTED_MODULE_7__.IsDead),!0)}onAttacked(evt){const attack=evt.data.attack,attacker=attack.attacker,defender=attack.defender,dodge=(0,_data_Skills__WEBPACK_IMPORTED_MODULE_2__.getSkillValue)(_data_Skills__WEBPACK_IMPORTED_MODULE_2__.SKILL_DODGE,defender),dodgePrcnt=(0,_data_skills_DodgeSkill__WEBPACK_IMPORTED_MODULE_4__.getDodgePercent)(dodge);if(!attack.ignoreDodge&&(0,_utils_rand__WEBPACK_IMPORTED_MODULE_6__.randomInt)(1,100)<=dodgePrcnt)return _core_Game__WEBPACK_IMPORTED_MODULE_1__.game.console.event(_enums_ConsoleEvents__WEBPACK_IMPORTED_MODULE_5__.CONSOLE_EVENT_MISS,{defender,attacker,dodgePrcnt}),evt.data.isDodged=!0,evt.data.isKilled=!1,void evt.handle();evt.data.isDodged=!1;const armor=(0,_data_Skills__WEBPACK_IMPORTED_MODULE_2__.getSkillValue)(_data_Skills__WEBPACK_IMPORTED_MODULE_2__.SKILL_ARMOR,defender),armorPrcnt=(0,_data_skills_ArmorSkill__WEBPACK_IMPORTED_MODULE_3__.getArmorBlockPercent)(armor),blocked=Math.floor(attack.damage*armorPrcnt),damage=attack.damage-blocked,isKilled=this.applyDamage(damage);if(evt.data.isKilled=isKilled,isKilled)return _core_Game__WEBPACK_IMPORTED_MODULE_1__.game.console.event(_enums_ConsoleEvents__WEBPACK_IMPORTED_MODULE_5__.CONSOLE_EVENT_DEAD,{target:defender,source:attacker,damage,damageType:attack.damageType}),void evt.handle();_core_Game__WEBPACK_IMPORTED_MODULE_1__.game.console.event(_enums_ConsoleEvents__WEBPACK_IMPORTED_MODULE_5__.CONSOLE_EVENT_DAMAGE,{target:defender,source:attacker,damage,damageType:attack.damageType,blocked});const pos=this.entity.position.getPos();_core_Game__WEBPACK_IMPORTED_MODULE_1__.game.particles.createParticle(pos.x,pos.y,{lifetime:140,fg1s:["#8d4c4f","#730d14"],glyphs:["*"]}),evt.handle()}onHeal(evt){this.value+=evt.data.value,this.value>this.max&&(this.value=this.max),evt.handle()}}value={value:32,max:32},(key="properties")in(obj=Health)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{IsDead:()=>IsDead});var geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23);class IsDead extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{FactionMember:()=>FactionMember});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_enums_Factions__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(89);class FactionMember extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{get faction(){return(0,_enums_Factions__WEBPACK_IMPORTED_MODULE_1__.getFactionByName)(this.name)}}value={name:"Neutral"},(key="properties")in(obj=FactionMember)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{FACTION_PLAYER:()=>FACTION_PLAYER,FACTION_VILLAGER:()=>FACTION_VILLAGER,FACTION_GOBLIN:()=>FACTION_GOBLIN,FACTION_NATURE:()=>FACTION_NATURE,factions:()=>factions,getFactionByName:()=>getFactionByName});var _data_Faction__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(90);const FACTION_PLAYER=0,FACTION_VILLAGER=1,FACTION_GOBLIN=2,FACTION_NATURE=3,factions={player:new _data_Faction__WEBPACK_IMPORTED_MODULE_0__.default({id:FACTION_PLAYER,name:"player",display:"Player"}),villager:new _data_Faction__WEBPACK_IMPORTED_MODULE_0__.default({id:FACTION_VILLAGER,name:"villager",display:"Villager"}),goblin:new _data_Faction__WEBPACK_IMPORTED_MODULE_0__.default({id:FACTION_GOBLIN,name:"goblin",display:"Goblin"}),nature:new _data_Faction__WEBPACK_IMPORTED_MODULE_0__.default({id:FACTION_NATURE,name:"nature",display:"Nature"})},getFactionByName=name=>factions[name]},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Faction});class Faction{constructor(properties){_defineProperty(this,"id",0),_defineProperty(this,"name","faction"),_defineProperty(this,"display","Faction"),this.id=properties.id,this.name=properties.name,this.display=properties.display}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Eyes:()=>Eyes});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_core_Game__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),_utils_BresenhamLine__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(68),_Shadowcaster__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(50);class Eyes extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{canSee(entity){const start=this.entity.position.getPos(),end=entity.position.getPos(),line=(0,_utils_BresenhamLine__WEBPACK_IMPORTED_MODULE_2__.bresenhamLine)(start.x,start.y,end.x,end.y);return!(line.length>this.range)&&!line.some((segment=>_core_Game__WEBPACK_IMPORTED_MODULE_1__.game.map.getEntitiesAt(segment.x,segment.y).some((entity=>entity.has(_Shadowcaster__WEBPACK_IMPORTED_MODULE_3__.Shadowcaster)))))}onTryDetectHostiles(evt){const position=_core_Game__WEBPACK_IMPORTED_MODULE_1__.game.map.getPosition(this.entity.id);if(!position)return;const targets=_core_Game__WEBPACK_IMPORTED_MODULE_1__.game.map.getEntitiesInRange(position.x,position.y,this.range).filter((e=>!!e.actor&&(!e.isDead&&(!!_core_Game__WEBPACK_IMPORTED_MODULE_1__.game.factions.areEntitiesHostile(this.entity,e)&&this.canSee(e)))));targets.length>0&&(targets.forEach((e=>{evt.data.targets.add(e)})),evt.handle())}}value={range:5},(key="properties")in(obj=Eyes)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Particle:()=>Particle});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23);class Particle extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{get isExpired(){return this.age>=this.lifetime}get percent(){return this.age/this.lifetime}frame(arr=[]){const chunks=1/arr.length;return Math.trunc(this.percent/chunks)}get glyph(){const frame=this.frame(this.glyphs);return this.glyphs[frame]}get fg1(){const frame=this.frame(this.fg1s);return this.fg1s[frame]}get fg2(){const frame=this.frame(this.fg2s);return this.fg2s[frame]}get bg(){const frame=this.frame(this.bgs);return this.bgs[frame]}}value={lifetime:200,fg1s:["#8d4c4f","#730d14"],fg2s:[],bgs:[],glyphs:["·"],speed:.05,age:0,x:0,y:0,startX:0,startY:0,direction:{x:0,y:0}},(key="properties")in(obj=Particle)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ParticleEmitter:()=>ParticleEmitter});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_Particle__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(92);class ParticleEmitter extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{get isExpired(){return this.age>=this.duration}get percent(){return this.age/this.duration}createParticle(){const particle=this.ecs.createEntity();return particle.add(_Particle__WEBPACK_IMPORTED_MODULE_1__.Particle,{...this.particleData,x:this.x,y:this.y}),this.count+=1,particle}frame(arr=[]){const chunks=1/arr.length;return Math.trunc(this.percent/chunks)}}value={particleData:{},duration:800,rate:3,age:0,x:0,y:0,count:0},(key="properties")in(obj=ParticleEmitter)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{LootDropper:()=>LootDropper});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_data_tables_LootSpawn__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(95);class LootDropper extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{onDeath(evt){const pos=this.entity.position.getPos();(0,_data_tables_LootSpawn__WEBPACK_IMPORTED_MODULE_1__.spawnLoot)(this.tables,pos.x,pos.y)}}value={tables:[]},(key="properties")in(obj=LootDropper)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{getTable:()=>getTable,pickLoot:()=>pickLoot,spawnLoot:()=>spawnLoot});var _utils_WeightedTable__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(96),_Spawner__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(27),_loot_LootTableGoblin__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(97),_loot_LootTableForest__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(98);const tables={TBL_LOOT_GOBLIN:_loot_LootTableGoblin__WEBPACK_IMPORTED_MODULE_2__.default,TBL_LOOT_FOREST:_loot_LootTableForest__WEBPACK_IMPORTED_MODULE_3__.default},getTable=tableKey=>tables[tableKey],pickLoot=(tableKeys=[])=>{const tables=tableKeys.map(getTable);return _utils_WeightedTable__WEBPACK_IMPORTED_MODULE_0__.default.combine(tables).pick()},spawnLoot=(tableKeys=[],x,y)=>{const spawnable=pickLoot(tableKeys);return(0,_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(spawnable,x,y)}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>WeightedTable});var _rand__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(45);class WeightedTable{constructor(){var obj,key,value;value=[],(key="rows")in(obj=this)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}get sum(){return this.rows.reduce(((sum,cur)=>sum+cur.weight),0)}pick(){const r=(0,_rand__WEBPACK_IMPORTED_MODULE_0__.randomInt)(0,this.sum);let currentW=0;const row=this.rows.find((row=>(currentW+=row.weight,currentW>=r)));if(row)return row.value}chance(value){const row=this.get(value);return row?row.weight/this.sum:0}get(value){return this.rows.find((row=>row.value===value))}add(weight,value){const existing=this.get(value);if(existing){const maxWeight=Math.max(existing.weight,weight);existing.weight=maxWeight}else this.rows.push({weight,value});this.rows.sort(((a,b)=>a.weight-b.weight))}static combine(tables=[]){const table=new WeightedTable;return tables.forEach((other=>{other.rows.forEach((row=>table.add(row.weight,row.value)))})),table}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _utils_WeightedTable__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(96),_Spawnables__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(26);const goblins=new _utils_WeightedTable__WEBPACK_IMPORTED_MODULE_0__.default;goblins.add(3,_Spawnables__WEBPACK_IMPORTED_MODULE_1__.SPWN_STONE),goblins.add(2,_Spawnables__WEBPACK_IMPORTED_MODULE_1__.SPWN_VIAL_BLOOD),goblins.add(5,_Spawnables__WEBPACK_IMPORTED_MODULE_1__.SPWN_AMULET),goblins.add(4,_Spawnables__WEBPACK_IMPORTED_MODULE_1__.SPWN_CLOTH_ARMOR),goblins.add(15,_Spawnables__WEBPACK_IMPORTED_MODULE_1__.SPWN_SHORTSWORD);const __WEBPACK_DEFAULT_EXPORT__=goblins},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _utils_WeightedTable__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(96),_Spawnables__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(26);const forest=new _utils_WeightedTable__WEBPACK_IMPORTED_MODULE_0__.default;forest.add(3,_Spawnables__WEBPACK_IMPORTED_MODULE_1__.SPWN_STONE),forest.add(2,_Spawnables__WEBPACK_IMPORTED_MODULE_1__.SPWN_VIAL_HONEY);const __WEBPACK_DEFAULT_EXPORT__=forest},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{IsEquipped:()=>IsEquipped});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23);class IsEquipped extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{get slot(){return this.owner.equipmentSlot[this.slotKey]}onDropped(evt){this.slot.unequip()}onThrown(evt){this.slot.unequip()}}value={slotKey:"",owner:"<Entity>"},(key="properties")in(obj=IsEquipped)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Equipment:()=>Equipment});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_core_Game__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),_core_screens_ScreenType__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(53),_data_EquipmentSlotType__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(101),_IsEquipped__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(99);class Equipment extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{onTryEquip(evt){const slots=Object.values(evt.data.interactor.equipmentSlot).filter((slot=>this.slotTypes.includes(slot.slotType)));_core_Game__WEBPACK_IMPORTED_MODULE_1__.game.screens.pushScreen(_core_screens_ScreenType__WEBPACK_IMPORTED_MODULE_2__.SCREEN_LIST_SELECT,{header:this.entity.moniker.display,icon:this.entity.glyph,leadText:"Select a slot",list:slots,onRenderRow:(slot,x,y,isSelected)=>{let text=slot.name;slot.isEmpty||(text+=" [".concat(slot.content.moniker.display,"]")),isSelected?_core_Game__WEBPACK_IMPORTED_MODULE_1__.game.renderer.drawText(x,y,"→ ".concat(text),"yellow"):_core_Game__WEBPACK_IMPORTED_MODULE_1__.game.renderer.drawText(x,y,"- ".concat(text))},onSelect:slot=>{slot.unequip(),slot.equip(this.entity),evt.data.interactor.fireEvent("energy-consumed",200),evt.handle(),_core_Game__WEBPACK_IMPORTED_MODULE_1__.game.screens.popScreen()}})}onTryUnequip(evt){const slotKey=this.entity.isEquipped.slotKey,slot=evt.data.interactor.equipmentSlot[slotKey];slot&&(slot.content=null),evt.data.interactor.fireEvent("energy-consumed",200),this.entity.isEquipped.destroy(),evt.handle()}onGetInteractions(evt){this.entity.has(_IsEquipped__WEBPACK_IMPORTED_MODULE_4__.IsEquipped)?evt.data.interactions.push({name:"Unequip [".concat(this.entity.isEquipped.slot.name,"]"),evt:"try-unequip"}):evt.data.interactions.push({name:"Equip",evt:"try-equip"})}}obj=Equipment,key="properties",value={slotTypes:[_data_EquipmentSlotType__WEBPACK_IMPORTED_MODULE_3__.EQ_SLOT_BODY]},key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{EQ_SLOT_HEAD:()=>EQ_SLOT_HEAD,EQ_SLOT_NECK:()=>EQ_SLOT_NECK,EQ_SLOT_BODY:()=>EQ_SLOT_BODY,EQ_SLOT_FEET:()=>EQ_SLOT_FEET,EQ_SLOT_ARM:()=>EQ_SLOT_ARM,EQ_SLOT_HAND:()=>EQ_SLOT_HAND});const EQ_SLOT_HEAD="EQ_SLOT_HEAD",EQ_SLOT_NECK="EQ_SLOT_NECK",EQ_SLOT_BODY="EQ_SLOT_BODY",EQ_SLOT_FEET="EQ_SLOT_FEET",EQ_SLOT_ARM="EQ_SLOT_ARM",EQ_SLOT_HAND="EQ_SLOT_HAND"},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{EquipmentSlot:()=>EquipmentSlot});var geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_data_EquipmentSlotType__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(101),_data_WeaponTypes__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(103),_IsEquipped__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(99);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class EquipmentSlot extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{get isEmpty(){return!this.content}onDestroyed(){this.isEmpty||this.content.destroy()}unequip(){if(this.isEmpty)return!1;const content=this.content;this.content=null,content.isEquipped.destroy(),content.fireEvent("unequipped",{interactor:this.entity})}equip(equipment){equipment.loot.take(this.entity),equipment.add(_IsEquipped__WEBPACK_IMPORTED_MODULE_3__.IsEquipped,{slotKey:this.key,owner:this.entity}),this.content=equipment,equipment.fireEvent("equipped",{interactor:this.entity})}onTryMelee(evt){if(!this.isPrimary)return;const map=window.game.map,targetPos=evt.data.target.position.getPos(),selfPos=this.entity.position.getPos();if(map.isAdjacent(selfPos.x,selfPos.y,targetPos.x,targetPos.y)){if(this.isEmpty){return(0,_data_WeaponTypes__WEBPACK_IMPORTED_MODULE_2__.getWeaponType)(_data_WeaponTypes__WEBPACK_IMPORTED_MODULE_2__.WPN_TYPE_UNARMED).attack(this.entity,evt.data.target),this.entity.fireEvent("energy-consumed",600),void evt.handle()}this.content.fireEvent("try-use-melee",{interactor:this.entity,target:evt.data.target}),evt.handle()}}onQuerySkillMod(evt){this.isEmpty||this.content.fireEvent("query-skill-mod-equipped",{skill:evt.data.skill,modifiers:evt.data.modifiers})}}_defineProperty(EquipmentSlot,"allowMultiple",!0),_defineProperty(EquipmentSlot,"keyProperty","key"),_defineProperty(EquipmentSlot,"properties",{name:"Body",key:"body",slotType:_data_EquipmentSlotType__WEBPACK_IMPORTED_MODULE_1__.EQ_SLOT_BODY,content:"<Entity>",isPrimary:!1,isOffhand:!1})},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{WPN_TYPE_WAR_HAMMER:()=>WPN_TYPE_WAR_HAMMER,WPN_TYPE_SLEDGE_HAMMER:()=>WPN_TYPE_SLEDGE_HAMMER,WPN_TYPE_CLUB:()=>WPN_TYPE_CLUB,WPN_TYPE_MACE:()=>WPN_TYPE_MACE,WPN_TYPE_HEAVY_AXE:()=>WPN_TYPE_HEAVY_AXE,WPN_TYPE_BATTLE_AXE:()=>WPN_TYPE_BATTLE_AXE,WPN_TYPE_GREATSWORD:()=>WPN_TYPE_GREATSWORD,WPN_TYPE_SHORTSWORD:()=>WPN_TYPE_SHORTSWORD,WPN_TYPE_DAGGER:()=>WPN_TYPE_DAGGER,WPN_TYPE_STAFF:()=>WPN_TYPE_STAFF,WPN_TYPE_HALBERD:()=>WPN_TYPE_HALBERD,WPN_TYPE_JAVELIN:()=>WPN_TYPE_JAVELIN,WPN_TYPE_UNARMED:()=>WPN_TYPE_UNARMED,getWeaponType:()=>getWeaponType,getWeaponTypeName:()=>getWeaponTypeName,getWeaponTypeFamily:()=>getWeaponTypeFamily,getWeaponTypeDmgType:()=>getWeaponTypeDmgType});var _DamageTypes__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(66),_WeaponFamilies__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(104),_weapons_WpnTypeBattleAxe__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(105),_weapons_WpnTypeGreatsword__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(107),_weapons_WpnTypeMace__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(108),_weapons_WpnTypeShortsword__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(114),_weapons_WpnTypeUnarmed__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(115);const WPN_TYPE_WAR_HAMMER="WPN_TYPE_WAR_HAMMER",WPN_TYPE_SLEDGE_HAMMER="WPN_TYPE_SLEDGE_HAMMER",WPN_TYPE_CLUB="WPN_TYPE_CLUB",WPN_TYPE_MACE="WPN_TYPE_MACE",WPN_TYPE_HEAVY_AXE="WPN_TYPE_HEAVY_AXE",WPN_TYPE_BATTLE_AXE="WPN_TYPE_BATTLE_AXE",WPN_TYPE_GREATSWORD="WPN_TYPE_GREATSWORD",WPN_TYPE_SHORTSWORD="WPN_TYPE_SHORTSWORD",WPN_TYPE_DAGGER="WPN_TYPE_DAGGER",WPN_TYPE_STAFF="WPN_TYPE_STAFF",WPN_TYPE_HALBERD="WPN_TYPE_HALBERD",WPN_TYPE_JAVELIN="WPN_TYPE_JAVELIN",WPN_TYPE_UNARMED="WPN_TYPE_UNARMED",lookup={[WPN_TYPE_UNARMED]:new _weapons_WpnTypeUnarmed__WEBPACK_IMPORTED_MODULE_6__.default,[WPN_TYPE_WAR_HAMMER]:{name:"War hammer",family:_WeaponFamilies__WEBPACK_IMPORTED_MODULE_1__.WPN_FAMILY_HAMMER,key:WPN_TYPE_WAR_HAMMER,damageType:_DamageTypes__WEBPACK_IMPORTED_MODULE_0__.DMG_TYPE_BLUDGEONING},[WPN_TYPE_SLEDGE_HAMMER]:{name:"Sledge hammer",family:_WeaponFamilies__WEBPACK_IMPORTED_MODULE_1__.WPN_FAMILY_HAMMER,key:WPN_TYPE_SLEDGE_HAMMER,damageType:_DamageTypes__WEBPACK_IMPORTED_MODULE_0__.DMG_TYPE_BLUDGEONING},[WPN_TYPE_CLUB]:{name:"Club",family:_WeaponFamilies__WEBPACK_IMPORTED_MODULE_1__.WPN_FAMILY_HAMMER,key:WPN_TYPE_CLUB,damageType:_DamageTypes__WEBPACK_IMPORTED_MODULE_0__.DMG_TYPE_BLUDGEONING},[WPN_TYPE_MACE]:{name:"Mace",family:_WeaponFamilies__WEBPACK_IMPORTED_MODULE_1__.WPN_FAMILY_HAMMER,key:WPN_TYPE_MACE,damageType:_DamageTypes__WEBPACK_IMPORTED_MODULE_0__.DMG_TYPE_BLUDGEONING},[WPN_TYPE_HEAVY_AXE]:{name:"Heavy axe",family:_WeaponFamilies__WEBPACK_IMPORTED_MODULE_1__.WPN_FAMILY_AXE,key:WPN_TYPE_HEAVY_AXE,damageType:_DamageTypes__WEBPACK_IMPORTED_MODULE_0__.DMG_TYPE_SLASHING},[WPN_TYPE_BATTLE_AXE]:new _weapons_WpnTypeBattleAxe__WEBPACK_IMPORTED_MODULE_2__.default,[WPN_TYPE_GREATSWORD]:new _weapons_WpnTypeGreatsword__WEBPACK_IMPORTED_MODULE_3__.default,[WPN_TYPE_SHORTSWORD]:new _weapons_WpnTypeShortsword__WEBPACK_IMPORTED_MODULE_5__.default,[WPN_TYPE_MACE]:new _weapons_WpnTypeMace__WEBPACK_IMPORTED_MODULE_4__.default,[WPN_TYPE_DAGGER]:{name:"Dagger",family:_WeaponFamilies__WEBPACK_IMPORTED_MODULE_1__.WPN_FAMILY_BLADE,key:WPN_TYPE_DAGGER,damageType:_DamageTypes__WEBPACK_IMPORTED_MODULE_0__.DMG_TYPE_SLASHING},[WPN_TYPE_STAFF]:{name:"Staff",family:_WeaponFamilies__WEBPACK_IMPORTED_MODULE_1__.WPN_FAMILY_POLEARM,key:WPN_TYPE_STAFF,damageType:_DamageTypes__WEBPACK_IMPORTED_MODULE_0__.DMG_TYPE_BLUDGEONING},[WPN_TYPE_HALBERD]:{name:"Halberd",family:_WeaponFamilies__WEBPACK_IMPORTED_MODULE_1__.WPN_FAMILY_POLEARM,key:WPN_TYPE_HALBERD,damageType:_DamageTypes__WEBPACK_IMPORTED_MODULE_0__.DMG_TYPE_PIERCING},[WPN_TYPE_JAVELIN]:{name:"Javelin",family:_WeaponFamilies__WEBPACK_IMPORTED_MODULE_1__.WPN_FAMILY_POLEARM,key:WPN_TYPE_JAVELIN,damageType:_DamageTypes__WEBPACK_IMPORTED_MODULE_0__.DMG_TYPE_PIERCING}},getWeaponType=type=>lookup[type],getWeaponTypeName=type=>lookup[type].name,getWeaponTypeFamily=type=>lookup[type].family,getWeaponTypeDmgType=type=>lookup[type].damageType},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{WPN_FAMILY_HAMMER:()=>WPN_FAMILY_HAMMER,WPN_FAMILY_AXE:()=>WPN_FAMILY_AXE,WPN_FAMILY_BLADE:()=>WPN_FAMILY_BLADE,WPN_FAMILY_ARCHERY:()=>WPN_FAMILY_ARCHERY,WPN_FAMILY_POLEARM:()=>WPN_FAMILY_POLEARM,WPN_FAMILY_UNARMED:()=>WPN_FAMILY_UNARMED,WPN_FAMILY_CUDGEL:()=>WPN_FAMILY_CUDGEL,getWeaponFamilyName:()=>getWeaponFamilyName});const WPN_FAMILY_HAMMER="WPN_FAMILY_HAMMER",WPN_FAMILY_AXE="WPN_FAMILY_AXE",WPN_FAMILY_BLADE="WPN_FAMILY_BLADE",WPN_FAMILY_ARCHERY="WPN_FAMILY_ARCHERY",WPN_FAMILY_POLEARM="WPN_FAMILY_POLEARM",WPN_FAMILY_UNARMED="WPN_FAMILY_UNARMED",WPN_FAMILY_CUDGEL="WPN_FAMILY_CUDGEL",lookup={[WPN_FAMILY_HAMMER]:{name:"Hammer"},[WPN_FAMILY_AXE]:{name:"Axe"},[WPN_FAMILY_BLADE]:{name:"Blade"},[WPN_FAMILY_ARCHERY]:{name:"Archery"},[WPN_FAMILY_POLEARM]:{name:"Polearm"},[WPN_FAMILY_UNARMED]:{name:"Unarmed"},[WPN_FAMILY_CUDGEL]:{name:"Cudgel"}},getWeaponFamilyName=family=>lookup[family].name},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>WpnTypeBattleAxe});var _utils_rand__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(45),_Attack__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(65),_DamageTypes__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(66),_Stats__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(61),_WeaponFamilies__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(104),_WeaponTypes__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(103),_WeaponType__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(106);class WpnTypeBattleAxe extends _WeaponType__WEBPACK_IMPORTED_MODULE_6__.default{constructor(){super({key:_WeaponTypes__WEBPACK_IMPORTED_MODULE_5__.WPN_TYPE_BATTLE_AXE,name:"Battle axe",family:_WeaponFamilies__WEBPACK_IMPORTED_MODULE_4__.WPN_FAMILY_AXE,damageType:_DamageTypes__WEBPACK_IMPORTED_MODULE_2__.DMG_TYPE_SLASHING})}_createAttack(attacker,defender,weapon){const str=(0,_Stats__WEBPACK_IMPORTED_MODULE_3__.getStat)(_Stats__WEBPACK_IMPORTED_MODULE_3__.STAT_STRENGTH,attacker),damage=weapon.roll()+str;return new _Attack__WEBPACK_IMPORTED_MODULE_1__.default({attacker,defender,weaponName:weapon.name,damage,damageType:this.damageType})}attack(attacker,defender,weapon){const attack=this._createAttack(attacker,defender,weapon),result=defender.fireEvent("attacked",{attack}),attacks=[attack];if(!result.data.isDodged&&!result.data.isKilled&&(0,_utils_rand__WEBPACK_IMPORTED_MODULE_0__.randomBool)()){const secondAttack=this._createAttack(attacker,defender,weapon);attacks.push(secondAttack),defender.fireEvent("attacked",{attack})}return attacks}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>WeaponType});__webpack_require__(66);var _Stats__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(61),_WeaponFamilies__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(104);class WeaponType{constructor(data){this.name=data.name,this.family=data.family,this.key=data.key,this.damageType=data.damageType}weaponDamageText(user,weapon){let text="1d".concat(weapon.die);const str=(0,_Stats__WEBPACK_IMPORTED_MODULE_1__.getStat)(_Stats__WEBPACK_IMPORTED_MODULE_1__.STAT_STRENGTH,user),mod=weapon.modifier+str;return mod&&(text+=mod>0?" + ".concat(mod):" - ".concat(Math.abs(mod))),text}getShortDescription(user,weapon){const fam=(0,_WeaponFamilies__WEBPACK_IMPORTED_MODULE_2__.getWeaponFamilyName)(this.family);return"".concat(fam,", ").concat(this.weaponDamageText(user,weapon))}getAttacks(attacker,defender,weapon){return[]}attack(attacker,defender,weapon){return this.getAttacks(attacker,defender,weapon).map((attack=>{attack.defender.fireEvent("attacked",{attack})}))}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>WpnTypeGreatsword});var _core_Game__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_enums_Directions__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(83),_Attack__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(65),_DamageTypes__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(66),_Stats__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(61),_WeaponFamilies__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(104),_WeaponTypes__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(103),_WeaponType__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(106);class WpnTypeGreatsword extends _WeaponType__WEBPACK_IMPORTED_MODULE_7__.default{constructor(){super({key:_WeaponTypes__WEBPACK_IMPORTED_MODULE_6__.WPN_TYPE_GREATSWORD,name:"Greatsword",family:_WeaponFamilies__WEBPACK_IMPORTED_MODULE_5__.WPN_FAMILY_BLADE,damageType:_DamageTypes__WEBPACK_IMPORTED_MODULE_3__.DMG_TYPE_SLASHING})}_getNeighborAttacks(attacker,defender,weapon,damage){const attackerPos=attacker.position.getPos(),defenderPos=defender.position.getPos(),deltaX=defenderPos.x-attackerPos.x,deltaY=defenderPos.y-attackerPos.y,direction=(0,_enums_Directions__WEBPACK_IMPORTED_MODULE_1__.directionFromDelta)(deltaX,deltaY);return(0,_enums_Directions__WEBPACK_IMPORTED_MODULE_1__.getAdjacentDeltas)(direction.key).map((delta=>_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.map.getEntitiesAt(attackerPos.x+delta.x,attackerPos.y+delta.y))).flat().filter((e=>_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.factions.areEntitiesHostile(e,attacker))).map((hostile=>new _Attack__WEBPACK_IMPORTED_MODULE_2__.default({attacker,ignoreDodge:!0,defender:hostile,weaponName:weapon.name,damage:Math.floor(damage/2),damageType:this.damageType})))}_tryAttackDefender(attacker,defender,weapon,damage){const attack=new _Attack__WEBPACK_IMPORTED_MODULE_2__.default({attacker,defender,weaponName:weapon.name,damage,damageType:this.damageType});return defender.fireEvent("attacked",{attack})}attack(attacker,defender,weapon){const str=(0,_Stats__WEBPACK_IMPORTED_MODULE_4__.getStat)(_Stats__WEBPACK_IMPORTED_MODULE_4__.STAT_STRENGTH,attacker),damage=weapon.roll()+str,result=this._tryAttackDefender(attacker,defender,weapon,damage),attacks=[result];if(!result.data.isDodged){this._getNeighborAttacks(attacker,defender,weapon,damage).forEach((attack=>{attacks.push(attack),attack.defender.fireEvent("attacked",{attack})}))}return attacks}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>WpnTypeMace});var _utils_rand__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(45),_Attack__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(65),_DamageTypes__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(66),_Stats__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(61),_Statuses__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(109),_WeaponFamilies__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(104),_WeaponTypes__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(103),_WeaponType__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(106);class WpnTypeMace extends _WeaponType__WEBPACK_IMPORTED_MODULE_7__.default{constructor(){super({key:_WeaponTypes__WEBPACK_IMPORTED_MODULE_6__.WPN_TYPE_MACE,name:"Mace",family:_WeaponFamilies__WEBPACK_IMPORTED_MODULE_5__.WPN_FAMILY_CUDGEL,damageType:_DamageTypes__WEBPACK_IMPORTED_MODULE_2__.DMG_TYPE_BLUDGEONING})}_createAttack(attacker,defender,weapon){const str=(0,_Stats__WEBPACK_IMPORTED_MODULE_3__.getStat)(_Stats__WEBPACK_IMPORTED_MODULE_3__.STAT_STRENGTH,attacker),damage=weapon.roll()+str;return new _Attack__WEBPACK_IMPORTED_MODULE_1__.default({attacker,defender,weaponName:weapon.name,damage,damageType:this.damageType})}attack(attacker,defender,weapon){const attack=this._createAttack(attacker,defender,weapon),result=defender.fireEvent("attacked",{attack}),attacks=[attack];return result.data.isDodged||result.data.isKilled||!(0,_utils_rand__WEBPACK_IMPORTED_MODULE_0__.randomWeightedBool)(.5)||(0,_Statuses__WEBPACK_IMPORTED_MODULE_4__.addStatus)(_Statuses__WEBPACK_IMPORTED_MODULE_4__.STATUS_STUNNED,defender),attacks}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{STATUS_BLEEDING:()=>STATUS_BLEEDING,STATUS_STUNNED:()=>STATUS_STUNNED,getStatus:()=>getStatus,addStatus:()=>addStatus});var _ecs_components__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(21),_statuses_StatusBleeding__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(110),_statuses_StatusStunned__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(113);const STATUS_BLEEDING="STATUS_BLEEDING",STATUS_STUNNED="STATUS_STUNNED",lookup={STATUS_BLEEDING:new _statuses_StatusBleeding__WEBPACK_IMPORTED_MODULE_1__.default,STATUS_STUNNED:new _statuses_StatusStunned__WEBPACK_IMPORTED_MODULE_2__.default},getStatus=key=>lookup[key],addStatus=(key,entity)=>entity.add(_ecs_components__WEBPACK_IMPORTED_MODULE_0__.Status,{key})},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>StatusBleeding});var _enums_LiquidTypes__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(29),_enums_StatusTypes__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(111),_Spawnables__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(26),_Spawner__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(27),_Statuses__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(109),_Status__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(112);class StatusBleeding extends _Status__WEBPACK_IMPORTED_MODULE_5__.default{constructor(){super(_Statuses__WEBPACK_IMPORTED_MODULE_4__.STATUS_BLEEDING,"Bleeding",_enums_StatusTypes__WEBPACK_IMPORTED_MODULE_1__.STATUS_TYPE_CONDITION,{fg1:"#f42323",fg2:"#411010",bg:null,ch:"s"}),this.isDot=!0}getDmgPerTurn(potency){return 3*potency+.5}getPipCount(potency){return Math.round(2*potency)}update(ticks,entity,status){const tick=Math.min(ticks,status.remainingLifetime()),damage=this.getDmgPerTurn(status.potency)*(tick/1e3);entity.health.applyDamage(damage);const position=entity.position.getPos();(0,_Spawner__WEBPACK_IMPORTED_MODULE_3__.spawn)(_Spawnables__WEBPACK_IMPORTED_MODULE_2__.SPWN_POOL_LIQUID,position.x,position.y,{content:_enums_LiquidTypes__WEBPACK_IMPORTED_MODULE_0__.LIQUID_BLOOD,volume:Math.ceil(6*damage)}),status.lifetime+=tick}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{STATUS_TYPE_CONDITION:()=>STATUS_TYPE_CONDITION});const STATUS_TYPE_CONDITION="STATUS_TYPE_CONDITION"},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Status});class Status{getPipCount(potency){return 0}constructor(key,name,type,glyph){!function(obj,key,value){key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}(this,"isDot",!1),this.key=key,this.name=name,this.type=type,this.glyph=glyph}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>StatusStunned});var _core_Game__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_ecs_components__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(21),_enums_StatusTypes__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(111),_Statuses__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(109),_Status__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(112);class StatusStunned extends _Status__WEBPACK_IMPORTED_MODULE_4__.default{constructor(){super(_Statuses__WEBPACK_IMPORTED_MODULE_3__.STATUS_STUNNED,"Stunned",_enums_StatusTypes__WEBPACK_IMPORTED_MODULE_2__.STATUS_TYPE_CONDITION,{fg1:"#daa53a",fg2:"#f2da97",bg:null,ch:"|"})}update(ticks,entity,status){if(status.lifetime+=ticks,!entity.isIncapacitated){entity.add(_ecs_components__WEBPACK_IMPORTED_MODULE_1__.IsIncapacitated);const pos=entity.position.getPos();_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.particles.createParticle(pos.x,pos.y,{lifetime:140,fg1s:["yellow"],glyphs:["*"]})}status.isCompleted()&&entity.isIncapacitated.destroy()}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>WpnTypeShortsword});var _Attack__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(65),_DamageTypes__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(66),_Stats__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(61),_WeaponFamilies__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(104),_WeaponTypes__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(103),_WeaponType__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(106);class WpnTypeShortsword extends _WeaponType__WEBPACK_IMPORTED_MODULE_5__.default{constructor(){super({key:_WeaponTypes__WEBPACK_IMPORTED_MODULE_4__.WPN_TYPE_SHORTSWORD,name:"Shortsword",family:_WeaponFamilies__WEBPACK_IMPORTED_MODULE_3__.WPN_FAMILY_BLADE,damageType:_DamageTypes__WEBPACK_IMPORTED_MODULE_1__.DMG_TYPE_SLASHING})}getAttacks(attacker,defender,weapon){const str=(0,_Stats__WEBPACK_IMPORTED_MODULE_2__.getStat)(_Stats__WEBPACK_IMPORTED_MODULE_2__.STAT_STRENGTH,attacker),damage=weapon.roll()+str;return[new _Attack__WEBPACK_IMPORTED_MODULE_0__.default({attacker,defender,weaponName:weapon.name,damage,damageType:this.damageType})]}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>WpnTypeUnarmed});var _utils_rand__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(45),_Attack__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(65),_DamageTypes__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(66),_Stats__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(61),_WeaponFamilies__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(104),_WeaponTypes__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(103),_WeaponType__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(106);class WpnTypeUnarmed extends _WeaponType__WEBPACK_IMPORTED_MODULE_6__.default{constructor(){super({key:_WeaponTypes__WEBPACK_IMPORTED_MODULE_5__.WPN_TYPE_UNARMED,name:"Unarmed",family:_WeaponFamilies__WEBPACK_IMPORTED_MODULE_4__.WPN_FAMILY_UNARMED,damageType:_DamageTypes__WEBPACK_IMPORTED_MODULE_2__.DMG_TYPE_BLUDGEONING})}getAttacks(attacker,defender,weapon){const str=(0,_Stats__WEBPACK_IMPORTED_MODULE_3__.getStat)(_Stats__WEBPACK_IMPORTED_MODULE_3__.STAT_STRENGTH,attacker),damage=(0,_utils_rand__WEBPACK_IMPORTED_MODULE_0__.randomInt)(1,4)+str;return[new _Attack__WEBPACK_IMPORTED_MODULE_1__.default({attacker,defender,weaponName:(0,_utils_rand__WEBPACK_IMPORTED_MODULE_0__.pickRandom)(["punch","kick"]),damage,damageType:this.damageType})]}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Stats:()=>Stats});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),rot_js_lib_util__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(117),_data_Stats__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(61);class Stats extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{_sumMods(modifiers){return modifiers.reduce(((sum,cur)=>sum+cur.mod),0)}getStatModifiers(stat){const name=(0,_data_Stats__WEBPACK_IMPORTED_MODULE_2__.getStatName)(stat),modifiers=[];return this.entity.fireEvent("query-stat-modifier-".concat(name),{modifiers}),modifiers}getStatModifierSum(stat){const mods=this.getStatModifiers(stat);return this._sumMods(mods)}data(stat){const name=(0,_data_Stats__WEBPACK_IMPORTED_MODULE_2__.getStatName)(stat),modifiers=this.getStatModifiers(stat),base=this["base".concat((0,rot_js_lib_util__WEBPACK_IMPORTED_MODULE_1__.capitalize)(name))],modSum=this._sumMods(modifiers);return{stat,name,modifiers,base,sum:base+modSum,modSum}}all(){return{strength:this.data(_data_Stats__WEBPACK_IMPORTED_MODULE_2__.STAT_STRENGTH),finesse:this.data(_data_Stats__WEBPACK_IMPORTED_MODULE_2__.STAT_FINESSE),athleticism:this.data(_data_Stats__WEBPACK_IMPORTED_MODULE_2__.STAT_ATHLETICISM),trickery:this.data(_data_Stats__WEBPACK_IMPORTED_MODULE_2__.STAT_TRICKERY)}}strength(){const mod=this.getStatModifierSum(_data_Stats__WEBPACK_IMPORTED_MODULE_2__.STAT_STRENGTH);return this.baseStrength+mod}finesse(){const mod=this.getStatModifierSum(_data_Stats__WEBPACK_IMPORTED_MODULE_2__.STAT_FINESSE);return this.baseFinesse+mod}athleticism(){const mod=this.getStatModifierSum(_data_Stats__WEBPACK_IMPORTED_MODULE_2__.STAT_ATHLETICISM);return this.baseAthleticism+mod}trickery(){const mod=this.getStatModifierSum(_data_Stats__WEBPACK_IMPORTED_MODULE_2__.STAT_TRICKERY);return this.baseTrickery+mod}}value={baseStrength:0,baseFinesse:0,baseAthleticism:0,baseTrickery:0},(key="properties")in(obj=Stats)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function mod(x,n){return(x%n+n)%n}function clamp(val,min=0,max=1){return val<min?min:val>max?max:val}function capitalize(string){return string.charAt(0).toUpperCase()+string.substring(1)}function format(template,...args){let map=format.map;return template.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,(function(match,group1,group2,index){if("%"==template.charAt(index-1))return match.substring(1);if(!args.length)return match;let obj=args[0],parts=(group1||group2).split(","),name=parts.shift()||"",method=map[name.toLowerCase()];if(!method)return match;obj=args.shift();let replaced=obj[method].apply(obj,parts),first=name.charAt(0);return first!=first.toLowerCase()&&(replaced=capitalize(replaced)),replaced}))}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{mod:()=>mod,clamp:()=>clamp,capitalize:()=>capitalize,format:()=>format}),format.map={s:"toString"}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Race:()=>Race});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_data_Skills__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(58),_data_Races__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(119);class Race extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{data(){return(0,_data_Races__WEBPACK_IMPORTED_MODULE_2__.getRaceData)(this.key)}get name(){return this.data().name}get speed(){return this.data().speed}get strengthMod(){return this.data().modStrength}get finesseMod(){return this.data().modFinesse}get athleticismMod(){return this.data().modAthleticism}get trickeryMod(){return this.data().modTrickery}onQueryStatModifierStrength(evt){const mod=this.strengthMod;0!==mod&&evt.data.modifiers.push({source:this.name,mod})}onQueryStatModifierFinesse(evt){const mod=this.finesseMod;0!==mod&&evt.data.modifiers.push({source:this.name,mod})}onQueryStatModifierAthleticism(evt){const mod=this.athleticismMod;0!==mod&&evt.data.modifiers.push({source:this.name,mod})}onQueryStatModifierTrickery(evt){const mod=this.trickeryMod;0!==mod&&evt.data.modifiers.push({source:this.name,mod})}onQuerySkillMod(evt){if(evt.data.skill===_data_Skills__WEBPACK_IMPORTED_MODULE_1__.SKILL_SPEED){const mod=this.speed;evt.data.modifiers.push({source:this.name,mod})}}}obj=Race,key="properties",value={key:_data_Races__WEBPACK_IMPORTED_MODULE_2__.RACE_HUMAN},key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{RACE_HUMAN:()=>RACE_HUMAN,RACE_GOBLIN:()=>RACE_GOBLIN,getRaceData:()=>getRaceData});var _RaceData__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(120);const RACE_HUMAN="RACE_HUMAN",RACE_GOBLIN="RACE_GOBLIN",lookup={[RACE_HUMAN]:new _RaceData__WEBPACK_IMPORTED_MODULE_0__.default({name:"Human",key:RACE_HUMAN,speed:1,modStrength:1,modFinesse:1,modAthleticism:1,modTrickery:1}),[RACE_GOBLIN]:new _RaceData__WEBPACK_IMPORTED_MODULE_0__.default({name:"Goblin",key:RACE_GOBLIN,speed:2,modStrength:-1,modFinesse:2,modAthleticism:1,modTrickery:2})},getRaceData=name=>lookup[name]},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>RaceData});class RaceData{constructor(data){_defineProperty(this,"name",""),_defineProperty(this,"speed",1),_defineProperty(this,"key",1),_defineProperty(this,"modStrength",0),_defineProperty(this,"modFinesse",0),_defineProperty(this,"modAthleticism",0),_defineProperty(this,"modTrickery",0),this.name=data.name||"",this.speed=data.speed||1,this.key=data.key,this.modStrength=data.modStrength||0,this.modFinesse=data.modFinesse||0,this.modAthleticism=data.modAthleticism||0,this.modTrickery=data.modTrickery||0}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Weapon:()=>Weapon});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_data_WeaponTypes__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(103),_utils_rand__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(45);class Weapon extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{get name(){return(0,_data_WeaponTypes__WEBPACK_IMPORTED_MODULE_1__.getWeaponTypeName)(this.weaponType)}get family(){return(0,_data_WeaponTypes__WEBPACK_IMPORTED_MODULE_1__.getWeaponTypeFamily)(this.weaponType)}get damageType(){return(0,_data_WeaponTypes__WEBPACK_IMPORTED_MODULE_1__.getWeaponTypeDmgType)(this.weaponType)}getShortDescription(user){return(0,_data_WeaponTypes__WEBPACK_IMPORTED_MODULE_1__.getWeaponType)(this.weaponType).getShortDescription(user,this)}roll(){return(0,_utils_rand__WEBPACK_IMPORTED_MODULE_2__.randomInt)(1,this.die)+this.modifier}onTryUseMelee(evt){(0,_data_WeaponTypes__WEBPACK_IMPORTED_MODULE_1__.getWeaponType)(this.weaponType).attack(evt.data.interactor,evt.data.target,this),evt.data.interactor.fireEvent("energy-consumed",this.cost),evt.handle()}}value={weaponType:"WPN_TYPE_DAGGER",die:6,modifier:0,cost:600},(key="properties")in(obj=Weapon)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Status:()=>Status});var geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_data_Statuses__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(109);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class Status extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{remainingLifetime(){return this.duration-this.lifetime}isCompleted(){return this.lifetime>=this.duration}}_defineProperty(Status,"allowMultiple",!0),_defineProperty(Status,"properties",{key:_data_Statuses__WEBPACK_IMPORTED_MODULE_1__.STATUS_BLEEDING,duration:4e3,lifetime:0,potency:.5})},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Ground:()=>Ground});var geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23);class Ground extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{IsIncapacitated:()=>IsIncapacitated});var geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23);class IsIncapacitated extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{SharpTrap:()=>SharpTrap});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_data_Stats__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(61);class SharpTrap extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{test(entity){return(0,_data_Stats__WEBPACK_IMPORTED_MODULE_1__.statCheck)(_data_Stats__WEBPACK_IMPORTED_MODULE_1__.STAT_FINESSE,entity,this.challenge)}}value={challenge:15},(key="properties")in(obj=SharpTrap)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{EquippedSkillMod:()=>EquippedSkillMod});var geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class EquippedSkillMod extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{onQuerySkillModEquipped(evt){const mod=this[evt.data.skill];mod&&evt.data.modifiers.push({source:this.entity.moniker.name,mod})}}_defineProperty(EquippedSkillMod,"allowMultiple",!0),_defineProperty(EquippedSkillMod,"properties",{SKILL_ARMOR:0,SKILL_SPEED:0,SKILL_THROWING:0,SKILL_DODGE:0})},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Combustible:()=>Combustible});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_core_Game__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),_utils_rand__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(45),_Fire__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(128);class Combustible extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{get isOnFire(){return!!this.entity.fire}get isOutOfFuel(){return this.fuel<=0}getTemperature(){const pos=this.entity.position.getPos();return _core_Game__WEBPACK_IMPORTED_MODULE_1__.game.temperature.getTemperature(pos.x,pos.y)}setTemperature(value){const pos=this.entity.position.getPos();return _core_Game__WEBPACK_IMPORTED_MODULE_1__.game.temperature.setTemperature(pos.x,pos.y,value)}getDieOutChance(){return.01}getSparkChance(){return this.getTemperature()/1e3}getCatchChance(intensity){if(this.fuel<=0)return 0;return this.getTemperature()*intensity/1e3}onSpark(evt){if(this.isOnFire)return;const intensity=evt.data.intensity;(0,_utils_rand__WEBPACK_IMPORTED_MODULE_2__.randomWeightedBool)(this.getCatchChance(intensity))&&(this.entity.add(_Fire__WEBPACK_IMPORTED_MODULE_3__.Fire,{intensity}),this.setTemperature(this.flashPoint))}onTryIgnite(evt){this.entity.add(_Fire__WEBPACK_IMPORTED_MODULE_3__.Fire,{intensity:3}),this.setTemperature(this.flashPoint)}onGetInteractions(evt){this.isOnFire||this.entity.isInventoried||evt.data.interactions.push({name:"Ignite",evt:"try-ignite",intensity:3})}}value={fuel:200,flashPoint:200,spawnableRemains:null,burnRate:5},(key="properties")in(obj=Combustible)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Fire:()=>Fire});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23);class Fire extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{extinguish(){this.destroy()}onTryExtinguish(evt){this.extinguish()}onGetInteractions(evt){evt.data.interactions.push({name:"Extinguish",evt:"try-extinguish"})}}value={intensity:3},(key="properties")in(obj=Fire)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ThermalCapacity:()=>ThermalCapacity});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23);class ThermalCapacity extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{}value={value:.5},(key="properties")in(obj=ThermalCapacity)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Abilities:()=>Abilities});var obj,key,value,geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23);class Abilities extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{onQueryAbilities(evt){evt.data.abilities.push(...this.known)}}value={known:[],state:{}},(key="properties")in(obj=Abilities)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{AbilityStatus:()=>AbilityStatus});var geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_data_Abilities__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(132);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class AbilityStatus extends geotic__WEBPACK_IMPORTED_MODULE_0__.Component{get ability(){return(0,_data_Abilities__WEBPACK_IMPORTED_MODULE_1__.getAbility)(this.key)}get remainingCooldownDuration(){return this.isCoolingDown?this.cooldownDuration-this.currentCooldownDuration:1/0}get remainingToggleDuration(){return!this.isToggledOn||this.isCoolingDown?0:this.toggleDuration-this.currentToggleDuration}get isToggleDurationComplete(){return this.currentToggleDuration>=this.toggleDuration}get isCooldownComplete(){return this.isCoolingDown&&this.currentCooldownDuration>=this.cooldownDuration}startCooldown(){this.isCoolingDown=!0,this.isToggledOn=!1}onQuerySkillMod(evt){if(this.isCoolingDown)return;const mod=this.ability.getSkillMod(evt.data.skill,this);mod&&evt.data.modifiers.push({source:this.ability.name,mod})}onQueryStatMod(evt){if(this.isCoolingDown)return;const mod=this.ability.getStatMod(evt.data.stat,this);mod&&evt.data.modifiers.push({source:this.ability.name,mod})}}_defineProperty(AbilityStatus,"allowMultiple",!0),_defineProperty(AbilityStatus,"keyProperty","key"),_defineProperty(AbilityStatus,"properties",{key:"ABILITY_SPRINT",isCoolingDown:!1,isToggledOn:!0,cooldownDuration:5e4,currentCooldownDuration:0,toggleDuration:1e4,currentToggleDuration:0,abilityMods:[]})},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ABILITY_SPRINT:()=>ABILITY_SPRINT,ABILITY_RAGE:()=>ABILITY_RAGE,getAbility:()=>getAbility,getAbilityStatus:()=>getAbilityStatus});var _abilities_stances_RageAbility__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(133),_abilities_stances_SprintAbility__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(137);const ABILITY_SPRINT="ABILITY_SPRINT",ABILITY_RAGE="ABILITY_RAGE",lookup={ABILITY_SPRINT:new _abilities_stances_SprintAbility__WEBPACK_IMPORTED_MODULE_1__.default,ABILITY_RAGE:new _abilities_stances_RageAbility__WEBPACK_IMPORTED_MODULE_0__.default},getAbility=key=>lookup[key],getAbilityStatus=(key,entity)=>{if(entity.abilityStatus)return entity.abilityStatus[key]}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>RageAbility});var _enums_AbilityTypes__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(134),_Abilities__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(132),_Stats__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(61),_SimpleToggledAbility__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(135);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class RageAbility extends _SimpleToggledAbility__WEBPACK_IMPORTED_MODULE_3__.default{constructor(...args){super(...args),_defineProperty(this,"key",_Abilities__WEBPACK_IMPORTED_MODULE_1__.ABILITY_RAGE),_defineProperty(this,"type",_enums_AbilityTypes__WEBPACK_IMPORTED_MODULE_0__.ABILITY_TYPE_STANCE),_defineProperty(this,"name","Rage"),_defineProperty(this,"description","Gain bonus STR"),_defineProperty(this,"isToggleable",!0)}computeStrengthMod(entity){return 6}getToggleDuration(entity){return 2e4}getCooldownDuration(entity){return 5e4}getDescription(entity){const str=this.computeStrengthMod(entity);return"Gain +".concat(str," strength.")}getStatMod(stat,status){return stat===_Stats__WEBPACK_IMPORTED_MODULE_2__.STAT_STRENGTH?this.computeStrengthMod(status.entity):0}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ABILITY_TYPE_STANCE:()=>ABILITY_TYPE_STANCE,ABILITY_TYPE_SHOUT:()=>ABILITY_TYPE_SHOUT,ABILITY_TYPE_STUNT:()=>ABILITY_TYPE_STUNT,getAbilityTypeName:()=>getAbilityTypeName});const ABILITY_TYPE_STANCE=0,ABILITY_TYPE_SHOUT=1,ABILITY_TYPE_STUNT=2,lookup={[ABILITY_TYPE_STANCE]:{name:"Stance"},[ABILITY_TYPE_SHOUT]:{name:"Shout"},[ABILITY_TYPE_STUNT]:{name:"Stunt"}},getAbilityTypeName=key=>lookup[key].name},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>SimpleToggledAbility});var _ecs_components_AbilityStatus__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(131),_Abilities__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(132),_Ability__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(136);class SimpleToggledAbility extends _Ability__WEBPACK_IMPORTED_MODULE_2__.default{constructor(...args){var obj,key,value;super(...args),value=!0,(key="isToggleable")in(obj=this)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}getToggleDuration(entity){return 2e4}getCooldownDuration(entity){return 5e4}execute(entity,data){const status=(0,_Abilities__WEBPACK_IMPORTED_MODULE_1__.getAbilityStatus)(this.key,entity);return status?!!status.isToggledOn&&(status.startCooldown(),!0):(entity.add(_ecs_components_AbilityStatus__WEBPACK_IMPORTED_MODULE_0__.AbilityStatus,{key:this.key,isToggledOn:!0,isCoolingDown:!1,maxToggleDuration:this.getToggleDuration(entity),cooldownDuration:this.getCooldownDuration(entity)}),!0)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Ability});var _Abilities__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(132);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class Ability{getDescription(entity){return""}constructor(key,type,name){_defineProperty(this,"key",""),_defineProperty(this,"type",0),_defineProperty(this,"name",""),_defineProperty(this,"description",""),_defineProperty(this,"isToggleable",!1),this.key=key,this.type=type,this.name=name}initiate(entity){}execute(entity,data){}updateAbilityStatus(dt,status){}getSkillMod(skill,status){return 0}getStatMod(stat,status){return 0}updateAbilityStatus(dt,status){status.isCoolingDown?status.currentCooldownDuration+=dt:status.isToggleDurationComplete&&status.startCooldown(),status.isToggledOn&&(status.currentToggleDuration+=dt),status.isCooldownComplete&&status.destroy()}getDisplayText(entity){const status=(0,_Abilities__WEBPACK_IMPORTED_MODULE_0__.getAbilityStatus)(this.key,entity);if(status&&status.isCoolingDown){const cd=(status.remainingCooldownDuration/1e3).toFixed(1);return{text:"".concat(this.name," [").concat(cd,"]"),isEnabled:!1}}return this.isToggleable?status&&status.isToggledOn?{text:"".concat(this.name," [toggle OFF]"),isEnabled:!0}:{text:"".concat(this.name," [toggle ON]"),isEnabled:!0}:{text:this.name,isEnabled:!0}}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>SprintAbility});var _enums_AbilityTypes__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(134),_Abilities__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(132),_Skills__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(58),_Stats__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(61),_SimpleToggledAbility__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(135);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class SprintAbility extends _SimpleToggledAbility__WEBPACK_IMPORTED_MODULE_4__.default{constructor(...args){super(...args),_defineProperty(this,"key",_Abilities__WEBPACK_IMPORTED_MODULE_1__.ABILITY_SPRINT),_defineProperty(this,"type",_enums_AbilityTypes__WEBPACK_IMPORTED_MODULE_0__.ABILITY_TYPE_STANCE),_defineProperty(this,"name","Sprint"),_defineProperty(this,"description","Gain bonus move speed"),_defineProperty(this,"isToggleable",!0)}computeSpeedMod(entity){return 5+2*(0,_Stats__WEBPACK_IMPORTED_MODULE_3__.getStat)(_Stats__WEBPACK_IMPORTED_MODULE_3__.STAT_ATHLETICISM,entity)}getToggleDuration(entity){return 2e4}getCooldownDuration(entity){return 5e4}getDescription(entity){const speed=this.computeSpeedMod(entity);return"Gain +".concat(speed," move speed. [ATH]")}getSkillMod(skill,status){return skill===_Skills__WEBPACK_IMPORTED_MODULE_2__.SKILL_SPEED?this.computeSpeedMod(status.entity):0}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>System});var _game=new WeakMap;class System{get game(){return function(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}(this,_game)}constructor(game){_game.set(this,{writable:!0,value:null}),function(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}}(this,_game,game)}update(dt){}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>RenderSystem});var _core_Game__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_utils_ColorUtil__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(15),_System__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(138);const modeLookup={0:(x,y,e)=>{e.isVisible?_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.renderer.draw(x,y,e.glyph.char,e.glyph.primary,e.glyph.secondary,e.glyph.background):e.explored&&_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.renderer.draw(x,y,e.glyph.char,"#2c3538","#2c3538")},1:(x,y,e,worldX,worldY)=>{const temp=_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.temperature.getTemperature(worldX,worldY)/200,bg=(v=>{const rgb=(0,_utils_ColorUtil__WEBPACK_IMPORTED_MODULE_1__.lerpHSL)([216,40,50],[0,80,50],Math.sqrt(v));return"rgb(".concat(rgb[0],",").concat(rgb[1],",").concat(rgb[2],")")})(Math.min(1,temp));e.isVisible?_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.renderer.draw(x,y,e.glyph.char,e.glyph.primary,e.glyph.secondary,bg):_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.renderer.draw(x,y,e.glyph.char,"#2c3538","#2c3538",bg)}};class RenderSystem extends _System__WEBPACK_IMPORTED_MODULE_2__.default{constructor(...args){var obj,key,value;super(...args),value=0,(key="mode")in(obj=this)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}renderTile(x,y){const world=this.game.camera.screenToWorld(x,y);if(!this.game.camera.isInView(world.x,world.y))return;const entities=this.game.map.getEntitiesAt(world.x,world.y,!0).filter((e=>e.glyph&&!e.isInventoried&&!e.isDestroying));if(entities.length<=0)return;let renderableZ=-1,renderable=null;entities.forEach((e=>{e.glyph.z>=renderableZ&&(renderable=e,renderableZ=e.glyph.z)})),modeLookup[this.mode](x,y,renderable,world.x,world.y)}render(dt){this.game.renderer.clear();for(let x=0;x<this.game.camera.width;x++)for(let y=0;y<this.game.camera.height;y++)this.renderTile(x,y)}update(dt){this.render()}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>UISystem});var _data_Statuses__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(109),_ecs_components__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(21),_System__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(138);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class UISystem extends _System__WEBPACK_IMPORTED_MODULE_2__.default{constructor(game){super(game),_defineProperty(this,"showTicks",!1),_defineProperty(this,"beingsQuery",null),this.beingsQuery=this.game.ecs.createQuery({all:[_ecs_components__WEBPACK_IMPORTED_MODULE_1__.Moniker,_ecs_components__WEBPACK_IMPORTED_MODULE_1__.Actor,_ecs_components__WEBPACK_IMPORTED_MODULE_1__.IsVisible],none:[_ecs_components__WEBPACK_IMPORTED_MODULE_1__.IsInventoried]})}renderNearbyCreatures(){const beings=this.beingsQuery.get();let offsetY=1;beings.forEach((entity=>{let moniker=entity.moniker.display,glyphOffset=1;if(entity.factionMember){const relation=this.game.factions.getEntityRelation(game.player.entity,entity),glyph=this.game.factions.getAttitudeGlyph(relation);this.game.renderer.drawUI(1,offsetY,glyph.char,glyph.fg1,glyph.fg2),glyphOffset+=1.5}this.game.renderer.drawText(glyphOffset,offsetY,moniker);let statusOffset=this.game.renderer.computeTextWidth(moniker)+glyphOffset+.5,dotLevel=0;if(entity.status&&entity.status.forEach((status=>{const statusType=(0,_data_Statuses__WEBPACK_IMPORTED_MODULE_0__.getStatus)(status.key);dotLevel+=statusType.getPipCount(status.potency),this.game.renderer.drawUI(statusOffset,offsetY,statusType.glyph.ch,statusType.glyph.fg1,statusType.glyph.fg2),statusOffset++})),dotLevel=Math.min(3,dotLevel),entity.health){offsetY++;const health=entity.health,barWidth=8,prcnt=health.value/health.max,healthWidth=Math.ceil(prcnt*barWidth*2)/2,middle=Math.floor(barWidth/2)-1,primaryHP="#803636",secondaryHp="#352323";for(let i=0;i<barWidth;i++){const diff=healthWidth-i;dotLevel&&i===middle?.5===diff?1===dotLevel?this.game.renderer.drawUI(i+1,offsetY,"#",primaryHP,secondaryHp):2===dotLevel?this.game.renderer.drawUI(i+1,offsetY,'"',primaryHP,secondaryHp):3===dotLevel&&this.game.renderer.drawUI(i+1,offsetY,"!",primaryHP,secondaryHp):diff>0?1===dotLevel?this.game.renderer.drawUI(i+1,offsetY,"‼",primaryHP,secondaryHp):2===dotLevel?this.game.renderer.drawUI(i+1,offsetY,"↕",primaryHP,secondaryHp):3===dotLevel&&this.game.renderer.drawUI(i+1,offsetY,"◄",primaryHP,secondaryHp):1===dotLevel?this.game.renderer.drawUI(i+1,offsetY,"‼",secondaryHp,primaryHP):2===dotLevel?this.game.renderer.drawUI(i+1,offsetY,"↕",secondaryHp,primaryHP):3===dotLevel&&this.game.renderer.drawUI(i+1,offsetY,"◄",secondaryHp,primaryHP):.5===diff?this.game.renderer.drawUI(i+1,offsetY," ",primaryHP,secondaryHp):diff>0?this.game.renderer.drawUI(i+1,offsetY,"►",primaryHP,secondaryHp):this.game.renderer.drawUI(i+1,offsetY,"►",secondaryHp)}}offsetY++}))}update(dt){if(this.showTicks){const turn=this.game.clock.turn,subTurn="".concat(this.game.clock.subTurn.toFixed(0)).padEnd(3,"0"),str="".concat(turn,".").concat(subTurn),len=Math.ceil(this.game.renderer.computeTextWidth(str));this.game.renderer.drawText(this.game.camera.width-1-len,1,str)}this.renderNearbyCreatures()}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>MouseManager});var _Manager__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5);function _classPrivateFieldSet(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}return value}function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}var _x=new WeakMap,_y=new WeakMap,_hasMouse=new WeakMap;class MouseManager extends _Manager__WEBPACK_IMPORTED_MODULE_0__.default{constructor(...args){super(...args),_x.set(this,{writable:!0,value:0}),_y.set(this,{writable:!0,value:0}),_hasMouse.set(this,{writable:!0,value:!1})}get x(){return _classPrivateFieldGet(this,_x)}get y(){return _classPrivateFieldGet(this,_y)}get hasMouse(){return _classPrivateFieldGet(this,_hasMouse)}updatePosition(x,y){_classPrivateFieldSet(this,_x,Math.max(0,x)),_classPrivateFieldSet(this,_y,Math.max(0,y))}updateMouseEnter(){_classPrivateFieldSet(this,_hasMouse,!0)}updateMouseLeave(){_classPrivateFieldSet(this,_hasMouse,!1)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>CommandManager});var _InputDomainType__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(143),_commands__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(144),_Manager__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(5);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class CommandManager extends _Manager__WEBPACK_IMPORTED_MODULE_2__.default{constructor(game){super(game),_defineProperty(this,"_commands",{}),_defineProperty(this,"_domainStack",[_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT]),_defineProperty(this,"_inputStack",[]),_commands__WEBPACK_IMPORTED_MODULE_1__.default.forEach((cmd=>this.registerCommand(cmd)))}onInputEvent(evt){this._inputStack.push(evt)}getNextCommand(){const evt=this._inputStack.shift();if(evt)return this.getCommandForInputEvent(evt)}pushDomain(domain){this._domainStack.push(domain)}popDomain(domain){const index=this._domainStack.lastIndexOf(domain);index>-1&&this._domainStack.splice(index,1)}getDomainCommands(domain){return this._commands[domain]||[]}getCommandForInputEvent(evt){for(let i=this._domainStack.length-1;i>=0;i--){const domain=this._domainStack[i],cmd=this.getDomainCommands(domain).find((cmd=>cmd.matches(evt)));if(cmd)return cmd}}registerCommand(command){this._commands[command.domain]||(this._commands[command.domain]=[]),this._commands[command.domain].push(command)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{INPUT_DOMAIN_DEFAULT:()=>INPUT_DOMAIN_DEFAULT,INPUT_DOMAIN_MAIN_MENU:()=>INPUT_DOMAIN_MAIN_MENU,INPUT_DOMAIN_ADVENTURE:()=>INPUT_DOMAIN_ADVENTURE,INPUT_DOMAIN_LOOK:()=>INPUT_DOMAIN_LOOK,INPUT_DOMAIN_LIST:()=>INPUT_DOMAIN_LIST});const INPUT_DOMAIN_DEFAULT=0,INPUT_DOMAIN_MAIN_MENU=1,INPUT_DOMAIN_ADVENTURE=2,INPUT_DOMAIN_LOOK=3,INPUT_DOMAIN_LIST=4},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _InputDomainType__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(143),_InputCommand__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(145),_InputCommandType__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(146),_KeyCodes__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(147);const cmd=(domain,type,name,isKeyboard,key,shift,ctrl,alt,meta)=>new _InputCommand__WEBPACK_IMPORTED_MODULE_1__.default({domain,type,name,isKeyboard,key,shift,ctrl,alt,meta}),__WEBPACK_DEFAULT_EXPORT__=[cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_CONFIRM,"confirm",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_ENTER,!1,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_CONFIRM,"confirm2",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_SPACE,!1,!0,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_CANCEL,"cancel",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_ESCAPE,!1,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_MAIN_MENU,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_SAVE,"save",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_S,!1,!0,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_MAIN_MENU,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_LOAD,"load",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_L,!1,!0,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_MAIN_MENU,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_NEW_GAME,"new game",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_N,!1,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_ADVENTURE,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_WAIT,"wait",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_S,!1,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_MOVE_NW,"move nw",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_Q,!1,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_MOVE_N,"move n",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_W,!1,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_MOVE_N,"move n2",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_UP,!1,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_MOVE_NE,"move ne",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_E,!1,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_MOVE_W,"move w",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_A,!1,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_MOVE_W,"move w2",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_LEFT,!1,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_MOVE_E,"move e",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_D,!1,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_MOVE_E,"move e2",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_RIGHT,!1,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_MOVE_SW,"move sw",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_Z,!1,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_MOVE_S,"move s",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_X,!1,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_MOVE_S,"move s2",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_DOWN,!1,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_MOVE_SE,"move se",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_C,!1,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_SELECT_NW,"select nw",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_Q,!0,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_SELECT_N,"select n",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_W,!0,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_SELECT_N,"select n2",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_UP,!0,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_SELECT_NE,"select ne",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_E,!0,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_SELECT_W,"select w",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_A,!0,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_SELECT_W,"select w2",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_LEFT,!0,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_SELECT_E,"select e",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_D,!0,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_SELECT_E,"select e2",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_RIGHT,!0,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_SELECT_SW,"select sw",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_Z,!0,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_SELECT_S,"select s",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_X,!0,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_SELECT_S,"select s2",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_DOWN,!0,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_SELECT_SE,"select se",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_C,!0,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_DEFAULT,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_INTERACT,"select",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_S,!0,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_ADVENTURE,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_LOOK,"look",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_L,!1,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_ADVENTURE,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_PICK_UP,"pick up",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_G,!1,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_ADVENTURE,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_INTERACT,"interact",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_J,!1,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_ADVENTURE,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_INVENTORY,"inventory",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_I,!1,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_ADVENTURE,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_EQUIPMENT,"equipment",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_P,!1,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_ADVENTURE,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_CHARACTER,"character",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_Y,!1,!1,!1,!1),cmd(_InputDomainType__WEBPACK_IMPORTED_MODULE_0__.INPUT_DOMAIN_ADVENTURE,_InputCommandType__WEBPACK_IMPORTED_MODULE_2__.INPUT_CMD_ABILITIES,"abilities",!0,_KeyCodes__WEBPACK_IMPORTED_MODULE_3__.KEY_T,!1,!1,!1,!1)]},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>InputCommand});var _events_InputEvent__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(18);class InputCommand{constructor(data){this.domain=data.domain,this.type=data.type,this.name=data.name,this.isKeyboard=data.isKeyboard,this.key=data.key,this.shift=data.shift,this.ctrl=data.ctrl,this.alt=data.alt,this.meta=data.meta}matches(inputEvent){const isKeyboard=inputEvent instanceof _events_InputEvent__WEBPACK_IMPORTED_MODULE_0__.default;return this.isKeyboard==isKeyboard&&this.key==inputEvent.key&&this.shift==inputEvent.shift&&this.ctrl==inputEvent.ctrl&&this.alt==inputEvent.alt&&this.meta==inputEvent.meta}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{INPUT_CMD_MOVE_NW:()=>INPUT_CMD_MOVE_NW,INPUT_CMD_MOVE_N:()=>INPUT_CMD_MOVE_N,INPUT_CMD_MOVE_NE:()=>INPUT_CMD_MOVE_NE,INPUT_CMD_MOVE_W:()=>INPUT_CMD_MOVE_W,INPUT_CMD_MOVE_E:()=>INPUT_CMD_MOVE_E,INPUT_CMD_MOVE_SW:()=>INPUT_CMD_MOVE_SW,INPUT_CMD_MOVE_S:()=>INPUT_CMD_MOVE_S,INPUT_CMD_MOVE_SE:()=>INPUT_CMD_MOVE_SE,INPUT_CMD_WAIT:()=>INPUT_CMD_WAIT,INPUT_CMD_CONFIRM:()=>INPUT_CMD_CONFIRM,INPUT_CMD_CANCEL:()=>INPUT_CMD_CANCEL,INPUT_CMD_SAVE:()=>INPUT_CMD_SAVE,INPUT_CMD_LOAD:()=>INPUT_CMD_LOAD,INPUT_CMD_LOOK:()=>INPUT_CMD_LOOK,INPUT_CMD_PICK_UP:()=>INPUT_CMD_PICK_UP,INPUT_CMD_INTERACT:()=>INPUT_CMD_INTERACT,INPUT_CMD_INVENTORY:()=>INPUT_CMD_INVENTORY,INPUT_CMD_SELECT_NW:()=>INPUT_CMD_SELECT_NW,INPUT_CMD_SELECT_N:()=>INPUT_CMD_SELECT_N,INPUT_CMD_SELECT_NE:()=>INPUT_CMD_SELECT_NE,INPUT_CMD_SELECT_W:()=>INPUT_CMD_SELECT_W,INPUT_CMD_SELECT_E:()=>INPUT_CMD_SELECT_E,INPUT_CMD_SELECT_SW:()=>INPUT_CMD_SELECT_SW,INPUT_CMD_SELECT_S:()=>INPUT_CMD_SELECT_S,INPUT_CMD_SELECT_SE:()=>INPUT_CMD_SELECT_SE,INPUT_CMD_NEW_GAME:()=>INPUT_CMD_NEW_GAME,INPUT_CMD_EQUIPMENT:()=>INPUT_CMD_EQUIPMENT,INPUT_CMD_CHARACTER:()=>INPUT_CMD_CHARACTER,INPUT_CMD_ABILITIES:()=>INPUT_CMD_ABILITIES});const INPUT_CMD_MOVE_NW=0,INPUT_CMD_MOVE_N=1,INPUT_CMD_MOVE_NE=2,INPUT_CMD_MOVE_W=3,INPUT_CMD_MOVE_E=4,INPUT_CMD_MOVE_SW=5,INPUT_CMD_MOVE_S=6,INPUT_CMD_MOVE_SE=7,INPUT_CMD_WAIT=8,INPUT_CMD_CONFIRM=9,INPUT_CMD_CANCEL=10,INPUT_CMD_SAVE=11,INPUT_CMD_LOAD=12,INPUT_CMD_LOOK=13,INPUT_CMD_PICK_UP=16,INPUT_CMD_INTERACT=17,INPUT_CMD_INVENTORY=19,INPUT_CMD_SELECT_NW=20,INPUT_CMD_SELECT_N=21,INPUT_CMD_SELECT_NE=22,INPUT_CMD_SELECT_W=23,INPUT_CMD_SELECT_E=24,INPUT_CMD_SELECT_SW=25,INPUT_CMD_SELECT_S=26,INPUT_CMD_SELECT_SE=27,INPUT_CMD_NEW_GAME=28,INPUT_CMD_EQUIPMENT=29,INPUT_CMD_CHARACTER=30,INPUT_CMD_ABILITIES=31},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{KEY_CANCEL:()=>KEY_CANCEL,KEY_HELP:()=>KEY_HELP,KEY_BACK_SPACE:()=>KEY_BACK_SPACE,KEY_TAB:()=>KEY_TAB,KEY_CLEAR:()=>KEY_CLEAR,KEY_ENTER:()=>KEY_ENTER,KEY_ENTER_SPECIAL:()=>KEY_ENTER_SPECIAL,KEY_SHIFT:()=>KEY_SHIFT,KEY_CONTROL:()=>KEY_CONTROL,KEY_ALT:()=>KEY_ALT,KEY_PAUSE:()=>KEY_PAUSE,KEY_CAPS_LOCK:()=>KEY_CAPS_LOCK,KEY_KANA:()=>KEY_KANA,KEY_EISU:()=>KEY_EISU,KEY_JUNJA:()=>KEY_JUNJA,KEY_FINAL:()=>KEY_FINAL,KEY_HANJA:()=>KEY_HANJA,KEY_ESCAPE:()=>KEY_ESCAPE,KEY_CONVERT:()=>KEY_CONVERT,KEY_NONCONVERT:()=>KEY_NONCONVERT,KEY_ACCEPT:()=>KEY_ACCEPT,KEY_MODECHANGE:()=>KEY_MODECHANGE,KEY_SPACE:()=>KEY_SPACE,KEY_PAGE_UP:()=>KEY_PAGE_UP,KEY_PAGE_DOWN:()=>KEY_PAGE_DOWN,KEY_END:()=>KEY_END,KEY_HOME:()=>KEY_HOME,KEY_LEFT:()=>KEY_LEFT,KEY_UP:()=>KEY_UP,KEY_RIGHT:()=>KEY_RIGHT,KEY_DOWN:()=>KEY_DOWN,KEY_SELECT:()=>KEY_SELECT,KEY_PRINT:()=>KEY_PRINT,KEY_EXECUTE:()=>KEY_EXECUTE,KEY_PRINTSCREEN:()=>KEY_PRINTSCREEN,KEY_INSERT:()=>KEY_INSERT,KEY_DELETE:()=>KEY_DELETE,KEY_NUM_0:()=>KEY_NUM_0,KEY_NUM_1:()=>KEY_NUM_1,KEY_NUM_2:()=>KEY_NUM_2,KEY_NUM_3:()=>KEY_NUM_3,KEY_NUM_4:()=>KEY_NUM_4,KEY_NUM_5:()=>KEY_NUM_5,KEY_NUM_6:()=>KEY_NUM_6,KEY_NUM_7:()=>KEY_NUM_7,KEY_NUM_8:()=>KEY_NUM_8,KEY_NUM_9:()=>KEY_NUM_9,KEY_COLON:()=>KEY_COLON,KEY_SEMICOLON:()=>KEY_SEMICOLON,KEY_LESS_THAN:()=>KEY_LESS_THAN,KEY_EQUALS:()=>KEY_EQUALS,KEY_GREATER_THAN:()=>KEY_GREATER_THAN,KEY_QUESTION_MARK:()=>KEY_QUESTION_MARK,KEY_AT:()=>KEY_AT,KEY_A:()=>KEY_A,KEY_B:()=>KEY_B,KEY_C:()=>KEY_C,KEY_D:()=>KEY_D,KEY_E:()=>KEY_E,KEY_F:()=>KEY_F,KEY_G:()=>KEY_G,KEY_H:()=>KEY_H,KEY_I:()=>KEY_I,KEY_J:()=>KEY_J,KEY_K:()=>KEY_K,KEY_L:()=>KEY_L,KEY_M:()=>KEY_M,KEY_N:()=>KEY_N,KEY_O:()=>KEY_O,KEY_P:()=>KEY_P,KEY_Q:()=>KEY_Q,KEY_R:()=>KEY_R,KEY_S:()=>KEY_S,KEY_T:()=>KEY_T,KEY_U:()=>KEY_U,KEY_V:()=>KEY_V,KEY_W:()=>KEY_W,KEY_X:()=>KEY_X,KEY_Y:()=>KEY_Y,KEY_Z:()=>KEY_Z,KEY_META:()=>KEY_META,KEY_CONTEXT_MENU:()=>KEY_CONTEXT_MENU,KEY_SLEEP:()=>KEY_SLEEP,KEY_NUMPAD_0:()=>KEY_NUMPAD_0,KEY_NUMPAD_1:()=>KEY_NUMPAD_1,KEY_NUMPAD_2:()=>KEY_NUMPAD_2,KEY_NUMPAD_3:()=>KEY_NUMPAD_3,KEY_NUMPAD_4:()=>KEY_NUMPAD_4,KEY_NUMPAD_5:()=>KEY_NUMPAD_5,KEY_NUMPAD_6:()=>KEY_NUMPAD_6,KEY_NUMPAD_7:()=>KEY_NUMPAD_7,KEY_NUMPAD_8:()=>KEY_NUMPAD_8,KEY_NUMPAD_9:()=>KEY_NUMPAD_9,KEY_MULTIPLY:()=>KEY_MULTIPLY,KEY_ADD:()=>KEY_ADD,KEY_SEPARATOR:()=>KEY_SEPARATOR,KEY_SUBTRACT:()=>KEY_SUBTRACT,KEY_DECIMAL:()=>KEY_DECIMAL,KEY_DIVIDE:()=>KEY_DIVIDE,KEY_F1:()=>KEY_F1,KEY_F2:()=>KEY_F2,KEY_F3:()=>KEY_F3,KEY_F4:()=>KEY_F4,KEY_F5:()=>KEY_F5,KEY_F6:()=>KEY_F6,KEY_F7:()=>KEY_F7,KEY_F8:()=>KEY_F8,KEY_F9:()=>KEY_F9,KEY_F10:()=>KEY_F10,KEY_F11:()=>KEY_F11,KEY_F12:()=>KEY_F12,KEY_F13:()=>KEY_F13,KEY_F14:()=>KEY_F14,KEY_F15:()=>KEY_F15,KEY_F16:()=>KEY_F16,KEY_F17:()=>KEY_F17,KEY_F18:()=>KEY_F18,KEY_F19:()=>KEY_F19,KEY_F20:()=>KEY_F20,KEY_F21:()=>KEY_F21,KEY_F22:()=>KEY_F22,KEY_F23:()=>KEY_F23,KEY_F24:()=>KEY_F24,KEY_NUM_LOCK:()=>KEY_NUM_LOCK,KEY_SCROLL_LOCK:()=>KEY_SCROLL_LOCK,KEY_WIN_OEM_FJ_JISHO:()=>KEY_WIN_OEM_FJ_JISHO,KEY_WIN_OEM_FJ_MASSHOU:()=>KEY_WIN_OEM_FJ_MASSHOU,KEY_WIN_OEM_FJ_TOUROKU:()=>KEY_WIN_OEM_FJ_TOUROKU,KEY_WIN_OEM_FJ_LOYA:()=>KEY_WIN_OEM_FJ_LOYA,KEY_WIN_OEM_FJ_ROYA:()=>KEY_WIN_OEM_FJ_ROYA,KEY_CIRCUMFLEX:()=>KEY_CIRCUMFLEX,KEY_EXCLAMATION:()=>KEY_EXCLAMATION,KEY_DOUBLE_QUOTE:()=>KEY_DOUBLE_QUOTE,KEY_HASH:()=>KEY_HASH,KEY_DOLLAR:()=>KEY_DOLLAR,KEY_PERCENT:()=>KEY_PERCENT,KEY_AMPERSAND:()=>KEY_AMPERSAND,KEY_UNDERSCORE:()=>KEY_UNDERSCORE,KEY_OPEN_PAREN:()=>KEY_OPEN_PAREN,KEY_CLOSE_PAREN:()=>KEY_CLOSE_PAREN,KEY_ASTERISK:()=>KEY_ASTERISK,KEY_PLUS:()=>KEY_PLUS,KEY_PIPE:()=>KEY_PIPE,KEY_HYPHEN_MINUS:()=>KEY_HYPHEN_MINUS,KEY_OPEN_CURLY_BRACKET:()=>KEY_OPEN_CURLY_BRACKET,KEY_CLOSE_CURLY_BRACKET:()=>KEY_CLOSE_CURLY_BRACKET,KEY_TILDE:()=>KEY_TILDE,KEY_VOLUME_MUTE:()=>KEY_VOLUME_MUTE,KEY_VOLUME_DOWN:()=>KEY_VOLUME_DOWN,KEY_VOLUME_UP:()=>KEY_VOLUME_UP,KEY_SEMICOLON_2:()=>KEY_SEMICOLON_2,KEY_EQUALS_2:()=>KEY_EQUALS_2,KEY_COMMA:()=>KEY_COMMA,KEY_MINUS:()=>KEY_MINUS,KEY_PERIOD:()=>KEY_PERIOD,KEY_SLASH:()=>KEY_SLASH,KEY_BACK_QUOTE:()=>KEY_BACK_QUOTE,KEY_OPEN_BRACKET:()=>KEY_OPEN_BRACKET,KEY_BACK_SLASH:()=>KEY_BACK_SLASH,KEY_CLOSE_BRACKET:()=>KEY_CLOSE_BRACKET,KEY_QUOTE:()=>KEY_QUOTE,KEY_META_2:()=>KEY_META_2,KEY_ALTGR:()=>KEY_ALTGR,KEY_WIN_ICO_HELP:()=>KEY_WIN_ICO_HELP,KEY_WIN_ICO_00:()=>KEY_WIN_ICO_00,KEY_WIN_ICO_CLEAR:()=>KEY_WIN_ICO_CLEAR,KEY_WIN_OEM_RESET:()=>KEY_WIN_OEM_RESET,KEY_WIN_OEM_JUMP:()=>KEY_WIN_OEM_JUMP,KEY_WIN_OEM_PA1:()=>KEY_WIN_OEM_PA1,KEY_WIN_OEM_PA2:()=>KEY_WIN_OEM_PA2,KEY_WIN_OEM_PA3:()=>KEY_WIN_OEM_PA3,KEY_WIN_OEM_WSCTRL:()=>KEY_WIN_OEM_WSCTRL,KEY_WIN_OEM_CUSEL:()=>KEY_WIN_OEM_CUSEL,KEY_WIN_OEM_ATTN:()=>KEY_WIN_OEM_ATTN,KEY_WIN_OEM_FINISH:()=>KEY_WIN_OEM_FINISH,KEY_WIN_OEM_COPY:()=>KEY_WIN_OEM_COPY,KEY_WIN_OEM_AUTO:()=>KEY_WIN_OEM_AUTO,KEY_WIN_OEM_ENLW:()=>KEY_WIN_OEM_ENLW,KEY_WIN_OEM_BACKTAB:()=>KEY_WIN_OEM_BACKTAB,KEY_ATTN:()=>KEY_ATTN,KEY_CRSEL:()=>KEY_CRSEL,KEY_EXSEL:()=>KEY_EXSEL,KEY_EREOF:()=>KEY_EREOF,KEY_PLAY:()=>KEY_PLAY,KEY_ZOOM:()=>KEY_ZOOM,KEY_PA1:()=>KEY_PA1,KEY_WIN_OEM_CLEAR:()=>KEY_WIN_OEM_CLEAR});const KEY_CANCEL=3,KEY_HELP=6,KEY_BACK_SPACE=8,KEY_TAB=9,KEY_CLEAR=12,KEY_ENTER=13,KEY_ENTER_SPECIAL=14,KEY_SHIFT=16,KEY_CONTROL=17,KEY_ALT=18,KEY_PAUSE=19,KEY_CAPS_LOCK=20,KEY_KANA=21,KEY_EISU=22,KEY_JUNJA=23,KEY_FINAL=24,KEY_HANJA=25,KEY_ESCAPE=27,KEY_CONVERT=28,KEY_NONCONVERT=29,KEY_ACCEPT=30,KEY_MODECHANGE=31,KEY_SPACE=32,KEY_PAGE_UP=33,KEY_PAGE_DOWN=34,KEY_END=35,KEY_HOME=36,KEY_LEFT=37,KEY_UP=38,KEY_RIGHT=39,KEY_DOWN=40,KEY_SELECT=41,KEY_PRINT=42,KEY_EXECUTE=43,KEY_PRINTSCREEN=44,KEY_INSERT=45,KEY_DELETE=46,KEY_NUM_0=48,KEY_NUM_1=49,KEY_NUM_2=50,KEY_NUM_3=51,KEY_NUM_4=52,KEY_NUM_5=53,KEY_NUM_6=54,KEY_NUM_7=55,KEY_NUM_8=56,KEY_NUM_9=57,KEY_COLON=58,KEY_SEMICOLON=59,KEY_LESS_THAN=60,KEY_EQUALS=61,KEY_GREATER_THAN=62,KEY_QUESTION_MARK=63,KEY_AT=64,KEY_A=65,KEY_B=66,KEY_C=67,KEY_D=68,KEY_E=69,KEY_F=70,KEY_G=71,KEY_H=72,KEY_I=73,KEY_J=74,KEY_K=75,KEY_L=76,KEY_M=77,KEY_N=78,KEY_O=79,KEY_P=80,KEY_Q=81,KEY_R=82,KEY_S=83,KEY_T=84,KEY_U=85,KEY_V=86,KEY_W=87,KEY_X=88,KEY_Y=89,KEY_Z=90,KEY_META=91,KEY_CONTEXT_MENU=93,KEY_SLEEP=95,KEY_NUMPAD_0=96,KEY_NUMPAD_1=97,KEY_NUMPAD_2=98,KEY_NUMPAD_3=99,KEY_NUMPAD_4=100,KEY_NUMPAD_5=101,KEY_NUMPAD_6=102,KEY_NUMPAD_7=103,KEY_NUMPAD_8=104,KEY_NUMPAD_9=105,KEY_MULTIPLY=106,KEY_ADD=107,KEY_SEPARATOR=108,KEY_SUBTRACT=109,KEY_DECIMAL=110,KEY_DIVIDE=111,KEY_F1=112,KEY_F2=113,KEY_F3=114,KEY_F4=115,KEY_F5=116,KEY_F6=117,KEY_F7=118,KEY_F8=119,KEY_F9=120,KEY_F10=121,KEY_F11=122,KEY_F12=123,KEY_F13=124,KEY_F14=125,KEY_F15=126,KEY_F16=127,KEY_F17=128,KEY_F18=129,KEY_F19=130,KEY_F20=131,KEY_F21=132,KEY_F22=133,KEY_F23=134,KEY_F24=135,KEY_NUM_LOCK=144,KEY_SCROLL_LOCK=145,KEY_WIN_OEM_FJ_JISHO=146,KEY_WIN_OEM_FJ_MASSHOU=147,KEY_WIN_OEM_FJ_TOUROKU=148,KEY_WIN_OEM_FJ_LOYA=149,KEY_WIN_OEM_FJ_ROYA=150,KEY_CIRCUMFLEX=160,KEY_EXCLAMATION=161,KEY_DOUBLE_QUOTE=162,KEY_HASH=163,KEY_DOLLAR=164,KEY_PERCENT=165,KEY_AMPERSAND=166,KEY_UNDERSCORE=167,KEY_OPEN_PAREN=168,KEY_CLOSE_PAREN=169,KEY_ASTERISK=170,KEY_PLUS=171,KEY_PIPE=172,KEY_HYPHEN_MINUS=173,KEY_OPEN_CURLY_BRACKET=174,KEY_CLOSE_CURLY_BRACKET=175,KEY_TILDE=176,KEY_VOLUME_MUTE=181,KEY_VOLUME_DOWN=182,KEY_VOLUME_UP=183,KEY_SEMICOLON_2=186,KEY_EQUALS_2=187,KEY_COMMA=188,KEY_MINUS=189,KEY_PERIOD=190,KEY_SLASH=191,KEY_BACK_QUOTE=192,KEY_OPEN_BRACKET=219,KEY_BACK_SLASH=220,KEY_CLOSE_BRACKET=221,KEY_QUOTE=222,KEY_META_2=224,KEY_ALTGR=225,KEY_WIN_ICO_HELP=227,KEY_WIN_ICO_00=228,KEY_WIN_ICO_CLEAR=230,KEY_WIN_OEM_RESET=233,KEY_WIN_OEM_JUMP=234,KEY_WIN_OEM_PA1=235,KEY_WIN_OEM_PA2=236,KEY_WIN_OEM_PA3=237,KEY_WIN_OEM_WSCTRL=238,KEY_WIN_OEM_CUSEL=239,KEY_WIN_OEM_ATTN=240,KEY_WIN_OEM_FINISH=241,KEY_WIN_OEM_COPY=242,KEY_WIN_OEM_AUTO=243,KEY_WIN_OEM_ENLW=244,KEY_WIN_OEM_BACKTAB=245,KEY_ATTN=246,KEY_CRSEL=247,KEY_EXSEL=248,KEY_EREOF=249,KEY_PLAY=250,KEY_ZOOM=251,KEY_PA1=253,KEY_WIN_OEM_CLEAR=254},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>ScreenManager});var _ScreenType__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(53),_screens_AdventureScreen__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(149),_screens_MainMenuScreen__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(151),_screens_DeathScreen__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(154),_Manager__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(5),_screens_InventoryScreen__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(155),_screens_InteractModalScreen__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(157),_screens_CursorScreen__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(158),_screens_LoadSectorScreen__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(159),_screens_EquipmentScreen__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(160),_screens_ListSelectionScreen__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(161),_screens_CharacterScreen__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(162),_screens_AbilitiesScreen__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(163);function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}var _screens=new WeakMap,_screenStack=new WeakMap;class ScreenManager extends _Manager__WEBPACK_IMPORTED_MODULE_4__.default{constructor(game){super(game),_screens.set(this,{writable:!0,value:{}}),_screenStack.set(this,{writable:!0,value:[]}),function(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}}(this,_screens,{[_ScreenType__WEBPACK_IMPORTED_MODULE_0__.SCREEN_MAIN_MENU]:new _screens_MainMenuScreen__WEBPACK_IMPORTED_MODULE_2__.default(game),[_ScreenType__WEBPACK_IMPORTED_MODULE_0__.SCREEN_ADVENTURE]:new _screens_AdventureScreen__WEBPACK_IMPORTED_MODULE_1__.default(game),[_ScreenType__WEBPACK_IMPORTED_MODULE_0__.SCREEN_DEATH]:new _screens_DeathScreen__WEBPACK_IMPORTED_MODULE_3__.default(game),[_ScreenType__WEBPACK_IMPORTED_MODULE_0__.SCREEN_INVENTORY]:new _screens_InventoryScreen__WEBPACK_IMPORTED_MODULE_5__.default(game),[_ScreenType__WEBPACK_IMPORTED_MODULE_0__.SCREEN_INTERACT_MODAL]:new _screens_InteractModalScreen__WEBPACK_IMPORTED_MODULE_6__.default(game),[_ScreenType__WEBPACK_IMPORTED_MODULE_0__.SCREEN_CURSOR]:new _screens_CursorScreen__WEBPACK_IMPORTED_MODULE_7__.default(game),[_ScreenType__WEBPACK_IMPORTED_MODULE_0__.SCREEN_LOAD_SECTOR]:new _screens_LoadSectorScreen__WEBPACK_IMPORTED_MODULE_8__.default(game),[_ScreenType__WEBPACK_IMPORTED_MODULE_0__.SCREEN_EQUIPMENT]:new _screens_EquipmentScreen__WEBPACK_IMPORTED_MODULE_9__.default(game),[_ScreenType__WEBPACK_IMPORTED_MODULE_0__.SCREEN_LIST_SELECT]:new _screens_ListSelectionScreen__WEBPACK_IMPORTED_MODULE_10__.default(game),[_ScreenType__WEBPACK_IMPORTED_MODULE_0__.SCREEN_CHARACTER]:new _screens_CharacterScreen__WEBPACK_IMPORTED_MODULE_11__.default(game),[_ScreenType__WEBPACK_IMPORTED_MODULE_0__.SCREEN_ABILITIES]:new _screens_AbilitiesScreen__WEBPACK_IMPORTED_MODULE_12__.default(game)}),this.setScreen(_ScreenType__WEBPACK_IMPORTED_MODULE_0__.SCREEN_MAIN_MENU)}get screenType(){return _classPrivateFieldGet(this,_screenStack)[_classPrivateFieldGet(this,_screenStack).length-1].type}get screenCtx(){return _classPrivateFieldGet(this,_screenStack)[_classPrivateFieldGet(this,_screenStack).length-1].ctx}get screen(){return _classPrivateFieldGet(this,_screens)[this.screenType]}setScreen(screenType,ctx={}){for(;_classPrivateFieldGet(this,_screenStack).length>0;)this.screen.onLeave(ctx),_classPrivateFieldGet(this,_screenStack).pop();_classPrivateFieldGet(this,_screenStack).push({type:screenType,ctx}),this.screen.onEnter(this.screenCtx)}replaceScreen(screenType,ctx={}){this.screen.onLeave(ctx),_classPrivateFieldGet(this,_screenStack).pop(),_classPrivateFieldGet(this,_screenStack).push({type:screenType,ctx}),this.screen.onEnter(this.screenCtx)}pushScreen(screenType,ctx={}){this.screen.onLeave(ctx),_classPrivateFieldGet(this,_screenStack).push({type:screenType,ctx}),this.screen.onEnter(this.screenCtx)}popScreen(ctx={}){this.screen.onLeave(ctx),_classPrivateFieldGet(this,_screenStack).pop(),this.screen.onEnter(this.screenCtx)}update(dt){this.screen.onUpdate(dt)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>AdventureScreen});var _Screen__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(150),_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(146),_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(143),_enums_Directions__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(83),_ScreenType__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(53),_ecs_components__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(21);class AdventureScreen extends _Screen__WEBPACK_IMPORTED_MODULE_0__.default{onEnter(){this.game.renderer.clear(),this.game.commands.pushDomain(_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__.INPUT_DOMAIN_ADVENTURE),this.game.FOVSystem.computeFOV();const position=this.game.player.position;this.game.camera.setFocus(position.x,position.y)}onLeave(){this.game.commands.popDomain(_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__.INPUT_DOMAIN_ADVENTURE)}onDirectionInput(dir){const delta=(0,_enums_Directions__WEBPACK_IMPORTED_MODULE_3__.delta)(dir),playerPosition=this.game.player.position,targetPosition={x:playerPosition.x+delta.x,y:playerPosition.y+delta.y},entities=this.game.map.getEntitiesAt(targetPosition.x,targetPosition.y),hostileEntities=entities.filter((e=>this.game.factions.areEntitiesHostile(e,this.game.player.entity)));if(hostileEntities.length>0)this.game.player.melee(hostileEntities[0]);else{const doorEntity=entities.find((e=>e.has(_ecs_components__WEBPACK_IMPORTED_MODULE_5__.Door)));doorEntity&&!doorEntity.door.isOpen?doorEntity.fireEvent("try-open-door",{interactor:this.game.player.entity}):this.game.player.move(dir)}}onPickUpCommand(){const position=this.game.player.position,lootable=this.game.map.getEntitiesAt(position.x,position.y).find((entity=>entity.has(_ecs_components__WEBPACK_IMPORTED_MODULE_5__.Loot)));lootable?lootable.fireEvent("try-pick-up",{interactor:this.game.player.entity}):console.log("there is nothing here to pick up.")}onInteract(x,y){const items=this.game.map.getEntitiesAt(x,y).filter((e=>!e.isPlayer)).filter((entity=>entity.fireEvent("get-interactions",{interactor:this.game.player.entity,interactions:[]}).data.interactions.length>0));items.length<=0||(1!=items.length?game.screens.pushScreen(_ScreenType__WEBPACK_IMPORTED_MODULE_4__.SCREEN_LIST_SELECT,{header:"Ground",leadText:"Select an item to interact",list:items,onRenderRow:(item,x,y,isSelected)=>{const text=" ".concat(item.moniker.display);this.game.renderer.draw(x+1,y,item.glyph.char,item.glyph.primary,item.glyph.secondary,item.glyph.background),isSelected?(this.game.renderer.drawText(x,y,"→","yellow"),this.game.renderer.drawText(x+2,y,text,"yellow")):(this.game.renderer.drawText(x,y,"-"),this.game.renderer.drawText(x+2,y,text))},onSelect:item=>{this.game.screens.replaceScreen(_ScreenType__WEBPACK_IMPORTED_MODULE_4__.SCREEN_INTERACT_MODAL,{interactor:this.game.player.entity,interactable:item})}}):this.game.screens.pushScreen(_ScreenType__WEBPACK_IMPORTED_MODULE_4__.SCREEN_INTERACT_MODAL,{interactor:this.game.player.entity,interactable:items[0]}))}onInteractDirection(dir){const delta=(0,_enums_Directions__WEBPACK_IMPORTED_MODULE_3__.delta)(dir),playerPosition=this.game.player.position,targetPosition={x:playerPosition.x+delta.x,y:playerPosition.y+delta.y};this.onInteract(targetPosition.x,targetPosition.y)}handleInput(){const cmd=this.game.commands.getNextCommand();if(cmd){if(cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_SAVE&&this.game.state.saveGame(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_LOAD&&this.game.state.loadGame(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_LOOK&&game.screens.pushScreen(_ScreenType__WEBPACK_IMPORTED_MODULE_4__.SCREEN_CURSOR,{drawTags:!0,onResult:()=>game.screens.popScreen(),onCancel:()=>game.screens.popScreen()}),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_PICK_UP&&this.onPickUpCommand(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_INTERACT){const pos=this.game.player.position;this.onInteract(pos.x,pos.y)}cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_INVENTORY&&this.game.screens.pushScreen(_ScreenType__WEBPACK_IMPORTED_MODULE_4__.SCREEN_INVENTORY,{accessible:this.game.player.entity,accessor:this.game.player.entity}),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_ABILITIES&&this.game.screens.pushScreen(_ScreenType__WEBPACK_IMPORTED_MODULE_4__.SCREEN_ABILITIES,{character:this.game.player.entity}),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_EQUIPMENT&&this.game.screens.pushScreen(_ScreenType__WEBPACK_IMPORTED_MODULE_4__.SCREEN_EQUIPMENT,{accessor:this.game.player.entity}),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_CHARACTER&&this.game.screens.pushScreen(_ScreenType__WEBPACK_IMPORTED_MODULE_4__.SCREEN_CHARACTER,{character:this.game.player.entity}),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_CANCEL&&this.game.screens.setScreen(_ScreenType__WEBPACK_IMPORTED_MODULE_4__.SCREEN_MAIN_MENU),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_WAIT&&this.game.player.wait(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_NW&&this.onDirectionInput(_enums_Directions__WEBPACK_IMPORTED_MODULE_3__.DIR_NW),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_N&&this.onDirectionInput(_enums_Directions__WEBPACK_IMPORTED_MODULE_3__.DIR_N),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_NE&&this.onDirectionInput(_enums_Directions__WEBPACK_IMPORTED_MODULE_3__.DIR_NE),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_W&&this.onDirectionInput(_enums_Directions__WEBPACK_IMPORTED_MODULE_3__.DIR_W),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_E&&this.onDirectionInput(_enums_Directions__WEBPACK_IMPORTED_MODULE_3__.DIR_E),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_SW&&this.onDirectionInput(_enums_Directions__WEBPACK_IMPORTED_MODULE_3__.DIR_SW),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_S&&this.onDirectionInput(_enums_Directions__WEBPACK_IMPORTED_MODULE_3__.DIR_S),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_SE&&this.onDirectionInput(_enums_Directions__WEBPACK_IMPORTED_MODULE_3__.DIR_SE),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_SELECT_NW&&this.onInteractDirection(_enums_Directions__WEBPACK_IMPORTED_MODULE_3__.DIR_NW),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_SELECT_N&&this.onInteractDirection(_enums_Directions__WEBPACK_IMPORTED_MODULE_3__.DIR_N),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_SELECT_NE&&this.onInteractDirection(_enums_Directions__WEBPACK_IMPORTED_MODULE_3__.DIR_NE),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_SELECT_W&&this.onInteractDirection(_enums_Directions__WEBPACK_IMPORTED_MODULE_3__.DIR_W),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_SELECT_E&&this.onInteractDirection(_enums_Directions__WEBPACK_IMPORTED_MODULE_3__.DIR_E),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_SELECT_SW&&this.onInteractDirection(_enums_Directions__WEBPACK_IMPORTED_MODULE_3__.DIR_SW),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_SELECT_S&&this.onInteractDirection(_enums_Directions__WEBPACK_IMPORTED_MODULE_3__.DIR_S),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_SELECT_SE&&this.onInteractDirection(_enums_Directions__WEBPACK_IMPORTED_MODULE_3__.DIR_SE)}}onUpdate(dt){this.handleInput(),this.game.updateAdventureSystems(dt)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Screen});var _game=new WeakMap;class Screen{get game(){return function(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}(this,_game)}constructor(game){_game.set(this,{writable:!0,value:void 0}),function(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}}(this,_game,game)}onEnter(){}onLeave(){}onUpdate(dt){}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>MainMenuScreen});var _Screen__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(150),_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(146),_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(143),_ScreenType__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(53),_enums_UIGlyphs__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(152),_utils_UIWindowUtil__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(153);class MainMenuScreen extends _Screen__WEBPACK_IMPORTED_MODULE_0__.default{onEnter(){this.game.commands.pushDomain(_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__.INPUT_DOMAIN_MAIN_MENU),this.game.state.isStarted||this.game.music.play("BARDS_TALE")}onLeave(){this.game.commands.popDomain(_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__.INPUT_DOMAIN_MAIN_MENU)}onConfirm(){this.game.state.isStarted?this.game.screens.setScreen(_ScreenType__WEBPACK_IMPORTED_MODULE_3__.SCREEN_ADVENTURE):this.game.state.newGame()}inputCommand(){const cmd=this.game.commands.getNextCommand();cmd&&(cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_CONFIRM&&this.onConfirm(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_SAVE&&this.game.state.saveGame(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_LOAD&&this.game.state.loadGame(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_NEW_GAME&&this.game.state.newGame())}onUpdate(dt){this.inputCommand(),this.game.renderer.clear(),this.game.renderer.draw(2,1,"@","#adb8bc","#66a3dc"),this.game.renderer.drawText(3,1," Sleepy Crawler","#66a3dc");for(let i=1;i<this.game.camera.width-1;i++)1===i?this.game.renderer.drawUI(i,2,_enums_UIGlyphs__WEBPACK_IMPORTED_MODULE_4__.UI_GLYPH_BORDER_TERM_L,_utils_UIWindowUtil__WEBPACK_IMPORTED_MODULE_5__.UI_BORDER_FG1,_utils_UIWindowUtil__WEBPACK_IMPORTED_MODULE_5__.UI_BORDER_FG2):i===this.game.camera.width-2?this.game.renderer.drawUI(i,2,_enums_UIGlyphs__WEBPACK_IMPORTED_MODULE_4__.UI_GLYPH_BORDER_TERM_R,_utils_UIWindowUtil__WEBPACK_IMPORTED_MODULE_5__.UI_BORDER_FG1,_utils_UIWindowUtil__WEBPACK_IMPORTED_MODULE_5__.UI_BORDER_FG2):this.game.renderer.drawUI(i,2,_enums_UIGlyphs__WEBPACK_IMPORTED_MODULE_4__.UI_GLYPH_BORDER_T,_utils_UIWindowUtil__WEBPACK_IMPORTED_MODULE_5__.UI_BORDER_FG1,_utils_UIWindowUtil__WEBPACK_IMPORTED_MODULE_5__.UI_BORDER_FG2);this.game.renderer.drawText(2,4,"∙ Movement"),this.game.renderer.drawText(3,6,"▬Q  ↑W  ↨E"),this.game.renderer.drawText(3,7,"←A      →D"),this.game.renderer.drawText(3,8,"∟Z  ↓X  ↔C"),this.game.renderer.drawText(3,10,"hold [SHIFT] and a direction to interact"),this.game.renderer.drawText(2,12,"∙ Look [L]"),this.game.renderer.drawText(2,13,"∙ Inventory [I]"),this.game.renderer.drawText(2,14,"∙ Player Character [P]"),this.game.renderer.drawText(2,15,"∙ Equipment [Y]"),this.game.renderer.drawText(2,16,"∙ Confirm [ENTER]"),this.game.renderer.drawText(2,17,"∙ Cancel [ESC]"),this.game.renderer.drawTextCenter(19,"set out into the forest..."),this.game.renderer.drawTextCenter(21,"press [ENTER]","#213942")}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{UI_GLYPH_BORDER_TL:()=>UI_GLYPH_BORDER_TL,UI_GLYPH_BORDER_T:()=>UI_GLYPH_BORDER_T,UI_GLYPH_BORDER_TR:()=>UI_GLYPH_BORDER_TR,UI_GLYPH_BORDER_L:()=>UI_GLYPH_BORDER_L,UI_GLYPH_BORDER_R:()=>UI_GLYPH_BORDER_R,UI_GLYPH_BORDER_BL:()=>UI_GLYPH_BORDER_BL,UI_GLYPH_BORDER_B:()=>UI_GLYPH_BORDER_B,UI_GLYPH_BORDER_BR:()=>UI_GLYPH_BORDER_BR,UI_GLYPH_BORDER_TERM_R:()=>UI_GLYPH_BORDER_TERM_R,UI_GLYPH_BORDER_TERM_L:()=>UI_GLYPH_BORDER_TERM_L});const UI_GLYPH_BORDER_TL="╨",UI_GLYPH_BORDER_T="╤",UI_GLYPH_BORDER_TR="╥",UI_GLYPH_BORDER_L="α",UI_GLYPH_BORDER_R="Γ",UI_GLYPH_BORDER_BL="≡",UI_GLYPH_BORDER_B="±",UI_GLYPH_BORDER_BR="≥",UI_GLYPH_BORDER_TERM_R="╙",UI_GLYPH_BORDER_TERM_L="π"},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{UI_BORDER_FG1:()=>UI_BORDER_FG1,UI_BORDER_FG2:()=>UI_BORDER_FG2,drawUIBox:()=>drawUIBox,drawUIWindow:()=>drawUIWindow});var _core_Game__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_enums_UIGlyphs__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(152);const UI_BORDER_FG1="#405362",UI_BORDER_FG2="#979545",drawUIBox=(x,y,width,height)=>{_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.renderer.clearArea(x,y,width+1,height+1);for(let i=x;i<x+width;i++)_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.renderer.drawUI(i,y,_enums_UIGlyphs__WEBPACK_IMPORTED_MODULE_1__.UI_GLYPH_BORDER_T,UI_BORDER_FG1,UI_BORDER_FG2),_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.renderer.drawUI(i,y+height,_enums_UIGlyphs__WEBPACK_IMPORTED_MODULE_1__.UI_GLYPH_BORDER_B,UI_BORDER_FG1,UI_BORDER_FG2);for(let i=y;i<y+height;i++)_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.renderer.drawUI(x,i,_enums_UIGlyphs__WEBPACK_IMPORTED_MODULE_1__.UI_GLYPH_BORDER_L,UI_BORDER_FG1,UI_BORDER_FG2),_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.renderer.drawUI(x+width,i,_enums_UIGlyphs__WEBPACK_IMPORTED_MODULE_1__.UI_GLYPH_BORDER_R,UI_BORDER_FG1,UI_BORDER_FG2);_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.renderer.drawUI(x,y,_enums_UIGlyphs__WEBPACK_IMPORTED_MODULE_1__.UI_GLYPH_BORDER_TL,UI_BORDER_FG1,UI_BORDER_FG2),_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.renderer.drawUI(x+width,y,_enums_UIGlyphs__WEBPACK_IMPORTED_MODULE_1__.UI_GLYPH_BORDER_TR,UI_BORDER_FG1,UI_BORDER_FG2),_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.renderer.drawUI(x,y+height,_enums_UIGlyphs__WEBPACK_IMPORTED_MODULE_1__.UI_GLYPH_BORDER_BL,UI_BORDER_FG1,UI_BORDER_FG2),_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.renderer.drawUI(x+width,y+height,_enums_UIGlyphs__WEBPACK_IMPORTED_MODULE_1__.UI_GLYPH_BORDER_BR,UI_BORDER_FG1,UI_BORDER_FG2)},drawUIWindow=(x,y,width,height,title,icon)=>{drawUIBox(x,y,width,height);const titleText=icon?" ".concat(title):title,titleWidth=Math.ceil(_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.renderer.computeTextWidth(titleText)),titleOffset=x+2,iconWidth=icon?1:0;_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.renderer.drawUI(titleOffset-1,y,_enums_UIGlyphs__WEBPACK_IMPORTED_MODULE_1__.UI_GLYPH_BORDER_TERM_R,UI_BORDER_FG1,UI_BORDER_FG2),_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.renderer.drawUI(titleOffset+iconWidth+titleWidth,y,_enums_UIGlyphs__WEBPACK_IMPORTED_MODULE_1__.UI_GLYPH_BORDER_TERM_L,UI_BORDER_FG1,UI_BORDER_FG2),icon&&_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.renderer.draw(titleOffset,y,icon.char,icon.primary,icon.secondary,icon.background),_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.renderer.drawText(titleOffset+iconWidth,y,titleText)}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>DeathScreen});var _Screen__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(150),_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(146),_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(143),_ScreenType__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(53);class DeathScreen extends _Screen__WEBPACK_IMPORTED_MODULE_0__.default{onEnter(){this.game.state.gameOver(),this.game.commands.pushDomain(_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__.INPUT_DOMAIN_MAIN_MENU)}onLeave(){this.game.commands.popDomain(_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__.INPUT_DOMAIN_MAIN_MENU)}handleInput(){const cmd=this.game.commands.getNextCommand();cmd&&cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_CONFIRM&&this.game.screens.setScreen(_ScreenType__WEBPACK_IMPORTED_MODULE_3__.SCREEN_MAIN_MENU)}onUpdate(dt){this.handleInput(),this.game.renderSystem.update(dt);this.game.renderer.drawTextCenter(10,"you have succumbed to the forest","#ce5454","#ce5454")}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>InventoryScreen});var _Screen__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(150),_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(146),_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(143),_ScreenType__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(53),_utils_SelectableList__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(156);function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}function _classPrivateFieldSet(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}return value}var _accessible=new WeakMap,_accessor=new WeakMap;class InventoryScreen extends _Screen__WEBPACK_IMPORTED_MODULE_0__.default{constructor(...args){var obj,key,value;super(...args),_accessible.set(this,{writable:!0,value:void 0}),_accessor.set(this,{writable:!0,value:void 0}),obj=this,key="list",value=new _utils_SelectableList__WEBPACK_IMPORTED_MODULE_4__.default,key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}onEnter(ctx){this.game.commands.pushDomain(_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__.INPUT_DOMAIN_MAIN_MENU),_classPrivateFieldSet(this,_accessible,ctx.accessible),_classPrivateFieldSet(this,_accessor,ctx.accessor),this.list.setItems(_classPrivateFieldGet(this,_accessible).inventory.content)}onLeave(){this.game.commands.popDomain(_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__.INPUT_DOMAIN_MAIN_MENU)}selectItem(){const interactable=this.list.selected;interactable&&this.game.screens.pushScreen(_ScreenType__WEBPACK_IMPORTED_MODULE_3__.SCREEN_INTERACT_MODAL,{interactable,interactor:_classPrivateFieldGet(this,_accessor)})}handleInput(){const cmd=this.game.commands.getNextCommand();cmd&&(cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_CANCEL&&this.game.screens.popScreen(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_N&&this.list.up(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_S&&this.list.down(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_CONFIRM&&this.selectItem())}onUpdate(dt){this.handleInput(),this.game.renderer.clear(),this.game.renderer.drawTextCenter(3,"~ ".concat(_classPrivateFieldGet(this,_accessible).moniker.display," Inventory ~"),"yellow"),0===this.list.items.length&&this.game.renderer.drawTextCenter(6,"There is nothing here."),this.list.data.forEach((({item,idx,isSelected})=>{const ypos=idx+5;isSelected?this.game.renderer.drawText(1,ypos,"→","yellow"):this.game.renderer.drawText(1,ypos,"-"),this.game.renderer.draw(2,ypos,item.glyph.char,item.glyph.primary,item.glyph.secondary,item.glyph.background);const textLen=this.game.renderer.computeTextWidth(item.moniker.display);if(this.game.renderer.drawText(4,ypos,item.moniker.display),item.isEquipped){const slot=item.isEquipped.slot.name;this.game.renderer.drawText(4+textLen+.5,ypos,"[".concat(slot,"]"),"#2c3538")}})),this.game.renderer.drawText(1,1,"← back [esc]")}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>SelectableList});class SelectableList{get selected(){return this._items[this._idx]}get items(){return this._items}get data(){return this._items.map(((item,idx)=>({item,idx,isSelected:idx===this._idx})))}get isEmpty(){return this._items.length<=0}get length(){return this._items.length}constructor(items=[],idx=0){_defineProperty(this,"_items",[]),_defineProperty(this,"_idx",0),this._idx=idx,this.setItems(items)}setItems(items=[]){this._items=items,this._idx=Math.min(Math.max(this._idx,0),this._items.length-1)}up(){this._idx--,this._idx<0&&(this._idx=this._items.length-1)}down(){this._idx++,this._idx>=this._items.length&&(this._idx=0)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>InteractModalScreen});var _Screen__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(150),_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(146),_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(143),_utils_SelectableList__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(156),_data_Skills__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(58),_utils_UIWindowUtil__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(153);function _classPrivateFieldSet(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}return value}function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}var _width=new WeakMap,_height=new WeakMap,_interactable=new WeakMap,_interactor=new WeakMap;class InteractModalScreen extends _Screen__WEBPACK_IMPORTED_MODULE_0__.default{constructor(...args){var obj,key,value;super(...args),_width.set(this,{writable:!0,value:18}),_height.set(this,{writable:!0,value:10}),_interactable.set(this,{writable:!0,value:void 0}),_interactor.set(this,{writable:!0,value:void 0}),obj=this,key="list",value=new _utils_SelectableList__WEBPACK_IMPORTED_MODULE_3__.default,key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}get left(){return Math.floor((this.game.camera.width-_classPrivateFieldGet(this,_width))/2)}get top(){return Math.floor((this.game.camera.height-_classPrivateFieldGet(this,_height))/2)}onEnter(ctx){this.game.commands.pushDomain(_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__.INPUT_DOMAIN_MAIN_MENU),_classPrivateFieldSet(this,_interactable,ctx.interactable),_classPrivateFieldSet(this,_interactor,ctx.interactor),this.refreshList()}refreshList(){const evt=_classPrivateFieldGet(this,_interactable).fireEvent("get-interactions",{interactor:_classPrivateFieldGet(this,_interactor),interactions:[]});this.list.setItems([...evt.data.interactions,{name:"Back",isBack:!0}])}onLeave(){this.game.commands.popDomain(_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__.INPUT_DOMAIN_MAIN_MENU)}selectItem(){const interaction=this.list.selected;interaction.isBack?this.game.screens.popScreen():(_classPrivateFieldGet(this,_interactable).fireEvent(interaction.evt,{interactor:_classPrivateFieldGet(this,_interactor)}),_classPrivateFieldGet(this,_interactable).isDestroyed?this.game.screens.popScreen():this.refreshList())}handleInput(){const cmd=this.game.commands.getNextCommand();cmd&&(cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_CANCEL&&this.game.screens.popScreen(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_N&&this.list.up(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_S&&this.list.down(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_CONFIRM&&this.selectItem())}onUpdate(dt){this.handleInput(),(0,_utils_UIWindowUtil__WEBPACK_IMPORTED_MODULE_5__.drawUIWindow)(this.left,this.top,_classPrivateFieldGet(this,_width),_classPrivateFieldGet(this,_height),_classPrivateFieldGet(this,_interactable).moniker.display,_classPrivateFieldGet(this,_interactable).glyph);let listPadding=2;const xpos=this.left+2;if(_classPrivateFieldGet(this,_interactable).weapon){const weaponDmg=_classPrivateFieldGet(this,_interactable).weapon.getShortDescription(_classPrivateFieldGet(this,_interactor));this.game.renderer.drawText(xpos,this.top+listPadding,weaponDmg),listPadding+=2}const modifiers=(0,_data_Skills__WEBPACK_IMPORTED_MODULE_4__.getAllSkillEquippedModSums)(_classPrivateFieldGet(this,_interactable));let hasMod=!1;Object.keys(modifiers).forEach((skill=>{const modifier=modifiers[skill];if(0===modifier)return;hasMod=!0;const name=(0,_data_Skills__WEBPACK_IMPORTED_MODULE_4__.getSkillName)(skill),ypos=this.top+listPadding;this.game.renderer.drawText(xpos,ypos,name);const len=this.game.renderer.computeTextWidth(name);modifier>0?this.game.renderer.drawText(xpos+len,ypos," +".concat(modifier),"green"):this.game.renderer.drawText(xpos+len,ypos," -".concat(modifier),"red"),listPadding++})),hasMod&&listPadding++,this.list.data.forEach((({item,idx,isSelected})=>{const ypos=idx+this.top+listPadding;isSelected?this.game.renderer.drawText(xpos,ypos,"→ ".concat(item.name),"yellow"):this.game.renderer.drawText(xpos,ypos,"- ".concat(item.name))}))}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>CursorScreen});var _Screen__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(150),_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(146),_enums_Directions__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(83),_utils_BresenhamLine__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(68),_enums_CursorSegments__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(67),_ecs_components__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(21);function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}function _classPrivateFieldSet(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}return value}const NOOP=()=>{};var _start=new WeakMap,_onResult=new WeakMap,_onCancel=new WeakMap,_getSegmentTypes=new WeakMap,_drawLine=new WeakMap,_drawTags=new WeakMap;class CursorScreen extends _Screen__WEBPACK_IMPORTED_MODULE_0__.default{constructor(...args){super(...args),_start.set(this,{writable:!0,value:{}}),_onResult.set(this,{writable:!0,value:NOOP}),_onCancel.set(this,{writable:!0,value:NOOP}),_getSegmentTypes.set(this,{writable:!0,value:NOOP}),_drawLine.set(this,{writable:!0,value:!1}),_drawTags.set(this,{writable:!0,value:!1})}onEnter(ctx){this.game.renderer.clear(),this.game.FOVSystem.computeFOV(),this.game.cursor.enable(),_classPrivateFieldSet(this,_start,ctx.start||this.game.player.position),_classPrivateFieldSet(this,_onResult,ctx.onResult||NOOP),_classPrivateFieldSet(this,_onCancel,ctx.onCancel||NOOP),_classPrivateFieldSet(this,_getSegmentTypes,ctx.getSegmentTypes||NOOP),_classPrivateFieldSet(this,_drawLine,Boolean(ctx.drawLine)),_classPrivateFieldSet(this,_drawTags,Boolean(ctx.drawTags))}onLeave(){this.game.cursor.disable()}onDirectionInput(dir){this.game.cursor.move(dir)}onConfirm(){_classPrivateFieldGet(this,_onResult).call(this,{start:_classPrivateFieldGet(this,_start),position:{x:this.game.cursor.x,y:this.game.cursor.y}})}onCancel(){_classPrivateFieldGet(this,_onCancel).call(this)}handleInput(){const cmd=this.game.commands.getNextCommand();cmd&&(cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_CONFIRM&&this.onConfirm(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_CANCEL&&this.onCancel(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_NW&&this.onDirectionInput(_enums_Directions__WEBPACK_IMPORTED_MODULE_2__.DIR_NW),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_N&&this.onDirectionInput(_enums_Directions__WEBPACK_IMPORTED_MODULE_2__.DIR_N),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_NE&&this.onDirectionInput(_enums_Directions__WEBPACK_IMPORTED_MODULE_2__.DIR_NE),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_W&&this.onDirectionInput(_enums_Directions__WEBPACK_IMPORTED_MODULE_2__.DIR_W),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_E&&this.onDirectionInput(_enums_Directions__WEBPACK_IMPORTED_MODULE_2__.DIR_E),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_SW&&this.onDirectionInput(_enums_Directions__WEBPACK_IMPORTED_MODULE_2__.DIR_SW),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_S&&this.onDirectionInput(_enums_Directions__WEBPACK_IMPORTED_MODULE_2__.DIR_S),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_SE&&this.onDirectionInput(_enums_Directions__WEBPACK_IMPORTED_MODULE_2__.DIR_SE))}onUpdate(dt){this.handleInput(),this.game.updateAdventureSystems(dt);const line=(0,_utils_BresenhamLine__WEBPACK_IMPORTED_MODULE_3__.bresenhamLine)(_classPrivateFieldGet(this,_start).x,_classPrivateFieldGet(this,_start).y,this.game.cursor.x,this.game.cursor.y);let cursorColor=(0,_enums_CursorSegments__WEBPACK_IMPORTED_MODULE_4__.getCursorSegmentTypeColor)(_enums_CursorSegments__WEBPACK_IMPORTED_MODULE_4__.CURSOR_SEGMENT_INTEREST);if(_classPrivateFieldGet(this,_drawLine)){const types=_classPrivateFieldGet(this,_getSegmentTypes).call(this,line);line.forEach(((segment,idx)=>{const type=types[idx];if(type===_enums_CursorSegments__WEBPACK_IMPORTED_MODULE_4__.CURSOR_SEGMENT_NONE||isNaN(type))return;const color=(0,_enums_CursorSegments__WEBPACK_IMPORTED_MODULE_4__.getCursorSegmentTypeColor)(type),glyph=(0,_enums_CursorSegments__WEBPACK_IMPORTED_MODULE_4__.getCursorSegmentTypeGlyph)(type),screen=this.game.camera.worldToScreen(segment.x,segment.y);this.game.renderer.draw(screen.x,screen.y,glyph,color),idx===line.length-1&&(cursorColor=color)}))}_classPrivateFieldGet(this,_drawTags)&&this.game.cursor.drawTags();const target=this.game.cursor.getEntities().filter((e=>e.has(_ecs_components__WEBPACK_IMPORTED_MODULE_5__.FactionMember))).pop(),player=this.game.player.entity;if(target){const faction=target.factionMember.faction,relation=this.game.factions.getEntityRelation(player,target);let disp=this.game.factions.getDisplay(relation);this.game.renderer.drawTextCenter(1,"".concat(faction.display," Faction [").concat(disp,"]"))}const tmpC=this.game.temperature.getTemperature(this.game.cursor.x,this.game.cursor.y),tmpF=9*tmpC/5+32;this.game.renderer.drawText(this.game.camera.width-12,this.game.camera.height-1,"".concat(Math.round(tmpF),"°F (").concat(Math.round(tmpC),"°C)")),this.game.cursor.drawCursor(cursorColor)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>LoadSectorScreen});var _ScreenType__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(53),_Screen__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(150);function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}function _classPrivateFieldSet(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}return value}var _prevousSector=new WeakMap,_nextSector=new WeakMap;class LoadSectorScreen extends _Screen__WEBPACK_IMPORTED_MODULE_1__.default{constructor(...args){super(...args),_prevousSector.set(this,{writable:!0,value:void 0}),_nextSector.set(this,{writable:!0,value:void 0})}onEnter(ctx){if(_classPrivateFieldSet(this,_prevousSector,ctx.prevousSector),_classPrivateFieldSet(this,_nextSector,ctx.nextSector),this.renderLoadingText(),ctx.prevousSector){const data=this.game.state.saveGame();return data.world.sectorId=ctx.nextSector.id,data.map.playerPosition=ctx.entry,void this.game.state.loadGameData(data)}this.game.world.onSectorLoaded(ctx.nextSector,ctx.entry),this.game.map.onSectorLoaded(ctx.nextSector,ctx.entry),this.game.music.onSectorLoaded(ctx.nextSector,ctx.entry),this.game.temperature.onSectorLoaded(ctx.nextSector,ctx.entry),this.game.screens.setScreen(_ScreenType__WEBPACK_IMPORTED_MODULE_0__.SCREEN_ADVENTURE)}renderLoadingText(){if(this.game.renderer.clear(),_classPrivateFieldGet(this,_prevousSector)){const prevText="You are leaving sector ".concat(_classPrivateFieldGet(this,_prevousSector).id);this.game.renderer.drawTextCenter(11,prevText,"#ce5454")}else{const nextText="You are entering sector ".concat(_classPrivateFieldGet(this,_nextSector).id);this.game.renderer.drawTextCenter(11,nextText,"#ce5454")}}onUpdate(dt){this.renderLoadingText()}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>EquipmentScreen});var _Screen__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(150),_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(146),_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(143),_ScreenType__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(53),_utils_SelectableList__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(156);function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}var _accessor=new WeakMap;class EquipmentScreen extends _Screen__WEBPACK_IMPORTED_MODULE_0__.default{constructor(...args){var obj,key,value;super(...args),_accessor.set(this,{writable:!0,value:void 0}),obj=this,key="list",value=new _utils_SelectableList__WEBPACK_IMPORTED_MODULE_4__.default,key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}onEnter(ctx){this.game.commands.pushDomain(_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__.INPUT_DOMAIN_MAIN_MENU),function(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}}(this,_accessor,ctx.accessor),this.list.setItems(Object.values(_classPrivateFieldGet(this,_accessor).equipmentSlot))}onLeave(){this.game.commands.popDomain(_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__.INPUT_DOMAIN_MAIN_MENU)}selectSlot(){const interactable=this.list.selected.content;interactable&&this.game.screens.pushScreen(_ScreenType__WEBPACK_IMPORTED_MODULE_3__.SCREEN_INTERACT_MODAL,{interactable,interactor:_classPrivateFieldGet(this,_accessor)})}handleInput(){const cmd=this.game.commands.getNextCommand();cmd&&(cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_CANCEL&&this.game.screens.popScreen(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_N&&this.list.up(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_S&&this.list.down(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_CONFIRM&&this.selectSlot())}onUpdate(dt){this.handleInput(),this.game.renderer.clear(),this.game.renderer.drawTextCenter(3,"~ ".concat(_classPrivateFieldGet(this,_accessor).moniker.display," Equipment ~"),"purple"),this.list.isEmpty&&this.game.renderer.drawTextCenter(6,"There is nothing here."),this.list.data.forEach((({item,idx,isSelected})=>{const slot=item,ypos=idx+5;if(isSelected?(this.game.renderer.drawText(1,ypos,"→ ".concat(slot.name),"yellow"),this.game.renderer.drawText(14,ypos,"→","yellow")):(this.game.renderer.drawText(1,ypos,"- ".concat(slot.name)),this.game.renderer.drawText(14,ypos,"-","#2c3538")),slot.isEmpty)this.game.renderer.drawText(15,ypos,"[empty]","#2c3538");else{const content=slot.content;this.game.renderer.draw(15,ypos,content.glyph.char,content.glyph.primary,content.glyph.secondary,content.glyph.background),this.game.renderer.drawText(16,ypos," ".concat(content.moniker.display))}})),this.game.renderer.drawText(1,1,"← back [esc]")}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>ListSelectionScreen});var _Screen__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(150),_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(146),_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(143),_utils_SelectableList__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(156),_utils_UIWindowUtil__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(153);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const NOOP=()=>{};class ListSelectionScreen extends _Screen__WEBPACK_IMPORTED_MODULE_0__.default{constructor(...args){super(...args),_defineProperty(this,"width",18),_defineProperty(this,"height",10),_defineProperty(this,"list",new _utils_SelectableList__WEBPACK_IMPORTED_MODULE_3__.default),_defineProperty(this,"header",""),_defineProperty(this,"icon",null),_defineProperty(this,"leadText",null)}get left(){return Math.floor((this.game.camera.width-this.width)/2)}get top(){return Math.floor((this.game.camera.height-this.height)/2)}onEnter(ctx){this.game.commands.pushDomain(_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__.INPUT_DOMAIN_MAIN_MENU),this.list.setItems(ctx.list||[]),this.header=ctx.header||"Select",this.icon=ctx.icon||null,this.leadText=ctx.leadText||null,this.onSelect=ctx.onSelect||NOOP,this.onCancel=ctx.onCancel||NOOP,this.onGetRowName=ctx.onGetRowName||NOOP,this.onRenderRow=ctx.onRenderRow||this.defaultRowRender.bind(this)}onLeave(){this.game.commands.popDomain(_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__.INPUT_DOMAIN_MAIN_MENU)}selectItem(){this.onSelect(this.list.selected)}cancel(){this.onCancel(),this.game.screens.popScreen()}handleInput(){const cmd=this.game.commands.getNextCommand();cmd&&(cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_CANCEL&&this.cancel(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_N&&this.list.up(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_S&&this.list.down(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_CONFIRM&&this.selectItem())}defaultRowRender(row,x,y,isSelected){const text=this.onGetRowName(row,x,y,isSelected);isSelected?this.game.renderer.drawText(x,y,"→ ".concat(text),"yellow"):this.game.renderer.drawText(x,y,"- ".concat(text))}onUpdate(dt){this.handleInput(),(0,_utils_UIWindowUtil__WEBPACK_IMPORTED_MODULE_4__.drawUIWindow)(this.left,this.top,this.width,this.height,this.header,this.icon);let yOffset=this.top+2;const xpos=this.left+2;this.leadText&&(this.game.renderer.drawText(xpos,yOffset,this.leadText),yOffset+=2),this.list.data.forEach((({item,idx,isSelected})=>{const ypos=yOffset+idx;this.onRenderRow(item,xpos,ypos,isSelected,idx)}))}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>CharacterScreen});var _Screen__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(150),_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(146),_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(143),_utils_SelectableList__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(156),_data_Skills__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(58),_data_skills_SpeedSkill__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(62),_data_skills_ArmorSkill__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(59),_data_skills_DodgeSkill__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(64);class CharacterScreen extends _Screen__WEBPACK_IMPORTED_MODULE_0__.default{constructor(...args){var obj,key,value;super(...args),value=void 0,(key="character")in(obj=this)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}onEnter(ctx){this.game.commands.pushDomain(_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__.INPUT_DOMAIN_MAIN_MENU),this.character=ctx.character;const stats=this.character.stats.all();this.list=new _utils_SelectableList__WEBPACK_IMPORTED_MODULE_3__.default(Object.values(stats))}onLeave(){this.game.commands.popDomain(_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__.INPUT_DOMAIN_MAIN_MENU)}handleInput(){const cmd=this.game.commands.getNextCommand();cmd&&(cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_CANCEL&&this.game.screens.popScreen(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_N&&this.list.up(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_S&&this.list.down())}onUpdate(dt){this.handleInput(),this.game.renderer.clear(),this.game.renderer.drawTextCenter(3,"~ ".concat(this.character.moniker.display," Character ~"),"orange");const health=this.character.health.value,healthMax=this.character.health.max;this.game.renderer.drawText(2,5,"health"),this.game.renderer.drawText(10,5,"".concat(health,"/").concat(healthMax));const speed=(0,_data_Skills__WEBPACK_IMPORTED_MODULE_4__.getSkillValue)(_data_Skills__WEBPACK_IMPORTED_MODULE_4__.SKILL_SPEED,this.character),speedPrcnt=(0,_data_skills_SpeedSkill__WEBPACK_IMPORTED_MODULE_5__.getSpeedPercentDisplay)(speed);this.game.renderer.drawText(2,6,"speed"),this.game.renderer.drawText(10,6,"+".concat(speed," (").concat(100-speedPrcnt,"% less movement cost)"));const armor=(0,_data_Skills__WEBPACK_IMPORTED_MODULE_4__.getSkillValue)(_data_Skills__WEBPACK_IMPORTED_MODULE_4__.SKILL_ARMOR,this.character),armorPrcnt=(0,_data_skills_ArmorSkill__WEBPACK_IMPORTED_MODULE_6__.getArmorBlockPercentDisplay)(armor);this.game.renderer.drawText(2,7,"armor"),this.game.renderer.drawText(10,7,"+".concat(armor," (").concat(armorPrcnt,"% less melee damage taken)"));const dodge=(0,_data_Skills__WEBPACK_IMPORTED_MODULE_4__.getSkillValue)(_data_Skills__WEBPACK_IMPORTED_MODULE_4__.SKILL_DODGE,this.character),dodgePrcnt=(0,_data_skills_DodgeSkill__WEBPACK_IMPORTED_MODULE_7__.getDodgePercent)(dodge);this.game.renderer.drawText(2,8,"dodge"),this.game.renderer.drawText(10,8,"+".concat(dodge," (").concat(dodgePrcnt,"% chance to avoid a melee attack)"));let pad=0;this.list.data.forEach((({item,idx,isSelected})=>{const stat=item,ypos=idx+13+pad,modDir=stat.modSum>0?"+":"-";isSelected?(this.game.renderer.drawText(1,ypos,"→ ".concat(stat.name),"yellow"),this.game.renderer.drawText(10,ypos,"".concat(modDir).concat(stat.sum),"yellow"),stat.modifiers.forEach(((mod,i)=>{mod.mod>0?this.game.renderer.drawText(3,ypos+i+1,"+".concat(mod.mod," (").concat(mod.source,")"),"green"):this.game.renderer.drawText(3,ypos+i+1,"-".concat(Math.abs(mod.mod)," (").concat(mod.source,")"),"red")})),pad+=stat.modifiers.length):(this.game.renderer.drawText(1,ypos,"- ".concat(stat.name)),this.game.renderer.drawText(10,ypos,"".concat(modDir).concat(stat.sum)))})),this.game.renderer.drawText(1,1,"← back [esc]")}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>AbilitiesScreen});var _Screen__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(150),_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(146),_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(143),_utils_SelectableList__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(156),_utils_UIWindowUtil__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(153),_data_Abilities__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(132),_enums_AbilityTypes__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(134);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class AbilitiesScreen extends _Screen__WEBPACK_IMPORTED_MODULE_0__.default{constructor(...args){super(...args),_defineProperty(this,"width",14),_defineProperty(this,"PADDING_RIGHT",2),_defineProperty(this,"PADDING_HEIGHT",6),_defineProperty(this,"character",void 0),_defineProperty(this,"list",new _utils_SelectableList__WEBPACK_IMPORTED_MODULE_3__.default)}get left(){return Math.floor(this.game.camera.width-this.width-this.PADDING_RIGHT)}get top(){return this.PADDING_HEIGHT}get height(){return Math.floor(this.game.camera.height-2*this.PADDING_HEIGHT)}onEnter(ctx){this.game.commands.pushDomain(_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__.INPUT_DOMAIN_MAIN_MENU),this.character=ctx.character,this.refreshList()}refreshList(){const evt=this.character.fireEvent("query-abilities",{abilities:[]});this.list.setItems([...evt.data.abilities.map((type=>(0,_data_Abilities__WEBPACK_IMPORTED_MODULE_5__.getAbility)(type))),{name:"Back",isBack:!0}])}onLeave(){this.game.commands.popDomain(_input_InputDomainType__WEBPACK_IMPORTED_MODULE_2__.INPUT_DOMAIN_MAIN_MENU)}selectItem(){const ability=this.list.selected;if(ability.isBack)return void this.game.screens.popScreen();const data=ability.initiate(this.character);ability.execute(this.character,data),this.game.screens.popScreen()}handleInput(){const cmd=this.game.commands.getNextCommand();cmd&&(cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_CANCEL&&this.game.screens.popScreen(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_N&&this.list.up(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_MOVE_S&&this.list.down(),cmd.type===_input_InputCommandType__WEBPACK_IMPORTED_MODULE_1__.INPUT_CMD_CONFIRM&&this.selectItem())}onUpdate(dt){this.handleInput(),(0,_utils_UIWindowUtil__WEBPACK_IMPORTED_MODULE_4__.drawUIWindow)(this.left,this.top,this.width,this.height,"Abilities",this.character.glyph);let yOffset=this.top+2,xOffset=this.left+2;this.list.data.forEach((({item:ability,idx,isSelected})=>{if(ability.isBack)return void(isSelected?this.game.renderer.drawText(xOffset,yOffset+idx,"→ Back","yellow"):this.game.renderer.drawText(xOffset,yOffset+idx,"- Back"));const display=ability.getDisplayText(this.character);isSelected?display.isEnabled?this.game.renderer.drawText(xOffset,yOffset+idx,"→ ".concat(display.text),"yellow"):this.game.renderer.drawText(xOffset,yOffset+idx,"→ ".concat(display.text),"gray"):display.isEnabled?this.game.renderer.drawText(xOffset,yOffset+idx,"- ".concat(display.text)):this.game.renderer.drawText(xOffset,yOffset+idx,"- ".concat(display.text),"gray")}));const ability=this.list.selected;if(ability.isBack)return;const description="".concat((0,_enums_AbilityTypes__WEBPACK_IMPORTED_MODULE_6__.getAbilityTypeName)(ability.type),". ").concat(ability.getDescription(this.character));this.game.renderer.drawTextWrapping(xOffset,yOffset+this.list.length+1,this.width-1,description)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>PlayerManager});var _Manager__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5),_enums_Directions__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(83);function _classPrivateFieldSet(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}return value}function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}var _entityId=new WeakMap;class PlayerManager extends _Manager__WEBPACK_IMPORTED_MODULE_0__.default{constructor(...args){var obj,key,value;super(...args),_entityId.set(this,{writable:!0,value:null}),value=[],(key="actionQueue")in(obj=this)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}get entity(){return this.game.ecs.getEntity(_classPrivateFieldGet(this,_entityId))}get id(){return _classPrivateFieldGet(this,_entityId)}get isTurn(){return this.entity.actor.hasEnergy}get position(){return this.entity.position.getPos()}getSetupData(){const entity=this.game.ecs.createPrefab("Player"),entityId=entity.id,serialized=entity.serialize();return entity.destroy(),{entityId,entity:serialized}}setup(data){_classPrivateFieldSet(this,_entityId,data.entityId),this.game.ecs.deserialize(data.entity)}getSaveGameData(){const entityId=this.entity.id,evt=this.entity.fireEvent("query-ownership",{result:new Set([this.entity])}),serialized=this.game.ecs.serialize(Array.from(evt.data.result));return console.log(serialized),{entityId,entity:serialized}}teardown(){this.entity&&this.entity.destroy(),_classPrivateFieldSet(this,_entityId,null)}getNextAction(){return this.actionQueue.shift()}move(direction){this.actionQueue.push((()=>{const delta=_enums_Directions__WEBPACK_IMPORTED_MODULE_1__.delta(direction);this.entity.fireEvent("try-move",delta)}))}melee(target){this.actionQueue.push((()=>{target.isDestroyed||target.isDead?console.warn("Melee action on destroyed target ".concat(target)):this.entity.fireEvent("try-melee",{target})}))}wait(turns=1){this.actionQueue.push((()=>{this.entity.fireEvent("energy-consumed",1e3*turns)}))}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>ECS});var geotic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_components__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(21),_prefabs__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(166),_core_Manager__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(5);function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}var _engine=new WeakMap;class ECS extends _core_Manager__WEBPACK_IMPORTED_MODULE_3__.default{get engine(){return _classPrivateFieldGet(this,_engine)}constructor(game){super(game),_engine.set(this,{writable:!0,value:void 0}),function(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}}(this,_engine,new geotic__WEBPACK_IMPORTED_MODULE_0__.Engine),Object.values(_components__WEBPACK_IMPORTED_MODULE_1__).forEach((component=>{_classPrivateFieldGet(this,_engine).registerComponent(component)})),Object.values(_prefabs__WEBPACK_IMPORTED_MODULE_2__).forEach((prefab=>{_classPrivateFieldGet(this,_engine).registerPrefab(prefab)}))}teardown(){this.destroyEntities()}destroyEntities(){for(let entity of _classPrivateFieldGet(this,_engine).entities.all)entity.destroy()}cloneEntity(entity){const data=entity.serialize();return data.id=this.engine.generateId(),this.engine.deserialize(data),this.engine.getEntity(data.id)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";var _GameObjectPrefab_json__WEBPACK_IMPORTED_MODULE_0___namespace_cache,_CorpsePrefab_json__WEBPACK_IMPORTED_MODULE_1___namespace_cache,_VialPrefab_json__WEBPACK_IMPORTED_MODULE_2___namespace_cache,_BeingPrefab_json__WEBPACK_IMPORTED_MODULE_3___namespace_cache,_HumanoidPrefab_json__WEBPACK_IMPORTED_MODULE_4___namespace_cache,_HumanPrefab_json__WEBPACK_IMPORTED_MODULE_5___namespace_cache,_WandererPrefab_json__WEBPACK_IMPORTED_MODULE_6___namespace_cache,_HumanWandererPrefab_json__WEBPACK_IMPORTED_MODULE_7___namespace_cache,_PlayerPrefab_json__WEBPACK_IMPORTED_MODULE_8___namespace_cache,_GoalPrefab_json__WEBPACK_IMPORTED_MODULE_9___namespace_cache,_TilePrefab_json__WEBPACK_IMPORTED_MODULE_10___namespace_cache,_PineTreePrefab_json__WEBPACK_IMPORTED_MODULE_11___namespace_cache,_SmallPineTreePrefab_json__WEBPACK_IMPORTED_MODULE_12___namespace_cache,_WallPrefab_json__WEBPACK_IMPORTED_MODULE_13___namespace_cache,_WoodWallPrefab_json__WEBPACK_IMPORTED_MODULE_14___namespace_cache,_GoblinPrefab_json__WEBPACK_IMPORTED_MODULE_15___namespace_cache,_ChestPrefab_json__WEBPACK_IMPORTED_MODULE_16___namespace_cache,_DoorPrefab_json__WEBPACK_IMPORTED_MODULE_17___namespace_cache,_StonePrefab_json__WEBPACK_IMPORTED_MODULE_18___namespace_cache,_GlassShardPrefab_json__WEBPACK_IMPORTED_MODULE_19___namespace_cache,_PoolPrefab_json__WEBPACK_IMPORTED_MODULE_20___namespace_cache,_DirtPathwayPrefab_json__WEBPACK_IMPORTED_MODULE_21___namespace_cache,_AmuletPrefab_json__WEBPACK_IMPORTED_MODULE_22___namespace_cache,_ClothArmorPrefab_json__WEBPACK_IMPORTED_MODULE_23___namespace_cache,_BootsPrefab_json__WEBPACK_IMPORTED_MODULE_24___namespace_cache,_WeaponPrefab_json__WEBPACK_IMPORTED_MODULE_25___namespace_cache,_ShortswordPrefab_json__WEBPACK_IMPORTED_MODULE_26___namespace_cache,_GreatswordPrefab_json__WEBPACK_IMPORTED_MODULE_27___namespace_cache,_BattleAxePrefab_json__WEBPACK_IMPORTED_MODULE_28___namespace_cache,_HatchetPrefab_json__WEBPACK_IMPORTED_MODULE_29___namespace_cache,_MacePrefab_json__WEBPACK_IMPORTED_MODULE_30___namespace_cache,_GrassPrefab_json__WEBPACK_IMPORTED_MODULE_31___namespace_cache,_StoneGroundPrefab_json__WEBPACK_IMPORTED_MODULE_32___namespace_cache,_PlateArmorPrefab_json__WEBPACK_IMPORTED_MODULE_33___namespace_cache,_LeatherArmorPrefab_json__WEBPACK_IMPORTED_MODULE_34___namespace_cache,_ClothHoodPrefab_json__WEBPACK_IMPORTED_MODULE_35___namespace_cache,_WizardCapPrefab_json__WEBPACK_IMPORTED_MODULE_36___namespace_cache,_HelmPrefab_json__WEBPACK_IMPORTED_MODULE_37___namespace_cache,_TwigPrefab_json__WEBPACK_IMPORTED_MODULE_38___namespace_cache,_AshPrefab_json__WEBPACK_IMPORTED_MODULE_39___namespace_cache;__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{GameObjectPrefab:()=>_GameObjectPrefab_json__WEBPACK_IMPORTED_MODULE_0___namespace_cache||(_GameObjectPrefab_json__WEBPACK_IMPORTED_MODULE_0___namespace_cache=__webpack_require__.t(_GameObjectPrefab_json__WEBPACK_IMPORTED_MODULE_0__,2)),CorpsePrefab:()=>_CorpsePrefab_json__WEBPACK_IMPORTED_MODULE_1___namespace_cache||(_CorpsePrefab_json__WEBPACK_IMPORTED_MODULE_1___namespace_cache=__webpack_require__.t(_CorpsePrefab_json__WEBPACK_IMPORTED_MODULE_1__,2)),VialPrefab:()=>_VialPrefab_json__WEBPACK_IMPORTED_MODULE_2___namespace_cache||(_VialPrefab_json__WEBPACK_IMPORTED_MODULE_2___namespace_cache=__webpack_require__.t(_VialPrefab_json__WEBPACK_IMPORTED_MODULE_2__,2)),BeingPrefab:()=>_BeingPrefab_json__WEBPACK_IMPORTED_MODULE_3___namespace_cache||(_BeingPrefab_json__WEBPACK_IMPORTED_MODULE_3___namespace_cache=__webpack_require__.t(_BeingPrefab_json__WEBPACK_IMPORTED_MODULE_3__,2)),HumanoidPrefab:()=>_HumanoidPrefab_json__WEBPACK_IMPORTED_MODULE_4___namespace_cache||(_HumanoidPrefab_json__WEBPACK_IMPORTED_MODULE_4___namespace_cache=__webpack_require__.t(_HumanoidPrefab_json__WEBPACK_IMPORTED_MODULE_4__,2)),HumanPrefab:()=>_HumanPrefab_json__WEBPACK_IMPORTED_MODULE_5___namespace_cache||(_HumanPrefab_json__WEBPACK_IMPORTED_MODULE_5___namespace_cache=__webpack_require__.t(_HumanPrefab_json__WEBPACK_IMPORTED_MODULE_5__,2)),WandererPrefab:()=>_WandererPrefab_json__WEBPACK_IMPORTED_MODULE_6___namespace_cache||(_WandererPrefab_json__WEBPACK_IMPORTED_MODULE_6___namespace_cache=__webpack_require__.t(_WandererPrefab_json__WEBPACK_IMPORTED_MODULE_6__,2)),HumanWanderer:()=>_HumanWandererPrefab_json__WEBPACK_IMPORTED_MODULE_7___namespace_cache||(_HumanWandererPrefab_json__WEBPACK_IMPORTED_MODULE_7___namespace_cache=__webpack_require__.t(_HumanWandererPrefab_json__WEBPACK_IMPORTED_MODULE_7__,2)),PlayerPrefab:()=>_PlayerPrefab_json__WEBPACK_IMPORTED_MODULE_8___namespace_cache||(_PlayerPrefab_json__WEBPACK_IMPORTED_MODULE_8___namespace_cache=__webpack_require__.t(_PlayerPrefab_json__WEBPACK_IMPORTED_MODULE_8__,2)),GoalPrefab:()=>_GoalPrefab_json__WEBPACK_IMPORTED_MODULE_9___namespace_cache||(_GoalPrefab_json__WEBPACK_IMPORTED_MODULE_9___namespace_cache=__webpack_require__.t(_GoalPrefab_json__WEBPACK_IMPORTED_MODULE_9__,2)),TilePrefab:()=>_TilePrefab_json__WEBPACK_IMPORTED_MODULE_10___namespace_cache||(_TilePrefab_json__WEBPACK_IMPORTED_MODULE_10___namespace_cache=__webpack_require__.t(_TilePrefab_json__WEBPACK_IMPORTED_MODULE_10__,2)),PineTreePrefab:()=>_PineTreePrefab_json__WEBPACK_IMPORTED_MODULE_11___namespace_cache||(_PineTreePrefab_json__WEBPACK_IMPORTED_MODULE_11___namespace_cache=__webpack_require__.t(_PineTreePrefab_json__WEBPACK_IMPORTED_MODULE_11__,2)),SmallPineTreePrefab:()=>_SmallPineTreePrefab_json__WEBPACK_IMPORTED_MODULE_12___namespace_cache||(_SmallPineTreePrefab_json__WEBPACK_IMPORTED_MODULE_12___namespace_cache=__webpack_require__.t(_SmallPineTreePrefab_json__WEBPACK_IMPORTED_MODULE_12__,2)),WallPrefab:()=>_WallPrefab_json__WEBPACK_IMPORTED_MODULE_13___namespace_cache||(_WallPrefab_json__WEBPACK_IMPORTED_MODULE_13___namespace_cache=__webpack_require__.t(_WallPrefab_json__WEBPACK_IMPORTED_MODULE_13__,2)),WoodWallPrefab:()=>_WoodWallPrefab_json__WEBPACK_IMPORTED_MODULE_14___namespace_cache||(_WoodWallPrefab_json__WEBPACK_IMPORTED_MODULE_14___namespace_cache=__webpack_require__.t(_WoodWallPrefab_json__WEBPACK_IMPORTED_MODULE_14__,2)),GoblinPrefab:()=>_GoblinPrefab_json__WEBPACK_IMPORTED_MODULE_15___namespace_cache||(_GoblinPrefab_json__WEBPACK_IMPORTED_MODULE_15___namespace_cache=__webpack_require__.t(_GoblinPrefab_json__WEBPACK_IMPORTED_MODULE_15__,2)),ChestPrefab:()=>_ChestPrefab_json__WEBPACK_IMPORTED_MODULE_16___namespace_cache||(_ChestPrefab_json__WEBPACK_IMPORTED_MODULE_16___namespace_cache=__webpack_require__.t(_ChestPrefab_json__WEBPACK_IMPORTED_MODULE_16__,2)),DoorPrefab:()=>_DoorPrefab_json__WEBPACK_IMPORTED_MODULE_17___namespace_cache||(_DoorPrefab_json__WEBPACK_IMPORTED_MODULE_17___namespace_cache=__webpack_require__.t(_DoorPrefab_json__WEBPACK_IMPORTED_MODULE_17__,2)),StonePrefab:()=>_StonePrefab_json__WEBPACK_IMPORTED_MODULE_18___namespace_cache||(_StonePrefab_json__WEBPACK_IMPORTED_MODULE_18___namespace_cache=__webpack_require__.t(_StonePrefab_json__WEBPACK_IMPORTED_MODULE_18__,2)),GlassShardPrefab:()=>_GlassShardPrefab_json__WEBPACK_IMPORTED_MODULE_19___namespace_cache||(_GlassShardPrefab_json__WEBPACK_IMPORTED_MODULE_19___namespace_cache=__webpack_require__.t(_GlassShardPrefab_json__WEBPACK_IMPORTED_MODULE_19__,2)),PoolPrefab:()=>_PoolPrefab_json__WEBPACK_IMPORTED_MODULE_20___namespace_cache||(_PoolPrefab_json__WEBPACK_IMPORTED_MODULE_20___namespace_cache=__webpack_require__.t(_PoolPrefab_json__WEBPACK_IMPORTED_MODULE_20__,2)),DirtPathwayPrefab:()=>_DirtPathwayPrefab_json__WEBPACK_IMPORTED_MODULE_21___namespace_cache||(_DirtPathwayPrefab_json__WEBPACK_IMPORTED_MODULE_21___namespace_cache=__webpack_require__.t(_DirtPathwayPrefab_json__WEBPACK_IMPORTED_MODULE_21__,2)),AmuletPrefab:()=>_AmuletPrefab_json__WEBPACK_IMPORTED_MODULE_22___namespace_cache||(_AmuletPrefab_json__WEBPACK_IMPORTED_MODULE_22___namespace_cache=__webpack_require__.t(_AmuletPrefab_json__WEBPACK_IMPORTED_MODULE_22__,2)),ClothArmorPrefab:()=>_ClothArmorPrefab_json__WEBPACK_IMPORTED_MODULE_23___namespace_cache||(_ClothArmorPrefab_json__WEBPACK_IMPORTED_MODULE_23___namespace_cache=__webpack_require__.t(_ClothArmorPrefab_json__WEBPACK_IMPORTED_MODULE_23__,2)),BootsPrefab:()=>_BootsPrefab_json__WEBPACK_IMPORTED_MODULE_24___namespace_cache||(_BootsPrefab_json__WEBPACK_IMPORTED_MODULE_24___namespace_cache=__webpack_require__.t(_BootsPrefab_json__WEBPACK_IMPORTED_MODULE_24__,2)),WeaponPrefab:()=>_WeaponPrefab_json__WEBPACK_IMPORTED_MODULE_25___namespace_cache||(_WeaponPrefab_json__WEBPACK_IMPORTED_MODULE_25___namespace_cache=__webpack_require__.t(_WeaponPrefab_json__WEBPACK_IMPORTED_MODULE_25__,2)),ShortswordPrefab:()=>_ShortswordPrefab_json__WEBPACK_IMPORTED_MODULE_26___namespace_cache||(_ShortswordPrefab_json__WEBPACK_IMPORTED_MODULE_26___namespace_cache=__webpack_require__.t(_ShortswordPrefab_json__WEBPACK_IMPORTED_MODULE_26__,2)),GreatswordPrefab:()=>_GreatswordPrefab_json__WEBPACK_IMPORTED_MODULE_27___namespace_cache||(_GreatswordPrefab_json__WEBPACK_IMPORTED_MODULE_27___namespace_cache=__webpack_require__.t(_GreatswordPrefab_json__WEBPACK_IMPORTED_MODULE_27__,2)),BattleAxePrefab:()=>_BattleAxePrefab_json__WEBPACK_IMPORTED_MODULE_28___namespace_cache||(_BattleAxePrefab_json__WEBPACK_IMPORTED_MODULE_28___namespace_cache=__webpack_require__.t(_BattleAxePrefab_json__WEBPACK_IMPORTED_MODULE_28__,2)),HatchetPrefab:()=>_HatchetPrefab_json__WEBPACK_IMPORTED_MODULE_29___namespace_cache||(_HatchetPrefab_json__WEBPACK_IMPORTED_MODULE_29___namespace_cache=__webpack_require__.t(_HatchetPrefab_json__WEBPACK_IMPORTED_MODULE_29__,2)),MacePrefab:()=>_MacePrefab_json__WEBPACK_IMPORTED_MODULE_30___namespace_cache||(_MacePrefab_json__WEBPACK_IMPORTED_MODULE_30___namespace_cache=__webpack_require__.t(_MacePrefab_json__WEBPACK_IMPORTED_MODULE_30__,2)),GrassPrefab:()=>_GrassPrefab_json__WEBPACK_IMPORTED_MODULE_31___namespace_cache||(_GrassPrefab_json__WEBPACK_IMPORTED_MODULE_31___namespace_cache=__webpack_require__.t(_GrassPrefab_json__WEBPACK_IMPORTED_MODULE_31__,2)),StoneGroundPrefab:()=>_StoneGroundPrefab_json__WEBPACK_IMPORTED_MODULE_32___namespace_cache||(_StoneGroundPrefab_json__WEBPACK_IMPORTED_MODULE_32___namespace_cache=__webpack_require__.t(_StoneGroundPrefab_json__WEBPACK_IMPORTED_MODULE_32__,2)),PlateArmorPrefab:()=>_PlateArmorPrefab_json__WEBPACK_IMPORTED_MODULE_33___namespace_cache||(_PlateArmorPrefab_json__WEBPACK_IMPORTED_MODULE_33___namespace_cache=__webpack_require__.t(_PlateArmorPrefab_json__WEBPACK_IMPORTED_MODULE_33__,2)),LeatherArmorPrefab:()=>_LeatherArmorPrefab_json__WEBPACK_IMPORTED_MODULE_34___namespace_cache||(_LeatherArmorPrefab_json__WEBPACK_IMPORTED_MODULE_34___namespace_cache=__webpack_require__.t(_LeatherArmorPrefab_json__WEBPACK_IMPORTED_MODULE_34__,2)),ClothHoodPrefab:()=>_ClothHoodPrefab_json__WEBPACK_IMPORTED_MODULE_35___namespace_cache||(_ClothHoodPrefab_json__WEBPACK_IMPORTED_MODULE_35___namespace_cache=__webpack_require__.t(_ClothHoodPrefab_json__WEBPACK_IMPORTED_MODULE_35__,2)),WizardCapPrefab:()=>_WizardCapPrefab_json__WEBPACK_IMPORTED_MODULE_36___namespace_cache||(_WizardCapPrefab_json__WEBPACK_IMPORTED_MODULE_36___namespace_cache=__webpack_require__.t(_WizardCapPrefab_json__WEBPACK_IMPORTED_MODULE_36__,2)),HelmPrefab:()=>_HelmPrefab_json__WEBPACK_IMPORTED_MODULE_37___namespace_cache||(_HelmPrefab_json__WEBPACK_IMPORTED_MODULE_37___namespace_cache=__webpack_require__.t(_HelmPrefab_json__WEBPACK_IMPORTED_MODULE_37__,2)),TwigPrefab:()=>_TwigPrefab_json__WEBPACK_IMPORTED_MODULE_38___namespace_cache||(_TwigPrefab_json__WEBPACK_IMPORTED_MODULE_38___namespace_cache=__webpack_require__.t(_TwigPrefab_json__WEBPACK_IMPORTED_MODULE_38__,2)),AshPrefab:()=>_AshPrefab_json__WEBPACK_IMPORTED_MODULE_39___namespace_cache||(_AshPrefab_json__WEBPACK_IMPORTED_MODULE_39___namespace_cache=__webpack_require__.t(_AshPrefab_json__WEBPACK_IMPORTED_MODULE_39__,2))});var _GameObjectPrefab_json__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(167),_CorpsePrefab_json__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(168),_VialPrefab_json__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(169),_BeingPrefab_json__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(170),_HumanoidPrefab_json__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(171),_HumanPrefab_json__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(172),_WandererPrefab_json__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(173),_HumanWandererPrefab_json__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(174),_PlayerPrefab_json__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(175),_GoalPrefab_json__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(176),_TilePrefab_json__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(177),_PineTreePrefab_json__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(178),_SmallPineTreePrefab_json__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(179),_WallPrefab_json__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(180),_WoodWallPrefab_json__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(181),_GoblinPrefab_json__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(182),_ChestPrefab_json__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(183),_DoorPrefab_json__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(184),_StonePrefab_json__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(185),_GlassShardPrefab_json__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(186),_PoolPrefab_json__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(187),_DirtPathwayPrefab_json__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(188),_AmuletPrefab_json__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(189),_ClothArmorPrefab_json__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(190),_BootsPrefab_json__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(191),_WeaponPrefab_json__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(192),_ShortswordPrefab_json__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(193),_GreatswordPrefab_json__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__(194),_BattleAxePrefab_json__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__(195),_HatchetPrefab_json__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__(196),_MacePrefab_json__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__(197),_GrassPrefab_json__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__(198),_StoneGroundPrefab_json__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__(199),_PlateArmorPrefab_json__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__(200),_LeatherArmorPrefab_json__WEBPACK_IMPORTED_MODULE_34__=__webpack_require__(201),_ClothHoodPrefab_json__WEBPACK_IMPORTED_MODULE_35__=__webpack_require__(202),_WizardCapPrefab_json__WEBPACK_IMPORTED_MODULE_36__=__webpack_require__(203),_HelmPrefab_json__WEBPACK_IMPORTED_MODULE_37__=__webpack_require__(204),_TwigPrefab_json__WEBPACK_IMPORTED_MODULE_38__=__webpack_require__(205),_AshPrefab_json__WEBPACK_IMPORTED_MODULE_39__=__webpack_require__(206)},module=>{"use strict";module.exports=JSON.parse('{"name":"GameObject","components":[{"type":"Position"},{"type":"Glyph","properties":{"char":"?"}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Corpse","inherit":["GameObject"],"components":[{"type":"Moniker","properties":{"name":"Corpse"}},{"type":"Glyph","properties":{"ch":"%","fg1":"#730d14"}},{"type":"Loot"}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Vial","inherit":["GameObject"],"components":[{"type":"Moniker","properties":{"name":"Vial"}},{"type":"Glyph","properties":{"ch":"!","fg2":"#66a3dc","fg1":"transparent"}},{"type":"Loot"},{"type":"Throwable"},{"type":"FragileGlass"},{"type":"LiquidContainer","properties":{"content":1,"volume":5,"maxVolume":10,"overridePrimary":true,"overrideSecondary":true,"isPourable":true}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Being","inherit":["GameObject"],"components":[{"type":"Position"},{"type":"Actor","properties":{"energy":-500}},{"type":"Health"},{"type":"Glyph","properties":{"char":"?"}},{"type":"Stats"},{"type":"Abilities"}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Humanoid","inherit":["Being"],"components":[{"type":"Glyph","properties":{"ch":"h","fg1":"#ccc","z":8000}},{"type":"Inventory","properties":{"isOpenable":false}},{"type":"EquipmentSlot","properties":{"name":"Head","key":"head","slotType":"EQ_SLOT_HEAD"}},{"type":"EquipmentSlot","properties":{"name":"Neck","key":"neck","slotType":"EQ_SLOT_NECK"}},{"type":"EquipmentSlot","properties":{"name":"Body","key":"body","slotType":"EQ_SLOT_BODY"}},{"type":"EquipmentSlot","properties":{"name":"Left arm","key":"armLeft","slotType":"EQ_SLOT_ARM"}},{"type":"EquipmentSlot","properties":{"name":"Right hand","key":"handRight","slotType":"EQ_SLOT_HAND","isPrimary":true}},{"type":"EquipmentSlot","properties":{"name":"Right arm","key":"armRight","slotType":"EQ_SLOT_ARM"}},{"type":"EquipmentSlot","properties":{"name":"Left hand","key":"handLeft","slotType":"EQ_SLOT_HAND","isOffhand":true}},{"type":"EquipmentSlot","properties":{"name":"Feet","key":"feet","slotType":"EQ_SLOT_FEET"}},{"type":"Body"},{"type":"Legs"},{"type":"Eyes","properties":{"range":10}},{"type":"FactionMember","properties":{"name":"neutral"}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Human","inherit":["Humanoid"],"components":[{"type":"Race","properties":{"key":"RACE_HUMAN"}},{"type":"Glyph","properties":{"ch":"h","fg1":"pink"}},{"type":"FactionMember","properties":{"name":"villager"}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Wanderer","components":[{"type":"Moniker","properties":{"name":"Wanderer"}},{"type":"Wandering"},{"type":"Brain"},{"type":"Logger"}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"HumanWanderer","inherit":["Human","Wanderer"],"components":[{"type":"LootDropper","properties":{"tables":["TBL_LOOT_GOBLIN","TBL_LOOT_FOREST"]}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Player","inherit":["Human"],"components":[{"type":"Actor","properties":{"energy":0}},{"type":"Health","properties":{"value":64,"max":64}},{"type":"Moniker","properties":{"name":"Player"}},{"type":"Glyph","properties":{"ch":"@","fg1":"#adb8bc","fg2":"#66a3dc","z":10000}},{"type":"IsPlayer"},{"type":"FactionMember","properties":{"name":"player"}},{"type":"Inventory"},{"type":"Logger"},{"type":"Stats","properties":{"baseStrength":2}},{"type":"Abilities","properties":{"known":["ABILITY_SPRINT","ABILITY_RAGE"]}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Goal","components":[{"type":"Goal"}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Tile","components":[{"type":"Position"},{"type":"Explorable"},{"type":"Glyph","properties":{"ch":".","fg1":"#444"}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"PineTree","inherit":["Tile"],"components":[{"type":"Moniker","properties":{"name":"Pine Tree"}},{"type":"Glyph","properties":{"ch":"♣","fg1":"#467548","fg2":"#744931"}},{"type":"Blocker"},{"type":"Shadowcaster"},{"type":"Combustible","properties":{"spawnableRemains":"SPWN_ASH"}},{"type":"ThermalCapacity"}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"SmallPineTree","inherit":["PineTree"],"components":[{"type":"Glyph","properties":{"ch":"♠","fg1":"#467548","fg2":"#744931"}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Wall","inherit":["Tile"],"components":[{"type":"Moniker","properties":{"name":"Wall"}},{"type":"Glyph","properties":{"ch":"#","fg1":"#556267","fg2":"#556267"}},{"type":"Blocker"},{"type":"Shadowcaster"},{"type":"ThermalCapacity","properties":{"value":0.01}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"WoodWall","inherit":["Wall"],"components":[{"type":"Moniker","properties":{"name":"Wooden wall"}},{"type":"Glyph","properties":{"ch":"H","fg1":"#923e2b"}},{"type":"Combustible","properties":{"spawnableRemains":"SPWN_ASH"}},{"type":"ThermalCapacity","properties":{"value":0.05}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Goblin","inherit":["Humanoid","Wanderer"],"components":[{"type":"Race","properties":{"key":"RACE_GOBLIN"}},{"type":"Moniker","properties":{"name":"Goblin"}},{"type":"Glyph","properties":{"ch":"g","fg1":"#5d8250","z":8000}},{"type":"FactionMember","properties":{"name":"goblin"}},{"type":"LootDropper","properties":{"tables":["TBL_LOOT_GOBLIN","TBL_LOOT_FOREST"]}},{"type":"Stats"}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Chest","inherit":["GameObject"],"components":[{"type":"Moniker","properties":{"name":"Chest"}},{"type":"Glyph","properties":{"ch":"⌂","fg1":"#a66b44"}},{"type":"Inventory"}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Door","inherit":["GameObject"],"components":[{"type":"Moniker","properties":{"name":"Door"}},{"type":"Glyph","properties":{"ch":"+","fg1":"#923e2b"}},{"type":"Door","properties":{"chOpen":"\'","chClosed":"+"}},{"type":"Blocker"},{"type":"Explorable"},{"type":"Shadowcaster"},{"type":"Combustible"}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Stone","inherit":["GameObject"],"components":[{"type":"Moniker","properties":{"name":"Stone"}},{"type":"Glyph","properties":{"ch":":","fg1":"#c8b5b7"}},{"type":"Loot"},{"type":"Throwable"},{"type":"Stackable","properties":{"identifier":"STACKABLE_STONE"}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"GlassShard","inherit":["GameObject"],"components":[{"type":"Moniker","properties":{"name":"Glass shard"}},{"type":"Glyph","properties":{"ch":"«","fg1":"#c8b5b7"}},{"type":"Loot"},{"type":"Stackable","properties":{"identifier":"STACKABLE_GLASS_SHARD"}},{"type":"SharpTrap"}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Pool","inherit":["GameObject"],"components":[{"type":"Moniker","properties":{"name":"Pool"}},{"type":"Glyph","properties":{"ch":"≈","fg2":"#66a3dc","fg1":"transparent","z":300}},{"type":"LiquidContainer","properties":{"content":1,"volume":10,"maxVolume":100,"overridePrimary":true,"overrideSecondary":true,"destroyOnEmpty":true,"isFreeFlowing":true}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"DirtPathway","inherit":["GameObject"],"components":[{"type":"Moniker","properties":{"name":"Dirt path"}},{"type":"Glyph","properties":{"ch":"░","fg1":"#a66b44","z":110}},{"type":"Explorable"}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Amulet","inherit":["GameObject"],"components":[{"type":"Moniker","properties":{"name":"Amulet"}},{"type":"Glyph","properties":{"ch":"ü","fg1":"#44c081","fg2":"#9eafb3"}},{"type":"Loot"},{"type":"Equipment","properties":{"slotTypes":["EQ_SLOT_NECK","EQ_SLOT_ARM"]}},{"type":"Throwable"}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"ClothArmor","inherit":["GameObject"],"components":[{"type":"Moniker","properties":{"name":"Cloth armor"}},{"type":"Glyph","properties":{"ch":"[","fg1":"#587546","fg2":"#402f20"}},{"type":"Loot"},{"type":"Equipment","properties":{"slotTypes":["EQ_SLOT_BODY"]}},{"type":"EquippedSkillMod","properties":{"SKILL_ARMOR":1,"SKILL_DODGE":3}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Boots","inherit":["GameObject"],"components":[{"type":"Moniker","properties":{"name":"Boots"}},{"type":"Glyph","properties":{"ch":"£","fg1":"#923e2b"}},{"type":"Loot"},{"type":"Equipment","properties":{"slotTypes":["EQ_SLOT_FEET"]}},{"type":"EquippedSkillMod","properties":{"SKILL_ARMOR":1,"SKILL_DODGE":1,"SKILL_SPEED":1}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Weapon","inherit":["GameObject"],"components":[{"type":"Moniker","properties":{"name":"Weapon"}},{"type":"Glyph","properties":{"ch":"(","fg1":"silver"}},{"type":"Weapon","properties":{"weaponType":"WPN_TYPE_DAGGER"}},{"type":"Loot"},{"type":"Equipment","properties":{"slotTypes":["EQ_SLOT_HAND"]}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Shortsword","inherit":["Weapon"],"components":[{"type":"Moniker","properties":{"name":"Shortsword"}},{"type":"Glyph","properties":{"ch":"(","fg1":"silver","fg2":"#923e2b"}},{"type":"Weapon","properties":{"weaponType":"WPN_TYPE_SHORTSWORD"}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Greatsword","inherit":["Weapon"],"components":[{"type":"Moniker","properties":{"name":"Greatsword"}},{"type":"Glyph","properties":{"ch":")","fg1":"silver","fg2":"#923e2b"}},{"type":"Weapon","properties":{"weaponType":"WPN_TYPE_GREATSWORD","die":12,"modifier":2,"cost":800}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"BattleAxe","inherit":["Weapon"],"components":[{"type":"Moniker","properties":{"name":"Battle axe"}},{"type":"Glyph","properties":{"ch":"Γ","fg1":"silver","fg2":"#923e2b"}},{"type":"Weapon","properties":{"weaponType":"WPN_TYPE_BATTLE_AXE"}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Hatchet","inherit":["Weapon"],"components":[{"type":"Moniker","properties":{"name":"Hatchet"}},{"type":"Glyph","properties":{"ch":"ß","fg1":"silver","fg2":"#923e2b"}},{"type":"Weapon","properties":{"weaponType":"WPN_TYPE_BATTLE_AXE","die":4}},{"type":"Throwable","properties":{"damageType":"DMG_TYPE_SLASHING","die":4,"modifier":2}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Mace","inherit":["Weapon"],"components":[{"type":"Moniker","properties":{"name":"Mace"}},{"type":"Glyph","properties":{"ch":"í","fg1":"silver","fg2":"#923e2b"}},{"type":"Weapon","properties":{"weaponType":"WPN_TYPE_MACE"}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Grass","inherit":["GameObject"],"components":[{"type":"Glyph","properties":{"ch":"·","fg1":"#4e6151","z":100}},{"type":"Explorable"},{"type":"Ground"}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"StoneGround","inherit":["GameObject"],"components":[{"type":"Glyph","properties":{"ch":"·","fg1":"#57595b","z":100}},{"type":"Explorable"},{"type":"Ground"}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"PlateArmor","inherit":["GameObject"],"components":[{"type":"Moniker","properties":{"name":"Heavy plate armor"}},{"type":"Glyph","properties":{"ch":"]","fg1":"silver"}},{"type":"Loot"},{"type":"Equipment","properties":{"slotTypes":["EQ_SLOT_BODY"]}},{"type":"EquippedSkillMod","properties":{"SKILL_ARMOR":6}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"LeatherArmor","inherit":["GameObject"],"components":[{"type":"Moniker","properties":{"name":"Leather armor"}},{"type":"Glyph","properties":{"ch":"\\\\","fg1":"#923e2b"}},{"type":"Loot"},{"type":"Equipment","properties":{"slotTypes":["EQ_SLOT_BODY"]}},{"type":"EquippedSkillMod","properties":{"SKILL_ARMOR":2,"SKILL_DODGE":2}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"ClothHood","inherit":["GameObject"],"components":[{"type":"Moniker","properties":{"name":"Cloth hood"}},{"type":"Glyph","properties":{"ch":"é","fg1":"#587546","fg2":"#402f20"}},{"type":"Loot"},{"type":"Equipment","properties":{"slotTypes":["EQ_SLOT_HEAD"]}},{"type":"EquippedSkillMod","properties":{"SKILL_DODGE":2}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"WizardCap","inherit":["GameObject"],"components":[{"type":"Moniker","properties":{"name":"Wizard cap"}},{"type":"Glyph","properties":{"ch":"ä","fg1":"#535e7e","fg2":"#ebce6d"}},{"type":"Loot"},{"type":"Equipment","properties":{"slotTypes":["EQ_SLOT_HEAD"]}},{"type":"EquippedSkillMod","properties":{"SKILL_DODGE":2}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Helm","inherit":["GameObject"],"components":[{"type":"Moniker","properties":{"name":"Helm"}},{"type":"Glyph","properties":{"ch":"â","fg1":"silver"}},{"type":"Loot"},{"type":"Equipment","properties":{"slotTypes":["EQ_SLOT_HEAD"]}},{"type":"EquippedSkillMod","properties":{"SKILL_ARMOR":2}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Twig","inherit":["GameObject"],"components":[{"type":"Moniker","properties":{"name":"Twig"}},{"type":"Glyph","properties":{"ch":"/","fg1":"brown","fg2":"green"}},{"type":"Loot"},{"type":"Throwable"},{"type":"Combustible","properties":{"spawnableRemains":"SPWN_ASH","fuel":8}}]}')},module=>{"use strict";module.exports=JSON.parse('{"name":"Ash","inherit":["GameObject"],"components":[{"type":"Moniker","properties":{"name":"Ash"}},{"type":"Glyph","properties":{"ch":".","fg1":"#c8b5b7"}},{"type":"Loot"},{"type":"Stackable","properties":{"identifier":"STACKABLE_ASH"}}]}')},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>GameStateManager});var _Manager__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5);function _classPrivateFieldSet(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}return value}function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}var _isStarted=new WeakMap,_filename=new WeakMap;class GameStateManager extends _Manager__WEBPACK_IMPORTED_MODULE_0__.default{constructor(...args){super(...args),_isStarted.set(this,{writable:!0,value:!1}),_filename.set(this,{writable:!0,value:"test"})}get filename(){return _classPrivateFieldGet(this,_filename)}get isStarted(){return _classPrivateFieldGet(this,_isStarted)}gameOver(){_classPrivateFieldSet(this,_isStarted,!1)}initiateTeardown(){console.log("STATE - teardown"),_classPrivateFieldSet(this,_isStarted,!1),this.game.player.teardown(),this.game.map.teardown(),this.game.engine.teardown(),this.game.world.teardown(),this.game.temperature.teardown()}initiateSetup(data){console.log("STATE - setup"),_classPrivateFieldSet(this,_isStarted,!0),this.game.clock.setup(data.clock),this.game.player.setup(data.player),this.game.world.setup(data.world),this.game.map.setup(data.map)}newGame(){_classPrivateFieldSet(this,_filename,prompt("Enter save name","test")),this.deleteFile(this.filename),this.initiateTeardown();const data={filename:this.filename,clock:this.game.clock.getSetupData(),player:this.game.player.getSetupData(),world:this.game.world.getSetupData(),map:this.game.map.getSetupData()};this.initiateSetup(data)}saveGame(){if(!this.isStarted)return void console.warn("cannot save game since it's not started");const data={filename:this.filename,clock:this.game.clock.getSaveGameData(),map:this.game.map.getSaveGameData(),player:this.game.player.getSaveGameData(),world:this.game.world.getSaveGameData(),temperature:this.game.temperature.getSaveGameData()};return console.log("save data",data),localStorage.setItem(this.filename,JSON.stringify(data)),data}deleteFile(filename){Object.keys(localStorage).forEach((file=>{file.startsWith("".concat(filename,"-"))&&localStorage.removeItem(file)}))}saveSectorPositionData(sectorId,positionData){localStorage.setItem("".concat(this.filename,"-").concat(sectorId,"-positions"),JSON.stringify(positionData))}saveSectorTemperatureData(sectorId,temperatureData){localStorage.setItem("".concat(this.filename,"-").concat(sectorId,"-temperatures"),JSON.stringify(temperatureData))}saveSectorEntityData(sectorId,entityData){localStorage.setItem("".concat(this.filename,"-").concat(sectorId,"-entities"),JSON.stringify(entityData))}loadSectorEntityData(sectorId){const json=localStorage.getItem("".concat(this.filename,"-").concat(sectorId,"-entities"));return json&&JSON.parse(json)}loadSectorPositionData(sectorId){const json=localStorage.getItem("".concat(this.filename,"-").concat(sectorId,"-positions"));return json&&JSON.parse(json)}loadSectorTemperatureData(sectorId){const json=localStorage.getItem("".concat(this.filename,"-").concat(sectorId,"-temperatures"));return json&&JSON.parse(json)}loadSavefileData(filename){const json=localStorage.getItem(filename);return json&&JSON.parse(json)}loadGame(){const filename=prompt("Enter save filename to load","test"),data=this.loadSavefileData(filename);data||console.warn("save file ".concat(filename," not found")),_classPrivateFieldSet(this,_filename,filename),console.log("Loading game",data),this.initiateTeardown(),this.initiateSetup(data)}loadGameData(data){this.initiateTeardown(),this.initiateSetup(data)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>ClockManager});var _Manager__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5);function _classPrivateFieldSet(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}return value}function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}var _tick=new WeakMap,_tickDelta=new WeakMap,_turnDelta=new WeakMap;class ClockManager extends _Manager__WEBPACK_IMPORTED_MODULE_0__.default{constructor(...args){super(...args),_tick.set(this,{writable:!0,value:0}),_tickDelta.set(this,{writable:!0,value:0}),_turnDelta.set(this,{writable:!0,value:0})}get tick(){return _classPrivateFieldGet(this,_tick)}get tickDelta(){return _classPrivateFieldGet(this,_tickDelta)}get turnDelta(){return _classPrivateFieldGet(this,_turnDelta)}get turn(){return Math.floor(_classPrivateFieldGet(this,_tick)/1e3)}get subTurn(){return _classPrivateFieldGet(this,_tick)-1e3*this.turn}getSetupData(){return{tick:0,tickDelta:0}}getSaveGameData(){return{tick:this.tick,tickDelta:this.tickDelta}}setup(data){_classPrivateFieldSet(this,_tick,data.tick),_classPrivateFieldSet(this,_tickDelta,data.tickDelta)}incrementTick(delta){const prevTurn=this.turn;_classPrivateFieldSet(this,_tickDelta,delta),_classPrivateFieldSet(this,_tick,_classPrivateFieldGet(this,_tick)+delta);const curTurn=this.turn;_classPrivateFieldSet(this,_turnDelta,curTurn-prevTurn)}update(dt){_classPrivateFieldSet(this,_tickDelta,0),_classPrivateFieldSet(this,_turnDelta,0)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>CursorSystem});var _ecs_components__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(21),_enums_Directions__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(83),_System__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(138);function _classPrivateFieldSet(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}return value}function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}var _isEnabled=new WeakMap,_x=new WeakMap,_y=new WeakMap;class CursorSystem extends _System__WEBPACK_IMPORTED_MODULE_2__.default{constructor(...args){super(...args),_isEnabled.set(this,{writable:!0,value:!1}),_x.set(this,{writable:!0,value:1}),_y.set(this,{writable:!0,value:1})}get x(){return _classPrivateFieldGet(this,_x)}get y(){return _classPrivateFieldGet(this,_y)}get isEnabled(){return _classPrivateFieldGet(this,_isEnabled)}enable(){const player=this.game.player.position;_classPrivateFieldSet(this,_x,player.x),_classPrivateFieldSet(this,_y,player.y),_classPrivateFieldSet(this,_isEnabled,!0)}disable(){_classPrivateFieldSet(this,_isEnabled,!1)}toggle(){this.isEnabled?this.disable():this.enable()}move(direction){const delta=_enums_Directions__WEBPACK_IMPORTED_MODULE_1__.delta(direction);_classPrivateFieldSet(this,_x,_classPrivateFieldGet(this,_x)+delta.x),_classPrivateFieldSet(this,_y,_classPrivateFieldGet(this,_y)+delta.y)}getEntities(){return this.game.map.getEntitiesAt(this.x,this.y).filter((e=>e.has(_ecs_components__WEBPACK_IMPORTED_MODULE_0__.IsVisible)))}drawCursor(color="yellow"){const screen=this.game.camera.worldToScreen(this.x,this.y);this.game.renderer.draw(screen.x,screen.y,"X",color)}drawTags(){const entities=this.getEntities().filter((e=>e.has(_ecs_components__WEBPACK_IMPORTED_MODULE_0__.Moniker))),screen=this.game.camera.worldToScreen(this.x,this.y);screen.x<this.game.camera.width/2?entities.forEach(((entity,i)=>{const c=0===i?"◄":" ";this.game.renderer.drawText(screen.x+1,screen.y+i,"".concat(c,"█"),"#ddd"),this.game.renderer.drawText(screen.x+2,screen.y+i,entity.moniker.display+" ","#111133","white","#ddd")})):entities.forEach(((entity,i)=>{const c=0===i?"►":" ";this.game.renderer.drawText(screen.x-1,screen.y+i,"█".concat(c),"#ddd");const len=this.game.renderer.computeTextWidth(entity.moniker.display);this.game.renderer.drawText(screen.x-len-1.5,screen.y+i," "+entity.moniker.display,"#111133","white","#ddd")}))}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>MapManager});var _Manager__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5),_utils_FastMap__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(211),_ecs_components__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(21);__webpack_require__(7);function _classPrivateFieldSet(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}return value}function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}var _playerOutOfBounds=new WeakMap,_width=new WeakMap,_height=new WeakMap;class MapManager extends _Manager__WEBPACK_IMPORTED_MODULE_0__.default{get width(){return _classPrivateFieldGet(this,_width)}get height(){return _classPrivateFieldGet(this,_height)}constructor(game){var obj,key,value;super(game),_playerOutOfBounds.set(this,{writable:!0,value:null}),value=void 0,(key="positions")in(obj=this)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,_width.set(this,{writable:!0,value:32}),_height.set(this,{writable:!0,value:32}),this.query=this.game.ecs.createQuery({all:[_ecs_components__WEBPACK_IMPORTED_MODULE_2__.Position],none:[_ecs_components__WEBPACK_IMPORTED_MODULE_2__.IsInventoried]}),this.positions=new _utils_FastMap__WEBPACK_IMPORTED_MODULE_1__.default(this.width,this.height),this.query.onEntityAdded((e=>{this.positions.set(0,0,e.id)})),this.query.onEntityRemoved((e=>{this.positions.remove(e.id)}))}getSetupData(){return{}}teardown(){_classPrivateFieldSet(this,_playerOutOfBounds,!1),this.positions.clear()}setup(data){if(data.playerPosition)this.game.player.entity.position.setPos(data.playerPosition.x,data.playerPosition.y);else{const position=this.getRandomEmptyPosition();this.game.player.entity.position.setPos(position.x,position.y)}this.game.FOVSystem.computeFOV()}getSaveGameData(){const data=this.positions.serialize();return this.game.state.saveSectorPositionData(this.game.world.sectorId,data),{playerPosition:this.game.player.position}}onSectorLoaded(sector){_classPrivateFieldSet(this,_playerOutOfBounds,!1);const data=this.game.state.loadSectorPositionData(sector.id);data&&this.positions.deserialize(data)}getPosition(entityId){return this.positions.getPosition(entityId)}setPosition(x,y,entityId){this.positions.isOutOfBounds(x,y)?this.game.player.id===entityId&&_classPrivateFieldSet(this,_playerOutOfBounds,{x,y}):(this.positions.set(x,y,entityId),entityId===this.game.player.id&&this.game.camera.setFocus(x,y))}getEntitiesAt(x,y,includeGround=!1){return this.positions.get(x,y).reduce(((entities,id)=>{const e=this.game.ecs.getEntity(id);return e.isInventoried||!includeGround&&e.ground||entities.push(e),entities}),[])}isAdjacent(x1,y1,x2,y2){return Math.abs(x1-x2)<=1&&Math.abs(y1-y2)<=1}getEntitiesInRect(x,y,width,height){const entities=[];for(let i=x;i<x+width+1;i++)for(let j=y;j<y+height+1;j++)entities.push(...this.getEntitiesAt(i,j));return entities}getEntitiesInRange(x,y,range){const diameter=2*range;return this.getEntitiesInRect(x-range,y-range,diameter,diameter)}getNeighborEntities(x,y){return[this.getEntitiesAt(x-1,y-1),this.getEntitiesAt(x,y-1),this.getEntitiesAt(x+1,y-1),this.getEntitiesAt(x-1,y),this.getEntitiesAt(x+1,y),this.getEntitiesAt(x-1,y+1),this.getEntitiesAt(x,y+1),this.getEntitiesAt(x+1,y+1)]}getRandomEmptyPosition(){let x,y;do{x=Math.trunc(Math.random()*this.width),y=Math.trunc(Math.random()*this.height)}while(this.getEntitiesAt(x,y,!1).length>0);return{x,y}}isOutOfbounds(x,y){return x<0||y<0||x>=this.width||y>=this.height}onPlayerOutOfBounds(x,y){y<0&&this.game.world.enterSector(this.game.world.sector.northSector,{x,y:this.height-1}),y>=this.height&&this.game.world.enterSector(this.game.world.sector.southSector,{x,y:0}),x>=this.width&&this.game.world.enterSector(this.game.world.sector.eastSector,{x:0,y}),x<0&&this.game.world.enterSector(this.game.world.sector.westSector,{x:this.width-1,y})}update(dt){_classPrivateFieldGet(this,_playerOutOfBounds)&&this.onPlayerOutOfBounds(_classPrivateFieldGet(this,_playerOutOfBounds).x,_classPrivateFieldGet(this,_playerOutOfBounds).y)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>FastMap});class FastMap{get width(){return this._width}get height(){return this._height}get size(){return this._width*this._height}constructor(width,height){_defineProperty(this,"_width",0),_defineProperty(this,"_height",0),_defineProperty(this,"_data",[]),_defineProperty(this,"_idHash",new Map),this._width=width,this._height=height;for(let i=0;i<this.size;i++)this._data[i]=new Set}idx(x,y){return y*this.width+x}coord(idx){return{x:Math.trunc(idx%this.width),y:Math.trunc(idx/this.width)}}clear(){this._idHash.clear();for(let i=0;i<this.size;i++)this._data[i].clear()}serialize(){const entries=this._data.map((d=>Array.from(d)));return{width:this.width,height:this.height,entries}}deserialize(data){this._width=data.width,this._height=data.height,this._idHash=new Map;for(let i=0;i<data.entries.length;i++){const coord=this.coord(i);this._data[i]=new Set(data.entries[i]),data.entries[i].forEach((id=>{this._idHash.set(id,coord)}))}}set(x,y,id){if(this.isOutOfBounds(x,y))return void console.warn("Trying to set an entity ".concat(id," position out-of-bounds ").concat(x,", ").concat(y));const idx=this.idx(x,y);this.remove(id),this._idHash.set(id,{x,y}),this._data[idx].add(id)}get(x,y){return this.isOutOfBounds(x,y)?[]:Array.from(this._data[this.idx(x,y)])}has(id){return this._idHash.has(id)}getPosition(id){const pos=this._idHash.get(id);return pos||console.warn("Cannot get position",id),pos}remove(id){if(!this.has(id))return;const pos=this.getPosition(id),idx=this.idx(pos.x,pos.y);this._idHash.delete(id),this._data[idx].delete(id)}isOutOfBounds(x,y){return x<0||y<0||x>=this.width||y>=this.height}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>FOVSystem});var rot_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(213),_ecs_components__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(21),_System__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(138);class FOVSystem extends _System__WEBPACK_IMPORTED_MODULE_2__.default{constructor(game){super(game),this.fov=new rot_js__WEBPACK_IMPORTED_MODULE_0__.FOV.PreciseShadowcasting(((x,y)=>this.isSquareVisible(x,y))),this.query=this.game.ecs.createQuery({all:[_ecs_components__WEBPACK_IMPORTED_MODULE_1__.IsVisible]})}isSquareVisible(x,y){return!this.game.map.getEntitiesAt(x,y).some((e=>e.has(_ecs_components__WEBPACK_IMPORTED_MODULE_1__.Shadowcaster)))}setVisible(x,y,amount,range){this.game.map.getEntitiesAt(x,y,!0).forEach((e=>{e.add(_ecs_components__WEBPACK_IMPORTED_MODULE_1__.IsVisible,{range,amount}),e.explorable&&!e.explored&&e.add(_ecs_components__WEBPACK_IMPORTED_MODULE_1__.Explored)}))}computeFOV(){this.query.get().forEach((e=>e.isVisible.destroy()));const pos=this.game.player.position;this.fov.compute(pos.x,pos.y,8,((x,y,r,visibility)=>{this.setVisible(x,y,visibility,r)}))}update(dt){this.game.clock.tickDelta&&this.computeFOV()}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{RNG:()=>_rng_js__WEBPACK_IMPORTED_MODULE_0__.default,Display:()=>_display_display_js__WEBPACK_IMPORTED_MODULE_1__.default,StringGenerator:()=>_stringgenerator_js__WEBPACK_IMPORTED_MODULE_2__.default,EventQueue:()=>_eventqueue_js__WEBPACK_IMPORTED_MODULE_3__.default,Scheduler:()=>_scheduler_index_js__WEBPACK_IMPORTED_MODULE_4__.default,FOV:()=>_fov_index_js__WEBPACK_IMPORTED_MODULE_5__.default,Map:()=>_map_index_js__WEBPACK_IMPORTED_MODULE_6__.default,Noise:()=>_noise_index_js__WEBPACK_IMPORTED_MODULE_7__.default,Path:()=>_path_index_js__WEBPACK_IMPORTED_MODULE_8__.default,Engine:()=>_engine_js__WEBPACK_IMPORTED_MODULE_9__.default,Lighting:()=>_lighting_js__WEBPACK_IMPORTED_MODULE_10__.default,DEFAULT_WIDTH:()=>_constants_js__WEBPACK_IMPORTED_MODULE_11__.DEFAULT_WIDTH,DEFAULT_HEIGHT:()=>_constants_js__WEBPACK_IMPORTED_MODULE_11__.DEFAULT_HEIGHT,DIRS:()=>_constants_js__WEBPACK_IMPORTED_MODULE_11__.DIRS,KEYS:()=>_constants_js__WEBPACK_IMPORTED_MODULE_11__.KEYS,Util:()=>Util,Color:()=>Color,Text:()=>Text});var _rng_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(214),_display_display_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(215),_stringgenerator_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(226),_eventqueue_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(227),_scheduler_index_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(229),_fov_index_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(234),_map_index_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(239),_noise_index_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(251),_path_index_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(254),_engine_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(258),_lighting_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(259),_constants_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(225),_util_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(117),_color_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(222),_text_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(224);const Util=_util_js__WEBPACK_IMPORTED_MODULE_12__,Color=_color_js__WEBPACK_IMPORTED_MODULE_13__,Text=_text_js__WEBPACK_IMPORTED_MODULE_14__},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});const FRAC=2.3283064365386963e-10;class RNG{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(seed){return seed=seed<1?1/seed:seed,this._seed=seed,this._s0=(seed>>>0)*FRAC,seed=69069*seed+1>>>0,this._s1=seed*FRAC,seed=69069*seed+1>>>0,this._s2=seed*FRAC,this._c=1,this}getUniform(){let t=2091639*this._s0+this._c*FRAC;return this._s0=this._s1,this._s1=this._s2,this._c=0|t,this._s2=t-this._c,this._s2}getUniformInt(lowerBound,upperBound){let max=Math.max(lowerBound,upperBound),min=Math.min(lowerBound,upperBound);return Math.floor(this.getUniform()*(max-min+1))+min}getNormal(mean=0,stddev=1){let u,v,r;do{u=2*this.getUniform()-1,v=2*this.getUniform()-1,r=u*u+v*v}while(r>1||0==r);return mean+u*Math.sqrt(-2*Math.log(r)/r)*stddev}getPercentage(){return 1+Math.floor(100*this.getUniform())}getItem(array){return array.length?array[Math.floor(this.getUniform()*array.length)]:null}shuffle(array){let result=[],clone=array.slice();for(;clone.length;){let index=clone.indexOf(this.getItem(clone));result.push(clone.splice(index,1)[0])}return result}getWeightedValue(data){let total=0;for(let id in data)total+=data[id];let id,random=this.getUniform()*total,part=0;for(id in data)if(part+=data[id],random<part)return id;return id}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(state){return this._s0=state[0],this._s1=state[1],this._s2=state[2],this._c=state[3],this}clone(){return(new RNG).setState(this.getState())}}const __WEBPACK_DEFAULT_EXPORT__=(new RNG).setSeed(Date.now())},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _hex_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(216),_rect_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(219),_tile_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(220),_tile_gl_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(221),_term_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(223),_text_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(224),_constants_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(225);const BACKENDS={hex:_hex_js__WEBPACK_IMPORTED_MODULE_0__.default,rect:_rect_js__WEBPACK_IMPORTED_MODULE_1__.default,tile:_tile_js__WEBPACK_IMPORTED_MODULE_2__.default,"tile-gl":_tile_gl_js__WEBPACK_IMPORTED_MODULE_3__.default,term:_term_js__WEBPACK_IMPORTED_MODULE_4__.default},DEFAULT_OPTIONS={width:_constants_js__WEBPACK_IMPORTED_MODULE_6__.DEFAULT_WIDTH,height:_constants_js__WEBPACK_IMPORTED_MODULE_6__.DEFAULT_HEIGHT,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1};const __WEBPACK_DEFAULT_EXPORT__=(()=>{class Display{constructor(options={}){this._data={},this._dirty=!1,this._options={},options=Object.assign({},DEFAULT_OPTIONS,options),this.setOptions(options),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}DEBUG(x,y,what){let colors=[this._options.bg,this._options.fg];this.draw(x,y,null,null,colors[what%colors.length])}clear(){this._data={},this._dirty=!0}setOptions(options){if(Object.assign(this._options,options),options.width||options.height||options.fontSize||options.fontFamily||options.spacing||options.layout){if(options.layout){let ctor=BACKENDS[options.layout];this._backend=new ctor}this._backend.setOptions(this._options),this._dirty=!0}return this}getOptions(){return this._options}getContainer(){return this._backend.getContainer()}computeSize(availWidth,availHeight){return this._backend.computeSize(availWidth,availHeight)}computeFontSize(availWidth,availHeight){return this._backend.computeFontSize(availWidth,availHeight)}computeTileSize(availWidth,availHeight){return[Math.floor(availWidth/this._options.width),Math.floor(availHeight/this._options.height)]}eventToPosition(e){let x,y;return"touches"in e?(x=e.touches[0].clientX,y=e.touches[0].clientY):(x=e.clientX,y=e.clientY),this._backend.eventToPosition(x,y)}draw(x,y,ch,fg,bg){fg||(fg=this._options.fg),bg||(bg=this._options.bg);let key="".concat(x,",").concat(y);this._data[key]=[x,y,ch,fg,bg],!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[key]=!0)}drawText(x,y,text,maxWidth){let fg=null,bg=null,cx=x,cy=y,lines=1;maxWidth||(maxWidth=this._options.width-x);let tokens=_text_js__WEBPACK_IMPORTED_MODULE_5__.tokenize(text,maxWidth);for(;tokens.length;){let token=tokens.shift();switch(token.type){case _text_js__WEBPACK_IMPORTED_MODULE_5__.TYPE_TEXT:let isSpace=!1,isPrevSpace=!1,isFullWidth=!1,isPrevFullWidth=!1;for(let i=0;i<token.value.length;i++){let cc=token.value.charCodeAt(i),c=token.value.charAt(i);if("term"===this._options.layout){let cch=cc>>8;if(17===cch||cch>=46&&cch<=159||cch>=172&&cch<=215||cc>=43360&&cc<=43391){this.draw(cx+0,cy,c,fg,bg),this.draw(cx+1,cy,"\t",fg,bg),cx+=2;continue}}isFullWidth=cc>65280&&cc<65377||cc>65500&&cc<65512||cc>65518,isSpace=32==c.charCodeAt(0)||12288==c.charCodeAt(0),!isPrevFullWidth||isFullWidth||isSpace||cx++,isFullWidth&&!isPrevSpace&&cx++,this.draw(cx++,cy,c,fg,bg),isPrevSpace=isSpace,isPrevFullWidth=isFullWidth}break;case _text_js__WEBPACK_IMPORTED_MODULE_5__.TYPE_FG:fg=token.value||null;break;case _text_js__WEBPACK_IMPORTED_MODULE_5__.TYPE_BG:bg=token.value||null;break;case _text_js__WEBPACK_IMPORTED_MODULE_5__.TYPE_NEWLINE:cx=x,cy++,lines++}}return lines}_tick(){if(this._backend.schedule(this._tick),this._dirty){if(!0===this._dirty){this._backend.clear();for(let id in this._data)this._draw(id,!1)}else for(let key in this._dirty)this._draw(key,!0);this._dirty=!1}}_draw(key,clearBefore){let data=this._data[key];data[4]!=this._options.bg&&(clearBefore=!0),this._backend.draw(data,clearBefore)}}return Display.Rect=_rect_js__WEBPACK_IMPORTED_MODULE_1__.default,Display.Hex=_hex_js__WEBPACK_IMPORTED_MODULE_0__.default,Display.Tile=_tile_js__WEBPACK_IMPORTED_MODULE_2__.default,Display.TileGL=_tile_gl_js__WEBPACK_IMPORTED_MODULE_3__.default,Display.Term=_term_js__WEBPACK_IMPORTED_MODULE_4__.default,Display})()},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Hex});var _canvas_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(217),_util_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(117);class Hex extends _canvas_js__WEBPACK_IMPORTED_MODULE_0__.default{constructor(){super(),this._spacingX=0,this._spacingY=0,this._hexSize=0}draw(data,clearBefore){let[x,y,ch,fg,bg]=data,px=[(x+1)*this._spacingX,y*this._spacingY+this._hexSize];if(this._options.transpose&&px.reverse(),clearBefore&&(this._ctx.fillStyle=bg,this._fill(px[0],px[1])),!ch)return;this._ctx.fillStyle=fg;let chars=[].concat(ch);for(let i=0;i<chars.length;i++)this._ctx.fillText(chars[i],px[0],Math.ceil(px[1]))}computeSize(availWidth,availHeight){return this._options.transpose&&(availWidth+=availHeight,availWidth-=availHeight=availWidth-availHeight),[Math.floor(availWidth/this._spacingX)-1,Math.floor((availHeight-2*this._hexSize)/this._spacingY+1)]}computeFontSize(availWidth,availHeight){this._options.transpose&&(availWidth+=availHeight,availWidth-=availHeight=availWidth-availHeight);let hexSizeWidth=2*availWidth/((this._options.width+1)*Math.sqrt(3))-1,hexSizeHeight=availHeight/(2+1.5*(this._options.height-1)),hexSize=Math.min(hexSizeWidth,hexSizeHeight),oldFont=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let width=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=oldFont;let ratio=width/100;hexSize=Math.floor(hexSize)+1;let fontSize=2*hexSize/(this._options.spacing*(1+ratio/Math.sqrt(3)));return Math.ceil(fontSize)-1}_normalizedEventToPosition(x,y){let nodeSize;this._options.transpose?(x+=y,x-=y=x-y,nodeSize=this._ctx.canvas.width):nodeSize=this._ctx.canvas.height;let size=nodeSize/this._options.height;return y=Math.floor(y/size),(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.mod)(y,2)?(x-=this._spacingX,x=1+2*Math.floor(x/(2*this._spacingX))):x=2*Math.floor(x/(2*this._spacingX)),[x,y]}_fill(cx,cy){let a=this._hexSize,b=this._options.border;const ctx=this._ctx;ctx.beginPath(),this._options.transpose?(ctx.moveTo(cx-a+b,cy),ctx.lineTo(cx-a/2+b,cy+this._spacingX-b),ctx.lineTo(cx+a/2-b,cy+this._spacingX-b),ctx.lineTo(cx+a-b,cy),ctx.lineTo(cx+a/2-b,cy-this._spacingX+b),ctx.lineTo(cx-a/2+b,cy-this._spacingX+b),ctx.lineTo(cx-a+b,cy)):(ctx.moveTo(cx,cy-a+b),ctx.lineTo(cx+this._spacingX-b,cy-a/2+b),ctx.lineTo(cx+this._spacingX-b,cy+a/2-b),ctx.lineTo(cx,cy+a-b),ctx.lineTo(cx-this._spacingX+b,cy+a/2-b),ctx.lineTo(cx-this._spacingX+b,cy-a/2+b),ctx.lineTo(cx,cy-a+b)),ctx.fill()}_updateSize(){const opts=this._options,charWidth=Math.ceil(this._ctx.measureText("W").width);let xprop,yprop;this._hexSize=Math.floor(opts.spacing*(opts.fontSize+charWidth/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=1.5*this._hexSize,opts.transpose?(xprop="height",yprop="width"):(xprop="width",yprop="height"),this._ctx.canvas[xprop]=Math.ceil((opts.width+1)*this._spacingX),this._ctx.canvas[yprop]=Math.ceil((opts.height-1)*this._spacingY+2*this._hexSize)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Canvas});var _backend_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(218);class Canvas extends _backend_js__WEBPACK_IMPORTED_MODULE_0__.default{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(cb){requestAnimationFrame(cb)}getContainer(){return this._ctx.canvas}setOptions(opts){super.setOptions(opts);const style=opts.fontStyle?"".concat(opts.fontStyle," "):"",font="".concat(style," ").concat(opts.fontSize,"px ").concat(opts.fontFamily);this._ctx.font=font,this._updateSize(),this._ctx.font=font,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)}eventToPosition(x,y){let canvas=this._ctx.canvas,rect=canvas.getBoundingClientRect();return x-=rect.left,y-=rect.top,x*=canvas.width/rect.width,y*=canvas.height/rect.height,x<0||y<0||x>=canvas.width||y>=canvas.height?[-1,-1]:this._normalizedEventToPosition(x,y)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Backend});class Backend{getContainer(){return null}setOptions(options){this._options=options}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _canvas_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(217);const __WEBPACK_DEFAULT_EXPORT__=(()=>{class Rect extends _canvas_js__WEBPACK_IMPORTED_MODULE_0__.default{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(options){super.setOptions(options),this._canvasCache={}}draw(data,clearBefore){Rect.cache?this._drawWithCache(data):this._drawNoCache(data,clearBefore)}_drawWithCache(data){let canvas,[x,y,ch,fg,bg]=data,hash=""+ch+fg+bg;if(hash in this._canvasCache)canvas=this._canvasCache[hash];else{let b=this._options.border;canvas=document.createElement("canvas");let ctx=canvas.getContext("2d");if(canvas.width=this._spacingX,canvas.height=this._spacingY,ctx.fillStyle=bg,ctx.fillRect(b,b,canvas.width-b,canvas.height-b),ch){ctx.fillStyle=fg,ctx.font=this._ctx.font,ctx.textAlign="center",ctx.textBaseline="middle";let chars=[].concat(ch);for(let i=0;i<chars.length;i++)ctx.fillText(chars[i],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[hash]=canvas}this._ctx.drawImage(canvas,x*this._spacingX,y*this._spacingY)}_drawNoCache(data,clearBefore){let[x,y,ch,fg,bg]=data;if(clearBefore){let b=this._options.border;this._ctx.fillStyle=bg,this._ctx.fillRect(x*this._spacingX+b,y*this._spacingY+b,this._spacingX-b,this._spacingY-b)}if(!ch)return;this._ctx.fillStyle=fg;let chars=[].concat(ch);for(let i=0;i<chars.length;i++)this._ctx.fillText(chars[i],(x+.5)*this._spacingX,Math.ceil((y+.5)*this._spacingY))}computeSize(availWidth,availHeight){return[Math.floor(availWidth/this._spacingX),Math.floor(availHeight/this._spacingY)]}computeFontSize(availWidth,availHeight){let boxWidth=Math.floor(availWidth/this._options.width),boxHeight=Math.floor(availHeight/this._options.height),oldFont=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let width=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=oldFont;let widthFraction=width/100*boxHeight/boxWidth;return widthFraction>1&&(boxHeight=Math.floor(boxHeight/widthFraction)),Math.floor(boxHeight/this._options.spacing)}_normalizedEventToPosition(x,y){return[Math.floor(x/this._spacingX),Math.floor(y/this._spacingY)]}_updateSize(){const opts=this._options,charWidth=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(opts.spacing*charWidth),this._spacingY=Math.ceil(opts.spacing*opts.fontSize),opts.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=opts.width*this._spacingX,this._ctx.canvas.height=opts.height*this._spacingY}}return Rect.cache=!1,Rect})()},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Tile});var _canvas_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(217);class Tile extends _canvas_js__WEBPACK_IMPORTED_MODULE_0__.default{constructor(){super(),this._colorCanvas=document.createElement("canvas")}draw(data,clearBefore){let[x,y,ch,fg,bg]=data,tileWidth=this._options.tileWidth,tileHeight=this._options.tileHeight;if(clearBefore&&(this._options.tileColorize?this._ctx.clearRect(x*tileWidth,y*tileHeight,tileWidth,tileHeight):(this._ctx.fillStyle=bg,this._ctx.fillRect(x*tileWidth,y*tileHeight,tileWidth,tileHeight))),!ch)return;let chars=[].concat(ch),fgs=[].concat(fg),bgs=[].concat(bg);for(let i=0;i<chars.length;i++){let tile=this._options.tileMap[chars[i]];if(!tile)throw new Error('Char "'.concat(chars[i],'" not found in tileMap'));if(this._options.tileColorize){let canvas=this._colorCanvas,context=canvas.getContext("2d");context.globalCompositeOperation="source-over",context.clearRect(0,0,tileWidth,tileHeight);let fg=fgs[i],bg=bgs[i];context.drawImage(this._options.tileSet,tile[0],tile[1],tileWidth,tileHeight,0,0,tileWidth,tileHeight),"transparent"!=fg&&(context.fillStyle=fg,context.globalCompositeOperation="source-atop",context.fillRect(0,0,tileWidth,tileHeight)),"transparent"!=bg&&(context.fillStyle=bg,context.globalCompositeOperation="destination-over",context.fillRect(0,0,tileWidth,tileHeight)),this._ctx.drawImage(canvas,x*tileWidth,y*tileHeight,tileWidth,tileHeight)}else this._ctx.drawImage(this._options.tileSet,tile[0],tile[1],tileWidth,tileHeight,x*tileWidth,y*tileHeight,tileWidth,tileHeight)}}computeSize(availWidth,availHeight){return[Math.floor(availWidth/this._options.tileWidth),Math.floor(availHeight/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}_normalizedEventToPosition(x,y){return[Math.floor(x/this._options.tileWidth),Math.floor(y/this._options.tileHeight)]}_updateSize(){const opts=this._options;this._ctx.canvas.width=opts.width*opts.tileWidth,this._ctx.canvas.height=opts.height*opts.tileHeight,this._colorCanvas.width=opts.tileWidth,this._colorCanvas.height=opts.tileHeight}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>TileGL});var _backend_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(218),_color_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(222);class TileGL extends _backend_js__WEBPACK_IMPORTED_MODULE_0__.default{constructor(){super(),this._uniforms={};try{this._gl=this._initWebGL()}catch(e){alert(e.message)}}static isSupported(){return!!document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0})}schedule(cb){requestAnimationFrame(cb)}getContainer(){return this._gl.canvas}setOptions(opts){super.setOptions(opts),this._updateSize();let tileSet=this._options.tileSet;tileSet&&"complete"in tileSet&&!tileSet.complete?tileSet.addEventListener("load",(()=>this._updateTexture(tileSet))):this._updateTexture(tileSet)}draw(data,clearBefore){const gl=this._gl,opts=this._options;let[x,y,ch,fg,bg]=data,scissorY=gl.canvas.height-(y+1)*opts.tileHeight;if(gl.scissor(x*opts.tileWidth,scissorY,opts.tileWidth,opts.tileHeight),clearBefore&&(opts.tileColorize?gl.clearColor(0,0,0,0):gl.clearColor(...parseColor(bg)),gl.clear(gl.COLOR_BUFFER_BIT)),!ch)return;let chars=[].concat(ch),bgs=[].concat(bg),fgs=[].concat(fg);gl.uniform2fv(this._uniforms.targetPosRel,[x,y]);for(let i=0;i<chars.length;i++){let tile=this._options.tileMap[chars[i]];if(!tile)throw new Error('Char "'.concat(chars[i],'" not found in tileMap'));gl.uniform1f(this._uniforms.colorize,opts.tileColorize?1:0),gl.uniform2fv(this._uniforms.tilesetPosAbs,tile),opts.tileColorize&&(gl.uniform4fv(this._uniforms.tint,parseColor(fgs[i])),gl.uniform4fv(this._uniforms.bg,parseColor(bgs[i]))),gl.drawArrays(gl.TRIANGLE_STRIP,0,4)}}clear(){const gl=this._gl;gl.clearColor(...parseColor(this._options.bg)),gl.scissor(0,0,gl.canvas.width,gl.canvas.height),gl.clear(gl.COLOR_BUFFER_BIT)}computeSize(availWidth,availHeight){return[Math.floor(availWidth/this._options.tileWidth),Math.floor(availHeight/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}eventToPosition(x,y){let canvas=this._gl.canvas,rect=canvas.getBoundingClientRect();return x-=rect.left,y-=rect.top,x*=canvas.width/rect.width,y*=canvas.height/rect.height,x<0||y<0||x>=canvas.width||y>=canvas.height?[-1,-1]:this._normalizedEventToPosition(x,y)}_initWebGL(){let gl=document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0});window.gl=gl;let program=function(gl,vss,fss){const vs=gl.createShader(gl.VERTEX_SHADER);if(gl.shaderSource(vs,vss),gl.compileShader(vs),!gl.getShaderParameter(vs,gl.COMPILE_STATUS))throw new Error(gl.getShaderInfoLog(vs)||"");const fs=gl.createShader(gl.FRAGMENT_SHADER);if(gl.shaderSource(fs,fss),gl.compileShader(fs),!gl.getShaderParameter(fs,gl.COMPILE_STATUS))throw new Error(gl.getShaderInfoLog(fs)||"");const p=gl.createProgram();if(gl.attachShader(p,vs),gl.attachShader(p,fs),gl.linkProgram(p),!gl.getProgramParameter(p,gl.LINK_STATUS))throw new Error(gl.getProgramInfoLog(p)||"");return p}(gl,VS,FS);return gl.useProgram(program),function(gl){const pos=new Float32Array([0,0,1,0,0,1,1,1]),buf=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,buf),gl.bufferData(gl.ARRAY_BUFFER,pos,gl.STATIC_DRAW),gl.enableVertexAttribArray(0),gl.vertexAttribPointer(0,2,gl.FLOAT,!1,0,0)}(gl),UNIFORMS.forEach((name=>this._uniforms[name]=gl.getUniformLocation(program,name))),this._program=program,gl.enable(gl.BLEND),gl.blendFuncSeparate(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA),gl.enable(gl.SCISSOR_TEST),gl}_normalizedEventToPosition(x,y){return[Math.floor(x/this._options.tileWidth),Math.floor(y/this._options.tileHeight)]}_updateSize(){const gl=this._gl,opts=this._options,canvasSize=[opts.width*opts.tileWidth,opts.height*opts.tileHeight];gl.canvas.width=canvasSize[0],gl.canvas.height=canvasSize[1],gl.viewport(0,0,canvasSize[0],canvasSize[1]),gl.uniform2fv(this._uniforms.tileSize,[opts.tileWidth,opts.tileHeight]),gl.uniform2fv(this._uniforms.targetSize,canvasSize)}_updateTexture(tileSet){!function(gl,data){let t=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,t),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.REPEAT),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,0),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,data)}(this._gl,tileSet)}}const UNIFORMS=["targetPosRel","tilesetPosAbs","tileSize","targetSize","colorize","bg","tint"],VS="\n#version 300 es\n\nin vec2 tilePosRel;\nout vec2 tilesetPosPx;\n\nuniform vec2 tilesetPosAbs;\nuniform vec2 tileSize;\nuniform vec2 targetSize;\nuniform vec2 targetPosRel;\n\nvoid main() {\n\tvec2 targetPosPx = (targetPosRel + tilePosRel) * tileSize;\n\tvec2 targetPosNdc = ((targetPosPx / targetSize)-0.5)*2.0;\n\ttargetPosNdc.y *= -1.0;\n\n\tgl_Position = vec4(targetPosNdc, 0.0, 1.0);\n\ttilesetPosPx = tilesetPosAbs + tilePosRel * tileSize;\n}".trim(),FS="\n#version 300 es\nprecision highp float;\n\nin vec2 tilesetPosPx;\nout vec4 fragColor;\nuniform sampler2D image;\nuniform bool colorize;\nuniform vec4 bg;\nuniform vec4 tint;\n\nvoid main() {\n\tfragColor = vec4(0, 0, 0, 1);\n\n\tvec4 texel = texelFetch(image, ivec2(tilesetPosPx), 0);\n\n\tif (colorize) {\n\t\ttexel.rgb = tint.a * tint.rgb + (1.0-tint.a) * texel.rgb;\n\t\tfragColor.rgb = texel.a*texel.rgb + (1.0-texel.a)*bg.rgb;\n\t\tfragColor.a = texel.a + (1.0-texel.a)*bg.a;\n\t} else {\n\t\tfragColor = texel;\n\t}\n}".trim();let colorCache={};function parseColor(color){if(!(color in colorCache)){let parsed;if("transparent"==color)parsed=[0,0,0,0];else if(color.indexOf("rgba")>-1){parsed=(color.match(/[\d.]+/g)||[]).map(Number);for(let i=0;i<3;i++)parsed[i]=parsed[i]/255}else parsed=_color_js__WEBPACK_IMPORTED_MODULE_1__.fromString(color).map(($=>$/255)),parsed.push(1);colorCache[color]=parsed}return colorCache[color]}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{fromString:()=>fromString,add:()=>add,add_:()=>add_,multiply:()=>multiply,multiply_:()=>multiply_,interpolate:()=>interpolate,lerp:()=>lerp,interpolateHSL:()=>interpolateHSL,lerpHSL:()=>lerpHSL,randomize:()=>randomize,rgb2hsl:()=>rgb2hsl,hsl2rgb:()=>hsl2rgb,toRGB:()=>toRGB,toHex:()=>toHex});var _util_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(117),_rng_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(214);function fromString(str){let cached,r;if(str in CACHE)cached=CACHE[str];else{if("#"==str.charAt(0)){let values=(str.match(/[0-9a-f]/gi)||[]).map((x=>parseInt(x,16)));if(3==values.length)cached=values.map((x=>17*x));else{for(let i=0;i<3;i++)values[i+1]+=16*values[i],values.splice(i,1);cached=values}}else cached=(r=str.match(/rgb\(([0-9, ]+)\)/i))?r[1].split(/\s*,\s*/).map((x=>parseInt(x))):[0,0,0];CACHE[str]=cached}return cached.slice()}function add(color1,...colors){let result=color1.slice();for(let i=0;i<3;i++)for(let j=0;j<colors.length;j++)result[i]+=colors[j][i];return result}function add_(color1,...colors){for(let i=0;i<3;i++)for(let j=0;j<colors.length;j++)color1[i]+=colors[j][i];return color1}function multiply(color1,...colors){let result=color1.slice();for(let i=0;i<3;i++){for(let j=0;j<colors.length;j++)result[i]*=colors[j][i]/255;result[i]=Math.round(result[i])}return result}function multiply_(color1,...colors){for(let i=0;i<3;i++){for(let j=0;j<colors.length;j++)color1[i]*=colors[j][i]/255;color1[i]=Math.round(color1[i])}return color1}function interpolate(color1,color2,factor=.5){let result=color1.slice();for(let i=0;i<3;i++)result[i]=Math.round(result[i]+factor*(color2[i]-color1[i]));return result}const lerp=interpolate;function interpolateHSL(color1,color2,factor=.5){let hsl1=rgb2hsl(color1),hsl2=rgb2hsl(color2);for(let i=0;i<3;i++)hsl1[i]+=factor*(hsl2[i]-hsl1[i]);return hsl2rgb(hsl1)}const lerpHSL=interpolateHSL;function randomize(color,diff){diff instanceof Array||(diff=Math.round(_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.getNormal(0,diff)));let result=color.slice();for(let i=0;i<3;i++)result[i]+=diff instanceof Array?Math.round(_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.getNormal(0,diff[i])):diff;return result}function rgb2hsl(color){let s,r=color[0]/255,g=color[1]/255,b=color[2]/255,max=Math.max(r,g,b),min=Math.min(r,g,b),h=0,l=(max+min)/2;if(max==min)s=0;else{let d=max-min;switch(s=l>.5?d/(2-max-min):d/(max+min),max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}h/=6}return[h,s,l]}function hue2rgb(p,q,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?p+6*(q-p)*t:t<.5?q:t<2/3?p+(q-p)*(2/3-t)*6:p}function hsl2rgb(color){let l=color[2];if(0==color[1])return l=Math.round(255*l),[l,l,l];{let s=color[1],q=l<.5?l*(1+s):l+s-l*s,p=2*l-q,r=hue2rgb(p,q,color[0]+1/3),g=hue2rgb(p,q,color[0]),b=hue2rgb(p,q,color[0]-1/3);return[Math.round(255*r),Math.round(255*g),Math.round(255*b)]}}function toRGB(color){let clamped=color.map((x=>(0,_util_js__WEBPACK_IMPORTED_MODULE_0__.clamp)(x,0,255)));return"rgb(".concat(clamped.join(","),")")}function toHex(color){let clamped=color.map((x=>(0,_util_js__WEBPACK_IMPORTED_MODULE_0__.clamp)(x,0,255).toString(16).padStart(2,"0")));return"#".concat(clamped.join(""))}const CACHE={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Term});var _backend_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(218),_color_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(222);function termcolor(color){let rgb=_color_js__WEBPACK_IMPORTED_MODULE_1__.fromString(color);return 36*Math.floor(.0234375*rgb[0])+6*Math.floor(.0234375*rgb[1])+1*Math.floor(.0234375*rgb[2])+16}class Term extends _backend_js__WEBPACK_IMPORTED_MODULE_0__.default{constructor(){super(),this._offset=[0,0],this._cursor=[-1,-1],this._lastColor=""}schedule(cb){setTimeout(cb,1e3/60)}setOptions(options){super.setOptions(options);let size=[options.width,options.height],avail=this.computeSize();this._offset=avail.map(((val,index)=>Math.floor((val-size[index])/2)))}clear(){var bg;process.stdout.write((bg=this._options.bg,"[0;48;5;".concat(termcolor(bg),"m[2J")))}draw(data,clearBefore){let[x,y,ch,fg,bg]=data,dx=this._offset[0]+x,dy=this._offset[1]+y,size=this.computeSize();if(dx<0||dx>=size[0])return;if(dy<0||dy>=size[1])return;if(dx===this._cursor[0]&&dy===this._cursor[1]||(process.stdout.write(function(x,y){return"[".concat(y+1,";").concat(x+1,"H")}(dx,dy)),this._cursor[0]=dx,this._cursor[1]=dy),clearBefore&&(ch||(ch=" ")),!ch)return;let newColor=function(fg,bg){return"[0;38;5;".concat(termcolor(fg),";48;5;").concat(termcolor(bg),"m")}(fg,bg);if(newColor!==this._lastColor&&(process.stdout.write(newColor),this._lastColor=newColor),"\t"!=ch){let chars=[].concat(ch);process.stdout.write(chars[0])}this._cursor[0]++,this._cursor[0]>=size[0]&&(this._cursor[0]=0,this._cursor[1]++)}computeFontSize(){throw new Error("Terminal backend has no notion of font size")}eventToPosition(x,y){return[x,y]}computeSize(){return[process.stdout.columns,process.stdout.rows]}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{TYPE_TEXT:()=>TYPE_TEXT,TYPE_NEWLINE:()=>TYPE_NEWLINE,TYPE_FG:()=>TYPE_FG,TYPE_BG:()=>TYPE_BG,measure:()=>measure,tokenize:()=>tokenize});const RE_COLORS=/%([bc]){([^}]*)}/g,TYPE_TEXT=0,TYPE_NEWLINE=1,TYPE_FG=2,TYPE_BG=3;function measure(str,maxWidth){let result={width:0,height:1},tokens=tokenize(str,maxWidth),lineWidth=0;for(let i=0;i<tokens.length;i++){let token=tokens[i];switch(token.type){case TYPE_TEXT:lineWidth+=token.value.length;break;case TYPE_NEWLINE:result.height++,result.width=Math.max(result.width,lineWidth),lineWidth=0}}return result.width=Math.max(result.width,lineWidth),result}function tokenize(str,maxWidth){let result=[],offset=0;str.replace(RE_COLORS,(function(match,type,name,index){let part=str.substring(offset,index);return part.length&&result.push({type:TYPE_TEXT,value:part}),result.push({type:"c"==type?TYPE_FG:TYPE_BG,value:name.trim()}),offset=index+match.length,""}));let part=str.substring(offset);return part.length&&result.push({type:TYPE_TEXT,value:part}),function(tokens,maxWidth){maxWidth||(maxWidth=1/0);let i=0,lineLength=0,lastTokenWithSpace=-1;for(;i<tokens.length;){let token=tokens[i];if(token.type==TYPE_NEWLINE&&(lineLength=0,lastTokenWithSpace=-1),token.type!=TYPE_TEXT){i++;continue}for(;0==lineLength&&" "==token.value.charAt(0);)token.value=token.value.substring(1);let index=token.value.indexOf("\n");if(-1!=index){token.value=breakInsideToken(tokens,i,index,!0);let arr=token.value.split("");for(;arr.length&&" "==arr[arr.length-1];)arr.pop();token.value=arr.join("")}if(token.value.length){if(lineLength+token.value.length>maxWidth){let index=-1;for(;;){let nextIndex=token.value.indexOf(" ",index+1);if(-1==nextIndex)break;if(lineLength+nextIndex>maxWidth)break;index=nextIndex}if(-1!=index)token.value=breakInsideToken(tokens,i,index,!0);else if(-1!=lastTokenWithSpace){let token=tokens[lastTokenWithSpace],breakIndex=token.value.lastIndexOf(" ");token.value=breakInsideToken(tokens,lastTokenWithSpace,breakIndex,!0),i=lastTokenWithSpace}else token.value=breakInsideToken(tokens,i,maxWidth-lineLength,!1)}else lineLength+=token.value.length,-1!=token.value.indexOf(" ")&&(lastTokenWithSpace=i);i++}else tokens.splice(i,1)}tokens.push({type:TYPE_NEWLINE});let lastTextToken=null;for(let i=0;i<tokens.length;i++){let token=tokens[i];switch(token.type){case TYPE_TEXT:lastTextToken=token;break;case TYPE_NEWLINE:if(lastTextToken){let arr=lastTextToken.value.split("");for(;arr.length&&" "==arr[arr.length-1];)arr.pop();lastTextToken.value=arr.join("")}lastTextToken=null}}return tokens.pop(),tokens}(result,maxWidth)}function breakInsideToken(tokens,tokenIndex,breakIndex,removeBreakChar){let newBreakToken={type:TYPE_NEWLINE},newTextToken={type:TYPE_TEXT,value:tokens[tokenIndex].value.substring(breakIndex+(removeBreakChar?1:0))};return tokens.splice(tokenIndex+1,0,newBreakToken,newTextToken),tokens[tokenIndex].value.substring(0,breakIndex)}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DEFAULT_WIDTH:()=>DEFAULT_WIDTH,DEFAULT_HEIGHT:()=>DEFAULT_HEIGHT,DIRS:()=>DIRS,KEYS:()=>KEYS});let DEFAULT_WIDTH=80,DEFAULT_HEIGHT=25;const DIRS={4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]},KEYS={VK_CANCEL:3,VK_HELP:6,VK_BACK_SPACE:8,VK_TAB:9,VK_CLEAR:12,VK_RETURN:13,VK_ENTER:14,VK_SHIFT:16,VK_CONTROL:17,VK_ALT:18,VK_PAUSE:19,VK_CAPS_LOCK:20,VK_ESCAPE:27,VK_SPACE:32,VK_PAGE_UP:33,VK_PAGE_DOWN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_PRINTSCREEN:44,VK_INSERT:45,VK_DELETE:46,VK_0:48,VK_1:49,VK_2:50,VK_3:51,VK_4:52,VK_5:53,VK_6:54,VK_7:55,VK_8:56,VK_9:57,VK_COLON:58,VK_SEMICOLON:59,VK_LESS_THAN:60,VK_EQUALS:61,VK_GREATER_THAN:62,VK_QUESTION_MARK:63,VK_AT:64,VK_A:65,VK_B:66,VK_C:67,VK_D:68,VK_E:69,VK_F:70,VK_G:71,VK_H:72,VK_I:73,VK_J:74,VK_K:75,VK_L:76,VK_M:77,VK_N:78,VK_O:79,VK_P:80,VK_Q:81,VK_R:82,VK_S:83,VK_T:84,VK_U:85,VK_V:86,VK_W:87,VK_X:88,VK_Y:89,VK_Z:90,VK_CONTEXT_MENU:93,VK_NUMPAD0:96,VK_NUMPAD1:97,VK_NUMPAD2:98,VK_NUMPAD3:99,VK_NUMPAD4:100,VK_NUMPAD5:101,VK_NUMPAD6:102,VK_NUMPAD7:103,VK_NUMPAD8:104,VK_NUMPAD9:105,VK_MULTIPLY:106,VK_ADD:107,VK_SEPARATOR:108,VK_SUBTRACT:109,VK_DECIMAL:110,VK_DIVIDE:111,VK_F1:112,VK_F2:113,VK_F3:114,VK_F4:115,VK_F5:116,VK_F6:117,VK_F7:118,VK_F8:119,VK_F9:120,VK_F10:121,VK_F11:122,VK_F12:123,VK_F13:124,VK_F14:125,VK_F15:126,VK_F16:127,VK_F17:128,VK_F18:129,VK_F19:130,VK_F20:131,VK_F21:132,VK_F22:133,VK_F23:134,VK_F24:135,VK_NUM_LOCK:144,VK_SCROLL_LOCK:145,VK_CIRCUMFLEX:160,VK_EXCLAMATION:161,VK_DOUBLE_QUOTE:162,VK_HASH:163,VK_DOLLAR:164,VK_PERCENT:165,VK_AMPERSAND:166,VK_UNDERSCORE:167,VK_OPEN_PAREN:168,VK_CLOSE_PAREN:169,VK_ASTERISK:170,VK_PLUS:171,VK_PIPE:172,VK_HYPHEN_MINUS:173,VK_OPEN_CURLY_BRACKET:174,VK_CLOSE_CURLY_BRACKET:175,VK_TILDE:176,VK_COMMA:188,VK_PERIOD:190,VK_SLASH:191,VK_BACK_QUOTE:192,VK_OPEN_BRACKET:219,VK_BACK_SLASH:220,VK_CLOSE_BRACKET:221,VK_QUOTE:222,VK_META:224,VK_ALTGR:225,VK_WIN:91,VK_KANA:21,VK_HANGUL:21,VK_EISU:22,VK_JUNJA:23,VK_FINAL:24,VK_HANJA:25,VK_KANJI:25,VK_CONVERT:28,VK_NONCONVERT:29,VK_ACCEPT:30,VK_MODECHANGE:31,VK_SELECT:41,VK_PRINT:42,VK_EXECUTE:43,VK_SLEEP:95}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>StringGenerator});var _rng_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(214);class StringGenerator{constructor(options){this._options={words:!1,order:3,prior:.001},Object.assign(this._options,options),this._boundary=String.fromCharCode(0),this._suffix=this._boundary,this._prefix=[];for(let i=0;i<this._options.order;i++)this._prefix.push(this._boundary);this._priorValues={},this._priorValues[this._boundary]=this._options.prior,this._data={}}clear(){this._data={},this._priorValues={}}generate(){let result=[this._sample(this._prefix)];for(;result[result.length-1]!=this._boundary;)result.push(this._sample(result));return this._join(result.slice(0,-1))}observe(string){let tokens=this._split(string);for(let i=0;i<tokens.length;i++)this._priorValues[tokens[i]]=this._options.prior;tokens=this._prefix.concat(tokens).concat(this._suffix);for(let i=this._options.order;i<tokens.length;i++){let context=tokens.slice(i-this._options.order,i),event=tokens[i];for(let j=0;j<context.length;j++){let subcontext=context.slice(j);this._observeEvent(subcontext,event)}}}getStats(){let parts=[],priorCount=Object.keys(this._priorValues).length;priorCount--,parts.push("distinct samples: "+priorCount);let dataCount=Object.keys(this._data).length,eventCount=0;for(let p in this._data)eventCount+=Object.keys(this._data[p]).length;return parts.push("dictionary size (contexts): "+dataCount),parts.push("dictionary size (events): "+eventCount),parts.join(", ")}_split(str){return str.split(this._options.words?/\s+/:"")}_join(arr){return arr.join(this._options.words?" ":"")}_observeEvent(context,event){let key=this._join(context);key in this._data||(this._data[key]={});let data=this._data[key];event in data||(data[event]=0),data[event]++}_sample(context){context=this._backoff(context);let key=this._join(context),data=this._data[key],available={};if(this._options.prior){for(let event in this._priorValues)available[event]=this._priorValues[event];for(let event in data)available[event]+=data[event]}else available=data;return _rng_js__WEBPACK_IMPORTED_MODULE_0__.default.getWeightedValue(available)}_backoff(context){for(context.length>this._options.order?context=context.slice(-this._options.order):context.length<this._options.order&&(context=this._prefix.slice(0,this._options.order-context.length).concat(context));!(this._join(context)in this._data)&&context.length>0;)context=context.slice(1);return context}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>EventQueue});var _MinHeap__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(228);class EventQueue{constructor(){this._time=0,this._events=new _MinHeap__WEBPACK_IMPORTED_MODULE_0__.MinHeap}getTime(){return this._time}clear(){return this._events=new _MinHeap__WEBPACK_IMPORTED_MODULE_0__.MinHeap,this}add(event,time){this._events.push(event,time)}get(){if(!this._events.len())return null;let{key:time,value:event}=this._events.pop();return time>0&&(this._time+=time,this._events.shift(-time)),event}getEventTime(event){const r=this._events.find(event);if(r){const{key}=r;return key}}remove(event){return this._events.remove(event)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{MinHeap:()=>MinHeap});class MinHeap{constructor(){this.heap=[],this.timestamp=0}lessThan(a,b){return a.key==b.key?a.timestamp<b.timestamp:a.key<b.key}shift(v){this.heap=this.heap.map((({key,value,timestamp})=>({key:key+v,value,timestamp})))}len(){return this.heap.length}push(value,key){this.timestamp+=1;const loc=this.len();this.heap.push({value,timestamp:this.timestamp,key}),this.updateUp(loc)}pop(){if(0==this.len())throw new Error("no element to pop");const top=this.heap[0];return this.len()>1?(this.heap[0]=this.heap.pop(),this.updateDown(0)):this.heap.pop(),top}find(v){for(let i=0;i<this.len();i++)if(v==this.heap[i].value)return this.heap[i];return null}remove(v){let index=null;for(let i=0;i<this.len();i++)v==this.heap[i].value&&(index=i);if(null===index)return!1;if(this.len()>1){let last=this.heap.pop();return last.value!=v&&(this.heap[index]=last,this.updateDown(index)),!0}return this.heap.pop(),!0}parentNode(x){return Math.floor((x-1)/2)}leftChildNode(x){return 2*x+1}rightChildNode(x){return 2*x+2}existNode(x){return x>=0&&x<this.heap.length}swap(x,y){const t=this.heap[x];this.heap[x]=this.heap[y],this.heap[y]=t}minNode(numbers){const validnumbers=numbers.filter(this.existNode.bind(this));let minimal=validnumbers[0];for(const i of validnumbers)this.lessThan(this.heap[i],this.heap[minimal])&&(minimal=i);return minimal}updateUp(x){if(0==x)return;const parent=this.parentNode(x);this.existNode(parent)&&this.lessThan(this.heap[x],this.heap[parent])&&(this.swap(x,parent),this.updateUp(parent))}updateDown(x){const leftChild=this.leftChildNode(x),rightChild=this.rightChildNode(x);if(!this.existNode(leftChild))return;const m=this.minNode([x,leftChild,rightChild]);m!=x&&(this.swap(x,m),this.updateDown(m))}debugPrint(){console.log(this.heap)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _simple_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(230),_speed_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(232),_action_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(233);const __WEBPACK_DEFAULT_EXPORT__={Simple:_simple_js__WEBPACK_IMPORTED_MODULE_0__.default,Speed:_speed_js__WEBPACK_IMPORTED_MODULE_1__.default,Action:_action_js__WEBPACK_IMPORTED_MODULE_2__.default}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Simple});var _scheduler_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(231);class Simple extends _scheduler_js__WEBPACK_IMPORTED_MODULE_0__.default{add(item,repeat){return this._queue.add(item,0),super.add(item,repeat)}next(){return null!==this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,0),super.next()}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Scheduler});var _eventqueue_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(227);class Scheduler{constructor(){this._queue=new _eventqueue_js__WEBPACK_IMPORTED_MODULE_0__.default,this._repeat=[],this._current=null}getTime(){return this._queue.getTime()}add(item,repeat){return repeat&&this._repeat.push(item),this}getTimeOf(item){return this._queue.getEventTime(item)}clear(){return this._queue.clear(),this._repeat=[],this._current=null,this}remove(item){let result=this._queue.remove(item),index=this._repeat.indexOf(item);return-1!=index&&this._repeat.splice(index,1),this._current==item&&(this._current=null),result}next(){return this._current=this._queue.get(),this._current}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Speed});var _scheduler_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(231);class Speed extends _scheduler_js__WEBPACK_IMPORTED_MODULE_0__.default{add(item,repeat,time){return this._queue.add(item,void 0!==time?time:1/item.getSpeed()),super.add(item,repeat)}next(){return this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,1/this._current.getSpeed()),super.next()}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Action});var _scheduler_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(231);class Action extends _scheduler_js__WEBPACK_IMPORTED_MODULE_0__.default{constructor(){super(),this._defaultDuration=1,this._duration=this._defaultDuration}add(item,repeat,time){return this._queue.add(item,time||this._defaultDuration),super.add(item,repeat)}clear(){return this._duration=this._defaultDuration,super.clear()}remove(item){return item==this._current&&(this._duration=this._defaultDuration),super.remove(item)}next(){return null!==this._current&&-1!=this._repeat.indexOf(this._current)&&(this._queue.add(this._current,this._duration||this._defaultDuration),this._duration=this._defaultDuration),super.next()}setDuration(time){return this._current&&(this._duration=time),this}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _discrete_shadowcasting_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(235),_precise_shadowcasting_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(237),_recursive_shadowcasting_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(238);const __WEBPACK_DEFAULT_EXPORT__={DiscreteShadowcasting:_discrete_shadowcasting_js__WEBPACK_IMPORTED_MODULE_0__.default,PreciseShadowcasting:_precise_shadowcasting_js__WEBPACK_IMPORTED_MODULE_1__.default,RecursiveShadowcasting:_recursive_shadowcasting_js__WEBPACK_IMPORTED_MODULE_2__.default}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>DiscreteShadowcasting});var _fov_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(236);class DiscreteShadowcasting extends _fov_js__WEBPACK_IMPORTED_MODULE_0__.default{compute(x,y,R,callback){if(callback(x,y,0,1),!this._lightPasses(x,y))return;let A,B,cx,cy,blocks,DATA=[];for(let r=1;r<=R;r++){let neighbors=this._getCircle(x,y,r),angle=360/neighbors.length;for(let i=0;i<neighbors.length;i++)if(cx=neighbors[i][0],cy=neighbors[i][1],A=angle*(i-.5),B=A+angle,blocks=!this._lightPasses(cx,cy),this._visibleCoords(Math.floor(A),Math.ceil(B),blocks,DATA)&&callback(cx,cy,r,1),2==DATA.length&&0==DATA[0]&&360==DATA[1])return}}_visibleCoords(A,B,blocks,DATA){if(A<0){let v1=this._visibleCoords(0,B,blocks,DATA),v2=this._visibleCoords(360+A,360,blocks,DATA);return v1||v2}let index=0;for(;index<DATA.length&&DATA[index]<A;)index++;if(index==DATA.length)return blocks&&DATA.push(A,B),!0;let count=0;if(index%2){for(;index<DATA.length&&DATA[index]<B;)index++,count++;return 0!=count&&(blocks&&(count%2?DATA.splice(index-count,count,B):DATA.splice(index-count,count)),!0)}for(;index<DATA.length&&DATA[index]<B;)index++,count++;return(A!=DATA[index-count]||1!=count)&&(blocks&&(count%2?DATA.splice(index-count,count,A):DATA.splice(index-count,count,A,B)),!0)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>FOV});var _constants_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(225);class FOV{constructor(lightPassesCallback,options={}){this._lightPasses=lightPassesCallback,this._options=Object.assign({topology:8},options)}_getCircle(cx,cy,r){let dirs,countFactor,startOffset,result=[];switch(this._options.topology){case 4:countFactor=1,startOffset=[0,1],dirs=[_constants_js__WEBPACK_IMPORTED_MODULE_0__.DIRS[8][7],_constants_js__WEBPACK_IMPORTED_MODULE_0__.DIRS[8][1],_constants_js__WEBPACK_IMPORTED_MODULE_0__.DIRS[8][3],_constants_js__WEBPACK_IMPORTED_MODULE_0__.DIRS[8][5]];break;case 6:dirs=_constants_js__WEBPACK_IMPORTED_MODULE_0__.DIRS[6],countFactor=1,startOffset=[-1,1];break;case 8:dirs=_constants_js__WEBPACK_IMPORTED_MODULE_0__.DIRS[4],countFactor=2,startOffset=[-1,1];break;default:throw new Error("Incorrect topology for FOV computation")}let x=cx+startOffset[0]*r,y=cy+startOffset[1]*r;for(let i=0;i<dirs.length;i++)for(let j=0;j<r*countFactor;j++)result.push([x,y]),x+=dirs[i][0],y+=dirs[i][1];return result}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>PreciseShadowcasting});var _fov_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(236);class PreciseShadowcasting extends _fov_js__WEBPACK_IMPORTED_MODULE_0__.default{compute(x,y,R,callback){if(callback(x,y,0,1),!this._lightPasses(x,y))return;let cx,cy,blocks,A1,A2,visibility,SHADOWS=[];for(let r=1;r<=R;r++){let neighbors=this._getCircle(x,y,r),neighborCount=neighbors.length;for(let i=0;i<neighborCount;i++)if(cx=neighbors[i][0],cy=neighbors[i][1],A1=[i?2*i-1:2*neighborCount-1,2*neighborCount],A2=[2*i+1,2*neighborCount],blocks=!this._lightPasses(cx,cy),visibility=this._checkVisibility(A1,A2,blocks,SHADOWS),visibility&&callback(cx,cy,r,visibility),2==SHADOWS.length&&0==SHADOWS[0][0]&&SHADOWS[1][0]==SHADOWS[1][1])return}}_checkVisibility(A1,A2,blocks,SHADOWS){if(A1[0]>A2[0]){return(this._checkVisibility(A1,[A1[1],A1[1]],blocks,SHADOWS)+this._checkVisibility([0,1],A2,blocks,SHADOWS))/2}let index1=0,edge1=!1;for(;index1<SHADOWS.length;){let old=SHADOWS[index1],diff=old[0]*A1[1]-A1[0]*old[1];if(diff>=0){0!=diff||index1%2||(edge1=!0);break}index1++}let index2=SHADOWS.length,edge2=!1;for(;index2--;){let old=SHADOWS[index2],diff=A2[0]*old[1]-old[0]*A2[1];if(diff>=0){0==diff&&index2%2&&(edge2=!0);break}}let visibleLength,visible=!0;if((index1==index2&&(edge1||edge2)||edge1&&edge2&&index1+1==index2&&index2%2||index1>index2&&index1%2)&&(visible=!1),!visible)return 0;let remove=index2-index1+1;if(remove%2)if(index1%2){let P=SHADOWS[index1];visibleLength=(A2[0]*P[1]-P[0]*A2[1])/(P[1]*A2[1]),blocks&&SHADOWS.splice(index1,remove,A2)}else{let P=SHADOWS[index2];visibleLength=(P[0]*A1[1]-A1[0]*P[1])/(A1[1]*P[1]),blocks&&SHADOWS.splice(index1,remove,A1)}else{if(!(index1%2))return blocks&&SHADOWS.splice(index1,remove,A1,A2),1;{let P1=SHADOWS[index1],P2=SHADOWS[index2];visibleLength=(P2[0]*P1[1]-P1[0]*P2[1])/(P1[1]*P2[1]),blocks&&SHADOWS.splice(index1,remove)}}return visibleLength/((A2[0]*A1[1]-A1[0]*A2[1])/(A1[1]*A2[1]))}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>RecursiveShadowcasting});var _fov_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(236);const OCTANTS=[[-1,0,0,1],[0,-1,1,0],[0,-1,-1,0],[-1,0,0,-1],[1,0,0,-1],[0,1,-1,0],[0,1,1,0],[1,0,0,1]];class RecursiveShadowcasting extends _fov_js__WEBPACK_IMPORTED_MODULE_0__.default{compute(x,y,R,callback){callback(x,y,0,1);for(let i=0;i<OCTANTS.length;i++)this._renderOctant(x,y,OCTANTS[i],R,callback)}compute180(x,y,R,dir,callback){callback(x,y,0,1);let previousOctant=(dir-1+8)%8,nextPreviousOctant=(dir-2+8)%8,nextOctant=(dir+1+8)%8;this._renderOctant(x,y,OCTANTS[nextPreviousOctant],R,callback),this._renderOctant(x,y,OCTANTS[previousOctant],R,callback),this._renderOctant(x,y,OCTANTS[dir],R,callback),this._renderOctant(x,y,OCTANTS[nextOctant],R,callback)}compute90(x,y,R,dir,callback){callback(x,y,0,1);let previousOctant=(dir-1+8)%8;this._renderOctant(x,y,OCTANTS[dir],R,callback),this._renderOctant(x,y,OCTANTS[previousOctant],R,callback)}_renderOctant(x,y,octant,R,callback){this._castVisibility(x,y,1,1,0,R+1,octant[0],octant[1],octant[2],octant[3],callback)}_castVisibility(startX,startY,row,visSlopeStart,visSlopeEnd,radius,xx,xy,yx,yy,callback){if(!(visSlopeStart<visSlopeEnd))for(let i=row;i<=radius;i++){let dx=-i-1,dy=-i,blocked=!1,newStart=0;for(;dx<=0;){dx+=1;let mapX=startX+dx*xx+dy*xy,mapY=startY+dx*yx+dy*yy,slopeStart=(dx-.5)/(dy+.5),slopeEnd=(dx+.5)/(dy-.5);if(!(slopeEnd>visSlopeStart)){if(slopeStart<visSlopeEnd)break;if(dx*dx+dy*dy<radius*radius&&callback(mapX,mapY,i,1),blocked){if(!this._lightPasses(mapX,mapY)){newStart=slopeEnd;continue}blocked=!1,visSlopeStart=newStart}else!this._lightPasses(mapX,mapY)&&i<radius&&(blocked=!0,this._castVisibility(startX,startY,i+1,visSlopeStart,slopeStart,radius,xx,xy,yx,yy,callback),newStart=slopeEnd)}}if(blocked)break}}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _arena_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(240),_uniform_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(242),_cellular_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(245),_digger_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(246),_ellermaze_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(247),_dividedmaze_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(248),_iceymaze_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(249),_rogue_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(250);const __WEBPACK_DEFAULT_EXPORT__={Arena:_arena_js__WEBPACK_IMPORTED_MODULE_0__.default,Uniform:_uniform_js__WEBPACK_IMPORTED_MODULE_1__.default,Cellular:_cellular_js__WEBPACK_IMPORTED_MODULE_2__.default,Digger:_digger_js__WEBPACK_IMPORTED_MODULE_3__.default,EllerMaze:_ellermaze_js__WEBPACK_IMPORTED_MODULE_4__.default,DividedMaze:_dividedmaze_js__WEBPACK_IMPORTED_MODULE_5__.default,IceyMaze:_iceymaze_js__WEBPACK_IMPORTED_MODULE_6__.default,Rogue:_rogue_js__WEBPACK_IMPORTED_MODULE_7__.default}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Arena});var _map_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(241);class Arena extends _map_js__WEBPACK_IMPORTED_MODULE_0__.default{create(callback){let w=this._width-1,h=this._height-1;for(let i=0;i<=w;i++)for(let j=0;j<=h;j++){callback(i,j,i&&j&&i<w&&j<h?0:1)}return this}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Map});var _constants_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(225);class Map{constructor(width=_constants_js__WEBPACK_IMPORTED_MODULE_0__.DEFAULT_WIDTH,height=_constants_js__WEBPACK_IMPORTED_MODULE_0__.DEFAULT_HEIGHT){this._width=width,this._height=height}_fillMap(value){let map=[];for(let i=0;i<this._width;i++){map.push([]);for(let j=0;j<this._height;j++)map[i].push(value)}return map}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Uniform});var _dungeon_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(243),_features_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(244),_rng_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(214);class Uniform extends _dungeon_js__WEBPACK_IMPORTED_MODULE_0__.default{constructor(width,height,options){super(width,height),this._options={roomWidth:[3,9],roomHeight:[3,5],roomDugPercentage:.1,timeLimit:1e3},Object.assign(this._options,options),this._map=[],this._dug=0,this._roomAttempts=20,this._corridorAttempts=20,this._connected=[],this._unconnected=[],this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this)}create(callback){let t1=Date.now();for(;;){if(Date.now()-t1>this._options.timeLimit)return null;if(this._map=this._fillMap(1),this._dug=0,this._rooms=[],this._unconnected=[],this._generateRooms(),!(this._rooms.length<2)&&this._generateCorridors())break}if(callback)for(let i=0;i<this._width;i++)for(let j=0;j<this._height;j++)callback(i,j,this._map[i][j]);return this}_generateRooms(){let room,w=this._width-2,h=this._height-2;do{if(room=this._generateRoom(),this._dug/(w*h)>this._options.roomDugPercentage)break}while(room)}_generateRoom(){let count=0;for(;count<this._roomAttempts;){count++;let room=_features_js__WEBPACK_IMPORTED_MODULE_1__.Room.createRandom(this._width,this._height,this._options);if(room.isValid(this._isWallCallback,this._canBeDugCallback))return room.create(this._digCallback),this._rooms.push(room),room}return null}_generateCorridors(){let cnt=0;for(;cnt<this._corridorAttempts;){cnt++,this._corridors=[],this._map=this._fillMap(1);for(let i=0;i<this._rooms.length;i++){let room=this._rooms[i];room.clearDoors(),room.create(this._digCallback)}for(this._unconnected=_rng_js__WEBPACK_IMPORTED_MODULE_2__.default.shuffle(this._rooms.slice()),this._connected=[],this._unconnected.length&&this._connected.push(this._unconnected.pop());;){let connected=_rng_js__WEBPACK_IMPORTED_MODULE_2__.default.getItem(this._connected);if(!connected)break;let room1=this._closestRoom(this._unconnected,connected);if(!room1)break;let room2=this._closestRoom(this._connected,room1);if(!room2)break;if(!this._connectRooms(room1,room2))break;if(!this._unconnected.length)return!0}}return!1}_closestRoom(rooms,room){let dist=1/0,center=room.getCenter(),result=null;for(let i=0;i<rooms.length;i++){let r=rooms[i],c=r.getCenter(),dx=c[0]-center[0],dy=c[1]-center[1],d=dx*dx+dy*dy;d<dist&&(dist=d,result=r)}return result}_connectRooms(room1,room2){let start,end,dirIndex1,dirIndex2,min,max,index,center1=room1.getCenter(),center2=room2.getCenter(),diffX=center2[0]-center1[0],diffY=center2[1]-center1[1];if(Math.abs(diffX)<Math.abs(diffY)?(dirIndex1=diffY>0?2:0,dirIndex2=(dirIndex1+2)%4,min=room2.getLeft(),max=room2.getRight(),index=0):(dirIndex1=diffX>0?1:3,dirIndex2=(dirIndex1+2)%4,min=room2.getTop(),max=room2.getBottom(),index=1),start=this._placeInWall(room1,dirIndex1),!start)return!1;if(start[index]>=min&&start[index]<=max){end=start.slice();let value=0;switch(dirIndex2){case 0:value=room2.getTop()-1;break;case 1:value=room2.getRight()+1;break;case 2:value=room2.getBottom()+1;break;case 3:value=room2.getLeft()-1}end[(index+1)%2]=value,this._digLine([start,end])}else if(start[index]<min-1||start[index]>max+1){let diff=start[index]-center2[index],rotation=0;switch(dirIndex2){case 0:case 1:rotation=diff<0?3:1;break;case 2:case 3:rotation=diff<0?1:3}if(dirIndex2=(dirIndex2+rotation)%4,end=this._placeInWall(room2,dirIndex2),!end)return!1;let mid=[0,0];mid[index]=start[index];let index2=(index+1)%2;mid[index2]=end[index2],this._digLine([start,mid,end])}else{let index2=(index+1)%2;if(end=this._placeInWall(room2,dirIndex2),!end)return!1;let mid=Math.round((end[index2]+start[index2])/2),mid1=[0,0],mid2=[0,0];mid1[index]=start[index],mid1[index2]=mid,mid2[index]=end[index],mid2[index2]=mid,this._digLine([start,mid1,mid2,end])}return room1.addDoor(start[0],start[1]),room2.addDoor(end[0],end[1]),index=this._unconnected.indexOf(room1),-1!=index&&(this._unconnected.splice(index,1),this._connected.push(room1)),index=this._unconnected.indexOf(room2),-1!=index&&(this._unconnected.splice(index,1),this._connected.push(room2)),!0}_placeInWall(room,dirIndex){let start=[0,0],dir=[0,0],length=0;switch(dirIndex){case 0:dir=[1,0],start=[room.getLeft(),room.getTop()-1],length=room.getRight()-room.getLeft()+1;break;case 1:dir=[0,1],start=[room.getRight()+1,room.getTop()],length=room.getBottom()-room.getTop()+1;break;case 2:dir=[1,0],start=[room.getLeft(),room.getBottom()+1],length=room.getRight()-room.getLeft()+1;break;case 3:dir=[0,1],start=[room.getLeft()-1,room.getTop()],length=room.getBottom()-room.getTop()+1}let avail=[],lastBadIndex=-2;for(let i=0;i<length;i++){let x=start[0]+i*dir[0],y=start[1]+i*dir[1];avail.push(null),1==this._map[x][y]?lastBadIndex!=i-1&&(avail[i]=[x,y]):(lastBadIndex=i,i&&(avail[i-1]=null))}for(let i=avail.length-1;i>=0;i--)avail[i]||avail.splice(i,1);return avail.length?_rng_js__WEBPACK_IMPORTED_MODULE_2__.default.getItem(avail):null}_digLine(points){for(let i=1;i<points.length;i++){let start=points[i-1],end=points[i],corridor=new _features_js__WEBPACK_IMPORTED_MODULE_1__.Corridor(start[0],start[1],end[0],end[1]);corridor.create(this._digCallback),this._corridors.push(corridor)}}_digCallback(x,y,value){this._map[x][y]=value,0==value&&this._dug++}_isWallCallback(x,y){return!(x<0||y<0||x>=this._width||y>=this._height)&&1==this._map[x][y]}_canBeDugCallback(x,y){return!(x<1||y<1||x+1>=this._width||y+1>=this._height)&&1==this._map[x][y]}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Dungeon});var _map_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(241);class Dungeon extends _map_js__WEBPACK_IMPORTED_MODULE_0__.default{constructor(width,height){super(width,height),this._rooms=[],this._corridors=[]}getRooms(){return this._rooms}getCorridors(){return this._corridors}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Room:()=>Room,Corridor:()=>Corridor});var _rng_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(214);class Feature{}class Room extends Feature{constructor(x1,y1,x2,y2,doorX,doorY){super(),this._x1=x1,this._y1=y1,this._x2=x2,this._y2=y2,this._doors={},void 0!==doorX&&void 0!==doorY&&this.addDoor(doorX,doorY)}static createRandomAt(x,y,dx,dy,options){let min=options.roomWidth[0],max=options.roomWidth[1],width=_rng_js__WEBPACK_IMPORTED_MODULE_0__.default.getUniformInt(min,max);min=options.roomHeight[0],max=options.roomHeight[1];let height=_rng_js__WEBPACK_IMPORTED_MODULE_0__.default.getUniformInt(min,max);if(1==dx){let y2=y-Math.floor(_rng_js__WEBPACK_IMPORTED_MODULE_0__.default.getUniform()*height);return new this(x+1,y2,x+width,y2+height-1,x,y)}if(-1==dx){let y2=y-Math.floor(_rng_js__WEBPACK_IMPORTED_MODULE_0__.default.getUniform()*height);return new this(x-width,y2,x-1,y2+height-1,x,y)}if(1==dy){let x2=x-Math.floor(_rng_js__WEBPACK_IMPORTED_MODULE_0__.default.getUniform()*width);return new this(x2,y+1,x2+width-1,y+height,x,y)}if(-1==dy){let x2=x-Math.floor(_rng_js__WEBPACK_IMPORTED_MODULE_0__.default.getUniform()*width);return new this(x2,y-height,x2+width-1,y-1,x,y)}throw new Error("dx or dy must be 1 or -1")}static createRandomCenter(cx,cy,options){let min=options.roomWidth[0],max=options.roomWidth[1],width=_rng_js__WEBPACK_IMPORTED_MODULE_0__.default.getUniformInt(min,max);min=options.roomHeight[0],max=options.roomHeight[1];let height=_rng_js__WEBPACK_IMPORTED_MODULE_0__.default.getUniformInt(min,max),x1=cx-Math.floor(_rng_js__WEBPACK_IMPORTED_MODULE_0__.default.getUniform()*width),y1=cy-Math.floor(_rng_js__WEBPACK_IMPORTED_MODULE_0__.default.getUniform()*height);return new this(x1,y1,x1+width-1,y1+height-1)}static createRandom(availWidth,availHeight,options){let min=options.roomWidth[0],max=options.roomWidth[1],width=_rng_js__WEBPACK_IMPORTED_MODULE_0__.default.getUniformInt(min,max);min=options.roomHeight[0],max=options.roomHeight[1];let height=_rng_js__WEBPACK_IMPORTED_MODULE_0__.default.getUniformInt(min,max),left=availWidth-width-1,top=availHeight-height-1,x1=1+Math.floor(_rng_js__WEBPACK_IMPORTED_MODULE_0__.default.getUniform()*left),y1=1+Math.floor(_rng_js__WEBPACK_IMPORTED_MODULE_0__.default.getUniform()*top);return new this(x1,y1,x1+width-1,y1+height-1)}addDoor(x,y){return this._doors[x+","+y]=1,this}getDoors(cb){for(let key in this._doors){let parts=key.split(",");cb(parseInt(parts[0]),parseInt(parts[1]))}return this}clearDoors(){return this._doors={},this}addDoors(isWallCallback){let left=this._x1-1,right=this._x2+1,top=this._y1-1,bottom=this._y2+1;for(let x=left;x<=right;x++)for(let y=top;y<=bottom;y++)x!=left&&x!=right&&y!=top&&y!=bottom||isWallCallback(x,y)||this.addDoor(x,y);return this}debug(){console.log("room",this._x1,this._y1,this._x2,this._y2)}isValid(isWallCallback,canBeDugCallback){let left=this._x1-1,right=this._x2+1,top=this._y1-1,bottom=this._y2+1;for(let x=left;x<=right;x++)for(let y=top;y<=bottom;y++)if(x==left||x==right||y==top||y==bottom){if(!isWallCallback(x,y))return!1}else if(!canBeDugCallback(x,y))return!1;return!0}create(digCallback){let left=this._x1-1,right=this._x2+1,top=this._y1-1,bottom=this._y2+1,value=0;for(let x=left;x<=right;x++)for(let y=top;y<=bottom;y++)value=x+","+y in this._doors?2:x==left||x==right||y==top||y==bottom?1:0,digCallback(x,y,value)}getCenter(){return[Math.round((this._x1+this._x2)/2),Math.round((this._y1+this._y2)/2)]}getLeft(){return this._x1}getRight(){return this._x2}getTop(){return this._y1}getBottom(){return this._y2}}class Corridor extends Feature{constructor(startX,startY,endX,endY){super(),this._startX=startX,this._startY=startY,this._endX=endX,this._endY=endY,this._endsWithAWall=!0}static createRandomAt(x,y,dx,dy,options){let min=options.corridorLength[0],max=options.corridorLength[1],length=_rng_js__WEBPACK_IMPORTED_MODULE_0__.default.getUniformInt(min,max);return new this(x,y,x+dx*length,y+dy*length)}debug(){console.log("corridor",this._startX,this._startY,this._endX,this._endY)}isValid(isWallCallback,canBeDugCallback){let sx=this._startX,sy=this._startY,dx=this._endX-sx,dy=this._endY-sy,length=1+Math.max(Math.abs(dx),Math.abs(dy));dx&&(dx/=Math.abs(dx)),dy&&(dy/=Math.abs(dy));let nx=dy,ny=-dx,ok=!0;for(let i=0;i<length;i++){let x=sx+i*dx,y=sy+i*dy;if(canBeDugCallback(x,y)||(ok=!1),isWallCallback(x+nx,y+ny)||(ok=!1),isWallCallback(x-nx,y-ny)||(ok=!1),!ok){length=i,this._endX=x-dx,this._endY=y-dy;break}}if(0==length)return!1;if(1==length&&isWallCallback(this._endX+dx,this._endY+dy))return!1;let firstCornerBad=!isWallCallback(this._endX+dx+nx,this._endY+dy+ny),secondCornerBad=!isWallCallback(this._endX+dx-nx,this._endY+dy-ny);return this._endsWithAWall=isWallCallback(this._endX+dx,this._endY+dy),!firstCornerBad&&!secondCornerBad||!this._endsWithAWall}create(digCallback){let sx=this._startX,sy=this._startY,dx=this._endX-sx,dy=this._endY-sy,length=1+Math.max(Math.abs(dx),Math.abs(dy));dx&&(dx/=Math.abs(dx)),dy&&(dy/=Math.abs(dy));for(let i=0;i<length;i++){digCallback(sx+i*dx,sy+i*dy,0)}return!0}createPriorityWalls(priorityWallCallback){if(!this._endsWithAWall)return;let sx=this._startX,sy=this._startY,dx=this._endX-sx,dy=this._endY-sy;dx&&(dx/=Math.abs(dx)),dy&&(dy/=Math.abs(dy));let nx=dy,ny=-dx;priorityWallCallback(this._endX+dx,this._endY+dy),priorityWallCallback(this._endX+nx,this._endY+ny),priorityWallCallback(this._endX-nx,this._endY-ny)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Cellular});var _map_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(241),_constants_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(225),_rng_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(214);class Cellular extends _map_js__WEBPACK_IMPORTED_MODULE_0__.default{constructor(width,height,options={}){super(width,height),this._options={born:[5,6,7,8],survive:[4,5,6,7,8],topology:8},this.setOptions(options),this._dirs=_constants_js__WEBPACK_IMPORTED_MODULE_1__.DIRS[this._options.topology],this._map=this._fillMap(0)}randomize(probability){for(let i=0;i<this._width;i++)for(let j=0;j<this._height;j++)this._map[i][j]=_rng_js__WEBPACK_IMPORTED_MODULE_2__.default.getUniform()<probability?1:0;return this}setOptions(options){Object.assign(this._options,options)}set(x,y,value){this._map[x][y]=value}create(callback){let newMap=this._fillMap(0),born=this._options.born,survive=this._options.survive;for(let j=0;j<this._height;j++){let widthStep=1,widthStart=0;6==this._options.topology&&(widthStep=2,widthStart=j%2);for(let i=widthStart;i<this._width;i+=widthStep){let cur=this._map[i][j],ncount=this._getNeighbors(i,j);cur&&-1!=survive.indexOf(ncount)?newMap[i][j]=1:cur||-1==born.indexOf(ncount)||(newMap[i][j]=1)}}this._map=newMap,callback&&this._serviceCallback(callback)}_serviceCallback(callback){for(let j=0;j<this._height;j++){let widthStep=1,widthStart=0;6==this._options.topology&&(widthStep=2,widthStart=j%2);for(let i=widthStart;i<this._width;i+=widthStep)callback(i,j,this._map[i][j])}}_getNeighbors(cx,cy){let result=0;for(let i=0;i<this._dirs.length;i++){let dir=this._dirs[i],x=cx+dir[0],y=cy+dir[1];x<0||x>=this._width||y<0||y>=this._height||(result+=1==this._map[x][y]?1:0)}return result}connect(callback,value,connectionCallback){value||(value=0);let allFreeSpace=[],notConnected={},widthStep=1,widthStarts=[0,0];6==this._options.topology&&(widthStep=2,widthStarts=[0,1]);for(let y=0;y<this._height;y++)for(let x=widthStarts[y%2];x<this._width;x+=widthStep)if(this._freeSpace(x,y,value)){let p=[x,y];notConnected[this._pointKey(p)]=p,allFreeSpace.push([x,y])}let start=allFreeSpace[_rng_js__WEBPACK_IMPORTED_MODULE_2__.default.getUniformInt(0,allFreeSpace.length-1)],key=this._pointKey(start),connected={};for(connected[key]=start,delete notConnected[key],this._findConnected(connected,notConnected,[start],!1,value);Object.keys(notConnected).length>0;){let p=this._getFromTo(connected,notConnected),from=p[0],to=p[1],local={};local[this._pointKey(from)]=from,this._findConnected(local,notConnected,[from],!0,value),(6==this._options.topology?this._tunnelToConnected6:this._tunnelToConnected).call(this,to,from,connected,notConnected,value,connectionCallback);for(let k in local){let pp=local[k];this._map[pp[0]][pp[1]]=value,connected[k]=pp,delete notConnected[k]}}callback&&this._serviceCallback(callback)}_getFromTo(connected,notConnected){let d,from=[0,0],to=[0,0],connectedKeys=Object.keys(connected),notConnectedKeys=Object.keys(notConnected);for(let i=0;i<5;i++){if(connectedKeys.length<notConnectedKeys.length){let keys=connectedKeys;to=connected[keys[_rng_js__WEBPACK_IMPORTED_MODULE_2__.default.getUniformInt(0,keys.length-1)]],from=this._getClosest(to,notConnected)}else{let keys=notConnectedKeys;from=notConnected[keys[_rng_js__WEBPACK_IMPORTED_MODULE_2__.default.getUniformInt(0,keys.length-1)]],to=this._getClosest(from,connected)}if(d=(from[0]-to[0])*(from[0]-to[0])+(from[1]-to[1])*(from[1]-to[1]),d<64)break}return[from,to]}_getClosest(point,space){let minPoint=null,minDist=null;for(let k in space){let p=space[k],d=(p[0]-point[0])*(p[0]-point[0])+(p[1]-point[1])*(p[1]-point[1]);(null==minDist||d<minDist)&&(minDist=d,minPoint=p)}return minPoint}_findConnected(connected,notConnected,stack,keepNotConnected,value){for(;stack.length>0;){let tests,p=stack.splice(0,1)[0];tests=6==this._options.topology?[[p[0]+2,p[1]],[p[0]+1,p[1]-1],[p[0]-1,p[1]-1],[p[0]-2,p[1]],[p[0]-1,p[1]+1],[p[0]+1,p[1]+1]]:[[p[0]+1,p[1]],[p[0]-1,p[1]],[p[0],p[1]+1],[p[0],p[1]-1]];for(let i=0;i<tests.length;i++){let key=this._pointKey(tests[i]);null==connected[key]&&this._freeSpace(tests[i][0],tests[i][1],value)&&(connected[key]=tests[i],keepNotConnected||delete notConnected[key],stack.push(tests[i]))}}}_tunnelToConnected(to,from,connected,notConnected,value,connectionCallback){let a,b;from[0]<to[0]?(a=from,b=to):(a=to,b=from);for(let xx=a[0];xx<=b[0];xx++){this._map[xx][a[1]]=value;let p=[xx,a[1]],pkey=this._pointKey(p);connected[pkey]=p,delete notConnected[pkey]}connectionCallback&&a[0]<b[0]&&connectionCallback(a,[b[0],a[1]]);let x=b[0];from[1]<to[1]?(a=from,b=to):(a=to,b=from);for(let yy=a[1];yy<b[1];yy++){this._map[x][yy]=value;let p=[x,yy],pkey=this._pointKey(p);connected[pkey]=p,delete notConnected[pkey]}connectionCallback&&a[1]<b[1]&&connectionCallback([b[0],a[1]],[b[0],b[1]])}_tunnelToConnected6(to,from,connected,notConnected,value,connectionCallback){let a,b;from[0]<to[0]?(a=from,b=to):(a=to,b=from);let xx=a[0],yy=a[1];for(;xx!=b[0]||yy!=b[1];){let stepWidth=2;yy<b[1]?(yy++,stepWidth=1):yy>b[1]&&(yy--,stepWidth=1),xx<b[0]?xx+=stepWidth:xx>b[0]||b[1]%2?xx-=stepWidth:xx+=stepWidth,this._map[xx][yy]=value;let p=[xx,yy],pkey=this._pointKey(p);connected[pkey]=p,delete notConnected[pkey]}connectionCallback&&connectionCallback(from,to)}_freeSpace(x,y,value){return x>=0&&x<this._width&&y>=0&&y<this._height&&this._map[x][y]==value}_pointKey(p){return p[0]+"."+p[1]}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Digger});var _dungeon_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(243),_features_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(244),_rng_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(214),_constants_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(225);const FEATURES={room:_features_js__WEBPACK_IMPORTED_MODULE_1__.Room,corridor:_features_js__WEBPACK_IMPORTED_MODULE_1__.Corridor};class Digger extends _dungeon_js__WEBPACK_IMPORTED_MODULE_0__.default{constructor(width,height,options={}){super(width,height),this._options=Object.assign({roomWidth:[3,9],roomHeight:[3,5],corridorLength:[3,10],dugPercentage:.2,timeLimit:1e3},options),this._features={room:4,corridor:4},this._map=[],this._featureAttempts=20,this._walls={},this._dug=0,this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this),this._priorityWallCallback=this._priorityWallCallback.bind(this)}create(callback){this._rooms=[],this._corridors=[],this._map=this._fillMap(1),this._walls={},this._dug=0;let area=(this._width-2)*(this._height-2);this._firstRoom();let priorityWalls,t1=Date.now();do{if(priorityWalls=0,Date.now()-t1>this._options.timeLimit)break;let wall=this._findWall();if(!wall)break;let parts=wall.split(","),x=parseInt(parts[0]),y=parseInt(parts[1]),dir=this._getDiggingDirection(x,y);if(!dir)continue;let featureAttempts=0;do{if(featureAttempts++,this._tryFeature(x,y,dir[0],dir[1])){this._removeSurroundingWalls(x,y),this._removeSurroundingWalls(x-dir[0],y-dir[1]);break}}while(featureAttempts<this._featureAttempts);for(let id in this._walls)this._walls[id]>1&&priorityWalls++}while(this._dug/area<this._options.dugPercentage||priorityWalls);if(this._addDoors(),callback)for(let i=0;i<this._width;i++)for(let j=0;j<this._height;j++)callback(i,j,this._map[i][j]);return this._walls={},this._map=[],this}_digCallback(x,y,value){0==value||2==value?(this._map[x][y]=0,this._dug++):this._walls[x+","+y]=1}_isWallCallback(x,y){return!(x<0||y<0||x>=this._width||y>=this._height)&&1==this._map[x][y]}_canBeDugCallback(x,y){return!(x<1||y<1||x+1>=this._width||y+1>=this._height)&&1==this._map[x][y]}_priorityWallCallback(x,y){this._walls[x+","+y]=2}_firstRoom(){let cx=Math.floor(this._width/2),cy=Math.floor(this._height/2),room=_features_js__WEBPACK_IMPORTED_MODULE_1__.Room.createRandomCenter(cx,cy,this._options);this._rooms.push(room),room.create(this._digCallback)}_findWall(){let prio1=[],prio2=[];for(let id in this._walls){2==this._walls[id]?prio2.push(id):prio1.push(id)}let arr=prio2.length?prio2:prio1;if(!arr.length)return null;let id=_rng_js__WEBPACK_IMPORTED_MODULE_2__.default.getItem(arr.sort());return delete this._walls[id],id}_tryFeature(x,y,dx,dy){let featureName=_rng_js__WEBPACK_IMPORTED_MODULE_2__.default.getWeightedValue(this._features),feature=FEATURES[featureName].createRandomAt(x,y,dx,dy,this._options);return!!feature.isValid(this._isWallCallback,this._canBeDugCallback)&&(feature.create(this._digCallback),feature instanceof _features_js__WEBPACK_IMPORTED_MODULE_1__.Room&&this._rooms.push(feature),feature instanceof _features_js__WEBPACK_IMPORTED_MODULE_1__.Corridor&&(feature.createPriorityWalls(this._priorityWallCallback),this._corridors.push(feature)),!0)}_removeSurroundingWalls(cx,cy){let deltas=_constants_js__WEBPACK_IMPORTED_MODULE_3__.DIRS[4];for(let i=0;i<deltas.length;i++){let delta=deltas[i],x=cx+delta[0],y=cy+delta[1];delete this._walls[x+","+y],x=cx+2*delta[0],y=cy+2*delta[1],delete this._walls[x+","+y]}}_getDiggingDirection(cx,cy){if(cx<=0||cy<=0||cx>=this._width-1||cy>=this._height-1)return null;let result=null,deltas=_constants_js__WEBPACK_IMPORTED_MODULE_3__.DIRS[4];for(let i=0;i<deltas.length;i++){let delta=deltas[i],x=cx+delta[0],y=cy+delta[1];if(!this._map[x][y]){if(result)return null;result=delta}}return result?[-result[0],-result[1]]:null}_addDoors(){let data=this._map;function isWallCallback(x,y){return 1==data[x][y]}for(let i=0;i<this._rooms.length;i++){let room=this._rooms[i];room.clearDoors(),room.addDoors(isWallCallback)}}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>EllerMaze});var _map_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(241),_rng_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(214);function addToList(i,L,R){R[L[i+1]]=R[i],L[R[i]]=L[i+1],R[i]=i+1,L[i+1]=i}function removeFromList(i,L,R){R[L[i]]=R[i],L[R[i]]=L[i],R[i]=i,L[i]=i}class EllerMaze extends _map_js__WEBPACK_IMPORTED_MODULE_0__.default{create(callback){let j,map=this._fillMap(1),w=Math.ceil((this._width-2)/2),L=[],R=[];for(let i=0;i<w;i++)L.push(i),R.push(i);for(L.push(w-1),j=1;j+3<this._height;j+=2)for(let i=0;i<w;i++){let x=2*i+1,y=j;map[x][y]=0,i!=L[i+1]&&_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.getUniform()>.375&&(addToList(i,L,R),map[x+1][y]=0),i!=L[i]&&_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.getUniform()>.375?removeFromList(i,L,R):map[x][y+1]=0}for(let i=0;i<w;i++){let x=2*i+1,y=j;map[x][y]=0,i!=L[i+1]&&(i==L[i]||_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.getUniform()>.375)&&(addToList(i,L,R),map[x+1][y]=0),removeFromList(i,L,R)}for(let i=0;i<this._width;i++)for(let j=0;j<this._height;j++)callback(i,j,map[i][j]);return this}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>DividedMaze});var _map_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(241),_rng_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(214);class DividedMaze extends _map_js__WEBPACK_IMPORTED_MODULE_0__.default{constructor(){super(...arguments),this._stack=[],this._map=[]}create(callback){let w=this._width,h=this._height;this._map=[];for(let i=0;i<w;i++){this._map.push([]);for(let j=0;j<h;j++){let border=0==i||0==j||i+1==w||j+1==h;this._map[i].push(border?1:0)}}this._stack=[[1,1,w-2,h-2]],this._process();for(let i=0;i<w;i++)for(let j=0;j<h;j++)callback(i,j,this._map[i][j]);return this._map=[],this}_process(){for(;this._stack.length;){let room=this._stack.shift();this._partitionRoom(room)}}_partitionRoom(room){let availX=[],availY=[];for(let i=room[0]+1;i<room[2];i++){let top=this._map[i][room[1]-1],bottom=this._map[i][room[3]+1];!top||!bottom||i%2||availX.push(i)}for(let j=room[1]+1;j<room[3];j++){let left=this._map[room[0]-1][j],right=this._map[room[2]+1][j];!left||!right||j%2||availY.push(j)}if(!availX.length||!availY.length)return;let x=_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.getItem(availX),y=_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.getItem(availY);this._map[x][y]=1;let walls=[],w=[];walls.push(w);for(let i=room[0];i<x;i++)this._map[i][y]=1,i%2&&w.push([i,y]);w=[],walls.push(w);for(let i=x+1;i<=room[2];i++)this._map[i][y]=1,i%2&&w.push([i,y]);w=[],walls.push(w);for(let j=room[1];j<y;j++)this._map[x][j]=1,j%2&&w.push([x,j]);w=[],walls.push(w);for(let j=y+1;j<=room[3];j++)this._map[x][j]=1,j%2&&w.push([x,j]);let solid=_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.getItem(walls);for(let i=0;i<walls.length;i++){let w=walls[i];if(w==solid)continue;let hole=_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.getItem(w);this._map[hole[0]][hole[1]]=0}this._stack.push([room[0],room[1],x-1,y-1]),this._stack.push([x+1,room[1],room[2],y-1]),this._stack.push([room[0],y+1,x-1,room[3]]),this._stack.push([x+1,y+1,room[2],room[3]])}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>IceyMaze});var _map_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(241),_rng_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(214);class IceyMaze extends _map_js__WEBPACK_IMPORTED_MODULE_0__.default{constructor(width,height,regularity=0){super(width,height),this._regularity=regularity,this._map=[]}create(callback){let width=this._width,height=this._height,map=this._fillMap(1);width-=width%2?1:2,height-=height%2?1:2;let cx=0,cy=0,nx=0,ny=0,done=0,blocked=!1,dirs=[[0,0],[0,0],[0,0],[0,0]];do{if(cx=1+2*Math.floor(_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.getUniform()*(width-1)/2),cy=1+2*Math.floor(_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.getUniform()*(height-1)/2),done||(map[cx][cy]=0),!map[cx][cy]){this._randomize(dirs);do{0==Math.floor(_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.getUniform()*(this._regularity+1))&&this._randomize(dirs),blocked=!0;for(let i=0;i<4;i++)if(nx=cx+2*dirs[i][0],ny=cy+2*dirs[i][1],this._isFree(map,nx,ny,width,height)){map[nx][ny]=0,map[cx+dirs[i][0]][cy+dirs[i][1]]=0,cx=nx,cy=ny,blocked=!1,done++;break}}while(!blocked)}}while(done+1<width*height/4);for(let i=0;i<this._width;i++)for(let j=0;j<this._height;j++)callback(i,j,map[i][j]);return this._map=[],this}_randomize(dirs){for(let i=0;i<4;i++)dirs[i][0]=0,dirs[i][1]=0;switch(Math.floor(4*_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.getUniform())){case 0:dirs[0][0]=-1,dirs[1][0]=1,dirs[2][1]=-1,dirs[3][1]=1;break;case 1:dirs[3][0]=-1,dirs[2][0]=1,dirs[1][1]=-1,dirs[0][1]=1;break;case 2:dirs[2][0]=-1,dirs[3][0]=1,dirs[0][1]=-1,dirs[1][1]=1;break;case 3:dirs[1][0]=-1,dirs[0][0]=1,dirs[3][1]=-1,dirs[2][1]=1}}_isFree(map,x,y,width,height){return!(x<1||y<1||x>=width||y>=height)&&map[x][y]}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Rogue});var _map_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(241),_rng_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(214),_constants_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(225);class Rogue extends _map_js__WEBPACK_IMPORTED_MODULE_0__.default{constructor(width,height,options){super(width,height),this.map=[],this.rooms=[],this.connectedCells=[],(options=Object.assign({cellWidth:3,cellHeight:3},options)).hasOwnProperty("roomWidth")||(options.roomWidth=this._calculateRoomSize(this._width,options.cellWidth)),options.hasOwnProperty("roomHeight")||(options.roomHeight=this._calculateRoomSize(this._height,options.cellHeight)),this._options=options}create(callback){if(this.map=this._fillMap(1),this.rooms=[],this.connectedCells=[],this._initRooms(),this._connectRooms(),this._connectUnconnectedRooms(),this._createRandomRoomConnections(),this._createRooms(),this._createCorridors(),callback)for(let i=0;i<this._width;i++)for(let j=0;j<this._height;j++)callback(i,j,this.map[i][j]);return this}_calculateRoomSize(size,cell){let max=Math.floor(size/cell*.8),min=Math.floor(size/cell*.25);return min<2&&(min=2),max<2&&(max=2),[min,max]}_initRooms(){for(let i=0;i<this._options.cellWidth;i++){this.rooms.push([]);for(let j=0;j<this._options.cellHeight;j++)this.rooms[i].push({x:0,y:0,width:0,height:0,connections:[],cellx:i,celly:j})}}_connectRooms(){let idx,ncgx,ncgy,room,otherRoom,dirToCheck,cgx=_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.getUniformInt(0,this._options.cellWidth-1),cgy=_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.getUniformInt(0,this._options.cellHeight-1),found=!1;do{dirToCheck=[0,2,4,6],dirToCheck=_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.shuffle(dirToCheck);do{if(found=!1,idx=dirToCheck.pop(),ncgx=cgx+_constants_js__WEBPACK_IMPORTED_MODULE_2__.DIRS[8][idx][0],ncgy=cgy+_constants_js__WEBPACK_IMPORTED_MODULE_2__.DIRS[8][idx][1],!(ncgx<0||ncgx>=this._options.cellWidth||ncgy<0||ncgy>=this._options.cellHeight)){if(room=this.rooms[cgx][cgy],room.connections.length>0&&room.connections[0][0]==ncgx&&room.connections[0][1]==ncgy)break;otherRoom=this.rooms[ncgx][ncgy],0==otherRoom.connections.length&&(otherRoom.connections.push([cgx,cgy]),this.connectedCells.push([ncgx,ncgy]),cgx=ncgx,cgy=ncgy,found=!0)}}while(dirToCheck.length>0&&0==found)}while(dirToCheck.length>0)}_connectUnconnectedRooms(){let room,otherRoom,validRoom,cw=this._options.cellWidth,ch=this._options.cellHeight;this.connectedCells=_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.shuffle(this.connectedCells);for(let i=0;i<this._options.cellWidth;i++)for(let j=0;j<this._options.cellHeight;j++)if(room=this.rooms[i][j],0==room.connections.length){let directions=[0,2,4,6];directions=_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.shuffle(directions),validRoom=!1;do{let dirIdx=directions.pop(),newI=i+_constants_js__WEBPACK_IMPORTED_MODULE_2__.DIRS[8][dirIdx][0],newJ=j+_constants_js__WEBPACK_IMPORTED_MODULE_2__.DIRS[8][dirIdx][1];if(!(newI<0||newI>=cw||newJ<0||newJ>=ch)){if(otherRoom=this.rooms[newI][newJ],validRoom=!0,0==otherRoom.connections.length)break;for(let k=0;k<otherRoom.connections.length;k++)if(otherRoom.connections[k][0]==i&&otherRoom.connections[k][1]==j){validRoom=!1;break}if(validRoom)break}}while(directions.length);validRoom?room.connections.push([otherRoom.cellx,otherRoom.celly]):console.log("-- Unable to connect room.")}}_createRandomRoomConnections(){}_createRooms(){let roomw,roomh,sx,sy,otherRoom,w=this._width,h=this._height,cw=this._options.cellWidth,ch=this._options.cellHeight,cwp=Math.floor(this._width/cw),chp=Math.floor(this._height/ch),roomWidth=this._options.roomWidth,roomHeight=this._options.roomHeight;for(let i=0;i<cw;i++)for(let j=0;j<ch;j++){if(sx=cwp*i,sy=chp*j,0==sx&&(sx=1),0==sy&&(sy=1),roomw=_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.getUniformInt(roomWidth[0],roomWidth[1]),roomh=_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.getUniformInt(roomHeight[0],roomHeight[1]),j>0)for(otherRoom=this.rooms[i][j-1];sy-(otherRoom.y+otherRoom.height)<3;)sy++;if(i>0)for(otherRoom=this.rooms[i-1][j];sx-(otherRoom.x+otherRoom.width)<3;)sx++;let sxOffset=Math.round(_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.getUniformInt(0,cwp-roomw)/2),syOffset=Math.round(_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.getUniformInt(0,chp-roomh)/2);for(;sx+sxOffset+roomw>=w;)sxOffset?sxOffset--:roomw--;for(;sy+syOffset+roomh>=h;)syOffset?syOffset--:roomh--;sx+=sxOffset,sy+=syOffset,this.rooms[i][j].x=sx,this.rooms[i][j].y=sy,this.rooms[i][j].width=roomw,this.rooms[i][j].height=roomh;for(let ii=sx;ii<sx+roomw;ii++)for(let jj=sy;jj<sy+roomh;jj++)this.map[ii][jj]=0}}_getWallPosition(aRoom,aDirection){let rx,ry,door;return 1==aDirection||3==aDirection?(rx=_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.getUniformInt(aRoom.x+1,aRoom.x+aRoom.width-2),1==aDirection?(ry=aRoom.y-2,door=ry+1):(ry=aRoom.y+aRoom.height+1,door=ry-1),this.map[rx][door]=0):(ry=_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.getUniformInt(aRoom.y+1,aRoom.y+aRoom.height-2),2==aDirection?(rx=aRoom.x+aRoom.width+1,door=rx-1):(rx=aRoom.x-2,door=rx+1),this.map[door][ry]=0),[rx,ry]}_drawCorridor(startPosition,endPosition){let tempDist,xDir,yDir,move,xOffset=endPosition[0]-startPosition[0],yOffset=endPosition[1]-startPosition[1],xpos=startPosition[0],ypos=startPosition[1],moves=[],xAbs=Math.abs(xOffset),yAbs=Math.abs(yOffset),percent=_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.getUniform(),firstHalf=percent,secondHalf=1-percent;for(xDir=xOffset>0?2:6,yDir=yOffset>0?4:0,xAbs<yAbs?(tempDist=Math.ceil(yAbs*firstHalf),moves.push([yDir,tempDist]),moves.push([xDir,xAbs]),tempDist=Math.floor(yAbs*secondHalf),moves.push([yDir,tempDist])):(tempDist=Math.ceil(xAbs*firstHalf),moves.push([xDir,tempDist]),moves.push([yDir,yAbs]),tempDist=Math.floor(xAbs*secondHalf),moves.push([xDir,tempDist])),this.map[xpos][ypos]=0;moves.length>0;)for(move=moves.pop();move[1]>0;)xpos+=_constants_js__WEBPACK_IMPORTED_MODULE_2__.DIRS[8][move[0]][0],ypos+=_constants_js__WEBPACK_IMPORTED_MODULE_2__.DIRS[8][move[0]][1],this.map[xpos][ypos]=0,move[1]=move[1]-1}_createCorridors(){let room,connection,otherRoom,wall,otherWall,cw=this._options.cellWidth,ch=this._options.cellHeight;for(let i=0;i<cw;i++)for(let j=0;j<ch;j++){room=this.rooms[i][j];for(let k=0;k<room.connections.length;k++)connection=room.connections[k],otherRoom=this.rooms[connection[0]][connection[1]],otherRoom.cellx>room.cellx?(wall=2,otherWall=4):otherRoom.cellx<room.cellx?(wall=4,otherWall=2):otherRoom.celly>room.celly?(wall=3,otherWall=1):(wall=1,otherWall=3),this._drawCorridor(this._getWallPosition(room,wall),this._getWallPosition(otherRoom,otherWall))}}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});const __WEBPACK_DEFAULT_EXPORT__={Simplex:__webpack_require__(252).default}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Simplex});var _noise_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(253),_rng_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(214),_util_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(117);const F2=.5*(Math.sqrt(3)-1),G2=(3-Math.sqrt(3))/6;class Simplex extends _noise_js__WEBPACK_IMPORTED_MODULE_0__.default{constructor(gradients=256){super(),this._gradients=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]];let permutations=[];for(let i=0;i<gradients;i++)permutations.push(i);permutations=_rng_js__WEBPACK_IMPORTED_MODULE_1__.default.shuffle(permutations),this._perms=[],this._indexes=[];for(let i=0;i<2*gradients;i++)this._perms.push(permutations[i%gradients]),this._indexes.push(this._perms[i]%this._gradients.length)}get(xin,yin){let gi,i1,j1,perms=this._perms,indexes=this._indexes,count=perms.length/2,n0=0,n1=0,n2=0,s=(xin+yin)*F2,i=Math.floor(xin+s),j=Math.floor(yin+s),t=(i+j)*G2,x0=xin-(i-t),y0=yin-(j-t);x0>y0?(i1=1,j1=0):(i1=0,j1=1);let x1=x0-i1+G2,y1=y0-j1+G2,x2=x0-1+2*G2,y2=y0-1+2*G2,ii=(0,_util_js__WEBPACK_IMPORTED_MODULE_2__.mod)(i,count),jj=(0,_util_js__WEBPACK_IMPORTED_MODULE_2__.mod)(j,count),t0=.5-x0*x0-y0*y0;if(t0>=0){t0*=t0,gi=indexes[ii+perms[jj]];let grad=this._gradients[gi];n0=t0*t0*(grad[0]*x0+grad[1]*y0)}let t1=.5-x1*x1-y1*y1;if(t1>=0){t1*=t1,gi=indexes[ii+i1+perms[jj+j1]];let grad=this._gradients[gi];n1=t1*t1*(grad[0]*x1+grad[1]*y1)}let t2=.5-x2*x2-y2*y2;if(t2>=0){t2*=t2,gi=indexes[ii+1+perms[jj+1]];let grad=this._gradients[gi];n2=t2*t2*(grad[0]*x2+grad[1]*y2)}return 70*(n0+n1+n2)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Noise});class Noise{}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _dijkstra_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(255),_astar_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(257);const __WEBPACK_DEFAULT_EXPORT__={Dijkstra:_dijkstra_js__WEBPACK_IMPORTED_MODULE_0__.default,AStar:_astar_js__WEBPACK_IMPORTED_MODULE_1__.default}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Dijkstra});var _path_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(256);class Dijkstra extends _path_js__WEBPACK_IMPORTED_MODULE_0__.default{constructor(toX,toY,passableCallback,options){super(toX,toY,passableCallback,options),this._computed={},this._todo=[],this._add(toX,toY,null)}compute(fromX,fromY,callback){let key=fromX+","+fromY;if(key in this._computed||this._compute(fromX,fromY),!(key in this._computed))return;let item=this._computed[key];for(;item;)callback(item.x,item.y),item=item.prev}_compute(fromX,fromY){for(;this._todo.length;){let item=this._todo.shift();if(item.x==fromX&&item.y==fromY)return;let neighbors=this._getNeighbors(item.x,item.y);for(let i=0;i<neighbors.length;i++){let neighbor=neighbors[i],x=neighbor[0],y=neighbor[1];x+","+y in this._computed||this._add(x,y,item)}}}_add(x,y,prev){let obj={x,y,prev};this._computed[x+","+y]=obj,this._todo.push(obj)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Path});var _constants_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(225);class Path{constructor(toX,toY,passableCallback,options={}){this._toX=toX,this._toY=toY,this._passableCallback=passableCallback,this._options=Object.assign({topology:8},options),this._dirs=_constants_js__WEBPACK_IMPORTED_MODULE_0__.DIRS[this._options.topology],8==this._options.topology&&(this._dirs=[this._dirs[0],this._dirs[2],this._dirs[4],this._dirs[6],this._dirs[1],this._dirs[3],this._dirs[5],this._dirs[7]])}_getNeighbors(cx,cy){let result=[];for(let i=0;i<this._dirs.length;i++){let dir=this._dirs[i],x=cx+dir[0],y=cy+dir[1];this._passableCallback(x,y)&&result.push([x,y])}return result}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>AStar});var _path_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(256);class AStar extends _path_js__WEBPACK_IMPORTED_MODULE_0__.default{constructor(toX,toY,passableCallback,options={}){super(toX,toY,passableCallback,options),this._todo=[],this._done={}}compute(fromX,fromY,callback){for(this._todo=[],this._done={},this._fromX=fromX,this._fromY=fromY,this._add(this._toX,this._toY,null);this._todo.length;){let item=this._todo.shift(),id=item.x+","+item.y;if(id in this._done)continue;if(this._done[id]=item,item.x==fromX&&item.y==fromY)break;let neighbors=this._getNeighbors(item.x,item.y);for(let i=0;i<neighbors.length;i++){let neighbor=neighbors[i],x=neighbor[0],y=neighbor[1];x+","+y in this._done||this._add(x,y,item)}}let item=this._done[fromX+","+fromY];if(item)for(;item;)callback(item.x,item.y),item=item.prev}_add(x,y,prev){let h=this._distance(x,y),obj={x,y,prev,g:prev?prev.g+1:0,h},f=obj.g+obj.h;for(let i=0;i<this._todo.length;i++){let item=this._todo[i],itemF=item.g+item.h;if(f<itemF||f==itemF&&h<item.h)return void this._todo.splice(i,0,obj)}this._todo.push(obj)}_distance(x,y){switch(this._options.topology){case 4:return Math.abs(x-this._fromX)+Math.abs(y-this._fromY);case 6:let dx=Math.abs(x-this._fromX),dy=Math.abs(y-this._fromY);return dy+Math.max(0,(dx-dy)/2);case 8:return Math.max(Math.abs(x-this._fromX),Math.abs(y-this._fromY))}}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Engine});class Engine{constructor(scheduler){this._scheduler=scheduler,this._lock=1}start(){return this.unlock()}lock(){return this._lock++,this}unlock(){if(!this._lock)throw new Error("Cannot unlock unlocked engine");for(this._lock--;!this._lock;){let actor=this._scheduler.next();if(!actor)return this.lock();let result=actor.act();result&&result.then&&(this.lock(),result.then(this.unlock.bind(this)))}return this}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Lighting});var _color_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(222);class Lighting{constructor(reflectivityCallback,options={}){this._reflectivityCallback=reflectivityCallback,this._options={},options=Object.assign({passes:1,emissionThreshold:100,range:10},options),this._lights={},this._reflectivityCache={},this._fovCache={},this.setOptions(options)}setOptions(options){return Object.assign(this._options,options),options&&options.range&&this.reset(),this}setFOV(fov){return this._fov=fov,this._fovCache={},this}setLight(x,y,color){let key=x+","+y;return color?this._lights[key]="string"==typeof color?_color_js__WEBPACK_IMPORTED_MODULE_0__.fromString(color):color:delete this._lights[key],this}clearLights(){this._lights={}}reset(){return this._reflectivityCache={},this._fovCache={},this}compute(lightingCallback){let doneCells={},emittingCells={},litCells={};for(let key in this._lights){let light=this._lights[key];emittingCells[key]=[0,0,0],_color_js__WEBPACK_IMPORTED_MODULE_0__.add_(emittingCells[key],light)}for(let i=0;i<this._options.passes;i++)this._emitLight(emittingCells,litCells,doneCells),i+1!=this._options.passes&&(emittingCells=this._computeEmitters(litCells,doneCells));for(let litKey in litCells){let parts=litKey.split(",");lightingCallback(parseInt(parts[0]),parseInt(parts[1]),litCells[litKey])}return this}_emitLight(emittingCells,litCells,doneCells){for(let key in emittingCells){let parts=key.split(","),x=parseInt(parts[0]),y=parseInt(parts[1]);this._emitLightFromCell(x,y,emittingCells[key],litCells),doneCells[key]=1}return this}_computeEmitters(litCells,doneCells){let result={};for(let key in litCells){if(key in doneCells)continue;let reflectivity,color=litCells[key];if(key in this._reflectivityCache)reflectivity=this._reflectivityCache[key];else{let parts=key.split(","),x=parseInt(parts[0]),y=parseInt(parts[1]);reflectivity=this._reflectivityCallback(x,y),this._reflectivityCache[key]=reflectivity}if(0==reflectivity)continue;let emission=[0,0,0],intensity=0;for(let i=0;i<3;i++){let part=Math.round(color[i]*reflectivity);emission[i]=part,intensity+=part}intensity>this._options.emissionThreshold&&(result[key]=emission)}return result}_emitLightFromCell(x,y,color,litCells){let fov,key=x+","+y;fov=key in this._fovCache?this._fovCache[key]:this._updateFOV(x,y);for(let fovKey in fov){let result,formFactor=fov[fovKey];fovKey in litCells?result=litCells[fovKey]:(result=[0,0,0],litCells[fovKey]=result);for(let i=0;i<3;i++)result[i]+=Math.round(color[i]*formFactor)}return this}_updateFOV(x,y){let key1=x+","+y,cache={};this._fovCache[key1]=cache;let range=this._options.range;return this._fov.compute(x,y,range,function(x,y,r,vis){let formFactor=vis*(1-r/range);0!=formFactor&&(cache[x+","+y]=formFactor)}.bind(this)),cache}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>DeathSystem});var _core_screens_ScreenType__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(53),_ecs_components__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(21),_System__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(138);var _query=new WeakMap;class DeathSystem extends _System__WEBPACK_IMPORTED_MODULE_2__.default{constructor(game){super(game),_query.set(this,{writable:!0,value:null}),function(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}}(this,_query,game.ecs.createQuery({all:[_ecs_components__WEBPACK_IMPORTED_MODULE_1__.IsDead],none:[_ecs_components__WEBPACK_IMPORTED_MODULE_1__.IsDestroying]}))}update(dt){(function(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value})(this,_query).get().forEach((entity=>{entity.fireEvent("death"),entity.isPlayer?this.game.screens.setScreen(_core_screens_ScreenType__WEBPACK_IMPORTED_MODULE_0__.SCREEN_DEATH):entity.add(_ecs_components__WEBPACK_IMPORTED_MODULE_1__.IsDestroying)}))}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>ParticleSystem});__webpack_require__(3);var _ecs_components__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(21),_System__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(138);function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}function _classPrivateFieldSet(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}return value}var _particleQuery=new WeakMap,_emitterQuery=new WeakMap;class ParticleSystem extends _System__WEBPACK_IMPORTED_MODULE_2__.default{constructor(game){super(game),_particleQuery.set(this,{writable:!0,value:null}),_emitterQuery.set(this,{writable:!0,value:null}),_classPrivateFieldSet(this,_emitterQuery,game.ecs.createQuery({all:[_ecs_components__WEBPACK_IMPORTED_MODULE_1__.ParticleEmitter]})),_classPrivateFieldSet(this,_particleQuery,game.ecs.createQuery({all:[_ecs_components__WEBPACK_IMPORTED_MODULE_1__.Particle]}))}createParticle(x,y,properties={}){this.game.ecs.createEntity().add(_ecs_components__WEBPACK_IMPORTED_MODULE_1__.Particle,{...properties,x,y})}createEmitter(x,y,particleData={}){this.game.ecs.createEntity().add(_ecs_components__WEBPACK_IMPORTED_MODULE_1__.ParticleEmitter,{x,y,particleData:{direction:{x:0,y:1},glyphs:["░","▒","▓","█"],fg1s:["cyan","blue"],speed:.04,lifetime:600,...particleData}})}update(dt){_classPrivateFieldGet(this,_emitterQuery).get().forEach((entity=>{const emitter=entity.particleEmitter;if(emitter.age+=dt,emitter.isExpired)entity.destroy();else{const total=emitter.rate/1e3*emitter.duration,targetCount=Math.trunc(emitter.percent*total);for(let i=emitter.count;i<targetCount;i++)emitter.createParticle()}})),_classPrivateFieldGet(this,_particleQuery).get().forEach((entity=>{const particle=entity.particle;if(particle.age+=dt,particle.isExpired)return void entity.destroy();if(particle.x+=particle.direction.x*particle.speed,particle.y+=particle.direction.y*particle.speed,!this.game.camera.isInView(particle.x,particle.y))return;const screen=this.game.camera.worldToScreen(particle.x,particle.y);this.game.renderer.draw(Math.round(screen.x),Math.round(screen.y),particle.glyph,particle.fg1,particle.fg2,particle.bg)}))}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>FactionManager});var _ecs_components__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(21),_enums_Factions__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(89),_Manager__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(5);class FactionManager extends _Manager__WEBPACK_IMPORTED_MODULE_2__.default{get factions(){return Object.values(_enums_Factions__WEBPACK_IMPORTED_MODULE_1__.factions)}constructor(game){var obj,key,value;super(game),value={},(key="relations")in(obj=this)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,this.setRelation(_enums_Factions__WEBPACK_IMPORTED_MODULE_1__.FACTION_PLAYER,_enums_Factions__WEBPACK_IMPORTED_MODULE_1__.FACTION_GOBLIN,-300),this.setRelation(_enums_Factions__WEBPACK_IMPORTED_MODULE_1__.FACTION_PLAYER,_enums_Factions__WEBPACK_IMPORTED_MODULE_1__.FACTION_VILLAGER,300),this.setRelation(_enums_Factions__WEBPACK_IMPORTED_MODULE_1__.FACTION_GOBLIN,_enums_Factions__WEBPACK_IMPORTED_MODULE_1__.FACTION_VILLAGER,-400)}getFactionById(id){return this.factions.find((f=>f.id===id))}getFactionByName(name){return(0,_enums_Factions__WEBPACK_IMPORTED_MODULE_1__.getFactionByName)(name)}isHostile(factionA,factionB){return factionA!==factionB}_relationKey(idA,idB){return[idA,idB].sort().join("-")}setRelation(idA,idB,value){const key=this._relationKey(idA,idB);this.relations[key]=value}getRelation(idA,idB){const key=this._relationKey(idA,idB);return this.relations.hasOwnProperty(key)||(this.relations[key]=0),this.relations[key]}getEntityRelation(entityA,entityB){const memberA=entityA.get(_ecs_components__WEBPACK_IMPORTED_MODULE_0__.FactionMember),memberB=entityB.get(_ecs_components__WEBPACK_IMPORTED_MODULE_0__.FactionMember);if(memberA&&memberB){const factionA=memberA.faction,factionB=memberB.faction;return this.getRelation(factionA.id,factionB.id)}return 0}areEntitiesHostile(entityA,entityB){return this.getEntityRelation(entityA,entityB)<-200}getDisplay(value){return value<=-300?"Aggressive":value<=-200?"Unfriendly":value>=300?"Loyal":value>=200?"Friendly":value>=100?"Amicable":"Neutral"}getAttitudeGlyph(value){return value<=-200?{char:"☻",fg1:"#ca4444",fg2:"#411010"}:value>=200?{char:"☺",fg1:"#78b478",fg2:"#1a251a"}:{char:"♥",fg1:"#b9bcc2",fg2:"#222832"}}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>CameraManager});var _Manager__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class CameraManager extends _Manager__WEBPACK_IMPORTED_MODULE_0__.default{constructor(game){super(game),_defineProperty(this,"width",32),_defineProperty(this,"height",24),_defineProperty(this,"zoom",2),_defineProperty(this,"padding",5),_defineProperty(this,"clampX",16),_defineProperty(this,"clampY",12),_defineProperty(this,"_focusX",0),_defineProperty(this,"_focusY",0),window.addEventListener("resize",this.onWindowResize.bind(this)),this.onWindowResize()}get renderedTileWidth(){return this.zoom*this.game.renderer.tileWidth}get renderedTileHeight(){return this.zoom*this.game.renderer.tileHeight}computeSize(){this.width=Math.max(this.clampX,Math.floor(window.innerWidth/this.renderedTileWidth)),this.height=Math.max(this.clampY,Math.floor(window.innerHeight/this.renderedTileHeight)),this.topLeftWorldX=Math.floor(Math.min(Math.max(-this.padding,this._focusX-this.width/2),Math.max((this.width-this.game.map.width)/-2,this.padding+this.game.map.width-this.width))),this.topLeftWorldY=Math.floor(Math.min(Math.max(-this.padding,this._focusY-this.height/2),Math.max((this.height-this.game.map.height)/-2,this.padding+this.game.map.height-this.height)))}onWindowResize(){this.computeSize(),this.game.renderer.resizeDisplay(this.width,this.height,this.zoom)}setZoom(zoom){this.zoom=zoom,this.computeSize(),this.onWindowResize()}setFocus(x,y){this._focusX=x,this._focusY=y,this.computeSize()}setPadding(value){this.padding=value,this.computeSize()}worldToScreen(x,y){return{x:x-this.topLeftWorldX,y:y-this.topLeftWorldY}}screenToWorld(x,y){return{x:x+this.topLeftWorldX,y:y+this.topLeftWorldY}}getScreenRect(){return{x:this.topLeftWorldX,y:this.topLeftWorldY,width:this.width,height:this.height}}isInView(worldX,worldY){const screen=this.worldToScreen(worldX,worldY);return screen.x<this.width&&screen.y<this.height&&screen.x>=0&&screen.y>=0}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>FPSMonitoringSystem});var _System__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(138);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const fpsElement=document.getElementsByClassName("fps")[0];class FPSMonitoringSystem extends _System__WEBPACK_IMPORTED_MODULE_0__.default{constructor(game){super(game),_defineProperty(this,"frames",[]),_defineProperty(this,"frameCount",60),this.frames=[];for(let i=0;i<this.frameCount;i++)this.frames[i]=0}update(dt){this.frames.push(1e3/dt),this.frames.shift();const sum=this.frames.reduce(((s,v)=>s+v),0),fps=Math.trunc(sum/this.frameCount);fpsElement.innerText=fps}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{WorldManager:()=>WorldManager});var _data_WorldData__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(266),_ecs_components__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(21),_Manager__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(5),_screens_ScreenType__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(53);function _classPrivateFieldSet(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}return value}function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}var _data=new WeakMap,_sectorId=new WeakMap,_entry=new WeakMap;class WorldManager extends _Manager__WEBPACK_IMPORTED_MODULE_2__.default{get sectorId(){return _classPrivateFieldGet(this,_sectorId)}get sector(){return _classPrivateFieldGet(this,_data).getSector(_classPrivateFieldGet(this,_sectorId))}get entry(){return _classPrivateFieldGet(this,_entry)}constructor(game){super(game),_data.set(this,{writable:!0,value:void 0}),_sectorId.set(this,{writable:!0,value:void 0}),_entry.set(this,{writable:!0,value:void 0}),_classPrivateFieldSet(this,_data,new _data_WorldData__WEBPACK_IMPORTED_MODULE_0__.default)}getSetupData(){return{sectorId:_classPrivateFieldGet(this,_data).getStartingSector().id,exploredSectorIds:[]}}getSaveGameData(){const data=Array.from(this.game.ecs.entities.all).filter((e=>!e.has(_ecs_components__WEBPACK_IMPORTED_MODULE_1__.IsPlayer))),serialized=this.game.ecs.serialize(data);return console.log("serialized map data",serialized),this.game.state.saveSectorEntityData(this.sector.id,serialized),{sectorId:this.sector.id,exploredSectorIds:[]}}setup(data){const sector=_classPrivateFieldGet(this,_data).getSector(data.sectorId);this.game.screens.setScreen(_screens_ScreenType__WEBPACK_IMPORTED_MODULE_3__.SCREEN_LOAD_SECTOR,{nextSector:sector,entry:data.position})}teardown(){_classPrivateFieldSet(this,_sectorId,null)}onSectorLoaded(sector,entry){_classPrivateFieldSet(this,_sectorId,sector.id);const data=this.game.state.loadSectorEntityData(sector.id);data?this.game.ecs.deserialize(data):sector.generate(this.game)}enterSector(sector,entry){this.game.screens.setScreen(_screens_ScreenType__WEBPACK_IMPORTED_MODULE_3__.SCREEN_LOAD_SECTOR,{prevousSector:this.sector,nextSector:sector,entry})}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>WorldData});var _Sector__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(267),_world_json__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(290);function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}var _sectors=new WeakMap;class WorldData{get width(){return _world_json__WEBPACK_IMPORTED_MODULE_1__.width}get height(){return _world_json__WEBPACK_IMPORTED_MODULE_1__.height}idx(x,y){return y*this.width+x}coord(idx){return{x:Math.trunc(idx%this.width),y:Math.trunc(idx/this.width)}}constructor(){_sectors.set(this,{writable:!0,value:[]}),function(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}}(this,_sectors,[]);for(let x=0;x<_world_json__WEBPACK_IMPORTED_MODULE_1__.width;x++)for(let y=0;y<_world_json__WEBPACK_IMPORTED_MODULE_1__.height;y++){const sector=_Sector__WEBPACK_IMPORTED_MODULE_0__.Sector.parseData(this,_world_json__WEBPACK_IMPORTED_MODULE_1__.sectors[y][x],x,y);_classPrivateFieldGet(this,_sectors)[sector.id]=sector}}isOutOfBounds(x,y){return x<0||y<0||x>=this.width||y>=this.height}getStartingSector(){return this.getSector(4)}getSectorByCoord(x,y){return this.getSector(this.idx(x,y))}getSector(idx){const{x,y}=this.coord(idx);return this.isOutOfBounds(x,y)?new _Sector__WEBPACK_IMPORTED_MODULE_0__.Sector(this,x,y):_classPrivateFieldGet(this,_sectors)[idx]}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Sector:()=>Sector});var _core_Game__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_level_generators_generators__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(268);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _classPrivateFieldSet(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}return value}function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}var _x=new WeakMap,_y=new WeakMap;class Sector{get x(){return _classPrivateFieldGet(this,_x)}get y(){return _classPrivateFieldGet(this,_y)}get id(){return this.world.idx(this.x,this.y)}get northSector(){return this.world.getSectorByCoord(_classPrivateFieldGet(this,_x),_classPrivateFieldGet(this,_y)-1)}get southSector(){return this.world.getSectorByCoord(_classPrivateFieldGet(this,_x),_classPrivateFieldGet(this,_y)+1)}get eastSector(){return this.world.getSectorByCoord(_classPrivateFieldGet(this,_x)+1,_classPrivateFieldGet(this,_y))}get westSector(){return this.world.getSectorByCoord(_classPrivateFieldGet(this,_x)-1,_classPrivateFieldGet(this,_y))}constructor(world,x,y){_x.set(this,{writable:!0,value:0}),_y.set(this,{writable:!0,value:0}),_defineProperty(this,"connectionsNorth",[]),_defineProperty(this,"connectionsWest",[]),_defineProperty(this,"generator",{}),_defineProperty(this,"music",null),this.world=world,_classPrivateFieldSet(this,_x,x),_classPrivateFieldSet(this,_y,y)}getExits(){const exits=[];return exits.push(...this.connectionsNorth.map((c=>({x:12,y:0})))),exits.push(...this.connectionsWest.map((c=>({x:0,y:12})))),exits.push(...this.eastSector.connectionsWest.map((c=>({x:_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.map.width-1,y:12})))),exits.push(...this.southSector.connectionsNorth.map((c=>({x:12,y:_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.map.height-1})))),exits}generate(game){const exits=this.getExits(),generator=(0,_level_generators_generators__WEBPACK_IMPORTED_MODULE_1__.getGenerator)(this.generator.type),settings={width:game.map.width,height:game.map.height,exits},tiles=generator.generate(settings);generator.populate(settings,tiles),this.tiles=tiles}static parseData(world,data,x,y){const sector=new Sector(world,x,y);return sector.connectionsNorth=data.connectionsNorth,sector.connectionsWest=data.connectionsWest,sector.generator=data.generator,sector.music=data.music,sector.temperature=data.temperature,sector}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{getGenerator:()=>getGenerator});var _ForestCabinsGenerator__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(269),_ForestGenerator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(284),_ForestStrongholdGenerator__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(285),_ForestTownGenerator__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(287);const mapping={FOREST:_ForestGenerator__WEBPACK_IMPORTED_MODULE_1__.ForestGenerator,FOREST_STRONGHOLD:_ForestStrongholdGenerator__WEBPACK_IMPORTED_MODULE_2__.ForestStrongholdGenerator,FOREST_CABINS:_ForestCabinsGenerator__WEBPACK_IMPORTED_MODULE_0__.ForestCabinsGenerator,FOREST_TOWN:_ForestTownGenerator__WEBPACK_IMPORTED_MODULE_3__.ForestTownGenerator},getGenerator=name=>mapping[name]},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ForestCabinsGenerator:()=>ForestCabinsGenerator});var _utils_rand__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(45),_LevelConnections__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(270),_schemes_UniformScheme__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(277),_themes_TileTheme__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(272),_SectorGenerator__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(283);class ForestCabinsGenerator extends _SectorGenerator__WEBPACK_IMPORTED_MODULE_4__.default{static generate(settings){const tiles=_schemes_UniformScheme__WEBPACK_IMPORTED_MODULE_2__.UniformScheme.generate({width:settings.width,height:settings.height});tiles.rooms.forEach((room=>room.theme=_themes_TileTheme__WEBPACK_IMPORTED_MODULE_3__.TILE_THEME_FOREST));const mediumRooms=tiles.rooms.filter((r=>r.width>=3&&r.height>=3)),room=(0,_utils_rand__WEBPACK_IMPORTED_MODULE_0__.pickRandom)(mediumRooms);room&&(room.theme=_themes_TileTheme__WEBPACK_IMPORTED_MODULE_3__.TILE_THEME_CABIN,room.includeWalls=!0);const distancedRooms=mediumRooms.filter((r=>r!==room)),room2=(0,_utils_rand__WEBPACK_IMPORTED_MODULE_0__.pickRandom)(distancedRooms);room2&&(room2.theme=_themes_TileTheme__WEBPACK_IMPORTED_MODULE_3__.TILE_THEME_CABIN,room2.includeWalls=!0);return tiles.getUnassignedTiles().forEach((tile=>{tile.theme=_themes_TileTheme__WEBPACK_IMPORTED_MODULE_3__.TILE_THEME_FOREST})),(0,_LevelConnections__WEBPACK_IMPORTED_MODULE_1__.digExits)(tiles,settings.exits),tiles}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{digExit:()=>digExit,digExits:()=>digExits});var _utils_AStar__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(38),_utils_ManhattanDistance__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(40),_TileData__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(271);const digExit=(tiles,exit)=>{const source=((tiles,target)=>{let closest=null,closestDistance=null;return tiles.data.forEach((tile=>{if(!tile.isType(_TileData__WEBPACK_IMPORTED_MODULE_2__.TILE_TYPE_FLOOR))return;const distance=(0,_utils_ManhattanDistance__WEBPACK_IMPORTED_MODULE_1__.manhattanDistance)(tile,target);return distance<closestDistance||null===closest?(closest=tile,void(closestDistance=distance)):void 0})),closest})(tiles,exit);if(source.x===exit.x&&source.y===exit.y)return void tiles.setTileType(exit.x,exit.y,_TileData__WEBPACK_IMPORTED_MODULE_2__.TILE_TYPE_FLOOR);tiles.setTileType(source.x,source.y,_TileData__WEBPACK_IMPORTED_MODULE_2__.TILE_TYPE_WALL),tiles.setTileType(exit.x,exit.y,_TileData__WEBPACK_IMPORTED_MODULE_2__.TILE_TYPE_WALL);const result=(0,_utils_AStar__WEBPACK_IMPORTED_MODULE_0__.computeAStar)({goal:{x:source.x,y:source.y},start:{x:exit.x,y:exit.y},allowDiagonals:!1,cost:(a,b)=>tiles.isOnEdge(b.x,b.y)?1/0:tiles.tileTypeMatches(b.x,b.y,_TileData__WEBPACK_IMPORTED_MODULE_2__.TILE_TYPE_WALL)?(0,_utils_ManhattanDistance__WEBPACK_IMPORTED_MODULE_1__.manhattanDistance)(a,b):1/0});if(result.path.forEach((segment=>{tiles.setTileType(segment.x,segment.y,_TileData__WEBPACK_IMPORTED_MODULE_2__.TILE_TYPE_FLOOR)})),result.success){const door=result.path[result.path.length-2],room=tiles.getRoomForTile(door.x,door.y);room&&room.addExit(door.x,door.y)}},digExits=(tiles,exits)=>{exits.forEach((exit=>digExit(tiles,exit)))}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{TILE_TYPE_FLOOR:()=>TILE_TYPE_FLOOR,TILE_TYPE_WALL:()=>TILE_TYPE_WALL,TILE_TYPE_OUT_OF_BOUNDS:()=>TILE_TYPE_OUT_OF_BOUNDS,TileData:()=>TileData,createTileData:()=>createTileData});var _themes_TileTheme__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(272);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const TILE_TYPE_FLOOR=0,TILE_TYPE_WALL=1,TILE_TYPE_OUT_OF_BOUNDS=1;class TileData{constructor(x,y){_defineProperty(this,"x",-1),_defineProperty(this,"y",-1),_defineProperty(this,"type",TILE_TYPE_OUT_OF_BOUNDS),_defineProperty(this,"theme",_themes_TileTheme__WEBPACK_IMPORTED_MODULE_0__.TILE_THEME_CASTLE),this.x=x,this.y=y}isType(type){return this.type===type}}const createTileData=(x,y)=>new TileData(x,y)},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{TILE_THEME_FOREST:()=>TILE_THEME_FOREST,TILE_THEME_CASTLE:()=>TILE_THEME_CASTLE,TILE_THEME_CABIN:()=>TILE_THEME_CABIN,getThemePopulator:()=>getThemePopulator});var _CastleTheme__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(273),_ForestTheme__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(275),_CabinTheme__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(276);const TILE_THEME_FOREST=0,TILE_THEME_CASTLE=1,TILE_THEME_CABIN=2,mapping={[TILE_THEME_FOREST]:_ForestTheme__WEBPACK_IMPORTED_MODULE_1__.default,[TILE_THEME_CASTLE]:_CastleTheme__WEBPACK_IMPORTED_MODULE_0__.default,[TILE_THEME_CABIN]:_CabinTheme__WEBPACK_IMPORTED_MODULE_2__.default},getThemePopulator=theme=>mapping[theme]},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>CastleTheme});var _data_Spawnables__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(26),_data_Spawner__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(27),_utils_rand__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(45),_TileData__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(271),_TileThemePopulator__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(274);class CastleTheme extends _TileThemePopulator__WEBPACK_IMPORTED_MODULE_4__.default{static populateTile(tile){(0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_GROUND_STONE,tile.x,tile.y),0===this.getEntities(tile).length&&tile.isType(_TileData__WEBPACK_IMPORTED_MODULE_3__.TILE_TYPE_WALL)&&(0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_STONE_WALL,tile.x,tile.y)}static populateRoom(room){room.exits.forEach((exit=>{0===this.getEntities(exit).length&&(0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_WOOD_DOOR,exit.x,exit.y)})),room.tiles.forEach((tile=>this.populateTile(tile)));for(let i=0;i<(0,_utils_rand__WEBPACK_IMPORTED_MODULE_2__.randomInt)(0,3);i++)this.trySpawn(room,(tile=>{(0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_STONE,tile.x,tile.y)}))}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>TileThemePopulator});var _core_Game__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_utils_rand__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(45);class TileThemePopulator{static populateTile(tile){}static populateRoom(room){room.tiles.forEach((tile=>{this.populateTile(tile)}))}static populate(tiles){tiles.data.forEach((tile=>{this.populateTile(tile)}))}static getEntities(tile){return _core_Game__WEBPACK_IMPORTED_MODULE_0__.game.map.getEntitiesAt(tile.x,tile.y).filter((e=>!e.ground))}static clearTile(tile){getEntities(tile).forEach((e=>{e.destroy()}))}static getRandomEmptyTile(tileArr,attempts=100){for(let i=0;i<attempts;i++){const tile=(0,_utils_rand__WEBPACK_IMPORTED_MODULE_1__.pickRandom)(tileArr);if(this.getEntities(tile)<=0)return tile}console.warn("ran out of attempts (".concat(attempts,") to place item"),tileArr)}static trySpawn(room,cb){const tile=this.getRandomEmptyTile(room.interiorTiles);tile&&cb(tile)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>ForestTheme});var _data_Spawnables__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(26),_data_Spawner__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(27),_utils_rand__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(45),_TileData__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(271),_TileThemePopulator__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(274);class ForestTheme extends _TileThemePopulator__WEBPACK_IMPORTED_MODULE_4__.default{static populateTile(tile){(0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_GROUND_GRASS,tile.x,tile.y),tile.isType(_TileData__WEBPACK_IMPORTED_MODULE_3__.TILE_TYPE_WALL)&&(0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_PINE_TREE,tile.x,tile.y)}static populateRoom(room){room.tiles.forEach((tile=>{this.populateTile(tile),Math.random()>.1||(tile.isType(_TileData__WEBPACK_IMPORTED_MODULE_3__.TILE_TYPE_FLOOR)&&Math.random()<.5?(0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_TWIG,tile.x,tile.y):(0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_STONE,tile.x,tile.y))}));for(let i=0;i<(0,_utils_rand__WEBPACK_IMPORTED_MODULE_2__.randomInt)(0,1);i++)this.trySpawn(room,(tile=>{(0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_GOBLIN_GRUNT,tile.x,tile.y)}));for(let i=0;i<(0,_utils_rand__WEBPACK_IMPORTED_MODULE_2__.randomInt)(0,1);i++){if(Math.random()>.05)return;this.trySpawn(room,(tile=>{(0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_VIAL_BLOOD,tile.x,tile.y)}))}for(let i=0;i<(0,_utils_rand__WEBPACK_IMPORTED_MODULE_2__.randomInt)(0,1);i++){if(Math.random()>.05)return;this.trySpawn(room,(tile=>{(0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_VIAL_WATER,tile.x,tile.y)}))}for(let i=0;i<(0,_utils_rand__WEBPACK_IMPORTED_MODULE_2__.randomInt)(0,1);i++){if(Math.random()>.05)return;this.trySpawn(room,(tile=>{(0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_VIAL_HONEY,tile.x,tile.y)}))}}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>CabinTheme});var _data_Spawnables__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(26),_data_Spawner__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(27),_utils_rand__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(45),_TileData__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(271),_TileThemePopulator__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(274);class CabinTheme extends _TileThemePopulator__WEBPACK_IMPORTED_MODULE_4__.default{static populateTile(tile){(0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_GROUND_STONE,tile.x,tile.y),0===this.getEntities(tile).length&&tile.isType(_TileData__WEBPACK_IMPORTED_MODULE_3__.TILE_TYPE_WALL)&&(0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_WOOD_WALL,tile.x,tile.y)}static populateRoom(room){room.tiles.forEach((tile=>this.populateTile(tile))),room.exits.forEach((exit=>{0===this.getEntities(exit).length&&(0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_WOOD_DOOR,exit.x,exit.y)})),this.trySpawn(room,(tile=>{const chest=(0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_WOOD_CHEST,tile.x,tile.y);chest.inventory.addLoot((0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_TWIG)),chest.inventory.addLoot((0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_VIAL_HONEY)),chest.inventory.addLoot((0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_STONE)),chest.inventory.addLoot((0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_AMULET)),chest.inventory.addLoot((0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_CLOTH_ARMOR)),chest.inventory.addLoot((0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_LEATHER_BOOTS)),chest.inventory.addLoot((0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_SHORTSWORD)),chest.inventory.addLoot((0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_GREATSWORD)),chest.inventory.addLoot((0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_BATTLE_AXE)),chest.inventory.addLoot((0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_HATCHET)),chest.inventory.addLoot((0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_MACE)),chest.inventory.addLoot((0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_HEAVY_PLATE_ARMOR)),chest.inventory.addLoot((0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_LEATHER_ARMOR)),chest.inventory.addLoot((0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_CLOTH_HOOD)),chest.inventory.addLoot((0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_WIZARD_CAP)),chest.inventory.addLoot((0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_HELM))}));for(let i=0;i<(0,_utils_rand__WEBPACK_IMPORTED_MODULE_2__.randomInt)(1,3);i++)this.trySpawn(room,(tile=>{(0,_data_Spawner__WEBPACK_IMPORTED_MODULE_1__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_0__.SPWN_HUMAN_WANDERER,tile.x,tile.y)}))}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{UniformScheme:()=>UniformScheme});var rot_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(213),_LevelConnections__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(270),_TileContainer__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(278),_TileData__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(271),_TileScheme__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(282);class UniformScheme extends _TileScheme__WEBPACK_IMPORTED_MODULE_4__.default{static generate(settings){const width=settings.width,height=settings.height,exits=settings.exits||[],tiles=new _TileContainer__WEBPACK_IMPORTED_MODULE_2__.default(width,height),generator=new rot_js__WEBPACK_IMPORTED_MODULE_0__.Map.Uniform(width,height,{timeLimit:8e3,roomWidth:settings.roomWidth||[2,8],roomHeight:settings.roomHeight||[2,8],roomDugPercentage:settings.digPercentage||.8});return generator.create(((x,y,v)=>{0===v&&tiles.setTileType(x,y,_TileData__WEBPACK_IMPORTED_MODULE_3__.TILE_TYPE_FLOOR),1===v&&tiles.setTileType(x,y,_TileData__WEBPACK_IMPORTED_MODULE_3__.TILE_TYPE_WALL)})),generator.getRooms().forEach((r=>{const room=tiles.createRoom(r.getLeft(),r.getTop(),r.getRight()-r.getLeft()+1,r.getBottom()-r.getTop()+1);r.getDoors(((x,y)=>{room.addExit(x,y)}))})),(0,_LevelConnections__WEBPACK_IMPORTED_MODULE_1__.digExits)(tiles,exits),tiles}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>TileContainer});var _utils_Grid__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7),_RoomData__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(279),_TileData__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(271);function _classPrivateFieldSet(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}return value}function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}var _defaultType=new WeakMap,_grid=new WeakMap,_rooms=new WeakMap;class TileContainer{get width(){return _classPrivateFieldGet(this,_grid).width}get height(){return _classPrivateFieldGet(this,_grid).height}get size(){return this.width*this.height}get data(){return _classPrivateFieldGet(this,_grid).data}get rooms(){return Object.values(_classPrivateFieldGet(this,_rooms))}constructor(width,height,defaultType=_TileData__WEBPACK_IMPORTED_MODULE_2__.TILE_TYPE_FLOOR){_defaultType.set(this,{writable:!0,value:_TileData__WEBPACK_IMPORTED_MODULE_2__.TILE_TYPE_FLOOR}),_grid.set(this,{writable:!0,value:[]}),_rooms.set(this,{writable:!0,value:{}}),_classPrivateFieldSet(this,_grid,new _utils_Grid__WEBPACK_IMPORTED_MODULE_0__.default(width,height,_TileData__WEBPACK_IMPORTED_MODULE_2__.createTileData)),_classPrivateFieldSet(this,_defaultType,defaultType),this.clear()}getTile(x,y){return _classPrivateFieldGet(this,_grid).get(x,y)}setTileType(x,y,type){_classPrivateFieldGet(this,_grid).get(x,y).type=type}setTileTheme(x,y,theme){_classPrivateFieldGet(this,_grid).get(x,y).theme=theme}getTileType(x,y){return this.getTile(x,y).type}addRoom(room){_classPrivateFieldGet(this,_rooms)[room.id]=room}createRoom(x,y,width,height){const room=new _RoomData__WEBPACK_IMPORTED_MODULE_1__.default(x,y,width,height,this);return this.addRoom(room),room}clear(){this.fill(0,0,this.width,this.height,_classPrivateFieldGet(this,_defaultType))}fill(x,y,width,height,type){for(let i=x;i<x+width;i++)for(let j=y;j<y+height;j++)this.setTileType(i,j,type)}tileTypeMatches(x,y,type){return this.getTile(x,y).isType(type)}combineOther(offsetX,offsetY,tiles){tiles.rooms.forEach((room=>{room.cloneTo(room.x+offsetX,room.y+offsetY,this)})),tiles.data.forEach((tile=>{this.setTileType(tile.x+offsetX,tile.y+offsetY,tile.type),this.setTileTheme(tile.x+offsetX,tile.y+offsetY,tile.theme)}))}isOnEdge(x,y){return 0===x||0===y||x===this.width-1||y===this.height-1}setTheme(theme){this.data.forEach((tile=>this.setTileTheme(tile.x,tile.y,theme))),this.rooms.forEach((room=>room.theme=theme))}getRoomForTile(x,y){const tile=this.getTile(x,y);return this.rooms.find((room=>room.tiles.includes(tile)))}getUnassignedTiles(){return this.data.filter((tile=>!this.getRoomForTile(tile.x,tile.y)))}getNeighbors(x,y){return _classPrivateFieldGet(this,_grid).getNeighbors(x,y)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>RoomData});var nanoid__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(280),_themes_TileTheme__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(272),_TileData__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(271);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}var _container=new WeakMap,_exitCoords=new WeakMap;class RoomData{get relativeExits(){return _classPrivateFieldGet(this,_exitCoords)}get exits(){return this.relativeExits.map((exit=>({x:exit.x+this.x,y:exit.y+this.y})))}get left(){return this.includeWalls?this.x-1:this.x}get right(){return this.includeWalls?this.x+this.width+1:this.x+this.width}get top(){return this.includeWalls?this.y-1:this.y}get bottom(){return this.includeWalls?this.y+this.height+1:this.y+this.height}get borderTiles(){const start=this.includeWalls?-1:0,endWidth=this.includeWalls?this.width+1:this.width,endHeight=this.includeWalls?this.height+1:this.height,borders=[];for(let i=start;i<endWidth;i++)for(let j=start;j<endHeight;j++)i!==start&&i!==endWidth-1&&j!==start&&j!==endHeight-1||borders.push(_classPrivateFieldGet(this,_container).getTile(i+this.x,j+this.y));return borders}get interiorTiles(){const interior=[];for(let i=0;i<this.width;i++)for(let j=0;j<this.height;j++)interior.push(_classPrivateFieldGet(this,_container).getTile(i+this.x,j+this.y));return interior}get tiles(){const start=this.includeWalls?-1:0,endWidth=this.includeWalls?this.width+1:this.width,endHeight=this.includeWalls?this.height+1:this.height,tiles=[];for(let i=start;i<endWidth;i++)for(let j=start;j<endHeight;j++)tiles.push(_classPrivateFieldGet(this,_container).getTile(i+this.x,j+this.y));return tiles}constructor(x,y,width,height,container){_defineProperty(this,"id",0),_defineProperty(this,"x",0),_defineProperty(this,"y",0),_defineProperty(this,"width",0),_defineProperty(this,"height",0),_defineProperty(this,"theme",_themes_TileTheme__WEBPACK_IMPORTED_MODULE_0__.TILE_THEME_FOREST),_defineProperty(this,"includeWalls",!1),_container.set(this,{writable:!0,value:null}),_exitCoords.set(this,{writable:!0,value:[]}),this.id=(0,nanoid__WEBPACK_IMPORTED_MODULE_2__.nanoid)(),this.x=x,this.y=y,this.width=width,this.height=height,function(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}}(this,_container,container)}addRelativeExit(x,y){_classPrivateFieldGet(this,_container).setTileType(this.x+x,this.y+y,_TileData__WEBPACK_IMPORTED_MODULE_1__.TILE_TYPE_FLOOR),_classPrivateFieldGet(this,_exitCoords).push({x,y})}addExit(x,y){this.addRelativeExit(x-this.x,y-this.y)}cloneTo(x,y,container){const room=new RoomData(x,y,this.width,this.height,container);return room.theme=this.theme,room.includeWalls=this.includeWalls,this.relativeExits.forEach((exit=>{room.addRelativeExit(exit.x,exit.y)})),container.addRoom(room),room}containsPoint(x,y){return x<=this.right&&x>=this.left&&y<=this.bottom&&y>=this.top}intersects(left,top,right,bottom){const c1=left<this.right,c2=right>this.left,c3=top<this.bottom,c4=bottom>this.top;return c1&&c2&&c3&&c4}}},(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{nanoid:()=>nanoid,customAlphabet:()=>customAlphabet,customRandom:()=>customRandom,urlAlphabet:()=>_url_alphabet_index_js__WEBPACK_IMPORTED_MODULE_0__.urlAlphabet,random:()=>random});var _url_alphabet_index_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(281);let random=bytes=>crypto.getRandomValues(new Uint8Array(bytes)),customRandom=(alphabet,size,getRandom)=>{let mask=(2<<Math.log(alphabet.length-1)/Math.LN2)-1,step=-~(1.6*mask*size/alphabet.length);return()=>{let id="";for(;;){let bytes=getRandom(step),j=step;for(;j--;)if(id+=alphabet[bytes[j]&mask]||"",id.length===+size)return id}}},customAlphabet=(alphabet,size)=>customRandom(alphabet,size,random),nanoid=(size=21)=>{let id="",bytes=crypto.getRandomValues(new Uint8Array(size));for(;size--;){let byte=63&bytes[size];id+=byte<36?byte.toString(36):byte<62?(byte-26).toString(36).toUpperCase():byte<63?"_":"-"}return id}},(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{urlAlphabet:()=>urlAlphabet});let urlAlphabet="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW"},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>TileScheme});class TileScheme{static generate(){}static populate(){}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>SectorGenerator});var _themes_TileTheme__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(272),_TileContainer__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(278);class SectorGenerator{static generate(settings){return new _TileContainer__WEBPACK_IMPORTED_MODULE_1__.default(settings.width,settings.height)}static populate(settings,tiles){tiles.rooms.forEach((room=>{(0,_themes_TileTheme__WEBPACK_IMPORTED_MODULE_0__.getThemePopulator)(room.theme).populateRoom(room)})),tiles.getUnassignedTiles().forEach((tile=>{(0,_themes_TileTheme__WEBPACK_IMPORTED_MODULE_0__.getThemePopulator)(tile.theme).populateTile(tile)}))}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ForestGenerator:()=>ForestGenerator});var _LevelConnections__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(270),_schemes_UniformScheme__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(277),_themes_TileTheme__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(272),_SectorGenerator__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(283);class ForestGenerator extends _SectorGenerator__WEBPACK_IMPORTED_MODULE_3__.default{static generate(settings){const tiles=_schemes_UniformScheme__WEBPACK_IMPORTED_MODULE_1__.UniformScheme.generate({width:settings.width,height:settings.height,exits:settings.exits});return tiles.setTheme(_themes_TileTheme__WEBPACK_IMPORTED_MODULE_2__.TILE_THEME_FOREST),(0,_LevelConnections__WEBPACK_IMPORTED_MODULE_0__.digExits)(tiles,settings.exits),tiles}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ForestStrongholdGenerator:()=>ForestStrongholdGenerator});var _LevelConnections__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(270),_schemes_DenseCastleScheme__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(286),_schemes_UniformScheme__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(277),_themes_TileTheme__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(272),_TileContainer__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(278),_SectorGenerator__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(283);class ForestStrongholdGenerator extends _SectorGenerator__WEBPACK_IMPORTED_MODULE_5__.default{static generate(settings){const tiles=new _TileContainer__WEBPACK_IMPORTED_MODULE_4__.default(settings.width,settings.height),exitOffset=Math.ceil(2.5)-1,top=_schemes_UniformScheme__WEBPACK_IMPORTED_MODULE_2__.UniformScheme.generate({width:settings.width-5,height:5,exits:[{x:exitOffset,y:4},{x:settings.width-5-1,y:exitOffset-1},{x:16,y:4}]}),left=_schemes_UniformScheme__WEBPACK_IMPORTED_MODULE_2__.UniformScheme.generate({width:5,height:settings.height-5,exits:[{x:exitOffset,y:0},{x:4,y:settings.height-5-exitOffset-1}]}),bottom=_schemes_UniformScheme__WEBPACK_IMPORTED_MODULE_2__.UniformScheme.generate({width:settings.width-5,height:5,exits:[{x:0,y:exitOffset},{x:settings.width-5-exitOffset-1,y:0}]}),right=_schemes_UniformScheme__WEBPACK_IMPORTED_MODULE_2__.UniformScheme.generate({width:5,height:settings.height-5,exits:[{x:0,y:exitOffset-1},{x:exitOffset,y:settings.height-5-1}]}),castle=_schemes_DenseCastleScheme__WEBPACK_IMPORTED_MODULE_1__.DenseCastleScheme.generate({width:settings.width-10+2,height:settings.height-10+2,exits:[{x:12,y:0}]});return top.setTheme(_themes_TileTheme__WEBPACK_IMPORTED_MODULE_3__.TILE_THEME_FOREST),left.setTheme(_themes_TileTheme__WEBPACK_IMPORTED_MODULE_3__.TILE_THEME_FOREST),bottom.setTheme(_themes_TileTheme__WEBPACK_IMPORTED_MODULE_3__.TILE_THEME_FOREST),right.setTheme(_themes_TileTheme__WEBPACK_IMPORTED_MODULE_3__.TILE_THEME_FOREST),castle.setTheme(_themes_TileTheme__WEBPACK_IMPORTED_MODULE_3__.TILE_THEME_CASTLE),tiles.combineOther(0,0,top),tiles.combineOther(0,5,left),tiles.combineOther(5,settings.height-5,bottom),tiles.combineOther(settings.width-5,0,right),tiles.combineOther(4,4,castle),(0,_LevelConnections__WEBPACK_IMPORTED_MODULE_0__.digExits)(tiles,settings.exits),tiles}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DenseCastleScheme:()=>DenseCastleScheme});var _LevelConnections__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(270),_TileContainer__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(278),_TileData__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(271),_utils_rand__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(45),_utils_AStar__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(38),_utils_diagonalDistance__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(39),_TileScheme__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(282);let curId=1;const createNodeId=()=>curId++,splitNodeVertical=(node,cut)=>{const leftId=createNodeId(),rightId=createNodeId();return[{id:leftId,isLeaf:!0,parentId:node.id,siblingId:rightId,offsetX:node.offsetX,offsetY:node.offsetY,width:cut,height:node.height},{id:rightId,isLeaf:!0,parentId:node.id,siblingId:leftId,offsetX:node.offsetX+cut,offsetY:node.offsetY,width:node.width-cut,height:node.height}]},splitNodeHorizontal=(node,cut)=>{const topId=createNodeId(),bottomId=createNodeId();return[{id:topId,isLeaf:!0,parentId:node.id,siblingId:bottomId,offsetX:node.offsetX,offsetY:node.offsetY,width:node.width,height:cut},{id:bottomId,isLeaf:!0,parentId:node.id,siblingId:topId,offsetX:node.offsetX,offsetY:node.offsetY+cut,width:node.width,height:node.height-cut}]};class DenseCastleScheme extends _TileScheme__WEBPACK_IMPORTED_MODULE_6__.default{static generate(settings){const width=settings.width,height=settings.height,exits=settings.exits||[],minRoomWidth=settings.minRoomWidth||4,minRoomHeight=settings.minRoomHeight||4,maxRoomWidth=settings.maxRoomWidth||12,maxRoomHeight=settings.maxRoomHeight||12,splitIgnoreChance=settings.splitIgnoreChance||.8,loopiness=settings.loopiness||35,tiles=new _TileContainer__WEBPACK_IMPORTED_MODULE_1__.default(width,height);for(let i=0;i<width;i++)for(let j=0;j<height;j++)0===i||i===width-1||0===j||j===height-1?tiles.setTileType(i,j,_TileData__WEBPACK_IMPORTED_MODULE_2__.TILE_TYPE_WALL):tiles.setTileType(i,j,_TileData__WEBPACK_IMPORTED_MODULE_2__.TILE_TYPE_FLOOR);const nodes=[{isLeaf:!0,parentId:null,siblingId:null,id:createNodeId(),offsetX:0,offsetY:0,height:height-1,width:width-1}],graph=[];for(;nodes.length>0;){const node=nodes.pop();if(graph.push(node),node.width<maxRoomWidth&&node.height<maxRoomHeight){if(Math.random()<splitIgnoreChance)continue}const directions=[];if(node.width-minRoomWidth-1>minRoomWidth&&directions.push(0),node.height-minRoomHeight-1>minRoomHeight&&directions.push(1),directions.length<=0)continue;if(0===(0,_utils_rand__WEBPACK_IMPORTED_MODULE_3__.pickRandom)(directions)){const cut=(0,_utils_rand__WEBPACK_IMPORTED_MODULE_3__.randomInt)(minRoomWidth+1,node.width-minRoomWidth-1);nodes.push(...splitNodeVertical(node,cut))}else{const cut=(0,_utils_rand__WEBPACK_IMPORTED_MODULE_3__.randomInt)(minRoomHeight+1,node.height-minRoomHeight-1);nodes.push(...splitNodeHorizontal(node,cut))}node.isLeaf=!1}graph.forEach((node=>{if(null!==node.parentId)if(node.isLeaf){tiles.createRoom(node.offsetX+1,node.offsetY+1,node.width-1,node.height-1).includeWalls=!0;for(let i=0;i<node.width;i++)tiles.setTileType(node.offsetX+i,node.offsetY,_TileData__WEBPACK_IMPORTED_MODULE_2__.TILE_TYPE_WALL);for(let j=0;j<node.height;j++)tiles.setTileType(node.offsetX,node.offsetY+j,_TileData__WEBPACK_IMPORTED_MODULE_2__.TILE_TYPE_WALL)}else;})),graph.forEach((node=>{if(null===node.parentId)return;const sibling=graph.find((n=>n.id===node.siblingId));let doorCandidates=[],hasSib=!1;if(sibling.offsetX<node.offsetX){hasSib=!0;for(let i=1;i<node.height;i++){const x=node.offsetX,y=node.offsetY+i,tile=tiles.getTile(x,y);tiles.tileTypeMatches(x-1,y,_TileData__WEBPACK_IMPORTED_MODULE_2__.TILE_TYPE_FLOOR)&&tiles.tileTypeMatches(x+1,y,_TileData__WEBPACK_IMPORTED_MODULE_2__.TILE_TYPE_FLOOR)&&doorCandidates.push(tile)}}else if(sibling.offsetY<node.offsetY){hasSib=!0;for(let i=1;i<node.width;i++){const x=node.offsetX+i,y=node.offsetY,tile=tiles.getTile(x,y);tiles.tileTypeMatches(x,y-1,_TileData__WEBPACK_IMPORTED_MODULE_2__.TILE_TYPE_FLOOR)&&tiles.tileTypeMatches(x,y+1,_TileData__WEBPACK_IMPORTED_MODULE_2__.TILE_TYPE_FLOOR)&&doorCandidates.push(tile)}}const door=(0,_utils_rand__WEBPACK_IMPORTED_MODULE_3__.pickRandom)(doorCandidates);if(hasSib&&!door&&console.warn("cannot make door!?",node,node.width,node.height),door){const room=tiles.getRoomForTile(door.x,door.y);room&&room.addExit(door.x,door.y),tiles.setTileType(door.x,door.y,_TileData__WEBPACK_IMPORTED_MODULE_2__.TILE_TYPE_FLOOR)}}));const cost=(a,b)=>tiles.tileTypeMatches(b.x,b.y,_TileData__WEBPACK_IMPORTED_MODULE_2__.TILE_TYPE_FLOOR)?(0,_utils_diagonalDistance__WEBPACK_IMPORTED_MODULE_5__.diagonalDistance)(a,b):1/0,tryAddLoop=(a,b)=>{if(a.isType(_TileData__WEBPACK_IMPORTED_MODULE_2__.TILE_TYPE_FLOOR)&&b.isType(_TileData__WEBPACK_IMPORTED_MODULE_2__.TILE_TYPE_FLOOR)){const start={x:b.x,y:b.y},goal={x:a.x,y:a.y},path=(0,_utils_AStar__WEBPACK_IMPORTED_MODULE_4__.computeAStar)({start,goal,cost});if(path.success&&path.cost>=loopiness)return!0}return!1};return tiles.data.filter((tile=>tile.isType(_TileData__WEBPACK_IMPORTED_MODULE_2__.TILE_TYPE_WALL))).forEach((tile=>{const north=tiles.getTile(tile.x,tile.y-1),south=tiles.getTile(tile.x,tile.y+1);if(tryAddLoop(north,south)){tiles.setTileType(tile.x,tile.y,_TileData__WEBPACK_IMPORTED_MODULE_2__.TILE_TYPE_FLOOR);const room=tiles.getRoomForTile(tile.x,tile.y);return void(room&&room.addExit(tile.x,tile.y))}const east=tiles.getTile(tile.x-1,tile.y),west=tiles.getTile(tile.x+1,tile.y);if(tryAddLoop(east,west)){tiles.setTileType(tile.x,tile.y,_TileData__WEBPACK_IMPORTED_MODULE_2__.TILE_TYPE_FLOOR);const room=tiles.getRoomForTile(tile.x,tile.y);room&&room.addExit(tile.x,tile.y)}else;})),(0,_LevelConnections__WEBPACK_IMPORTED_MODULE_0__.digExits)(tiles,exits),tiles}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ForestTownGenerator:()=>ForestTownGenerator});var _core_Game__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_data_Spawnables__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(26),_data_Spawner__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(27),_utils_AStar__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(38),_utils_ManhattanDistance__WEBPACK_IMPORTED_MODULE_5__=(__webpack_require__(39),__webpack_require__(40)),_utils_rand__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(45),_LevelConnections__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(270),_schemes_ScatteredScheme__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(288),_themes_TileTheme__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(272),_TileData__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(271),_GeneratorUtils__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(289),_SectorGenerator__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(283);class ForestTownGenerator extends _SectorGenerator__WEBPACK_IMPORTED_MODULE_12__.default{static generate(settings){const tiles=_schemes_ScatteredScheme__WEBPACK_IMPORTED_MODULE_8__.ScatteredScheme.generate({width:settings.width,height:settings.height,exits:settings.exits});tiles.setTheme(_themes_TileTheme__WEBPACK_IMPORTED_MODULE_9__.TILE_THEME_CABIN);return tiles.rooms.forEach((room=>{const edges=room.borderTiles.filter((t=>!(((t,room)=>t.x===room.left&&t.y===room.top)(t,room)||((t,room)=>t.x===room.left&&t.y===room.bottom-1)(t,room)||((t,room)=>t.x===room.right-1&&t.y===room.bottom-1)(t,room)||((t,room)=>t.x===room.right-1&&t.y===room.top)(t,room)))),door=(0,_utils_rand__WEBPACK_IMPORTED_MODULE_6__.pickRandom)(edges);door&&room.addExit(door.x,door.y)})),tiles.getUnassignedTiles().forEach((tile=>{tile.theme=_themes_TileTheme__WEBPACK_IMPORTED_MODULE_9__.TILE_THEME_FOREST})),(0,_GeneratorUtils__WEBPACK_IMPORTED_MODULE_11__.addBorder)(tiles),(0,_LevelConnections__WEBPACK_IMPORTED_MODULE_7__.digExits)(tiles,settings.exits),tiles}static populate(settings,tiles){tiles.rooms.forEach((room=>{(0,_themes_TileTheme__WEBPACK_IMPORTED_MODULE_9__.getThemePopulator)(room.theme).populateRoom(room)}));const doors=tiles.rooms.map((room=>room.exits)).flat(),walkways=new Set,generatePath=(start,end)=>{const path=(0,_utils_AStar__WEBPACK_IMPORTED_MODULE_3__.computeAStar)({allowDiagonals:!1,start:{x:start.x,y:start.y},goal:{x:end.x,y:end.y},cost:(a,b)=>{if(tiles.tileTypeMatches(b.x,b.y,_TileData__WEBPACK_IMPORTED_MODULE_10__.TILE_TYPE_WALL))return 1/0;const walls=tiles.getNeighbors(b.x,b.y).filter((n=>n.isType(_TileData__WEBPACK_IMPORTED_MODULE_10__.TILE_TYPE_WALL)));return walls.length>0?2*walls.length:walkways.has("".concat(b.x,",").concat(b.y))?.1:2*(0,_utils_ManhattanDistance__WEBPACK_IMPORTED_MODULE_5__.manhattanDistance)(a,b)}});var result;(result=path).success&&result.path.forEach((segment=>{_core_Game__WEBPACK_IMPORTED_MODULE_0__.game.map.getEntitiesAt(segment.x,segment.y).length>0||((0,_data_Spawner__WEBPACK_IMPORTED_MODULE_2__.spawn)(_data_Spawnables__WEBPACK_IMPORTED_MODULE_1__.SPWN_DIRT_PATH,segment.x,segment.y),walkways.add("".concat(segment.x,",").concat(segment.y)))}))};doors.forEach((doorA=>{settings.exits.forEach((exit=>{generatePath(doorA,exit)})),doors.forEach((doorB=>{doorA!==doorB&&generatePath(doorA,doorB)}))})),tiles.getUnassignedTiles().forEach((tile=>{(0,_themes_TileTheme__WEBPACK_IMPORTED_MODULE_9__.getThemePopulator)(tile.theme).populateTile(tile)}))}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ScatteredScheme:()=>ScatteredScheme});var _utils_rand__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(45),_LevelConnections__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(270),_TileContainer__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(278),_TileData__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(271),_TileScheme__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(282);class ScatteredScheme extends _TileScheme__WEBPACK_IMPORTED_MODULE_4__.default{static generate(settings){const attempt=settings.attempt||1,maxAttempts=settings.maxAttempts||100,width=settings.width,height=settings.height,padding=settings.padding||3,roomPadding=settings.roomPadding||3,minCount=settings.minCount||5,maxCount=settings.maxCount||8,minWidth=settings.minWidth||6,maxWidth=settings.maxWidth||10,minHeight=settings.minHeight||6,maxHeight=settings.maxHeight||10,exits=settings.exits||[],tiles=new _TileContainer__WEBPACK_IMPORTED_MODULE_2__.default(width,height);if(attempt>maxAttempts)return console.warn("Failed to generate ScatteredScheme in ".concat(maxAttempts," attempts")),tiles;const createBox=()=>{const width=(0,_utils_rand__WEBPACK_IMPORTED_MODULE_0__.randomInt)(minWidth,maxWidth),height=(0,_utils_rand__WEBPACK_IMPORTED_MODULE_0__.randomInt)(minHeight,maxHeight);return{x:(0,_utils_rand__WEBPACK_IMPORTED_MODULE_0__.randomInt)(padding,settings.width-padding-width),y:(0,_utils_rand__WEBPACK_IMPORTED_MODULE_0__.randomInt)(padding,settings.height-padding-height),width,height,get top(){return this.y-roomPadding},get bottom(){return this.y+this.height+roomPadding},get left(){return this.x-roomPadding},get right(){return this.x+this.width+roomPadding}}},overlaps=box=>tiles.rooms.some((room=>room.intersects(box.left,box.top,box.right,box.bottom)));for(let i=0;i<100;i++){const box=createBox();if(!overlaps(box)){for(let i=0;i<box.width;i++)for(let j=0;j<box.height;j++){const point={x:box.x+i,y:box.y+j};0===i||i===box.width-1||0===j||j===box.height-1?tiles.setTileType(point.x,point.y,_TileData__WEBPACK_IMPORTED_MODULE_3__.TILE_TYPE_WALL):tiles.setTileType(point.x,point.y,_TileData__WEBPACK_IMPORTED_MODULE_3__.TILE_TYPE_FLOOR)}if(tiles.createRoom(box.x,box.y,box.width,box.height),tiles.rooms.length>=maxCount)break}}return tiles.rooms.length<minCount?this.generate({...settings,attempt:attempt+1}):((0,_LevelConnections__WEBPACK_IMPORTED_MODULE_1__.digExits)(tiles,exits),tiles)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{addBorder:()=>addBorder});var _TileData__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(271);const addBorder=tiles=>{for(let i=0;i<tiles.width;i++)tiles.setTileType(i,0,_TileData__WEBPACK_IMPORTED_MODULE_0__.TILE_TYPE_WALL),tiles.setTileType(i,tiles.height-1,_TileData__WEBPACK_IMPORTED_MODULE_0__.TILE_TYPE_WALL);for(let j=1;j<tiles.height-1;j++)tiles.setTileType(0,j,_TileData__WEBPACK_IMPORTED_MODULE_0__.TILE_TYPE_WALL),tiles.setTileType(tiles.width-1,j,_TileData__WEBPACK_IMPORTED_MODULE_0__.TILE_TYPE_WALL)}},module=>{"use strict";module.exports=JSON.parse('{"width":3,"height":3,"sectors":[[{"music":"FOREST","temperature":{"ambient":18,"capacity":0.16},"generator":{"type":"FOREST"},"connectionsNorth":[],"connectionsWest":[]},{"music":"FOREST","temperature":{"ambient":18,"capacity":0.16},"generator":{"type":"FOREST_CABINS"},"connectionsNorth":[],"connectionsWest":[{"type":"path"}]},{"music":"FOREST","temperature":{"ambient":18,"capacity":0.16},"generator":{"type":"FOREST_STRONGHOLD"},"connectionsNorth":[],"connectionsWest":[{"type":"path"}]}],[{"music":"FOREST","temperature":{"ambient":18,"capacity":0.16},"generator":{"type":"FOREST_STRONGHOLD"},"connectionsNorth":[],"connectionsWest":[]},{"music":"FOREST_VILLAGE","temperature":{"ambient":18,"capacity":0.16},"generator":{"type":"FOREST_TOWN"},"connectionsNorth":[{"type":"path"}],"connectionsWest":[{"type":"path"}]},{"music":"FOREST","temperature":{"ambient":18,"capacity":0.16},"generator":{"type":"FOREST_CABINS"},"connectionsNorth":[{"type":"path"}],"connectionsWest":[{"type":"path"}]}],[{"music":"FOREST","temperature":{"ambient":18,"capacity":0.16},"generator":{"type":"FOREST"},"connectionsNorth":[{"type":"path"}],"connectionsWest":[]},{"music":"FOREST","temperature":{"ambient":18,"capacity":0.16},"generator":{"type":"FOREST_STRONGHOLD"},"connectionsNorth":[{"type":"path"}],"connectionsWest":[{"type":"path"}]},{"music":"FOREST","temperature":{"ambient":18,"capacity":0.16},"generator":{"type":"FOREST"},"connectionsNorth":[{"type":"path"}],"connectionsWest":[]}]]}')},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>ConsoleManager});var _enums_ConsoleEvents__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(72),_Manager__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(5);function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}var _messages=new WeakMap,_events=new WeakMap,_viewCount=new WeakMap;class ConsoleManager extends _Manager__WEBPACK_IMPORTED_MODULE_1__.default{constructor(...args){super(...args),_messages.set(this,{writable:!0,value:[]}),_events.set(this,{writable:!0,value:[]}),_viewCount.set(this,{writable:!0,value:4})}event(type,data){_classPrivateFieldGet(this,_events).push({type,data})}log(text){_classPrivateFieldGet(this,_messages).push({text})}render(dt){_classPrivateFieldGet(this,_events).forEach((({type,data})=>{(0,_enums_ConsoleEvents__WEBPACK_IMPORTED_MODULE_0__.shouldAppear)(type,data)&&_classPrivateFieldGet(this,_messages).push({text:(0,_enums_ConsoleEvents__WEBPACK_IMPORTED_MODULE_0__.getMessage)(type,data)})})),function(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}}(this,_events,[]);const msgs=_classPrivateFieldGet(this,_messages).slice(Math.max(_classPrivateFieldGet(this,_messages).length-_classPrivateFieldGet(this,_viewCount),0)),height=Math.min(msgs.length,_classPrivateFieldGet(this,_viewCount));msgs.forEach(((message,i)=>{this.game.renderer.drawText(0,this.game.camera.height-(height-i),message.text)}))}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>DestroySystem});var _ecs_components__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(21),_System__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(138);var _query=new WeakMap;class DestroySystem extends _System__WEBPACK_IMPORTED_MODULE_1__.default{constructor(game){super(game),_query.set(this,{writable:!0,value:void 0}),function(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}}(this,_query,game.ecs.createQuery({all:[_ecs_components__WEBPACK_IMPORTED_MODULE_0__.IsDestroying]}))}update(dt){(function(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value})(this,_query).get().forEach((entity=>{entity.isDestroying.pass>0?entity.destroy():entity.isDestroying.pass++}))}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>MusicManager});var howler__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_Manager__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(5),_data_music_json__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(294);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class Track{constructor(path,data){_defineProperty(this,"isPlaying",!1),_defineProperty(this,"isIntro",!1),_defineProperty(this,"howl",null),this.name=data.name,this.loop=new howler__WEBPACK_IMPORTED_MODULE_0__.Howl({loop:!0,src:["".concat(path).concat(data.loop)]}),data.intro&&(this.intro=new howler__WEBPACK_IMPORTED_MODULE_0__.Howl({loop:!1,src:["".concat(path).concat(data.intro)]}),this.intro.on("end",(()=>{this.isPlaying?(this.howl=this.loop,this.loop.seek(0),this.loop.volume(1),this.loop.play()):(this.intro.stop(),this.loop.stop())})))}play(){this.isPlaying||(this.intro?(this.howl=this.intro,this.intro.seek(0),this.intro.play(),this.intro.fade(0,1,5e3),this.loop.stop()):(this.howl=this.loop,this.loop.seek(0),this.loop.play(),this.loop.fade(0,1,5e3)),this.isPlaying=!0)}stop(){this.howl&&this.howl.fade(1,0,500),this.isPlaying=!1}}class MusicManager extends _Manager__WEBPACK_IMPORTED_MODULE_1__.default{constructor(game){super(game),_defineProperty(this,"tracks",{}),_defineProperty(this,"currentTrack",null);const path="".concat(window.location.protocol,"//").concat(window.location.host).concat(window.location.pathname).concat(_data_music_json__WEBPACK_IMPORTED_MODULE_2__.path);_data_music_json__WEBPACK_IMPORTED_MODULE_2__.tracks.forEach((data=>{const track=new Track(path,data);this.tracks[data.key]=track}))}play(key){key!==this.currentTrack&&(this.currentTrack&&this.tracks[this.currentTrack].stop(),this.tracks[key].play(),this.currentTrack=key)}stop(){this.currentTrack&&this.tracks[this.currentTrack].stop()}onSectorLoaded(sector){this.play(sector.music)}}},module=>{"use strict";module.exports=JSON.parse('{"path":"/resources/music/","tracks":[{"name":"Bards Tale","key":"BARDS_TALE","loop":"menu.wav"},{"name":"Hello New York","key":"FOREST_VILLAGE","intro":"village_intro.wav","loop":"village_loop.wav"},{"name":"Intrigue Awaits","key":"FOREST","intro":"forest_intro.wav","loop":"forest_loop.wav"}]}')},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>StatusSystem});var _data_Statuses__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(109),_ecs_components__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(21),_System__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(138);class StatusSystem extends _System__WEBPACK_IMPORTED_MODULE_2__.default{constructor(game){super(game),this.query=this.game.ecs.createQuery({all:[_ecs_components__WEBPACK_IMPORTED_MODULE_1__.Status]})}update(dt){if(!this.game.clock.tickDelta)return;const delta=this.game.clock.tickDelta;this.query.get().forEach((entity=>{entity.status.forEach((status=>{(0,_data_Statuses__WEBPACK_IMPORTED_MODULE_0__.getStatus)(status.key).update(delta,entity,status),status.isCompleted()&&status.destroy()}))}))}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>LiquidSystem});var _ecs_components__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(21),_System__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(138);class LiquidSystem extends _System__WEBPACK_IMPORTED_MODULE_1__.default{constructor(game){super(game),this.query=this.game.ecs.createQuery({all:[_ecs_components__WEBPACK_IMPORTED_MODULE_0__.LiquidContainer,_ecs_components__WEBPACK_IMPORTED_MODULE_0__.Position],none:[_ecs_components__WEBPACK_IMPORTED_MODULE_0__.IsInventoried,_ecs_components__WEBPACK_IMPORTED_MODULE_0__.IsDestroying]})}update(dt){if(!this.game.clock.tickDelta)return;Array.from(this.query.get()).reduce(((rv,pool)=>{const container=pool.liquidContainer;if(!container.isFreeFlowing)return rv;const pos=pool.position.getPos(),liquid=container.content,key="".concat(pos.x,",").concat(pos.y,",").concat(liquid);return rv[key]?rv[key].combineFrom(container):rv[key]=container,rv}),{})}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>TrapSystem});var _data_Statuses__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(109),_ecs_components__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(21),_enums_ConsoleEvents__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(72),_System__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(138);class TrapSystem extends _System__WEBPACK_IMPORTED_MODULE_3__.default{constructor(game){super(game),this.sharpTrapQuery=this.game.ecs.createQuery({all:[_ecs_components__WEBPACK_IMPORTED_MODULE_1__.SharpTrap,_ecs_components__WEBPACK_IMPORTED_MODULE_1__.Position],none:[_ecs_components__WEBPACK_IMPORTED_MODULE_1__.IsInventoried,_ecs_components__WEBPACK_IMPORTED_MODULE_1__.IsDestroying]})}update(dt){this.game.clock.turnDelta&&this.sharpTrapQuery.get().forEach((trapEntity=>{const pos=trapEntity.position.getPos();this.game.map.getEntitiesAt(pos.x,pos.y).forEach((entity=>{if(entity.id!==trapEntity.id&&entity.stats){trapEntity.sharpTrap.test(entity)||((0,_data_Statuses__WEBPACK_IMPORTED_MODULE_0__.addStatus)(_data_Statuses__WEBPACK_IMPORTED_MODULE_0__.STATUS_BLEEDING,entity),this.game.console.event(_enums_ConsoleEvents__WEBPACK_IMPORTED_MODULE_2__.CONSOLE_EVENT_TRAP_SHARP,{trap:trapEntity,entity}))}}))}))}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>FireSystem});var _data_Spawner__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(27),_ecs_components__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(21),_utils_rand__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(45),_System__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(138);class FireSystem extends _System__WEBPACK_IMPORTED_MODULE_3__.default{constructor(game){super(game),this.query=this.game.ecs.createQuery({all:[_ecs_components__WEBPACK_IMPORTED_MODULE_1__.Fire,_ecs_components__WEBPACK_IMPORTED_MODULE_1__.Combustible,_ecs_components__WEBPACK_IMPORTED_MODULE_1__.Position],none:[_ecs_components__WEBPACK_IMPORTED_MODULE_1__.IsInventoried,_ecs_components__WEBPACK_IMPORTED_MODULE_1__.IsDestroying]})}update(dt){this.game.clock.turnDelta&&this.query.get().forEach((entity=>{const pos=entity.position.getPos(),combustible=entity.combustible;let temperature=this.game.temperature.getTemperature(pos.x,pos.y);combustible.fuel-=combustible.burnRate,temperature+=combustible.burnRate,this.game.temperature.setTemperature(pos.x,pos.y,temperature);const sparkChance=combustible.getSparkChance(),dieChance=combustible.getDieOutChance();this.game.map.getNeighborEntities(pos.x,pos.y).flat().filter((e=>e.combustible)).forEach((neighbor=>{(0,_utils_rand__WEBPACK_IMPORTED_MODULE_2__.randomWeightedBool)(sparkChance)&&neighbor.fireEvent("spark",{intensity:entity.fire.intensity-1})})),combustible.isOutOfFuel?(entity.add(_ecs_components__WEBPACK_IMPORTED_MODULE_1__.IsDestroying),combustible.spawnableRemains&&(0,_data_Spawner__WEBPACK_IMPORTED_MODULE_0__.spawn)(combustible.spawnableRemains,pos.x,pos.y)):(0,_utils_rand__WEBPACK_IMPORTED_MODULE_2__.randomWeightedBool)(dieChance)?(entity.fire.extinguish(),this.game.particles.createParticle(pos.x,pos.y,{lifetime:1e3,fg1s:["yellow","red"],glyphs:[".","↑","^"]})):this.game.particles.createParticle(pos.x,pos.y,{lifetime:1e3,fg1s:["yellow","red"],glyphs:[".","↑","^"]})}))}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>TemperatureSystem});var _utils_ArrayUtil__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(300),_utils_LerpUtil__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(301),_utils_MemoryGrid__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(302),_System__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(138);class TemperatureSystem extends _System__WEBPACK_IMPORTED_MODULE_3__.default{get width(){return this.game.map.width}get height(){return this.game.map.height}constructor(game){var obj,key,value;super(game),value=void 0,(key="data")in(obj=this)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,this.grid=new _utils_MemoryGrid__WEBPACK_IMPORTED_MODULE_2__.default(this.width,this.height)}teardown(){this.grid.clear()}getAmbientTemperature(){return this.game.world.sector.temperature.ambient}getAmbientCapacity(){return this.game.world.sector.temperature.capacity}getSaveGameData(){const data=this.grid.serialize();this.game.state.saveSectorTemperatureData(this.game.world.sectorId,data)}onSectorLoaded(sector){const data=this.game.state.loadSectorTemperatureData(sector.id);data?this.grid.deserialize(data):(this.grid.defaultValueGenerator=()=>sector.temperature.ambient,this.grid.previous.defaultValueGenerator=()=>sector.temperature.ambient,this.grid.setAll(sector.temperature.ambient))}setTemperature(x,y,value){this.grid.set(x,y,value)}getTemperature(x,y){return this.grid.get(x,y)}getCapacity(x,y){let hasCap=!1,hasFire=!1;const capacity=this.game.map.getEntitiesAt(x,y).reduce(((cap,e)=>e.fire?(hasFire=!0,0):e.thermalCapacity?(hasCap=!0,cap+e.thermalCapacity.value):cap),0);return hasFire?0:hasCap?capacity:this.getAmbientCapacity()}update(dt){if(!this.game.clock.tickDelta)return;this.grid.copyToPrevious();const ambient=this.getAmbientTemperature();for(let x=0;x<this.width;x++)for(let y=0;y<this.height;y++){const previous=this.grid.previous.get(x,y),cells=this.grid.previous.getNeighbors(x,y);cells.push(ambient),cells.push(previous);const avg=(0,_utils_ArrayUtil__WEBPACK_IMPORTED_MODULE_0__.avgArray)(cells);if(Math.abs(previous-avg)<.01)continue;const capacity=this.getCapacity(x,y),t=(0,_utils_LerpUtil__WEBPACK_IMPORTED_MODULE_1__.lerp)(previous,avg,capacity);this.grid.set(x,y,t)}}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{sumArray:()=>sumArray,avgArray:()=>avgArray});const sumArray=(arr=[])=>arr.reduce(((sum,val)=>sum+val),0),avgArray=(arr=[])=>sumArray(arr)/arr.length},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{lerp:()=>lerp,lerp2:()=>lerp2});const lerp=(f0,f1,t)=>(1-t)*f0+t*f1,lerp2=(v1,v2,t)=>({x:lerp(v1.x,v2.x,t),y:lerp(v2.y,v2.x,t)});window.lerp=lerp},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>MemoryGrid});var _Grid__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7);class MemoryGrid extends _Grid__WEBPACK_IMPORTED_MODULE_0__.default{get width(){return this._width}get height(){return this._height}constructor(width,height,defaultValueGenerator=(()=>null)){super(width,height,defaultValueGenerator),this.previous=new _Grid__WEBPACK_IMPORTED_MODULE_0__.default(width,height,defaultValueGenerator)}copyToPrevious(){this.previous._width=this._width,this.previous._height=this._height,this.previous.data=[...this.data]}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>AbilitySystem});var _ecs_components__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(21),_ecs_components_AbilityStatus__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(131),_System__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(138);class AbilitySystem extends _System__WEBPACK_IMPORTED_MODULE_2__.default{constructor(game){super(game),this.query=this.game.ecs.createQuery({all:[_ecs_components_AbilityStatus__WEBPACK_IMPORTED_MODULE_1__.AbilityStatus],none:[_ecs_components__WEBPACK_IMPORTED_MODULE_0__.IsDestroying]})}update(dt){const delta=this.game.clock.tickDelta;delta&&this.query.get().forEach((entity=>{Object.values(entity.abilityStatus).forEach((status=>{status.ability.updateAbilityStatus(delta,status)}))}))}}}],__webpack_module_cache__={};function __webpack_require__(moduleId){if(__webpack_module_cache__[moduleId])return __webpack_module_cache__[moduleId].exports;var module=__webpack_module_cache__[moduleId]={exports:{}};return __webpack_modules__[moduleId](module,module.exports,__webpack_require__),module.exports}__webpack_require__.n=module=>{var getter=module&&module.__esModule?()=>module.default:()=>module;return __webpack_require__.d(getter,{a:getter}),getter},getProto=Object.getPrototypeOf?obj=>Object.getPrototypeOf(obj):obj=>obj.__proto__,__webpack_require__.t=function(value,mode){if(1&mode&&(value=this(value)),8&mode)return value;if("object"==typeof value&&value){if(4&mode&&value.__esModule)return value;if(16&mode&&"function"==typeof value.then)return value}var ns=Object.create(null);__webpack_require__.r(ns);var def={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var current=2&mode&&value;"object"==typeof current&&!~leafPrototypes.indexOf(current);current=getProto(current))Object.getOwnPropertyNames(current).forEach((key=>def[key]=()=>value[key]));return def.default=()=>value,__webpack_require__.d(ns,def),ns},__webpack_require__.d=(exports,definition)=>{for(var key in definition)__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports,key)&&Object.defineProperty(exports,key,{enumerable:!0,get:definition[key]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(obj,prop)=>Object.prototype.hasOwnProperty.call(obj,prop),__webpack_require__.r=exports=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__(0)})();
//# sourceMappingURL=main.edd541bc3676718c6b61.js.map